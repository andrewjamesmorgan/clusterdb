<!DOCTYPE html>
<!-- HTML 5 --><html lang="en-US">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<link rel="pingback" href="./../xmlrpc.php">
	
	<title>SwiftUI | Andrew Morgan on Databases</title>

<meta name="robots" content="max-image-preview:large">
	<style>img:is([sizes="auto" i], [sizes^="auto," i]) { contain-intrinsic-size: 3000px 1500px }</style>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="alternate" type="application/rss+xml" title="Andrew Morgan on Databases &raquo; Feed" href="./../feed/index.html">
<link rel="alternate" type="application/rss+xml" title="Andrew Morgan on Databases &raquo; Comments Feed" href="./../comments/feed/index.html">
<link rel="alternate" type="application/rss+xml" title="Andrew Morgan on Databases &raquo; SwiftUI Tag Feed" href="./feed/index.html">
		<!-- This site uses the Google Analytics by MonsterInsights plugin v9.2.2 - Using Analytics tracking - https://www.monsterinsights.com/ -->
		<!-- Note: MonsterInsights is not currently configured on this site. The site owner needs to authenticate with Google Analytics in the MonsterInsights settings panel. -->
					<!-- No tracking code set -->
				<!-- / Google Analytics by MonsterInsights -->
		<script type="text/javascript">
/* <![CDATA[ */
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/www.clusterdb.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=81fb77f64976ac32efe42aab69fdb5e4"}};
/*! This file is auto-generated */
!function(i,n){var o,s,e;function c(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function p(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data),r=(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0),new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data));return t.every(function(e,t){return e===r[t]})}function u(e,t,n){switch(t){case"flag":return n(e,"ðŸ³ï¸â€âš§ï¸","ðŸ³ï¸â€‹âš§ï¸")?!1:!n(e,"ðŸ‡ºðŸ‡³","ðŸ‡ºâ€‹ðŸ‡³")&&!n(e,"ðŸ´ó §ó ¢ó ¥ó ®ó §ó ¿","ðŸ´â€‹ó §â€‹ó ¢â€‹ó ¥â€‹ó ®â€‹ó §â€‹ó ¿");case"emoji":return!n(e,"ðŸ¦â€â¬›","ðŸ¦â€‹â¬›")}return!1}function f(e,t,n){var r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):i.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0}),o=(a.textBaseline="top",a.font="600 32px Arial",{});return e.forEach(function(e){o[e]=t(a,e,n)}),o}function t(e){var t=i.createElement("script");t.src=e,t.defer=!0,i.head.appendChild(t)}"undefined"!=typeof Promise&&(o="wpEmojiSettingsSupports",s=["flag","emoji"],n.supports={everything:!0,everythingExceptFlag:!0},e=new Promise(function(e){i.addEventListener("DOMContentLoaded",e,{once:!0})}),new Promise(function(t){var n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),p.toString()].join(",")+"));",r=new Blob([e],{type:"text/javascript"}),a=new Worker(URL.createObjectURL(r),{name:"wpTestEmojiSupports"});return void(a.onmessage=function(e){c(n=e.data),a.terminate(),t(n)})}catch(e){}c(n=f(s,u,p))}t(n)}).then(function(e){for(var t in e)n.supports[t]=e[t],n.supports.everything=n.supports.everything&&n.supports[t],"flag"!==t&&(n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&n.supports[t]);n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&!n.supports.flag,n.DOMReady=!1,n.readyCallback=function(){n.DOMReady=!0}}).then(function(){return e}).then(function(){var e;n.supports.everything||(n.readyCallback(),(e=n.source||{}).concatemoji?t(e.concatemoji):e.wpemoji&&e.twemoji&&(t(e.twemoji),t(e.wpemoji)))}))}((window,document),window._wpemojiSettings);
/* ]]> */
</script>
<style id="wp-emoji-styles-inline-css" type="text/css">img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}</style>
<link rel="stylesheet" id="wp-block-library-css" href="./../wp-includes/css/dist/block-library/style.min.css?ver=81fb77f64976ac32efe42aab69fdb5e4" type="text/css" media="all">
<style id="classic-theme-styles-inline-css" type="text/css">/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}</style>
<style id="global-styles-inline-css" type="text/css">:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
:root :where(.wp-block-pullquote){font-size: 1.5em;line-height: 1.6;}</style>
<link rel="stylesheet" id="plyr-css-css" href="./../wp-content/plugins/easy-video-player/lib/plyr.css?ver=81fb77f64976ac32efe42aab69fdb5e4" type="text/css" media="all">
<link rel="stylesheet" id="zeeSynergie_stylesheet-css" href="./../wp-content/themes/zeesynergie/style.css?ver=81fb77f64976ac32efe42aab69fdb5e4" type="text/css" media="all">
<link rel="stylesheet" id="zeeSynergie_colorscheme-css" href="./../wp-content/themes/zeesynergie/includes/css/colorschemes/blue.css?ver=81fb77f64976ac32efe42aab69fdb5e4" type="text/css" media="all">
<link rel="stylesheet" id="themezee_default_font-css" href="http://fonts.googleapis.com/css?family=Paytone+One&#038;ver=81fb77f64976ac32efe42aab69fdb5e4" type="text/css" media="all">
<script type="text/javascript" src="./../wp-content/plugins/easy-video-player/lib/plyr.min.js?ver=81fb77f64976ac32efe42aab69fdb5e4" id="plyr-js-js"></script>
<script type="text/javascript" src="./../wp-includes/js/jquery/jquery.min.js?ver=3.7.1" id="jquery-core-js"></script>
<script type="text/javascript" src="./../wp-includes/js/jquery/jquery-migrate.min.js?ver=3.4.1" id="jquery-migrate-js"></script>
<script type="text/javascript" src="./../wp-content/themes/zeesynergie/includes/js/jquery.cycle.all.min.js?ver=81fb77f64976ac32efe42aab69fdb5e4" id="zee_jquery-cycle-js"></script>
<link rel="https://api.w.org/" href="./../wp-json/index.html">
<link rel="alternate" title="JSON" type="application/json" href="./../wp-json/wp/v2/tags/217/index.html">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="./../xmlrpc.php?rsd">

<style data-context="foundation-flickity-css">/*! Flickity v2.0.2
http://flickity.metafizzy.co
---------------------------------------------- */.flickity-enabled{position:relative}.flickity-enabled:focus{outline:0}.flickity-viewport{overflow:hidden;position:relative;height:100%}.flickity-slider{position:absolute;width:100%;height:100%}.flickity-enabled.is-draggable{-webkit-tap-highlight-color:transparent;tap-highlight-color:transparent;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.flickity-enabled.is-draggable .flickity-viewport{cursor:move;cursor:-webkit-grab;cursor:grab}.flickity-enabled.is-draggable .flickity-viewport.is-pointer-down{cursor:-webkit-grabbing;cursor:grabbing}.flickity-prev-next-button{position:absolute;top:50%;width:44px;height:44px;border:none;border-radius:50%;background:#fff;background:hsla(0,0%,100%,.75);cursor:pointer;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.flickity-prev-next-button:hover{background:#fff}.flickity-prev-next-button:focus{outline:0;box-shadow:0 0 0 5px #09f}.flickity-prev-next-button:active{opacity:.6}.flickity-prev-next-button.previous{left:10px}.flickity-prev-next-button.next{right:10px}.flickity-rtl .flickity-prev-next-button.previous{left:auto;right:10px}.flickity-rtl .flickity-prev-next-button.next{right:auto;left:10px}.flickity-prev-next-button:disabled{opacity:.3;cursor:auto}.flickity-prev-next-button svg{position:absolute;left:20%;top:20%;width:60%;height:60%}.flickity-prev-next-button .arrow{fill:#333}.flickity-page-dots{position:absolute;width:100%;bottom:-25px;padding:0;margin:0;list-style:none;text-align:center;line-height:1}.flickity-rtl .flickity-page-dots{direction:rtl}.flickity-page-dots .dot{display:inline-block;width:10px;height:10px;margin:0 8px;background:#333;border-radius:50%;opacity:.25;cursor:pointer}.flickity-page-dots .dot.is-selected{opacity:1}</style>
<style data-context="foundation-slideout-css">.slideout-menu{position:fixed;left:0;top:0;bottom:0;right:auto;z-index:0;width:256px;overflow-y:auto;-webkit-overflow-scrolling:touch;display:none}.slideout-menu.pushit-right{left:auto;right:0}.slideout-panel{position:relative;z-index:1;will-change:transform}.slideout-open,.slideout-open .slideout-panel,.slideout-open body{overflow:hidden}.slideout-open .slideout-menu{display:block}.pushit{display:none}</style>
<script type="text/javascript">
				//<![CDATA[
					jQuery(document).ready(function($) {
						$('#nav ul').css({display: 'none'}); // Opera Fix
						$('#nav li').hover(function(){
							$(this).find('ul:first').css({visibility: 'visible',display: 'none'}).show().css({opacity:0}).animate({opacity:1},400);
						},function(){
							$(this).find('ul:first').css({visibility: 'hidden'});
						});
					});
				//]]>
				</script><style type="text/css"></style>
<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
<style type="text/css" id="custom-background-css">body.custom-background { background-color: #89a5bf; }</style>
	<style>.ios7.web-app-mode.has-fixed header{ background-color: rgba(3,122,221,.88);}</style>
</head>

<body class="archive tag tag-swiftui tag-217 custom-background">
<div id="wrapper">

	<div id="header">

		<div id="head">
			<div id="logo">
									<a href="./../index.html"><h1>Andrew Morgan on Databases</h1></a>
                                        <!-- <a href=".//"><h1>MySQL Cluster, Replication, Fabric...</h1></a>  ZXZX -->					
							</div>
			<div id="socialmedia_icons">
				<a href="http://twitter.com/andrewmorgan"><img src="./../wp-content/themes/zeesynergie/images/icons/twitter.png" alt="twitter"></a><a href="http://www.facebook.com/andrewjamesmorgan"><img src="./../wp-content/themes/zeesynergie/images/icons/facebook.png" alt="facebook"></a><a href="https://plus.google.com/u/0/100605473697871424413/posts"><img src="./../wp-content/themes/zeesynergie/images/icons/googleplus.png" alt="googleplus"></a><a href="http://www.linkedin.com/profile/view?id=16709956"><img src="./../wp-content/themes/zeesynergie/images/icons/linkedin.png" alt="linkedin"></a><a href="http://www.flickr.com/photos/andrewjamesmorgan/"><img src="./../wp-content/themes/zeesynergie/images/icons/flickr.png" alt="flickr"></a><a href="http://www.youtube.com/channel/UCodtDakJ4VdeSCzS3P3rIsw"><img src="./../wp-content/themes/zeesynergie/images/icons/youtube.png" alt="youtube"></a>				<div class="clear"></div>
			</div>
			<div class="clear"></div>
		</div>
		
		<div id="navi_container">
			<div id="navi">
				<ul id="nav" class="menu">
<li class="page_item page-item-1011"><a href="./../about/index.html">About</a></li>
</ul>			</div>
		</div>
		<div class="clear"></div>
	</div>
	
	<div id="container">
	
			<div id="custom_header">
			<img src="./../wp-content/uploads/2015/06/cropped-ClusterDB-logo-header.png">
		</div>
	
	<div id="wrap">
		<div id="content">
		
		<h2 class="arh">Tag Archive for SwiftUI</h2>
				
					<div id="post-4668" class="post-4668 post type-post status-publish format-standard hentry category-mongodb category-realm tag-game tag-ios tag-mongodb tag-realm tag-swift tag-swiftui">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../mongodb/building-a-collaborative-ios-minesweeper-game-with-realm/index.html">March 14, 2022</a>
			</div>
	<div class="postcomments">
		<a href="./../mongodb/building-a-collaborative-ios-minesweeper-game-with-realm/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../mongodb/building-a-collaborative-ios-minesweeper-game-with-realm/index.html" rel="bookmark">Building a collaborative iOS Minesweeper game with Realm</a></h2>
				
				<div class="entry">
										<p><a href="./../wp-content/uploads/2022/03/ATF-720x720-1.png"><img fetchpriority="high" decoding="async" src="./../wp-content/uploads/2022/03/ATF-720x720-1-300x300.png" alt="Realm-Sweeper. Writing a multiplayer iOS Minesweeper game using SwiftUI and Realm" width="300" height="300" class="alignright size-medium wp-image-4669" srcset="./../wp-content/uploads/2022/03/ATF-720x720-1-300x300.png 300w, ./../wp-content/uploads/2022/03/ATF-720x720-1-150x150.png 150w, ./../wp-content/uploads/2022/03/ATF-720x720-1-144x144.png 144w, ./../wp-content/uploads/2022/03/ATF-720x720-1.png 720w" sizes="(max-width: 300px) 100vw, 300px"></a></p>
<p>I wanted to build an app that we could use at events to demonstrate <a href="https://www.mongodb.com/realm/mobile/sync">Realm Sync</a>. It needed to be fun to interact with, and so a multiplayer game made sense. Tic-tac-toe is too simple to get excited about. I&#8217;m not a game developer and so <em>Call Of Duty</em> wasn&#8217;t an option. Then I remembered Microsoft&#8217;s <a href="https://en.wikipedia.org/wiki/Minesweeper">Minesweeper</a>.</p>
<p>Minesweeper was a Windows fixture from 1990 until Windows 8 relegated it to the app store in 2012. It was a single-player game, but it struck me as something that could be a lot of fun to play with others. Some family beta-testing of my first version while waiting for a ferry proved that it did get people to interact with each other (even if most interactions involved shouting, &#8220;Which of you muppets clicked on that mine?!&#8221;).</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/IMG_1301_81fa444116.jpeg" alt="Family sat around a table, all playing the Realm-Sweeper game on their iPhones"></p>
<p>You can download the back end and iOS apps from the <a href="https://github.com/realm/Realm-Sweeper">Realm-Sweeper repo</a>, and get it up and running in a few minutes if you want to play with it.</p>
<p>This article steps you through some of the key aspects of setting up the backend Realm app, as well as the iOS code. Hopefully, you&#8217;ll see how simple it is and try building something for yourself. If anyone&#8217;s looking for ideas, then <a href="https://en.wikipedia.org/wiki/Sokoban">Sokoban</a> could be interesting.</p>
<h2>Prerequisites</h2>
<ul>
<li><a href="https://github.com/realm/realm-swift/releases/tag/v10.23.0">Realm-Cocoa 10.20.1+</a></li>
<li>iOS 15+</li>
</ul>
<h2>The Minesweeper game</h2>
<p>The gameplay for Minesweeper is very simple.</p>
<p>You&#8217;re presented with a grid of gray tiles. You tap on a tile to expose what&#8217;s beneath. If you expose a mine, game over. If there isn&#8217;t a mine, then you&#8217;ll be rewarded with a hint as to how many mines are adjacent to that tile. If you deduce (or guess) that a tile is covering a mine, then you can plant a flag to record that.</p>
<p>You win the game when you correctly flag every mine and expose what&#8217;s behind every non-mined tile.</p>
<h3>What Realm-Sweeper adds</h3>
<p>Minesweeper wasn&#8217;t designed for touchscreen devices; you had to use a physical mouse. Realm-Sweeper brings the game into the 21st century by adding touch controls. Tap a tile to reveal what&#8217;s beneath; tap and hold to plant a flag.</p>
<p>Minesweeper was a single-player game. All people who sign into Realm-Sweeper with the same user ID get to collaborate on the same game in real time.</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/realm_sweeper_24ef46cef1.gif" alt="Animation of two iPhones. As a user taps a tile on one device, the change appears almost instantly on the other"></p>
<p>You also get to configure the size of the grid and how many mines you&#8217;d like to hide.</p>
<h2>The data model</h2>
<p>I decided to go for a simple data model that would put Realm sync to the test.</p>
<p>Each game is a single document/object that contains meta data (score, number of rows/columns, etc.) together with the grid of tiles (the board):</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/schema_f791f6acf6.png" alt="Data model for the Game Class"></p>
<p>This means that even a modestly sized grid (20&#215;20 tiles) results in a <code>Game</code> document/object with more than 2,000 attributes.</p>
<p>Every time you tap on a tile, the <code>Game</code> object has to be synced with all other players. Those players are also tapping on tiles, and those changes have to be synced too. If you tap on a tile which isn&#8217;t adjacent to any mines, then the app will recursively ripple through exposing similar, connected tiles. That&#8217;s a lot of near-simultaneous changes being made to the same object from different devicesâ€”a great test of Realm&#8217;s automatic conflict resolution!</p>
<h2>The backend Realm app</h2>
<p>If you don&#8217;t want to set this up yourself, simply follow the <a href="https://github.com/realm/Realm-Sweeper/tree/main/Realm">instructions from the repo</a> to import the app.</p>
<p>If you opt to build the backend app yourself, there are only two things to configure once you create the empty Realm app:</p>
<ol>
<li>
<a href="https://docs.mongodb.com/realm/authentication/email-password/#:~:text=Summary-,Overview,email%20addresses%20are%20case%2Dsensitive.">Enable email/password authentication</a>. I kept it simple by opting to auto-confirm new users and sticking with the default password-reset function (which does nothing).</li>
<li>
<a href="https://docs.mongodb.com/realm/sync/configure/enable-sync/">Enable partitioned Realm sync</a>. Set the partition key to <code>partition</code> and enable developer mode (so that the schema will be created automatically when the iOS app syncs for the first time).</li>
</ol>
<p>The <code>partition</code> field will be set to the usernameâ€”allowing anyone who connects as that user to sync all of their games.</p>
<p>You can also add sync rules to ensure that a user can only sync their own games (in case someone hacks the mobile app). I always prefer using Realm functions for permissions. You can add this for both the read and write rules:</p>
<pre><code class="json">{
  "%%true": {
    "%function": {
      "arguments": [
        "%%partition"
      ],
      "name": "canAccessPartition"
    }
  }
}
</code></pre>
<p>The <code>canAccessPartition</code> function is:</p>
<pre><code class="js">exports = function(partition) {
  const user = context.user.data.email;
  return partition === user;
};
</code></pre>
<h2>The iOS app</h2>
<p>I&#8217;d suggest starting by downloading, configuring, and running the appâ€”just follow the <a href="https://github.com/realm/Realm-Sweeper/tree/main/iOS">instructions from the repo</a>. That way, you can get a feel for how it works.</p>
<p>This isn&#8217;t intended to be a full tutorial covering every line of code in the app. Instead, I&#8217;ll point out some key components.</p>
<p>As always with Realm and MongoDB, it all starts with the dataâ€¦</p>
<h3>Model</h3>
<p>There&#8217;s a single top-level Realm Objectâ€”<code>Game</code>:</p>
<pre><code class="swift">class Game: Object, ObjectKeyIdentifiable {
    @Persisted(primaryKey: true) var _id: ObjectId
    @Persisted var numRows = 0
    @Persisted var numCols = 0
    @Persisted var score = 0
    @Persisted var startTime: Date? = Date()
    @Persisted var latestMoveTime: Date?
    @Persisted var secondsTakenToComplete: Int?
    @Persisted var board: Board?
    @Persisted var gameStatus = GameStatus.notStarted
    @Persisted var winningTimeInSeconds: Int?
    â€¦
}
</code></pre>
<p>Most of the fields are pretty obvious. The most interesting is <code>board</code>, which contains the grid of tiles:</p>
<pre><code class="swift">class Board: EmbeddedObject, ObjectKeyIdentifiable {
    @Persisted var rows = List&lt;Row&gt;()
    @Persisted var startingNumberOfMines = 0
    ... 
}
</code></pre>
<p><code>row</code> is a list of <code>Cells</code>:</p>
<pre><code class="swift">class Row: EmbeddedObject, ObjectKeyIdentifiable {
    @Persisted var cells = List&lt;Cell&gt;()
    ...
}

class Cell: EmbeddedObject, ObjectKeyIdentifiable {
    @Persisted var isMine = false
    @Persisted var numMineNeigbours = 0
    @Persisted var isExposed = false
    @Persisted var isFlagged = false
    @Persisted var hasExploded = false
    ...
}
</code></pre>
<p>The model is also where the ~~business~~ game logic is implemented. This means that the views can focus on the UI. For example, <code>Game</code> includes a computed variable to check whether the game has been solved:</p>
<pre><code class="swift">var hasWon: Bool {
    guard let board = board else { return false }
    if board.remainingMines != 0 { return false }

    var result = true

    board.rows.forEach() { row in
        row.cells.forEach() { cell in
            if !cell.isExposed &amp;&amp; !cell.isFlagged {
                result = false
                return
            }
        }
        if !result { return }
    }
    return result
}
</code></pre>
<h3>Views</h3>
<p>As with any SwiftUI app, the UI is built up of a hierarchy of many views.</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/views_aaac46f078.png" alt="Screen capture from Xcode showing the hierarchy of views making up the RealmSweeper UI"></p>
<p>Here&#8217;s a quick summary of the <a href="https://github.com/realm/Realm-Sweeper/tree/main/iOS/RealmSweeper/Views">views</a> that make up Real-Sweeper:</p>
<p><strong><a href="https://github.com/realm/Realm-Sweeper/blob/main/iOS/RealmSweeper/Views/ContentView.swift"><code>ContentView</code></a></strong> is the top-level view. When the app first runs, it will show the <code>LoginView</code>. Once the user has logged in, it shows <code>GameListView</code> instead. It&#8217;s here that we set the Realm Sync partition (to be the <code>username</code> of the user that&#8217;s just logged in):</p>
<pre><code class="swift">if username == "" {
    LoginView(username: $username)
} else {
    GameListView()
        .environment(\.realmConfiguration, realmApp.currentUser!.configuration(partitionValue: username))
        .navigationBarItems(leading: realmApp.currentUser != nil ? LogoutButton(username: $username) : nil)
}
</code></pre>
<p><code>ContentView</code> also includes the <code>LogoutButton</code> view.</p>
<p><strong><a href="https://github.com/realm/Realm-Sweeper/blob/main/iOS/RealmSweeper/Views/Users/LoginView.swift"><code>LoginView</code></a></strong> allows the user to provide a username and password:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Login_View_034d3f058f.png" alt="Screen capture of the login view. Fields to enter username and password. Checkbox to indicate that you're registering a new user. Button to login,"></p>
<p>Those credentials are then used to register or log into the backend Realm app:</p>
<pre><code class="swift">func userAction() {
    Task {
        do {
            if newUser {
                try await realmApp.emailPasswordAuth.registerUser(
                    email: email, password: password)
            }
            let _ = try await realmApp.login(
                    credentials: .emailPassword(email: email, password: password))
            username = email
        } catch {
            errorMessage = error.localizedDescription
        }
    }
}
</code></pre>
<p><a href="https://github.com/realm/Realm-Sweeper/blob/main/iOS/RealmSweeper/Views/Game%20List/GameListView.swift"><strong><code>GameListView</code></strong></a> reads the list of this user&#8217;s existing games.</p>
<pre><code class="swift">@ObservedResults(Game.self, 
    sortDescriptor: SortDescriptor(keyPath: "startTime", ascending: false)) var games
</code></pre>
<p>It displays each of the games within a <code>GameSummaryView</code>. If you tap one of the games, then you jump to a <code>GameView</code> for that game:</p>
<pre><code class="swift">NavigationLink(destination: GameView(game: game)) {
    GameSummaryView(game: game)
}
</code></pre>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Game_List_View_22711c2b4a.png" alt="GameListView, Screen capture of a list of games, together with buttons to logout, set settings, or create a new game"></p>
<p>Tap the settings button and you&#8217;re sent to <code>SettingsView</code>.</p>
<p>Tap the &#8220;New Game&#8221; button and a new <code>Game</code> object is created and then stored in Realm by appending it to the <code>games</code> live query:</p>
<pre><code class="swift">private func createGame() {
    numMines = min(numMines, numRows * numColumns)
    game = Game(rows: numRows, cols: numColumns, mines: numMines)
    if let game = game {
        $games.append(game)
    }
    startGame  = true
}
</code></pre>
<p><strong><a href="https://github.com/realm/Realm-Sweeper/blob/main/iOS/RealmSweeper/Views/SettingsView.swift"><code>SettingsView</code></a></strong> lets the user choose the number of tiles and mines to use:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Settings_View_39aa24c7ce.png" alt="SettingsView. Steppers to set the number of rows, columns, and mines"></p>
<p>If the user uses multiple devices to play the game (e.g., an iPhone and an iPad), then they may want different-sized boards (taking advantage of the extra screen space on the iPad). Because of that, the view uses the device&#8217;s <code>UserDefaults</code> to locally persist the settings rather than storing them in a synced realm:</p>
<pre><code class="swift">@AppStorage("numRows") var numRows = 10
@AppStorage("numColumns") var numColumns = 10
@AppStorage("numMines") var numMines = 15
</code></pre>
<p><strong><a href="https://github.com/realm/Realm-Sweeper/blob/main/iOS/RealmSweeper/Views/Game%20List/GameSummaryView.swift"><code>GameSummaryView</code></a></strong> displays a summary of one of the user&#8217;s current or past games.</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Game_Summary_View_e80a138236.png" alt="GameSummaryView. Screen capture of view containing the start and completion times + emoji for the status of the game"></p>
<p><strong><a href="https://github.com/realm/Realm-Sweeper/blob/main/iOS/RealmSweeper/Views/Game/GameView.swift"><code>GameView</code></a></strong> shows the latest stats for the current game at the top of the screen:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Game_Status_5ee8b8b6e0.png" alt="GameStatusView. Screen capture showing remaining mines, status of the game (smiling emoji) and elapsed time"></p>
<p>It uses the <code>LEDCounter</code> and <code>StatusButton</code> views for the summary.</p>
<p>Below the summary, it displays the <code>BoardView</code> for the game.</p>
<p><strong><a href="https://github.com/realm/Realm-Sweeper/blob/main/iOS/RealmSweeper/Views/Control%20Box/Counters/LEDCounter.swift"><code>LEDCounter</code></a></strong> displays the provided number as three digits using a retro LED font:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Counter_View_d7b73c42ce.png" alt="CounterView â€“ 3 red LED numbers"></p>
<p><strong><a href="https://github.com/realm/Realm-Sweeper/blob/main/iOS/RealmSweeper/Views/Control%20Box/StatusButton.swift"><code>StatusButton</code></a></strong> uses a <code>ZStack</code> to display the symbol for the game&#8217;s status on top of a tile image:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Status_Button_8975894d39.png" alt="StatusButton. Smiling emoji in front of a gray tile"></p>
<p>The view uses SwiftUI&#8217;s <a href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-provide-relative-sizes-using-geometryreader"><code>GeometryReader</code></a> function to discover how much space is available so that it can select an appropriate font size for the symbol:</p>
<pre><code class="swift">GeometryReader { geo in
    Text(status)
        .font(.system(size: geo.size.height * 0.7))
}
</code></pre>
<p><strong><a href="https://github.com/realm/Realm-Sweeper/blob/main/iOS/RealmSweeper/Views/Game/BoardView.swift"><code>BoardView</code></a></strong> displays the game&#8217;s grid of tiles:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Board_View_703d6386db.png" alt="BoardView. A grid of tiles. Some tiles have been removed, revealing colored numbers. One tile contains a red flag"></p>
<p>Each of the tiles is represented by a <code>CellView</code> view.</p>
<p>When a tile is tapped, this view exposes its contents:</p>
<pre><code class="swift">.onTapGesture() {
    expose(row: row, col: col)
}
</code></pre>
<p>On a tap-and-hold, a flag is dropped:</p>
<pre><code class="swift">.onLongPressGesture(minimumDuration: 0.1) {
    flag(row: row, col: col)
}
</code></pre>
<p>When my family tested the first version of the app, they were frustrated that they couldn&#8217;t tell whether they&#8217;d held long enough for the flag to be dropped. This was an easy mistake to make as their finger was hiding the tile at the timeâ€”an example of where testing with a mouse and simulator wasn&#8217;t a substitute for using real devices. It was especially frustrating as getting it wrong meant that you revealed a mine and immediately lost the game. Fortunately, this is easy to fix using iOS&#8217;s haptic feedback:</p>
<pre><code class="swift">func hapticFeedback(_ isSuccess: Bool) {
    let generator = UINotificationFeedbackGenerator()
    generator.notificationOccurred(isSuccess ? .success : .error)
}
</code></pre>
<p>You now feel a buzz when the flag has been dropped.</p>
<p><strong><a href="./CellView/index.html"><code>CellView</code></a></strong> displays an individual tile:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Cell_View_6ee46c6103.png" alt="CellView. Tile containing a crossed out red flag"></p>
<p>What&#8217;s displayed depends on the contents of the <code>Cell</code> and the state of the game. It uses four further views to display different types of tile: <code>FlagView</code>, <code>MineCountView</code>, <code>MineView</code>, and <code>TileView</code>.</p>
<p><strong><a href="https://github.com/realm/Realm-Sweeper/blob/main/iOS/RealmSweeper/Views/Tiles/FlagView.swift"><code>FlagView</code></a></strong></p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Flag_View_fd57e245f3.png" alt="FlagView. 2 Tiles, both containing a flag, one shows the  flag crossed out"></p>
<p><strong><a href="https://github.com/realm/Realm-Sweeper/blob/main/iOS/RealmSweeper/Views/Tiles/MineCountView.swift"><code>MineCountView</code></a></strong></p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Mine_Count_View_e8392ff46d.png" alt="MineCountView, 6 gray tiles. One is empty the others containing numbers 1 through 5, each in a different color"></p>
<p><strong><a href="https://github.com/realm/Realm-Sweeper/blob/main/iOS/RealmSweeper/Views/Tiles/MineView.swift"><code>MineView</code></a></strong></p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Mine_View_18eaaf517b.png" alt="MineView. Two tiles containing mines, one with a gray background, one with a red background"></p>
<p><strong><a href="https://github.com/realm/Realm-Sweeper/blob/main/iOS/RealmSweeper/Views/Tiles/TileView.swift"><code>TileView</code></a></strong></p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Tile_View_1a01815c26.png" alt="TileView. A single gray tile"></p>
<h2>Conclusion</h2>
<p>Realm-Sweeper gives a real feel for how quickly Realm is able to synchronize data over the internet.</p>
<p>I intentionally avoided optimizing how I updated the game data in Realm. When you see a single click exposing dozens of tiles, each cell change is an update to the <code>Game</code> object that needs to be synced.</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/sync_526ade2926.gif" alt="GIF showing changes in one game board appearing in near-realtime in the game board on a different device"></p>
<p>Note that both instances of the game are running in iPhone simulators on an overworked Macbook in England. The Realm backend app is running in the USâ€”that&#8217;s a 12,000 km/7,500 mile round trip for each sync.</p>
<p>I took this approach as I wanted to demonstrate the performance of Realm synchronization. If an app like this became super-popular with millions of users, then it would put a lot of extra strain on the backend Realm app.</p>
<p>An obvious optimization would be to condense all of the tile changes from a single tap into a single write to the Realm object. If you&#8217;re interested in trying that out, just fork the <a href="https://github.com/realm/Realm-Sweeper">repo</a> and make the changes. If you do implement the optimization, then please create a pull request. (I&#8217;d probably add it as an option within the settings so that the &#8220;slow&#8221; mode is still an option.)</p>
<p>Got questions? Ask them in our <a href="https://www.mongodb.com/community/forums/c/realm/realm-sync/111">Community forum</a>.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/building-a-collaborative-ios-minesweeper-game-with-realm" data-via="wpbeginner" data-text="Building a collaborative iOS Minesweeper game with Realm" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/building-a-collaborative-ios-minesweeper-game-with-realm"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/building-a-collaborative-ios-minesweeper-game-with-realm" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Fbuilding-a-collaborative-ios-minesweeper-game-with-realm&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../category/mongodb/index.html" rel="category tag">MongoDB</a>, <a href="./../category/mongodb/realm/index.html" rel="category tag">Realm</a> | 
Tags: <a href="./game/index.html" rel="tag">game</a>, <a href="./ios/index.html" rel="tag">ios</a>, <a href="./mongodb/index.html" rel="tag">mongodb</a>, <a href="./realm/index.html" rel="tag">Realm</a>, <a href="./swift/index.html" rel="tag">Swift</a>, <a href="./swiftui/index.html" rel="tag">SwiftUI</a>
</div>

			</div>			<div id="post-4664" class="post-4664 post type-post status-publish format-standard has-post-thumbnail hentry category-mongodb category-realm tag-mongodb tag-realm tag-swiftui">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../mongodb/using-realm-flexible-sync-in-your-app-an-ios-tutorial/index.html">February 25, 2022</a>
			</div>
	<div class="postcomments">
		<a href="./../mongodb/using-realm-flexible-sync-in-your-app-an-ios-tutorial/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../mongodb/using-realm-flexible-sync-in-your-app-an-ios-tutorial/index.html" rel="bookmark">Using Realm Flexible Sync in Your Appâ€”an iOS Tutorial</a></h2>
				
				<div class="entry">
					<img width="150" height="150" src="./../wp-content/uploads/2022/02/ATF-720x720-1-150x150.png" class="alignleft wp-post-image" alt="" decoding="async" srcset="./../wp-content/uploads/2022/02/ATF-720x720-1-150x150.png 150w, ./../wp-content/uploads/2022/02/ATF-720x720-1-300x300.png 300w, ./../wp-content/uploads/2022/02/ATF-720x720-1-144x144.png 144w, ./../wp-content/uploads/2022/02/ATF-720x720-1.png 720w" sizes="(max-width: 150px) 100vw, 150px">					<h2>Introduction</h2>
<p>We recently announced the <a href="https://www.mongodb.com/developer/article/realm-flexible-sync/">release of the Realm Flexible Sync preview</a>â€”an opportunity for developers to take it for a spin and give us feedback. That article provided an overview of the benefits of flexible sync and how it works. TL;DR: You typically don&#8217;t want to sync the entire backend database to every deviceâ€”whether for capacity or security concerns. Realm Flexible Sync lets the developer provide queries to control exactly what the mobile app asks to sync, together with backend rules to ensure users can only access the data that they&#8217;re entitled to.</p>
<p>This post builds on that introduction by showing how to add flexible sync to the RChat mobile app. I&#8217;ll show how to configure the Realm backend app, and then what code needs adding to the mobile app.</p>
<p>Everything you see in this tutorial can be found in the <a href="https://github.com/realm/RChat/tree/flex-sync">flex-sync branch of the RChat repo</a>.</p>
<h2>Prerequisites</h2>
<ul>
<li>Xcode 13.2+</li>
<li>iOS 15+</li>
<li><a href="https://github.com/realm/realm-swift/releases">Realm-Swift 10.22.0+</a></li>
<li>MongoDB 5.0+</li>
</ul>
<h2>The RChat App</h2>
<p>RChat is a messaging app. Users can add other users to a chat room and then share messages, images, and location with each other.</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/chat_realm_flex_sync_468d197c99.gif" alt="Screen capture video of running the RCha App on 2 different iOS simulators. Two users join a chat room and send messages to each other"></p>
<p>All of the user and chat message data is shared between instances of the app via Realm Sync.</p>
<p>There&#8217;s a common Realm backend app. There are frontend apps for iOS and Android. This post focuses on the backend and the iOS app.</p>
<h2>Configuring the Realm Backend App</h2>
<p>The backend app contains a lot of functionality that isn&#8217;t connected to the sync functionality, and so I won&#8217;t cover that here. If you&#8217;re interested, then check out the <a href="https://www.mongodb.com/developer/how-to/realm-swiftui-ios-chat-app/">original RChat series</a>.</p>
<p>As a starting point, you can install the app. I&#8217;ll then explain the parts connected to Realm Sync.</p>
<h3>Import the Backend Realm App</h3>
<ol>
<li>If you don&#8217;t already have one, <a href="https://cloud.mongodb.com/">create a MongoDB Atlas Cluster</a>, keeping the default name of Cluster0. The Atlas cluster must be running MongoDB 5.0 or later.</li>
<li>Install the <a href="https://docs.mongodb.com/realm/deploy/realm-cli-reference">Realm CLI</a> and <a href="https://docs.atlas.mongodb.com/configure-api-access#programmatic-api-keys">create an API key pair</a>.</li>
<li>Download the repo and install the Realm app:</li>
</ol>
<pre><code class="bash">git clone https://github.com/ClusterDB/RChat.git
git checkout flex-sync
cd RChat/RChat-Realm/RChat
realm-cli login --api-key &lt;your new public key&gt; --private-api-key &lt;your new private key&gt;
realm-cli import # Then answer prompts, naming the app RChat

</code></pre>
<ol>
<li>From the Atlas UI, click on the Realm logo and you will see the RChat app. Open it and copy the App Id. You&#8217;ll need to use this before building the iOS app.</li>
</ol>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/copy_realm_app_id_b2d9b27ddc.png" alt="Screen capture of how to copy the Realm App ID in the Realm UI"></p>
<h3>How Flexible Sync is Enabled in the Back End</h3>
<h4>Schema</h4>
<p>The schema represents how the data will be stored in MongoDB Atlas **and*- what the Swift (and Kotlin) model classes must contain.</p>
<p>Each collection/class requires a schema. If you enable Realm&#8217;s &#8220;Developer Mode&#8221; option, then Realm will automatically define the schema based on your Swift or Kotlin model classes. In this case, your imported Realm <code>App</code> includes the schemas, and so developer mode isn&#8217;t needed. You can view the schemas by browsing to the &#8220;Schema&#8221; section in the <a href="https://cloud.mongodb.com/">Realm UI</a>:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/schemas_in_realm_ui_4032fe478c.png" alt="Screen capture of schema section of the Realm UI"></p>
<p>You can find more details about the schema/model in <a href="https://www.mongodb.com/developer/how-to/realm-swiftui-ios-chat-app/">Building a Mobile Chat App Using Realm â€“ Data Architecture</a>, but note that for flexible sync (as opposed to the original partition-based sync), the <code>partition</code> field has been removed.</p>
<p>We&#8217;re interested in the schema for three collections/model-classes:</p>
<p><strong>User:</strong></p>
<pre><code class="json">{
  "bsonType": "object",
  "properties": {
    "_id": {
      "bsonType": "string"
    },
    "conversations": {
      "bsonType": "array",
      "items": {
        "bsonType": "object",
        "properties": {
          "displayName": {
            "bsonType": "string"
          },
          "id": {
            "bsonType": "string"
          },
          "members": {
            "bsonType": "array",
            "items": {
              "bsonType": "object",
              "properties": {
                "membershipStatus": {
                  "bsonType": "string"
                },
                "userName": {
                  "bsonType": "string"
                }
              },
              "required": [
                "membershipStatus",
                "userName"
              ],
              "title": "Member"
            }
          },
          "unreadCount": {
            "bsonType": "long"
          }
        },
        "required": [
          "unreadCount",
          "id",
          "displayName"
        ],
        "title": "Conversation"
      }
    },
    "lastSeenAt": {
      "bsonType": "date"
    },
    "presence": {
      "bsonType": "string"
    },
    "userName": {
      "bsonType": "string"
    },
    "userPreferences": {
      "bsonType": "object",
      "properties": {
        "avatarImage": {
          "bsonType": "object",
          "properties": {
            "_id": {
              "bsonType": "string"
            },
            "date": {
              "bsonType": "date"
            },
            "picture": {
              "bsonType": "binData"
            },
            "thumbNail": {
              "bsonType": "binData"
            }
          },
          "required": [
            "_id",
            "date"
          ],
          "title": "Photo"
        },
        "displayName": {
          "bsonType": "string"
        }
      },
      "required": [],
      "title": "UserPreferences"
    }
  },
  "required": [
    "_id",
    "userName",
    "presence"
  ],
  "title": "User"
}
</code></pre>
<p><code>User</code> documents/objects represent users of the app.</p>
<p><strong>Chatster:</strong></p>
<pre><code class="json">{
  "bsonType": "object",
  "properties": {
    "_id": {
      "bsonType": "string"
    },
    "avatarImage": {
      "bsonType": "object",
      "properties": {
        "_id": {
          "bsonType": "string"
        },
        "date": {
          "bsonType": "date"
        },
        "picture": {
          "bsonType": "binData"
        },
        "thumbNail": {
          "bsonType": "binData"
        }
      },
      "required": [
        "_id",
        "date"
      ],
      "title": "Photo"
    },
    "displayName": {
      "bsonType": "string"
    },
    "lastSeenAt": {
      "bsonType": "date"
    },
    "presence": {
      "bsonType": "string"
    },
    "userName": {
      "bsonType": "string"
    }
  },
  "required": [
    "_id",
    "presence",
    "userName"
  ],
  "title": "Chatster"
}
</code></pre>
<p><code>Chatster</code> documents/objects represent a read-only subset of instances of <code>User</code> documents. <code>Chatster</code> is needed because there&#8217;s a subset of <code>User</code> data that we want to make accessible to all users. E.g., I want everyone to be able to see my username, presence status, and avatar image, but I don&#8217;t want them to see which chat rooms I&#8217;m a member of.</p>
<p>Realm Sync lets you control which users can sync which documents, but it doesn&#8217;t let you sync just a subset of a document&#8217;s fields. That&#8217;s why <code>Chatster</code> is needed. I&#8217;m looking forward to when Realm Sync permissions allow me to control access on a per-field (rather than per-document/class) basis. At that point, I can remove <code>Chatster</code> from the app.</p>
<p><strong>ChatMessage:</strong></p>
<pre><code class="json">{
  "bsonType": "object",
  "properties": {
    "_id": {
      "bsonType": "string"
    },
    "author": {
      "bsonType": "string"
    },
    "authorID": {
      "bsonType": "string"
    },
    "conversationID": {
      "bsonType": "string"
    },
    "image": {
      "bsonType": "object",
      "properties": {
        "_id": {
          "bsonType": "string"
        },
        "date": {
          "bsonType": "date"
        },
        "picture": {
          "bsonType": "binData"
        },
        "thumbNail": {
          "bsonType": "binData"
        }
      },
      "required": [
        "_id",
        "date"
      ],
      "title": "Photo"
    },
    "location": {
      "bsonType": "array",
      "items": {
        "bsonType": "double"
      }
    },
    "text": {
      "bsonType": "string"
    },
    "timestamp": {
      "bsonType": "date"
    }
  },
  "required": [
    "_id",
    "authorID",
    "conversationID",
    "text",
    "timestamp"
  ],
  "title": "ChatMessage"
}
</code></pre>
<p>There&#8217;s a <code>ChatMessage</code> document object for every message sent to any chat room.</p>
<h4>Flexible Sync Configuration</h4>
<p>You can view and edit the sync configuration by browsing to the &#8220;Sync&#8221; section of the Realm UI:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/configure_flex_sync_9b3221e283.png" alt="Enabling Realm Flexible Sync in the Realm UI"></p>
<p>For this deployment, I&#8217;ve selected the Atlas cluster to use. <strong>That cluster must be running MongoDB 5.0 or later</strong>. At the time of writing, MongoDB 5.0 isn&#8217;t available for shared clusters (including free-tier M0 instances)â€”that&#8217;s expected to change very soon, possibly by the time that you&#8217;re reading this.</p>
<p>You must specify which fields the mobile app can use in its sync filter queries. Without this, you can&#8217;t refer to those fields in your sync queries or permissions. You are currently limited to 10 fields.</p>
<p>Scrolling down, you can see the sync permissions:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/sync_permission_f780c57241.png" alt="Screenshot of a JSON document representing sync permissions in the Realm UI"></p>
<p>The UI has flattened the permissions JSON document; here&#8217;s a version that&#8217;s easier to read:</p>
<pre><code class="json">{
   "rules": {
       "User": [
           {
               "name": "anyone",
               "applyWhen": {},
               "read": {
                   "_id": "%%user.id"
               },
               "write": {
                   "_id": "%%user.id"
               }
           }
       ],
       "Chatster": [
           {
               "name": "anyone",
               "applyWhen": {},
               "read": true,
               "write": false
           }
       ],
       "ChatMessage": [
           {
               "name": "anyone",
               "applyWhen": {},
               "read": true,
               "write": {
                   "authorID": "%%user.id"
               }
           }
       ]
   },
   "defaultRoles": [
       {
           "name": "all",
           "applyWhen": {},
           "read": {},
           "write": {}
       }
   ]
}
</code></pre>
<p>The <code>rules</code> component contains a sub-document for each of our collections. Each of those sub-documents contain an array of roles. Each role contains:</p>
<ul>
<li>The <code>name</code> of the role, this should be something that helps other developers understand the purpose of the role (e.g., &#8220;admin,&#8221; &#8220;owner,&#8221; &#8220;guest&#8221;).</li>
<li>
<code>applyWhen</code>, which defines whether the requesting user matches the role or not. Each of our collections have a single role, and so <code>applyWhen</code> is set to <code>{}</code>, which always evaluates to true.</li>
<li>A read ruleâ€”how to decide whether this user can view a given document. This is where our three collections impose different rules:
<ul>
<li>A user can read and write to their own <code>User</code> object. No one else can read or write to it.</li>
<li>Anyone can read any <code>Chatster</code> document, but no one can write to them. Note that these documents are maintained by database triggers to keep them consistent with their associated <code>User</code> document.</li>
<li>The author of a <code>ChatMessage</code> is allowed to write to it. Anyone can read any <code>ChatMessage</code>. Ideally, we&#8217;d restrict it to just members of the chat room, but permissions don&#8217;t currently support arraysâ€”this is another feature that I&#8217;m keen to see added.</li>
</ul>
</li>
</ul>
<h2>Adding Realm Flexible Sync to the iOS App</h2>
<p>As with the back end, the iOS app is too big to cover in its entirety in this post. I&#8217;ll explain how to build and run the app and then go through the components relevant to Realm Flexible Sync.</p>
<h3>Configure, Build, and Run the RChat iOS App</h3>
<p>You&#8217;ve already downloaded the repo containing the iOS app, but you need to change directory before opening and running the app:</p>
<pre><code class="bash">cd ../../RChat-iOS
pod install
open RChat.xcodeproj
</code></pre>
<p>Update <code>RChatApp.swift</code> with your Realm App Id (you copied that from the Realm UI when configuring your backend Realm app). In Xcode, select your device or simulator before building and running the app (âŒ˜R). Select a second device or simulator and run the app a second time (âŒ˜R).</p>
<p>On each device, provide a username and password and select the &#8220;Register new user&#8221; checkbox:<br>
<img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/register_rchat_user_f04514f5bf.png" alt="iOS screenshot of registering a new user through the RChat app"></p>
<p>Once registered and logged in on both devices, you can create a new chat room, invite your second user, and start sharing messages and photos. To share location, you first need to enable it in the app&#8217;s settings.</p>
<h3>Key Pieces of the iOS App Code</h3>
<h4>The Model</h4>
<p>You&#8217;ve seen the schemas that were defined for the &#8220;User,&#8221; &#8220;Chatster,&#8221; and &#8220;ChatMessage&#8221; collections in the back end Realm app. Each of those collections has an associated Realm <code>Object</code> class in the iOS app. Sub-documents map to embedded objects that conform to <code>RealmEmbeddedObject</code>:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/R_Chat_Flex_Sync_Class_Model_496e297d36.png" alt="UML diagram showing the User, Chatster, and ChatMessage classesâ€”together with their embedded classes"></p>
<p>Let&#8217;s take a close look at each of these classes:</p>
<p><strong>User Class</strong></p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/User_Flex_Sync_Class_Model_78340465be.png" alt="UML diagram showing the User classâ€”together with its embedded classes"></p>
<pre><code class="swift">class User: Object, ObjectKeyIdentifiable {
   @Persisted(primaryKey: true) var _id = UUID().uuidString
   @Persisted var userName = ""
   @Persisted var userPreferences: UserPreferences?
   @Persisted var lastSeenAt: Date?
   @Persisted var conversations = List&lt;Conversation&gt;()
   @Persisted var presence = "On-Line"
}

class UserPreferences: EmbeddedObject, ObjectKeyIdentifiable {
   @Persisted var displayName: String?
   @Persisted var avatarImage: Photo?
}

class Photo: EmbeddedObject, ObjectKeyIdentifiable {
   @Persisted var _id = UUID().uuidString
   @Persisted var thumbNail: Data?
   @Persisted var picture: Data?
   @Persisted var date = Date()
}

class Conversation: EmbeddedObject, ObjectKeyIdentifiable {
   @Persisted var id = UUID().uuidString
   @Persisted var displayName = ""
   @Persisted var unreadCount = 0
   @Persisted var members = List&lt;Member&gt;()
}

class Member: EmbeddedObject, ObjectKeyIdentifiable {
   @Persisted var userName = ""
   @Persisted var membershipStatus = "User added, but invite pending"
}
</code></pre>
<p><strong>Chatster Class</strong></p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Chatster_Flex_Sync_Class_Model_7f5cf9bc28.png" alt="UML diagram showing the Chatster classâ€”together with its embedded class"></p>
<pre><code class="swift">class Chatster: Object, ObjectKeyIdentifiable {
   @Persisted(primaryKey: true) var _id = UUID().uuidString // This will match the _id of the associated User
   @Persisted var userName = ""
   @Persisted var displayName: String?
   @Persisted var avatarImage: Photo?
   @Persisted var lastSeenAt: Date?
   @Persisted var presence = "Off-Line"
}

class Photo: EmbeddedObject, ObjectKeyIdentifiable {
   @Persisted var _id = UUID().uuidString
   @Persisted var thumbNail: Data?
   @Persisted var picture: Data?
   @Persisted var date = Date()
}
</code></pre>
<p><strong>ChatMessage Class</strong></p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Chat_Message_Flex_Sync_Class_Model_17_25_06_c33478d3e9.png" alt="UML diagram showing the ChatMessage classâ€”together with its embedded class"></p>
<pre><code class="swift">class ChatMessage: Object, ObjectKeyIdentifiable {
   @Persisted(primaryKey: true) var _id = UUID().uuidString
   @Persisted var conversationID = ""
   @Persisted var author: String? // username
   @Persisted var authorID: String
   @Persisted var text = ""
   @Persisted var image: Photo?
   @Persisted var location = List&lt;Double&gt;()
   @Persisted var timestamp = Date()
}

class Photo: EmbeddedObject, ObjectKeyIdentifiable {
   @Persisted var _id = UUID().uuidString
   @Persisted var thumbNail: Data?
   @Persisted var picture: Data?
   @Persisted var date = Date()
}
</code></pre>
<h4>Accessing Synced Realm Data</h4>
<p>Any iOS app that wants to sync Realm data needs to create a Realm <code>App</code> instance, providing the Realm App ID so that the Realm SDK can connect to the backend Realm app:</p>
<pre><code class="swift">let app = RealmSwift.App(id: "rchat-xxxxx") // TODO: Set the Realm application ID
</code></pre>
<p>When a SwiftUI view (in this case, <code>LoggedInView</code>) needs to access synced data, the parent view must flag that flexible sync will be used. It does this by passing the Realm configuration through the SwiftUI environment:</p>
<pre><code class="swift">LoggedInView(userID: $userID)
   .environment(\.realmConfiguration,
               app.currentUser!.flexibleSyncConfiguration())
</code></pre>
<p><code>LoggedInView</code> can then access two variables from the SwiftUI environment:</p>
<pre><code class="swift">struct LoggedInView: View {
   ...
   @Environment(\.realm) var realm
   @ObservedResults(User.self) var users
</code></pre>
<p>The users variable is a live query containing all synced <code>User</code> objects in the Realm. But at this point, no <code>User</code> documents have been synced because we haven&#8217;t subscribed to anything.</p>
<p>That&#8217;s easy to fix. We create a new function (<code>setSubscription</code>) that&#8217;s invoked when the view is opened:</p>
<pre><code class="swift">struct LoggedInView: View {
   ...
   @Binding var userID: String?
   ...
   var body: some View {
       ZStack {
           ...
       }
       .onAppear(perform: setSubscription)
   }

   private func setSubscription() {
       let subscriptions = realm.subscriptions
       subscriptions.write {
           if let currentSubscription = subscriptions.first(named: "user_id") {
               print("Replacing subscription for user_id")
               currentSubscription.update(toType: User.self) { user in
                   user._id == userID!
               }
           } else {
               print("Appending subscription for user_id")
               subscriptions.append(QuerySubscription&lt;User&gt;(name: "user_id") { user in
                   user._id == userID!
               })
           }
       }
   }
}
</code></pre>
<p>Subscriptions are given a name to make them easier to work with. I named this one <code>user_id</code>.</p>
<p>The function checks whether there&#8217;s already a subscription named <code>user_id</code>. If there is, then the function replaces it. If not, then it adds the new subscription. In either case, the subscription is defined by passing in a query that finds any <code>User</code> documents/objects where the <code>_id</code> field matches the current user&#8217;s ID.</p>
<p>The subscription should sync exactly one <code>User</code> object to the realm, and so the code for the view&#8217;s body can work with the <code>first</code> object in the results:</p>
<pre><code class="swift">struct LoggedInView: View {
   ...
   @ObservedResults(User.self) var users
   @Binding var userID: String?
   ...
   var body: some View {
       ZStack {
           if let user = users.first {
               ...
               ConversationListView(user: user)
               ...
           }
       }
       .navigationBarTitle("Chats", displayMode: .inline)
       .onAppear(perform: setSubscription)
   }
}
</code></pre>
<p>Other views work with different model classes and sync queries. For example, when the user clicks on a chat room, a new view is opened that displays all of the <code>ChatMessage</code>s for that conversation:</p>
<pre><code class="swift">struct ChatRoomBubblesView: View {
   ...
   @ObservedResults(ChatMessage.self, sortDescriptor: SortDescriptor(keyPath: "timestamp", ascending: true)) var chats
   @Environment(\.realm) var realm
   ...
   var conversation: Conversation?
   ...
   var body: some View {
       VStack {
           ...
       }
       .onAppear { loadChatRoom() }
   }

   private func loadChatRoom() {
       ...
       setSubscription()
       ...
   }

   private func setSubscription() {
       let subscriptions = realm.subscriptions
       subscriptions.write {
           if let conversation = conversation {
               if let currentSubscription = subscriptions.first(named: "conversation") {
                   currentSubscription.update(toType: ChatMessage.self) { chatMessage in
                       chatMessage.conversationID == conversation.id
                   }
               } else {
                   subscriptions.append(QuerySubscription&lt;ChatMessage&gt;(name: "conversation") { chatMessage in
                       chatMessage.conversationID == conversation.id
                   })
               }
           }
       }
   }
}
</code></pre>
<p>In this case, the query syncs all <code>ChatMessage</code> objects where the <code>conversationID</code> matches the <code>id</code> of the <code>Conversation</code> object passed to the view.</p>
<p>The view&#8217;s body can then iterate over all of the matching, synced objects:</p>
<pre><code class="swift">struct ChatRoomBubblesView: View {
...
   @ObservedResults(ChatMessage.self,
       sortDescriptor: SortDescriptor(keyPath: "timestamp", ascending: true)) var chats
   ...
   var body: some View {
       ...
       ForEach(chats) { chatMessage in
           ChatBubbleView(chatMessage: chatMessage,
                           authorName: chatMessage.author != user.userName ? chatMessage.author : nil,
                           isPreview: isPreview)
       }
       ...
   }
}
</code></pre>
<p>As it stands, there&#8217;s some annoying behavior. If you open conversation A, go back, and then open conversation B, you&#8217;ll initially see all of the messages from conversation A. The reason is that it takes a short time for the updated subscription to replace the <code>ChatMessage</code> objects in the synced Realm. I solve that by explicitly removing the subscription (which purges the synced objects) when closing the view:</p>
<pre><code class="swift">struct ChatRoomBubblesView: View {
   ...
   @Environment(\.realm) var realm
   ...
   var body: some View {
       VStack {
           ...
       }
       .onDisappear { closeChatRoom() }
   }

   private func closeChatRoom() {
       clearSubscription()
       ...
   }

   private func clearSubscription() {
       print("Leaving room, clearing subscription")
       let subscriptions = realm.subscriptions
       subscriptions.write {
           subscriptions.remove(named: "conversation")
       }
   }
}
</code></pre>
<p>I made a design decision that I&#8217;d use the same name (&#8220;conversation&#8221;) for this view, regardless of which conversation/chat room it&#8217;s working with. An alternative would be to create a unique subscription whenever a new chat room is opened (including the ID of the conversation in the name). I could then avoid removing the subscription when navigating away from a chat room.  This second approach would come with two advantages:</p>
<ol>
<li>The app should be more responsive when navigating between chat rooms (if you&#8217;d previously visited the chat room that you&#8217;re opening).</li>
<li>You can switch between chat rooms even when the device isn&#8217;t connected to the internet.</li>
</ol>
<p>The disadvantages of this approach would be:</p>
<ol>
<li>The app could end up with a lot of subscriptions (and there&#8217;s a cost to them).</li>
<li>The app continues to store all of the messages from any chat room that you&#8217;ve ever visited from this device. That consumes extra device storage and network bandwidth as messages from all of those rooms continue to be synced to the app.</li>
</ol>
<p>A third approach would be to stick with a single subscription (named &#8220;conversations&#8221;) that matches every <code>ChatMessage</code> object. The view would then need to apply a filter on the resulting <code>ChatMessage</code> objects so it only displayed those for the open chat room. This has the same advantages as the second approach, but can consume even more storage as the device will contain messages from all chat roomsâ€”including those that the user has never visited.</p>
<p>Note that a different user can log into the app from the same device. You don&#8217;t want that user to be greeted with someone else&#8217;s data. To avoid that, the app removes all subscriptions when a user logs out:</p>
<pre><code class="swift">struct LogoutButton: View {
   ...
   @Environment(\.realm) var realm


   var body: some View {
       Button("Log Out") { isConfirming = true }
       .confirmationDialog("Are you that you want to logout",
                           isPresented: $isConfirming) {
           Button("Confirm Logout", role: .destructive, action: logout)
           Button("Cancel", role: .cancel) {}
       }
       .disabled(state.shouldIndicateActivity)
   }

   private func logout() {
       ...
       clearSubscriptions()
       ...
   }

   private func clearSubscriptions() {
       let subscriptions = realm.subscriptions
       subscriptions.write {
           subscriptions.removeAll()
       }
   }
}
</code></pre>
<h2>Conclusion</h2>
<p>In this article, you&#8217;ve seen how to include Realm Flexible Sync in your mobile app. I&#8217;ve shown the code for Swift, but the approach would be the same when building apps with Kotlin, Javascript, or .NET.</p>
<p>This is a preview release and we want your feedback.</p>
<p>Realm Flexible Sync will evolve to include more query and permission operators. Up next, we&#8217;re looking to expose array operators (that would allow me to add tighter restrictions on who can ask to read which chat messages). We&#8217;ll also enable querying on embedded documents.</p>
<p>Another feature I&#8217;d like to see is to limit which fields from a document get synced to a given user. This could allow the removal of the <code>Chatster</code> collection, as it&#8217;s only there to provide a read-only view of a subset of <code>User</code> fields to other users.</p>
<p>Want to suggest an enhancement or up-vote an existing request? The most effective way is through our <a href="https://feedback.mongodb.com/forums/923521-realm">feedback portal</a>.</p>
<p>Got questions? Ask them in our <a href="https://www.mongodb.com/community/forums/c/realm/realm-sync/111">Community forum</a>.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/using-realm-flexible-sync-in-your-app-an-ios-tutorial" data-via="wpbeginner" data-text="Using Realm Flexible Sync in Your Appâ€”an iOS Tutorial" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/using-realm-flexible-sync-in-your-app-an-ios-tutorial"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/using-realm-flexible-sync-in-your-app-an-ios-tutorial" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Fusing-realm-flexible-sync-in-your-app-an-ios-tutorial&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../category/mongodb/index.html" rel="category tag">MongoDB</a>, <a href="./../category/mongodb/realm/index.html" rel="category tag">Realm</a> | 
Tags: <a href="./mongodb/index.html" rel="tag">mongodb</a>, <a href="./realm/index.html" rel="tag">Realm</a>, <a href="./swiftui/index.html" rel="tag">SwiftUI</a>
</div>

			</div>			<div id="post-4659" class="post-4659 post type-post status-publish format-standard has-post-thumbnail hentry category-mongodb category-realm tag-mongodb tag-realm tag-swift tag-swiftui">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../mongodb/realm-swift-type-projections/index.html">January 26, 2022</a>
			</div>
	<div class="postcomments">
		<a href="./../mongodb/realm-swift-type-projections/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../mongodb/realm-swift-type-projections/index.html" rel="bookmark">Realm-Swift Type Projections</a></h2>
				
				<div class="entry">
					<img width="150" height="150" src="./../wp-content/uploads/2022/01/TP-ATF-720x720-1-150x150.png" class="alignleft wp-post-image" alt="" decoding="async" srcset="./../wp-content/uploads/2022/01/TP-ATF-720x720-1-150x150.png 150w, ./../wp-content/uploads/2022/01/TP-ATF-720x720-1-300x300.png 300w, ./../wp-content/uploads/2022/01/TP-ATF-720x720-1-144x144.png 144w, ./../wp-content/uploads/2022/01/TP-ATF-720x720-1.png 720w" sizes="(max-width: 150px) 100vw, 150px">					<h2>Introduction</h2>
<p><a href="https://docs.mongodb.com/realm/sdk/swift/data-types/supported-property-types/">Realm natively provides a broad set of data types</a>, including <code>Bool</code>, <code>Int</code>, <code>Float</code>, <code>Double</code>, <code>String</code>, <code>Date</code>, <code>ObjectID</code>, <code>List</code>, <code>Mutable Set</code>, <code>enum</code>, <code>Map</code>, â€¦</p>
<p>But, there are other data types that many of your iOS apps are likely to use. As an example, if you&#8217;re using Core Graphics, then it&#8217;s hard to get away without using types such as <code>CGFloat</code>, <code>CGPoint</code>, etc. When working with SwiftUI, you use the <a href="https://developer.apple.com/documentation/swiftui/color"><code>Color</code></a> struct when working with colors.</p>
<p>A typical design pattern is to persist data using types natively supported by Realm, and then use a richer set of types in your app. When reading data, you add extra boilerplate code to convert them to your app&#8217;s types. When persisting data, you add more boilerplate code to convert your data back into types supported by Realm.</p>
<p>That works fine and gives you complete control over the type conversions. The downside is that you can end up with dozens of places in your code where you need to make the conversion.</p>
<p>Type projections still give you total control over how to map a <code>CGPoint</code> into something that can be persisted in Realm. But, you write the conversion code just once and then forget about it. The Realm-Swift SDK will then ensure that types are converted back and forth as required in the rest of your app.</p>
<p>The Realm-Swift SDK enables this by adding two new protocols that you can use to extend any Swift type. You opt whether to implement <code>CustomPersistable</code> or the version that&#8217;s allowed to fail (<code>FailableCustomPersistable</code>):</p>
<pre><code class="swift">protocol CustomPersistable {
   associatedtype PersistedType
   init(persisted: PersistedType)
   var persistableValue: PersistedType { get }
}
protocol FailableCustomPersistable {
   associatedtype PersistedType
   init?(persisted: PersistedType)
   var persistableValue: PersistedType { get }
}
</code></pre>
<p>In this post, I&#8217;ll show how the <a href="https://github.com/realm/Realm-Drawing">Realm-Drawing</a> app uses type projections to interface between Realm and Core Graphics.</p>
<h2>Prerequisites</h2>
<ul>
<li>iOS 15+</li>
<li>Xcode 13.2+</li>
<li><a href="https://github.com/realm/realm-swift/releases">Realm-Swift 10.21.0+</a></li>
</ul>
<h2>The Realm-Drawing App</h2>
<p><a href="https://github.com/realm/Realm-Drawing">Realm-Drawing</a> is a simple, collaborative drawing app. If two people log into the app using the same username, they can work on a drawing together. All strokes making up the drawing are persisted to Realm and then synced to all other instances of the app where the same username is logged in.</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Realm_Draw_5f4559a2b9.gif" alt="Animated screen captures showing two iOS devices working on the same drawing"></p>
<p>It&#8217;s currently iOS-only, but it would also sync with any Android drawing app that is connected to the same Realm back end.</p>
<h2>Using Type Projections in the App</h2>
<p>The Realm-Drawing iOS app uses three types that aren&#8217;t natively supported by Realm:</p>
<ul>
<li><code>CGFloat</code></li>
<li><code>CGPoint</code></li>
<li>
<code>Color</code> (SwiftUI)</li>
</ul>
<p>In this section, you&#8217;ll see how simple it is to use type projections to convert them into types that can be persisted to Realm and synced.</p>
<h3>Realm Schema (The Model)</h3>
<p>An individual drawing is represented by a single <a href="https://github.com/realm/Realm-Drawing/blob/main/iOS/DrawingApp/Model/Drawing.swift"><code>Drawing</code></a> object:</p>
<pre><code class="swift">class Drawing: Object, ObjectKeyIdentifiable {
   @Persisted(primaryKey: true) var _id: ObjectId
   @Persisted var name = UUID().uuidString
   @Persisted var lines = RealmSwift.List&lt;Line&gt;()
}
</code></pre>
<p>A Drawing contains a <code>List</code> of <a href="https://github.com/realm/Realm-Drawing/blob/main/iOS/DrawingApp/Model/Line.swift"><code>Line</code></a> objects:</p>
<pre><code class="swift">class Line: EmbeddedObject, ObjectKeyIdentifiable {
   @Persisted var lineColor: Color
   @Persisted var lineWidth: CGFloat = 5.0
   @Persisted var linePoints = RealmSwift.List&lt;CGPoint&gt;()
}
</code></pre>
<p>It&#8217;s the <code>Line</code> class that uses the non-Realm-native types.</p>
<p>Let&#8217;s see how each type is handled.</p>
<h4>CGFloat</h4>
<p>I extend <code>CGFloat</code> to conform to Realm-Swift&#8217;s <code>CustomPersistable</code> protocol. All I needed to provide was:</p>
<ul>
<li>An initializer to convert what&#8217;s persisted in Realm (a <code>Double</code>) into the <code>CGFloat</code> used by the model</li>
<li>A method to convert a <code>CGFloat</code> into a <code>Double</code>:</li>
</ul>
<pre><code class="swift">extension CGFloat: CustomPersistable {
   public typealias PersistedType = Double
   public init(persistedValue: Double) { self.init(persistedValue) }
   public var persistableValue: Double { Double(self) }
}
</code></pre>
<p>The <a href="https://github.com/realm/Realm-Drawing/blob/main/iOS/DrawingApp/Views/DrawingView.swift"><code>view</code></a> can then use <code>lineWidth</code> from the model object without worrying about how it&#8217;s converted by the Realm SDK:</p>
<pre><code class="swift">context.stroke(path, with: .color(line.lineColor),
   style: StrokeStyle(
       lineWidth: line.lineWidth,
       lineCap: .round, l
       ineJoin: .round
   )
)
</code></pre>
<h4>CGPoint</h4>
<p><code>CGPoint</code> is a little trickier, as it can&#8217;t just be cast into a Realm-native type. <code>CGPoint</code> contains the x and y coordinates for a point, and so, I create a Realm-friendly class (<a href="https://github.com/realm/Realm-Drawing/blob/main/iOS/DrawingApp/Model/PersistablePoint.swift"><code>PersistablePoint</code></a>) that stores just thatâ€”<code>x</code> and <code>y</code> values as <code>Doubles</code>:</p>
<pre><code class="swift">public class PersistablePoint: EmbeddedObject, ObjectKeyIdentifiable {
   @Persisted var x = 0.0
   @Persisted var y = 0.0

   convenience init(_ point: CGPoint) {
       self.init()
       self.x = point.x
       self.y = point.y
   }
}
</code></pre>
<p>I implement the <code>CustomPersistable</code> protocol for <code>CGPoint</code> by mapping between a <code>CGPoint</code> and the <code>x</code> and <code>y</code> coordinates within a <code>PersistablePoint</code>:</p>
<pre><code class="swift">extension CGPoint: CustomPersistable {
   public typealias PersistedType = PersistablePoint   
   public init(persistedValue: PersistablePoint) { self.init(x: persistedValue.x, y: persistedValue.y) }
   public var persistableValue: PersistablePoint { PersistablePoint(self) }
}
</code></pre>
<h4>SwiftUI.Color</h4>
<p><code>Color</code> is made up of the three RGB components plus the opacity. I use the <a href="https://github.com/realm/Realm-Drawing/blob/main/iOS/DrawingApp/Model/PersistableColor.swift"><code>PersistableColor</code></a> class to persist a representation of <code>Color</code>:</p>
<pre><code class="swift">public class PersistableColor: EmbeddedObject {
   @Persisted var red: Double = 0
   @Persisted var green: Double = 0
   @Persisted var blue: Double = 0
   @Persisted var opacity: Double = 0

   convenience init(color: Color) {
       self.init()
       if let components = color.cgColor?.components {
           if components.count &gt;= 3 {
               red = components[0]
               green = components[1]
               blue = components[2]
           }
           if components.count &gt;= 4 {
               opacity = components[3]
           }
       }
   }
}
</code></pre>
<p>The extension to implement <code>CustomPersistable</code> for <code>Color</code> provides methods to initialize <code>Color</code> from a <code>PersistableColor</code>, and to generate a <code>PersistableColor</code> from itself:</p>
<pre><code class="swift">extension Color: CustomPersistable {
   public typealias PersistedType = PersistableColor

   public init(persistedValue: PersistableColor) { self.init(
       .sRGB,
       red: persistedValue.red,
       green: persistedValue.green,
       blue: persistedValue.blue,
       opacity: persistedValue.opacity) }

   public var persistableValue: PersistableColor {
       PersistableColor(color: self)
   }
}
</code></pre>
<p>The <a href="https://github.com/realm/Realm-Drawing/blob/main/iOS/DrawingApp/Views/DrawingView.swift">view</a> can then use <code>selectedColor</code> from the model object without worrying about how it&#8217;s converted by the Realm SDK:</p>
<pre><code class="swift">context.stroke(
   path,
   with: .color(line.lineColor),
   style: StrokeStyle(lineWidth:
   line.lineWidth,
   lineCap: .round,
   lineJoin: .round)
)
</code></pre>
<h2>Conclusion</h2>
<p>Type projections provide a simple, elegant way to convert any type to types that can be persisted and synced by Realm.</p>
<p>It&#8217;s your responsibility to define how the mapping is implemented. After that, the Realm SDK takes care of everything else.</p>
<p>Please provide feedback and ask any questions in the <a href="https://www.mongodb.com/community/forums/c/realm-sdks/58">Realm Community Forum</a>.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/realm-swift-type-projections" data-via="wpbeginner" data-text="Realm-Swift Type Projections" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/realm-swift-type-projections"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/realm-swift-type-projections" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Frealm-swift-type-projections&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../category/mongodb/index.html" rel="category tag">MongoDB</a>, <a href="./../category/mongodb/realm/index.html" rel="category tag">Realm</a> | 
Tags: <a href="./mongodb/index.html" rel="tag">mongodb</a>, <a href="./realm/index.html" rel="tag">Realm</a>, <a href="./swift/index.html" rel="tag">Swift</a>, <a href="./swiftui/index.html" rel="tag">SwiftUI</a>
</div>

			</div>			<div id="post-4643" class="post-4643 post type-post status-publish format-standard has-post-thumbnail hentry category-mongodb category-realm tag-realm tag-swift tag-swiftui">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../mongodb/making-swiftui-previews-work-for-you/index.html">November 4, 2021</a>
			</div>
	<div class="postcomments">
		<a href="./../mongodb/making-swiftui-previews-work-for-you/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../mongodb/making-swiftui-previews-work-for-you/index.html" rel="bookmark">Making SwiftUI Previews Work For You</a></h2>
				
				<div class="entry">
					<img width="150" height="150" src="./../wp-content/uploads/2021/11/preview-multiple-devices-150x150.png" class="alignleft wp-post-image" alt="" decoding="async" loading="lazy" srcset="./../wp-content/uploads/2021/11/preview-multiple-devices-150x150.png 150w, ./../wp-content/uploads/2021/11/preview-multiple-devices-144x144.png 144w" sizes="auto, (max-width: 150px) 100vw, 150px">					<h2>Introduction</h2>
<p>Canvas previews are an in-your-face feature of SwiftUI. When you create a new view, half of the boilerplate code is for the preview. A third of your Xcode real estate is taken up by the preview.</p>
<p>Despite the prominence of the feature, many developers simply delete the preview code from their views and rely on the simulator.</p>
<p>In past releases of Xcode (including the Xcode 13 betas), a reluctance to use previews was understandable. They&#8217;d fail for no apparent reason, and the error messages were beyond cryptic.</p>
<p>I&#8217;ve stuck with previews from the start, but at times, they&#8217;ve felt like more effort than they&#8217;re worth. But, with Xcode 13, I think we should all be using them for all views. In particular, I&#8217;ve noticed:</p>
<ul>
<li>They&#8217;re more reliable.</li>
<li>The error messages finally make sense.</li>
<li>Landscape mode is supported.</li>
</ul>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/preview_multiple_devices_8cfe4cccd4.png" alt="Xcode showing a blackjack app with multiple previews for different devices, orientations, and color schemes"></p>
<p>I consider previews a little like UI unit tests for your views. Like with unit tests, there&#8217;s some extra upfront effort required, but you get a big payback in terms of productivity and quality.</p>
<p>In this article, I&#8217;m going to cover:</p>
<ul>
<li>What you can check in your previews (think light/dark mode, different devices, landscape mode, etc.) and how to do it.</li>
<li>Reducing the amount of boilerplate code you need in your previews.</li>
<li>Writing previews for stateful apps. (I&#8217;ll be using <a href="https://realm.io/">Realm</a>, but the same approach can be used with Core Data.)</li>
<li>Troubleshooting your previews.</li>
</ul>
<p>One feature I won&#8217;t cover is using previews as a graphical way to edit views. One of the big draws of SwiftUI is writing everything in code rather than needing storyboards and XML files. Using a drag-and-drop view builder for SwiftUI doesn&#8217;t appeal to me.</p>
<p>95% of the examples I use in this article are based on a BlackJack training app. You can find the final version in the <a href="https://github.com/mongodb-developer/BlackJackTrainer">repo</a>.</p>
<h2>Prerequisites</h2>
<ul>
<li>Xcode 13+</li>
<li>iOS 15+</li>
<li>Realm-Cocoa 10.17.0+</li>
</ul>
<p>Note:</p>
<ul>
<li>I&#8217;ve used Xcode 13 and iOS 15, but most of the examples in this post will work with older versions.</li>
<li>Previewing in landscape mode is new in Xcode 13.</li>
<li>The <code>buttonStyle</code> modifier is only available in iOS 15.</li>
<li>I used Realm-Cocoa 10.17.0, but earlier 10.X versions are likely to work. </li>
</ul>
<h2>Working with previews</h2>
<p>Previews let you see what your view looks like without running it in a simulator or physical device. When you edit the code for your view, its preview updates in real time.</p>
<p>This section shows what aspects you can preview, and how it&#8217;s done.</p>
<h3>A super-simple preview</h3>
<p>When you create a new Xcode project or SwiftUI view, Xcode adds the code for the preview automatically. All you need to do is press the &#8220;Resume&#8221; button (or CMD-Alt-P).</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/simple_preview_a0d9cef7ab.gif" alt="A simple Xcode preview which updates as the code is edited"></p>
<p>The preview code always has the same structure, with the <code>View</code> that needs previewing (in this case, <code>ContentView</code>) within the <code>previews</code> <code>View</code>:</p>
<pre><code class="swift">struct ContentView_Previews: PreviewProvider {
   static var previews: some View {
       ContentView()
   }
}
</code></pre>
<h3>Views that require parameters</h3>
<p>Most of your views will require that the enclosing view pass in parameters. Your preview must do the sameâ€”you&#8217;ll get a build error if you forget.</p>
<p>My <a href="https://github.com/mongodb-developer/BlackJackTrainer/blob/main/Black%20Jack%20Trainer/Black%20Jack%20Trainer/Views/Decision%20Matrix/ResetButton.swift"><code>ResetButton</code></a> view requires that the caller provides two valuesâ€”<code>label</code> and <code>resetType</code>:</p>
<pre><code class="swift">struct ResetButton: View {
   var label: String
   var resetType: ResetType
   ...
}
</code></pre>
<p>The preview code needs to pass in those values, just like any embedding view:</p>
<pre><code class="swift">struct ResetButton_Previews: PreviewProvider {
   static var previews: some View {
       ResetButton(label: "Reset All Matrices",
                   resetType: .all)
   }
}
</code></pre>
<h3>Views that require <code>Binding</code>s</h3>
<p>In a chat app, I have a <a href="https://github.com/mongodb-developer/LiveTutorial2021/blob/main/iOS/LiveChat/LiveChat/Views/LoginView.swift"><code>LoginView</code></a> that updates the <code>username</code> binding that&#8217;s past from the enclosing view:</p>
<pre><code class="swift">struct LoginView: View {  
   @Binding var username: String
   ...
}
</code></pre>
<p>The simplest way to create a binding in your preview is to use the <code>constant</code> function:</p>
<pre><code class="swift">struct LoginView_Previews: PreviewProvider {
   static var previews: some View {
       LoginView(username: .constant("Billy"))
   }
}
</code></pre>
<h3>
<code>NavigationView</code>s</h3>
<p>In your view hierarchy, you only add a <code>NavigationView</code> at a single level. That <code>NavigationView</code> then wraps all subviews.</p>
<p>When previewing those subviews, you may or may not care about the <code>NavigationView</code> functionality. For example, you&#8217;ll only see titles and buttons in the top nav bar if your preview wraps the view in a <code>NavigationView</code>.</p>
<p>If I preview my <a href="https://github.com/mongodb-developer/BlackJackTrainer/blob/main/Black%20Jack%20Trainer/Black%20Jack%20Trainer/Views/PracticeView.swift"><code>PracticeView</code></a> without adding a <code>NavigationView</code>, then I don&#8217;t see the title:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/no_title_171f797127.png" alt="Preview where there is no title on the screen"></p>
<p>To preview the title, my preview code needs to wrap <code>PracticeView</code> in a <code>NavigationView</code>:</p>
<pre><code class="swift">struct PracticeView_Previews: PreviewProvider {
   static var previews: some View {
       NavigationView {
           PracticeView()
       }
   }
}
</code></pre>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/with_title_bf15560aac.png" alt="Preview with title"></p>
<h3>Smaller views</h3>
<p>Sometimes, you don&#8217;t need to preview your view in the context of a full device screen. My <a href="https://github.com/mongodb-developer/BlackJackTrainer/blob/main/Black%20Jack%20Trainer/Black%20Jack%20Trainer/Views/CardView.swift"><code>CardView</code></a> displays a single playing card. Previewing it in a full device screen just wastes desk space:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/full_device_preview_c8ffd5925f.png" alt="Lots of preview space taken up for the iPhone, but the view we're testing only takes up a tiny proportion of the space"></p>
<p>We can add the <code>previewLayout</code> modifier to indicate that we only want to preview an area large enough for the view. It often makes sense to add some <code>padding</code> as well:</p>
<pre><code class="swift">struct CardView_Previews: PreviewProvider {
   static var previews: some View {
       CardView(card: Card(suit: .heart))
           .previewLayout(.sizeThatFits)
           .padding()
   }
}
</code></pre>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/no_device_bfc4332e8f.png" alt="Lots of screen space freed up by only previewing the view (rather than the entire iPhone screen"></p>
<h3>Light and dark modes</h3>
<p>It can be quite a shock when you finally get around to testing your app in dark mode. If you&#8217;ve not thought about light/dark mode when implementing each of your views, then the result can be ugly, or even unusable.</p>
<p>Previews to the rescue!</p>
<p>Returning to <a href="https://github.com/mongodb-developer/BlackJackTrainer/blob/main/Black%20Jack%20Trainer/Black%20Jack%20Trainer/Views/CardView.swift"><code>CardView</code></a>, I can preview a card in dark mode using the <code>preferredColorScheme</code> view modifier:</p>
<pre><code class="swift">struct CardView_Previews: PreviewProvider {
   static var previews: some View {
       CardView(card: Card(suit: .heart))
           .preferredColorScheme(.dark)
           .previewLayout(.sizeThatFits)
           .padding()
   }
}
</code></pre>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/dark_heart_bbecd98b30.png" alt="10 Hearts displaying correctly in front of a dark background"></p>
<p>That seems fine, but what if I previewed a spade instead?</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/dark_spade_fe9e8efa1d.png" alt="Black spade isn't visible in front of dark background"></p>
<p>That could be a problem.</p>
<p>Adding a white background to the view fixes it:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/dark_spade_2_d61601c19e.png" alt="King of spades now shows up as it sits in a white box"></p>
<h3>Preview multiple view instances</h3>
<p>Sometimes, previewing a single instance of your view doesn&#8217;t paint the full picture. Just look at the surprise I got when enabling dark mode for my card view. Wouldn&#8217;t it be better to simultaneously preview both hearts and spades in both dark and light modes?</p>
<p>You can create multiple previews for the same view using the <code>Group</code> view:</p>
<pre><code class="swift">struct CardView_Previews: PreviewProvider {
   static var previews: some View {
       Group {
           CardView(card: Card(suit: .heart))
           CardView(card: Card(suit: .spade))
           CardView(card: Card(suit: .heart))
               .preferredColorScheme(.dark)
           CardView(card: Card(suit: .spade))
               .preferredColorScheme(.dark)
       }
       .previewLayout(.sizeThatFits)
       .padding()
   }
}
</code></pre>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/multiple_cards_835ef6cf03.png" alt="Multiple cards, each with their own preview"></p>
<h3>Composing views in a preview</h3>
<p>A preview of a single view in isolation might look fine, but what will they look like within a broader context?</p>
<p>Previewing a single <a href="https://github.com/mongodb-developer/BlackJackTrainer/blob/main/Black%20Jack%20Trainer/Black%20Jack%20Trainer/Views/Decision%20Matrix/DecisionCell.swift"><code>DecisionCell</code></a> view looks great:</p>
<pre><code class="swift">struct DecisionCell_Previews: PreviewProvider {
   static var previews: some View {
       DecisionCell(
           decision: Decision(handValue: 6, dealerCardValue: .nine, action: .hit), myHandValue: 8, dealerCardValue: .five)
           .previewLayout(.sizeThatFits)
           .padding()
   }
}
</code></pre>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/single_decision_cell_ea54c12fee.png" alt="A single, yellow Hit cell"></p>
<p>But, the app will never display a single <code>DecisionCell</code>. They&#8217;ll always be in a grid. Also, the text, background color, and border vary according to state. To create a more realistic preview, I created some sample data within the view and then composed multiple <code>DecisionCell</code>s using vertical and horizontal stacks:</p>
<pre><code class="swift">struct DecisionCell_Previews: PreviewProvider {
   static var previews: some View {
       let decisions: [Decision] = [
           Decision(handValue: 6, dealerCardValue: .nine, action: .split),
           Decision(handValue: 6, dealerCardValue: .nine, action: .stand),
           Decision(handValue: 6, dealerCardValue: .nine, action: .double),
           Decision(handValue: 6, dealerCardValue: .nine, action: .hit)
       ]
       return Group {
           VStack(spacing: 0) {
               ForEach(decisions) { decision in
                   HStack (spacing: 0) {
                       DecisionCell(decision: decision, myHandValue: 8, dealerCardValue: .three)
                       DecisionCell(decision: decision, myHandValue: 6, dealerCardValue: .three)
                       DecisionCell(decision: decision, myHandValue: 8, dealerCardValue: .nine)
                       DecisionCell(decision: decision, myHandValue: 6, dealerCardValue: .nine)
                   }
               }
           }
           VStack(spacing: 0) {
               ForEach(decisions) { decision in
                   HStack (spacing: 0) {
                       DecisionCell(decision: decision, myHandValue: 8, dealerCardValue: .three)
                       DecisionCell(decision: decision, myHandValue: 6, dealerCardValue: .three)
                       DecisionCell(decision: decision, myHandValue: 8, dealerCardValue: .nine)
                       DecisionCell(decision: decision, myHandValue: 6, dealerCardValue: .nine)
                   }
               }
           }
           .preferredColorScheme(.dark)
       }
       .previewLayout(.sizeThatFits)
       .padding()
   }
</code></pre>
<p>I could then see that the black border didn&#8217;t work too well in dark mode:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/stacked_decisions_47d742bf14.png" alt="Dark border around selected cells is lost in front of the dark background"></p>
<p>Switching the border color from <code>black</code> to <code>primary</code> quickly fixed the issue:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/stacked_decisions2_ecf23e1695.png" alt="White frame around selected cell is visible in front of dark background"></p>
<h3>Landscape mode</h3>
<p>Previews default to portrait mode. Use the <code>previewInterfaceOrientation</code> modifier to preview in landscape mode instead:</p>
<pre><code class="swift">struct ContentView_Previews: PreviewProvider {
   static var previews: some View {
       ContentView()
           .previewInterfaceOrientation(.landscapeRight)
   }
}
</code></pre>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/landscape_80d4442055.png" alt="iPhone app previewed in lanscape mode"></p>
<h3>Device type</h3>
<p>Previews default to the simulator device that you&#8217;ve selected in Xcode. Chances are that you want your app to work well on multiple devices. Typically, I find that there&#8217;s extra work needed to make an app I designed for the iPhone work well on an iPad.</p>
<p>The <code>previewDevice</code> modifier lets us specify the device type to use in the preview:</p>
<pre><code class="swift">struct ContentView_Previews: PreviewProvider {
   static var previews: some View {
       ContentView()
           .previewDevice(PreviewDevice(rawValue: "iPad (9th generation)"))
   }
}
</code></pre>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/i_Pad_27efe03ad8.png" alt="App previewed on an iPad"></p>
<p>You can find the names of the available devices from Xcode&#8217;s simulator menu, or from the terminal using <code>xcrun simctl list devices</code>.</p>
<h3>Pinning views</h3>
<p>In the bottom-left corner of the preview area, there&#8217;s a pin button. Pressing this &#8220;pins&#8221; the current preview so that it&#8217;s still shown when you browse to the code for other views:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/pin_icon_82889deb40.png" alt="Pin icon in Xcode"></p>
<p>This is useful to observe how a parent view changes as you edit the code for the child view:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/pin_2ac0418850.gif" alt="Animation of the pinned view continuing to be shown and updates as the developer switches to other views in Xcode"></p>
<h3>Live previews</h3>
<p>At the start of this article, I made a comparison between previews and unit testing. Live previews mean that you really can test your views in isolation (to be accurate, the view you&#8217;re testing plus all of the views it embeds or links to).</p>
<p>Press the play button above the preview to enter live mode:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/play_button_4c5824b927.png" alt="Play button above Xcode preview"></p>
<p>You can now interact with your view:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/live_mode_6bcaa486c9.gif" alt="Preview responds to user actions"></p>
<h2>Getting rid of excess boilerplate preview code</h2>
<p>As you may have noticed, some of my previews now have more code than the actual views. This isn&#8217;t necessarily a problem, but there&#8217;s a lot of repeated boilerplate code used by multiple views. Not only that, but you&#8217;ll be embedding the same boilerplate code into previews in other projects.</p>
<p>To streamline my preview code, I&#8217;ve created several view builders. They all follow the same patternâ€”receive a <code>View</code> and return a new <code>View</code> that&#8217;s built from that <code>View</code>.</p>
<p>I start the name of each view builder with <code>_Preview</code> to make it easy to take advantage of Xcode&#8217;s code completion feature.</p>
<h3>Light/dark mode</h3>
<p><a href="https://github.com/mongodb-developer/BlackJackTrainer/blob/main/Black%20Jack%20Trainer/Black%20Jack%20Trainer/Preview%20Content/Custom%20Previews/_PreviewColorScheme.swift"><code>_PreviewColorScheme</code></a> returns a <code>Group</code> of copies of the view. One is in light mode, the other dark:</p>
<pre><code class="swift">struct _PreviewColorScheme&lt;Value: View&gt;: View {
   private let viewToPreview: Value

   init(_ viewToPreview: Value) {
       self.viewToPreview = viewToPreview
   }

   var body: some View {
       Group {
           viewToPreview
           viewToPreview.preferredColorScheme(.dark)
       }
   }
}
</code></pre>
<p>To use this view builder in a preview, simply pass in the <code>View</code> you&#8217;re previewing:</p>
<pre><code class="swift">struct CardView_Previews: PreviewProvider {
   static var previews: some View {
       _PreviewColorScheme(
           VStack {
               ForEach(Suit.allCases, id: \.rawValue) { suit in
                   CardView(card: Card(suit: suit))
               }
           }
               .padding()
               .previewLayout(.sizeThatFits)
       )
   }
}
</code></pre>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/preview_color_c1a36666a1.png" alt="multiple cards shown in the same preview"></p>
<h3>Orientation</h3>
<p><a href="https://github.com/mongodb-developer/BlackJackTrainer/blob/main/Black%20Jack%20Trainer/Black%20Jack%20Trainer/Preview%20Content/Custom%20Previews/_PreviewOrientation.swift"><code>_PreviewOrientation</code></a> returns a <code>Group</code> containing the original <code>View</code> in portrait and landscape modes:</p>
<pre><code class="swift">struct _PreviewOrientation&lt;Value: View&gt;: View {
   private let viewToPreview: Value

   init(_ viewToPreview: Value) {
       self.viewToPreview = viewToPreview
   }

   var body: some View {
       Group {
           viewToPreview
           viewToPreview.previewInterfaceOrientation(.landscapeRight)
       }
   }
}
</code></pre>
<p>To use this view builder in a preview, simply pass in the <code>View</code> you&#8217;re previewing:</p>
<pre><code class="swift">struct ContentView_Previews: PreviewProvider {
   static var previews: some View {
       _PreviewOrientation(
           ContentView()
       )
   }
}
</code></pre>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/preview_Orientation_400bbf69dc.png" alt="Preview showing the same view in portrait and lanscape modes"></p>
<h3>No device</h3>
<p><a href="https://github.com/mongodb-developer/BlackJackTrainer/blob/main/Black%20Jack%20Trainer/Black%20Jack%20Trainer/Preview%20Content/Custom%20Previews/_PreviewNoDevice.swift"><code>_PreviewNoDevice</code></a> returns a view built from adding the <code>previewLayout</code> modifier and adding `padding to the input view:</p>
<pre><code class="swift">struct _PreviewNoDevice&lt;Value: View&gt;: View {
   private let viewToPreview: Value

   init(_ viewToPreview: Value) {
       self.viewToPreview = viewToPreview
   }

   var body: some View {
       Group {
           viewToPreview
               .previewLayout(.sizeThatFits)
               .padding()
       }
   }
}
</code></pre>
<p>To use this view builder in a preview, simply pass in the <code>View</code> you&#8217;re previewing:</p>
<pre><code class="swift">struct CardView_Previews: PreviewProvider {
   static var previews: some View {
       _PreviewNoDevice(
           CardView(card: Card())
       )
   }
}
</code></pre>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/preview_no_device_1_c61ae16f88.png" alt="9 Clubs previewed in a small window"></p>
<h3>Multiple devices</h3>
<p><a href="https://github.com/mongodb-developer/BlackJackTrainer/blob/main/Black%20Jack%20Trainer/Black%20Jack%20Trainer/Preview%20Content/Custom%20Previews/_PreviewDevices.swift"><code>_PreviewDevices</code></a> returns a <code>Group</code> containing a copy of the <code>View</code> for each device type. You can modify <code>devices</code> in the code to include the devices you want to see previews for:</p>
<pre><code class="swift">struct _PreviewDevices&lt;Value: View&gt;: View {
   let devices = [
       "iPhone 13 Pro Max",
       "iPhone 13 mini",
       "iPad (9th generation)"
   ]

   private let viewToPreview: Value

   init(_ viewToPreview: Value) {
       self.viewToPreview = viewToPreview
   }

   var body: some View {
       Group {
           ForEach(devices, id: \.self) { device in
               viewToPreview
                   .previewDevice(PreviewDevice(rawValue: device))
                   .previewDisplayName(device)
           }
       }
   }
}
</code></pre>
<p>I&#8217;d be cautious about adding too many devices as it will make any previews using this view builder slow down and consume resources.</p>
<p>To use this view builder in a preview, simply pass in the <code>View</code> you&#8217;re previewing:</p>
<pre><code class="swift">struct ContentView_Previews: PreviewProvider {
   static var previews: some View {
       _PreviewDevices(
           ContentView()
       )
   }
}
</code></pre>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/pasted_image_0_c78c26b145.png" alt="The same view previewed on 3 different device types"></p>
<h3>Combining multiple view builders</h3>
<p>Each view builder receives a view and returns a new view. That means that you can compose the functions by passing the results of one view builder to another. In the extreme case, you can use up to three on the same view preview:</p>
<pre><code class="swift">struct ContentView_Previews: PreviewProvider {
   static var previews: some View {
       _PreviewOrientation(
           _PreviewColorScheme(
               _PreviewDevices(ContentView())
           )
       )
   }
}
</code></pre>
<p>This produces 12 views to cover all permutations of orientation, appearance, and device.</p>
<p>For each view, you should consider which modifiers add value. For the <code>CardView</code>, it makes sense to use <code>_PreviewNoDevice</code> and <code>_PreviewColorSchem</code>e, but previewing on different devices and orientations wouldn&#8217;t add any value.</p>
<h2>Previewing stateful views (Realm)</h2>
<p>Often, a SwiftUI view will fetch state from a database such as Realm or Core Data. For that to work, there needs to be data in that database.</p>
<p>Previews are effectively running on embedded iOS simulators. That helps explain how they are both slower and more powerful than you might expect from a &#8220;preview&#8221; feature. That also means that each preview also contains a Realm database (assuming that you&#8217;re using the <a href="https://github.com/realm/realm-cocoa">Realm-Cocoa SDK</a>). The preview can store data in that database, and the view can access that data.</p>
<p>In the BlackJack training app, the action to take for each player/dealer hand combination is stored in Realm. For example, <a href="https://github.com/mongodb-developer/BlackJackTrainer/blob/main/Black%20Jack%20Trainer/Black%20Jack%20Trainer/Views/Decision%20Matrix/DefaultDecisionView.swift"><code>DefaultDecisionView</code></a> uses <code>@ObservedResults</code> to access data from Realm:</p>
<pre><code class="swift">struct DefaultDecisionView: View {
   @ObservedResults(Decisions.self,
                    filter: NSPredicate(format: "isSoft == NO AND isSplit == NO")) var decisions
</code></pre>
<p>To ensure that there&#8217;s data for the previewed view to find, the preview checks whether the Realm database already contains data (<code>Decisions.areDecisionsPopulated</code>). If not, then it adds the required data (<code>Decisions.bootstrapDecisions()</code>):</p>
<pre><code class="swift">struct DefaultDecisionView_Previews: PreviewProvider {
   static var previews: some View {
       if !Decisions.areDecisionsPopulated {
           Decisions.bootstrapDecisions()
       }
       return _PreviewOrientation(
           _PreviewColorScheme(
               Group {
                   NavigationView {
                       DefaultDecisionView(myHandValue: 6, dealerCardValue: .nine)
                   }
                   NavigationView {
                       DefaultDecisionView(myHandValue: 6, dealerCardValue: .nine, editable: true)
                   }
               }
                   .navigationViewStyle(StackNavigationViewStyle())
           )
       )
   }
}
</code></pre>
<p><code>DefaultDecisionView</code> is embedded in <a href="https://github.com/mongodb-developer/BlackJackTrainer/blob/main/Black%20Jack%20Trainer/Black%20Jack%20Trainer/Views/Decision%20Matrix/DecisionMatrixView.swift"><code>DecisionMatrixView</code></a> and so the preview for <code>DecisionMatrixView</code> must also conditionally populate the Realm data. In turn, <code>DecisionMatrixView</code> is embedded in <a href="https://github.com/mongodb-developer/BlackJackTrainer/blob/main/Black%20Jack%20Trainer/Black%20Jack%20Trainer/Views/PracticeView.swift"><code>PracticeView</code></a>, and <code>PracticeView</code> in <a href="https://github.com/mongodb-developer/BlackJackTrainer/blob/main/Black%20Jack%20Trainer/Black%20Jack%20Trainer/Views/ContentView.swift"><code>ContentView</code></a>â€”and so, they too need to bootstrap the Realm data so that it&#8217;s available further down the view hierarchy.</p>
<p>This is the implementation of the bootstrap functions:</p>
<pre><code class="swift">extension Decisions {
   static var areDecisionsPopulated: Bool {
       do {
           let realm = try Realm()
           let decisionObjects = realm.objects(Decisions.self)
           return decisionObjects.count &gt;= 3
       } catch {
           print("Error, couldn't read decision objects from Realm: \(error.localizedDescription)")
           return false
       }
   }

   static func bootstrapDecisions() {
       do {
           let realm = try Realm()
           let defaultDecisions = Decisions()
           let softDecisions = Decisions()
           let splitDecisions = Decisions()

           defaultDecisions.bootstrap(defaults: defaultDefaultDecisions, handType: .normal)
           softDecisions.bootstrap(defaults: defaultSoftDecisions, handType: .soft)
           splitDecisions.bootstrap(defaults: defaultSplitDecisions, handType: .split)
           try realm.write {
               realm.delete(realm.objects(Decision.self))
               realm.delete(realm.objects(Decisions.self))
               realm.delete(realm.objects(Decision.self))
               realm.delete(realm.objects(Decisions.self))
               realm.add(defaultDecisions)
               realm.add(softDecisions)
               realm.add(splitDecisions)
           }
       } catch {
           print("Error, couldn't read decision objects from Realm: \(error.localizedDescription)")
       }
   }
}
</code></pre>
<h3>Partitioned, synced realms</h3>
<p>The BlackJack training app uses a standalone Realm database. But what happens if the app is using <a href="https://docs.mongodb.com/realm/sync/">Realm Sync</a>?</p>
<p>One option could be to have the SwiftUI preview sync data with your backend Realm service. I think that&#8217;s a bit too complex, and it breaks my paradigm of treating previews like unit tests for views.</p>
<p>I&#8217;ve found that the simplest solution is to make the view aware of whether it&#8217;s been created by a preview or by a running app. I&#8217;ll explain how that works.</p>
<p><a href="https://github.com/realm/RChat/blob/main/RChat-iOS/RChat/Views/Chat%20Messages/AuthorView.swift"><code>AuthorView</code></a> from the <a href="https://github.com/realm/RChat/">RChat</a> app fetches data from Realm:</p>
<pre><code class="swift">struct AuthorView: View {
   @ObservedResults(Chatster.self) var chatsters
   ...
}
</code></pre>
<p>Its preview code bootstraps the embedded realm:</p>
<pre><code class="swift">struct AuthorView_Previews: PreviewProvider {
   static var previews: some View {
       Realm.bootstrap()


       return AppearancePreviews(AuthorView(userName: "rod@contoso.com"))
           .previewLayout(.sizeThatFits)
           .padding()
   }
}
</code></pre>
<p>The app adds bootstrap as an extension to Realm:</p>
<pre><code class="swift">extension Realm: Samplable {
   static func bootstrap() {
       do {
           let realm = try Realm()
           try realm.write {
               realm.deleteAll()
               realm.add(Chatster.samples)
               realm.add(User(User.sample))
               realm.add(ChatMessage.samples)
           }
       } catch {
           print("Failed to bootstrap the default realm")
       }
   }
}
</code></pre>
<p>A complication is that <code>AuthorView</code> is embedded in <a href="https://github.com/realm/RChat/tree/main/RChat-iOS/RChat/Views/Chat%20Messages"><code>ChatBubbleView</code></a>. For the app to work, <code>ChatBubbleView</code> must pass the synced realm configuration to <code>AuthorView</code>:</p>
<pre><code class="swift">AuthorView(userName: authorName)
   .environment(\.realmConfiguration,
                   app.currentUser!.configuration(
                   partitionValue: "all-users=all-the-users"))
</code></pre>
<p><strong>But</strong>, when previewing <code>ChatBubbleView</code>, we want <code>AuthorView</code> to use the preview&#8217;s local, embedded realm (not to be dependent on a Realm back-end app). That means that <code>ChatBubbleView</code> must check whether or not it&#8217;s running as part of a preview:</p>
<pre><code class="swift">struct ChatBubbleView: View {
   ...
   var isPreview = false
   ...
   var body: some View {
       ...
       if isPreview {
           AuthorView(userName: authorName)
       } else {
           AuthorView(userName: authorName)
               .environment(\.realmConfiguration,
                   app.currentUser!.configuration(
                       partitionValue: "all-users=all-the-users"))
       }
       ...
   }
}
</code></pre>
<p>The preview is then responsible for bootstrapping the local realm and flagging to <code>ChatBubbleView</code> that it&#8217;s a preview:</p>
<pre><code class="swift">struct ChatBubbleView_Previews: PreviewProvider {
   static var previews: some View {
       Realm.bootstrap()
       return ChatBubbleView(
           chatMessage: .sample,
           authorName: "jane",
           isPreview: true)
   }
}
</code></pre>
<h2>Troubleshooting your previews</h2>
<p>As mentioned at the beginning of this article, the error messages for failed previews are actually useful in Xcode 13.</p>
<p>That&#8217;s the good news.</p>
<p>The bad news is that you still can&#8217;t use breakpoints or print to the console.</p>
<p>One mitigation is that the <code>previews</code> static var in your preview is a <code>View</code>. That means that you can replace the <code>body</code> of your <code>ContentView</code> with your <code>previews</code> code. You can then run the app in a simulator and add breakpoints or print to the console. It feels odd to use this approach, but I haven&#8217;t found a better option yet.</p>
<h2>Conclusion</h2>
<p>I&#8217;ve had a mixed relationship with SwiftUI previews.</p>
<p>When they work, they&#8217;re a great tool, making it quicker to write your views. Previews allow you to unit test your views. Previews help you avoid issues when your app is running in dark or landscape mode or on different devices.</p>
<p>But, they require effort to build. Prior to Xcode 13, it would be tough to justify that effort because of reliability issues.</p>
<p>I believe that Xcode 13 is the tipping point where the efficiency and quality gains far outweigh the effort of writing preview code. That&#8217;s why I&#8217;ve written this article now.</p>
<p>In this article, you&#8217;ve seen a number of tips to make previews as useful as possible. I&#8217;ve provided four view builders that you can copy directly into your SwiftUI projects, letting you build the best previews with the minimum of code. Finally, you&#8217;ve seen how you can write previews for views that work with data held in a database such as Realm or Core Data.</p>
<p>Please provide feedback and ask any questions in the <a href="https://www.mongodb.com/community/forums/c/realm-sdks/58">Realm Community Forum</a>.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/making-swiftui-previews-work-for-you" data-via="wpbeginner" data-text="Making SwiftUI Previews Work For You" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/making-swiftui-previews-work-for-you"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/making-swiftui-previews-work-for-you" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Fmaking-swiftui-previews-work-for-you&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../category/mongodb/index.html" rel="category tag">MongoDB</a>, <a href="./../category/mongodb/realm/index.html" rel="category tag">Realm</a> | 
Tags: <a href="./realm/index.html" rel="tag">Realm</a>, <a href="./swift/index.html" rel="tag">Swift</a>, <a href="./swiftui/index.html" rel="tag">SwiftUI</a>
</div>

			</div>			<div id="post-4639" class="post-4639 post type-post status-publish format-standard has-post-thumbnail hentry category-realm tag-ios tag-realm tag-swift tag-swiftui">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../mongodb/realm/most-useful-ios-15-swiftui-features/index.html">September 30, 2021</a>
			</div>
	<div class="postcomments">
		<a href="./../mongodb/realm/most-useful-ios-15-swiftui-features/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../mongodb/realm/most-useful-ios-15-swiftui-features/index.html" rel="bookmark">Most Useful iOS 15 SwiftUI Features</a></h2>
				
				<div class="entry">
					<img width="150" height="150" src="./../wp-content/uploads/2021/09/SwiftUI-Features_ATF-150x150.png" class="alignleft wp-post-image" alt="" decoding="async" loading="lazy" srcset="./../wp-content/uploads/2021/09/SwiftUI-Features_ATF-150x150.png 150w, ./../wp-content/uploads/2021/09/SwiftUI-Features_ATF-300x300.png 300w, ./../wp-content/uploads/2021/09/SwiftUI-Features_ATF-1024x1024.png 1024w, ./../wp-content/uploads/2021/09/SwiftUI-Features_ATF-768x768.png 768w, ./../wp-content/uploads/2021/09/SwiftUI-Features_ATF-144x144.png 144w, ./../wp-content/uploads/2021/09/SwiftUI-Features_ATF.png 1501w" sizes="auto, (max-width: 150px) 100vw, 150px">					<h2>Introduction</h2>
<p>I&#8217;m all-in on using SwiftUI to build iOS apps. I find it so much simpler than wrangling with storyboards and UIKit. Unfortunately, there are still occasions when SwiftUI doesn&#8217;t let you do what you needâ€”forcing you to break out into UIKit.</p>
<p>That&#8217;s why I always focus on Apple&#8217;s SwiftUI enhancements at each year&#8217;s WWDC. And, each year I&#8217;m rewarded with a few more enhancements that make SwiftUI more powerful and easy to work with. For example, iOS14 made it much <a href="https://www.mongodb.com/developer/how-to/realm-swiftui-maps-location/">easier to work with Apple Maps</a>.</p>
<p>WWDC 2021 was no exception, introducing a raft of <a href="https://developer.apple.com/videos/play/wwdc2021/10018/">SwiftUI enhancements that were coming in iOS 15/ SwiftUI 3 / Xcode 13</a>. As iOS 15 has now been released, it feels like a good time to cover the features that I&#8217;ve found the most useful.</p>
<p>I&#8217;ve revisited some of my existing iOS apps to see how I could exploit the new iOS 15 SwiftUI features to improve the user experience and/or simplify my code base. This article steps through the features I found most interesting/useful, and how I tested them out on my apps. These are the apps/branches that I worked with:</p>
<ul>
<li><a href="https://github.com/realm/RCurrency/">RCurrency</a></li>
<li><a href="https://github.com/realm/RChat/">RChat</a></li>
<li><a href="https://github.com/mongodb-developer/LiveTutorial2021/">LiveTutorial2021</a></li>
<li><a href="https://github.com/realm/task-tracker-swiftui/">task-tracker-swiftui</a></li>
</ul>
<h2>Prerequisites</h2>
<ul>
<li>Xcode 13</li>
<li>iOS 15</li>
<li>
<a href="https://github.com/realm/realm-cocoa/releases">Realm-Cocoa</a> (varies by app, but 10.13.0+ is safe for them all)</li>
</ul>
<h2>Lists</h2>
<p>SwiftUI <code>List</code>s are pretty critical to data-based apps. I use <code>List</code>s in almost every iOS app I build, typically to represent objects stored in Realm. That&#8217;s why I always go there first when seeing what&#8217;s new.</p>
<h3>Custom Swipe Options</h3>
<p>We&#8217;ve all used mobile apps where you swipe an item to the left for one action, and to the right for another. SwiftUI had a glaring omissionâ€”the only supported action was to swipe left to delete an item.</p>
<p>This was a massive pain.</p>
<p>This limitation meant that my <a href="https://github.com/realm/task-tracker-swiftui/">task-tracker-swiftui</a> app had a cumbersome UI. You had to click on a task to expose a sheet that let you click on your preferred action.</p>
<p>With iOS 15, I can replace that popup sheet with swipe actions:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/swipe_action_b291b24533.gif" alt="iOS app showing that action buttons are revealed when swiping a list item to the left or right"></p>
<p>The swipe actions are implemented in <a href="https://github.com/realm/task-tracker-swiftui/blob/main/task-tracker-swiftui/Views/Projects%20%26%20Tasks/TasksView.swift"><code>TasksView</code></a>:</p>
<pre><code class="swift">List {
   ForEach(tasks) { task in
       TaskView(task: task)
           .swipeActions(edge: .leading) {
               if task.statusEnum == .Open || task.statusEnum == .InProgress {
                   CompleteButton(task: task)
               }
               if task.statusEnum == .Open || task.statusEnum == .Complete {
                   InProgressButton(task: task)
               }
               if task.statusEnum == .InProgress || task.statusEnum == .Complete {
                   NotStartedButton(task: task)
               }
           }
           .swipeActions(edge: .trailing) {
               Button(role: .destructive, action: { $tasks.remove(task) }) {
                   Label("Delete", systemImage: "trash")
               }
           }
   }
}
</code></pre>
<p>The role of the delete button is set to <code>.destructive</code> which automatically sets the color to red.</p>
<p>For the other actions, I created custom buttons. For example, this is the code for <a href="https://github.com/realm/task-tracker-swiftui/blob/main/task-tracker-swiftui/Views/Projects%20%26%20Tasks/Buttons/CompleteButton.swift"><code>CompleteButton</code></a>:</p>
<pre><code class="swift">struct CompleteButton: View {
   @ObservedRealmObject var task: Task

   var body: some View {
       Button(action: { $task.statusEnum.wrappedValue = .Complete }) {
           Label("Complete", systemImage: "checkmark")
       }
       .tint(.green)
   }
}
</code></pre>
<h3>Searchable Lists</h3>
<p>When you&#8217;re presented with a long list of options, it helps the user if you offer a way to filter the results.</p>
<p><a href="https://github.com/realm/RCurrency/">RCurrency</a> lets the user choose between 150 different currencies. Forcing the user to scroll through the whole list wouldn&#8217;t make for a good experience. A search bar lets them quickly jump to the items they care about:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/search_d5cdac1c86.gif" alt="Animation showing currencies being filtered as a user types into the search box"></p>
<p>The selection of the currency is implemented in the <a href="https://github.com/realm/RCurrency/blob/main/iOS-SwiftUI/RCurrency/RCurrency/Views/SymbolPickerView.swift"><code>SymbolPickerView</code></a> view.</p>
<p>The view includes a state variable to store the <code>searchText</code> (the characters that the user has typed) and a <code>searchResults</code> computed value that uses it to filter the full list of symbols:</p>
<pre><code class="swift">struct SymbolPickerView: View {
   ...
   @State private var searchText = ""
   ...
   var searchResults: Dictionary&lt;String, String&gt; {
       if searchText.isEmpty {
           return Symbols.data.symbols
       } else {
           return Symbols.data.symbols.filter {
               $0.key.contains(searchText.uppercased()) || $0.value.contains(searchText)}
       }
   }
}
</code></pre>
<p>The <code>List</code> then loops over those <code>searchResults</code>. We add the <code>.searchable</code> modifier to add the search bar, and bind it to the <code>searchText</code> state variable:</p>
<pre><code class="swift">List {
   ForEach(searchResults.sorted(by: &lt;), id: \.key) { symbol in
       ...
   }
}
.searchable(text: $searchText)
</code></pre>
<p>This is the full view:</p>
<pre><code class="swift">struct SymbolPickerView: View {
   @Environment(\.presentationMode) var presentationMode

   var action: (String) -&gt; Void
   let existingSymbols: [String]

   @State private var searchText = ""

   var body: some View {
       List {
           ForEach(searchResults.sorted(by: &lt;), id: \.key) { symbol in
               Button(action: {
                   pickedSymbol(symbol.key)
               }) {
                   HStack {
                       Image(symbol.key.lowercased())
                       Text("\(symbol.key): \(symbol.value)")
                   }
                   .foregroundColor(existingSymbols.contains(symbol.key) ? .secondary : .primary)
               }
               .disabled(existingSymbols.contains(symbol.key))
           }
       }
       .searchable(text: $searchText)
       .navigationBarTitle("Pick Currency", displayMode: .inline)
   }

   private func pickedSymbol(_ symbol: String) {
       action(symbol)
       presentationMode.wrappedValue.dismiss()
   }

   var searchResults: Dictionary&lt;String, String&gt; {
       if searchText.isEmpty {
           return Symbols.data.symbols
       } else {
           return Symbols.data.symbols.filter {
               $0.key.contains(searchText.uppercased()) || $0.value.contains(searchText)}
       }
   }
}
</code></pre>
<h2>Pull to Refresh</h2>
<p>We&#8217;ve all used this feature in iOS apps. You&#8217;re impatiently waiting on an important email, and so you drag your thumb down the page to get the app to check the server.</p>
<p>This feature isn&#8217;t always helpful for apps that use Realm and Realm Sync. When Realm cloud data changes, the local realm is updated, and your SwiftUI view automatically refreshes to show the new data.</p>
<p>However, the feature <strong>is</strong> useful for the RCurrency app. I can use it to refresh all of the locally-stored exchange rates with fresh data from the API:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/pull_to_refresh_b37e5a81b9.gif" alt="Animation showing currencies being refreshed when the screen is dragged dowm"></p>
<p>We allow the user to trigger the refresh by adding a <code>.refreshable</code> modifier and action (<code>refreshAll</code>) to the list of currencies in <a href="https://github.com/realm/RCurrency/blob/main/iOS-SwiftUI/RCurrency/RCurrency/Views/CurrencyList/CurrencyListContainerView.swift"><code>CurrencyListContainerView</code></a>:</p>
<pre><code class="swift">List {
   ForEach(userSymbols.symbols, id: \.self) { symbol in
       CurrencyRowContainerView(baseSymbol: userSymbols.baseSymbol,
                                   baseAmount: $baseAmount,
                                   symbol: symbol,
                                   refreshNeeded: refreshNeeded)
           .listRowSeparator(.hidden)
   }
   .onDelete(perform: deleteSymbol)
}
.refreshable{ refreshAll() }
</code></pre>
<p>In that code snippet, you can see that I added the <code>.listRowSeparator(.hidden)</code> modifier to the <code>List</code>. This is another iOS 15 feature that hides the line that would otherwise be displayed between each <code>List</code> item. Not a big feature, but every little bit helps in letting us use native SwiftUI to get the exact design we want.</p>
<h2>Text</h2>
<h3>Markdown</h3>
<p>I&#8217;m a big fan of <a href="https://daringfireball.net/projects/markdown/">Markdown</a>. Markdown lets you write formatted text (including tables, links, and images) without taking your hands off the keyboard. I added this post to our CMS in markdown.</p>
<p>iOS 15 allows you to render markdown text within a <code>Text</code> view. If you pass a literal link to a <code>Text</code> view, then it&#8217;s automatically rendered correctly:</p>
<pre><code class="swift">struct MarkDownTest: View {
   var body: some View {
       Text("Let's see some **bold**, *italics* and some ***bold italic text***. ~~Strike that~~. We can even include a [link](https://realm.io).")
   }
}
</code></pre>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/markdown1_718e4edcae.png" alt="Text formatted. Included bold, italics and a link"></p>
<p>But, it doesn&#8217;t work out of the box for string constants or variables (e.g., data read from Realm):</p>
<pre><code class="swift">struct MarkDownTest: View {
   let myString = "Let's see some **bold**, *italics* and some ***bold italic text***. ~~Strike that~~. We can even include a [link](https://realm.io)."

   var body: some View {
       Text(myString)
   }
}
</code></pre>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/markdown2_be6d3e6123.png" alt="Raw Markdown source code, rather than rendered text"></p>
<p>The issue is that the version of <code>Text</code> that renders markdown expects to be passed an <code>AttributedString</code>. I created this simple <a href="https://github.com/realm/RChat/blob/main/RChat-iOS/RChat/Views/Components/MarkDown.swift"><code>Markdown</code></a> view to handle this for us:</p>
<pre><code class="swift">struct MarkDown: View {
   let text: String

   @State private var formattedText: AttributedString?

   var body: some View {
       Group {
           if let formattedText = formattedText {
               Text(formattedText)
           } else {
               Text(text)
           }
       }
       .onAppear(perform: formatText)
   }

   private func formatText() {
       do {
           try formattedText = AttributedString(markdown: text)
       } catch {
           print("Couldn't convert this from markdown: \(text)")
       }
   }
}
</code></pre>
<p>I updated the <a href="https://github.com/realm/RChat/blob/main/RChat-iOS/RChat/Views/Chat%20Messages/ChatBubbleView.swift"><code>ChatBubbleView</code></a> in RChat to use the <code>Markdown</code> view:</p>
<pre><code class="swift">if chatMessage.text != "" {
   MarkDown(text: chatMessage.text)
   .padding(Dimensions.padding)
}
</code></pre>
<p>RChat now supports markdown in user messages:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/markdown_in_R_Chat_b6d3a01409.gif" alt="Animation showing that Markdown source is converted to formated text in the RChat app"></p>
<h3>Dates</h3>
<p>We all know that working with dates can be a pain. At least in iOS 15 we get some nice new functionality to control how we display dates and times. We use the new <code>Date.formatted</code> syntax.</p>
<p>In RChat, I want the date/time information included in a chat bubble to depend on how recently the message was sent. If a message was sent less than a minute ago, then I care about the time to the nearest second. If it were sent a day ago, then I want to see the day of the week plus the hour and minutes. And so on.</p>
<p>I created a <a href="https://github.com/realm/RChat/blob/main/RChat-iOS/RChat/Views/Components/TextDate.swift"><code>TextDate</code></a> view to perform this conditional formatting:</p>
<pre><code class="swift">struct TextDate: View {
   let date: Date

   private var isLessThanOneMinute: Bool { date.timeIntervalSinceNow &gt; -60 }
   private var isLessThanOneDay: Bool { date.timeIntervalSinceNow &gt; -60 * 60 * 24 }
   private var isLessThanOneWeek: Bool { date.timeIntervalSinceNow &gt; -60 * 60 * 24 * 7}
   private var isLessThanOneYear: Bool { date.timeIntervalSinceNow &gt; -60 * 60 * 24 * 365}

   var body: some View {
       if isLessThanOneMinute {
           Text(date.formatted(.dateTime.hour().minute().second()))
       } else {
           if isLessThanOneDay {
               Text(date.formatted(.dateTime.hour().minute()))
           } else {
               if isLessThanOneWeek {
                   Text(date.formatted(.dateTime.weekday(.wide).hour().minute()))
               } else {
                   if isLessThanOneYear {
                       Text(date.formatted(.dateTime.month().day()))
                   } else {
                       Text(date.formatted(.dateTime.year().month().day()))
                   }
               }
           }
       }
   }
}
</code></pre>
<p>This preview code lets me test it&#8217;s working in the Xcode Canvas preview:</p>
<pre><code class="swift">struct TextDate_Previews: PreviewProvider {
   static var previews: some View {
       VStack {
           TextDate(date: Date(timeIntervalSinceNow: -60 * 60 * 24 * 365)) // 1 year ago
           TextDate(date: Date(timeIntervalSinceNow: -60 * 60 * 24 * 7))   // 1 week ago
           TextDate(date: Date(timeIntervalSinceNow: -60 * 60 * 24))       // 1 day ago
           TextDate(date: Date(timeIntervalSinceNow: -60 * 60))            // 1 hour ago
           TextDate(date: Date(timeIntervalSinceNow: -60))                 // 1 minute ago
           TextDate(date: Date())                                          // Now
       }
   }
}
</code></pre>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/dates_9f872c74b7.png" alt="Screen capture of dates rendered in various formatt"></p>
<p>We can then use <code>TextDate</code> in RChat&#8217;s <a href="https://github.com/realm/RChat/blob/main/RChat-iOS/RChat/Views/Chat%20Messages/ChatBubbleView.swift"><code>ChatBubbleView</code></a> to add context-sensitive date and time information:</p>
<pre><code class="swift">TextDate(date: chatMessage.timestamp)
   .font(.caption)
</code></pre>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/rchat_dates_034fae5600.png" alt="Screen capture of properly formatted dates against each chat message in the RChat app"></p>
<h2>Keyboards</h2>
<p>Customizing keyboards and form input was a real pain in the early days of SwiftUIâ€”take a look at the work we did for the <a href="https://github.com/WildAid/o-fish-ios/tree/main/o-fish-ios/Views/Components/KeyboardControlling">WildAid O-FISH</a> app if you don&#8217;t believe me. Thankfully, iOS 15 has shown some love in this area. There are a couple of features that I could see an immediate use for&#8230;</p>
<h3>Submit Labels</h3>
<p>It&#8217;s now trivial to rename the on-screen keyboard&#8217;s &#8220;return&#8221; key. It sounds trivial, but it can give the user a big hint about what will happen if they press it.</p>
<p>To rename the return key, add a <a href="https://developer.apple.com/documentation/swiftui/form/submitlabel(_:)"><code>.submitLabel</code></a> modifier to the input field. You pass the modifier one of these values:</p>
<ul>
<li><code>done</code></li>
<li><code>go</code></li>
<li><code>send</code></li>
<li><code>join</code></li>
<li><code>route</code></li>
<li><code>search</code></li>
<li><code>return</code></li>
<li><code>next</code></li>
<li><code>continue</code></li>
</ul>
<p>I decided to use these labels to improve the login flow for the <a href="https://github.com/mongodb-developer/LiveTutorial2021">LiveTutorial2021</a> app. In <a href="https://github.com/mongodb-developer/LiveTutorial2021/blob/main/iOS/LiveChat/LiveChat/Views/LoginView.swift"><code>LoginView</code></a>, I added a <code>submitLabel</code> to both the &#8220;email address&#8221; and &#8220;password&#8221; <code>TextFields</code>:</p>
<pre><code class="swift">TextField("email address", text: $email)
   .submitLabel(.next)
SecureField("password", text: $password)
   .onSubmit(userAction)
   .submitLabel(.go)
</code></pre>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/email_field_6245860cb5.png" alt="Screen capture showing that the &quot;return&quot; key is replaced with &quot;next&quot; when editing the email/username field"></p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/password_field_924329af36.png" alt="Screen capture showing that the &quot;return&quot; key is replaced with &quot;go&quot; when editing the password field"></p>
<p>Note the <code>.onSubmit(userAction)</code> modifier on the password field. If the user taps &#8220;go&#8221; (or hits return on an external keyboard), then the <code>userAction</code> function is called. <code>userAction</code> either registers or logs in the user, depending on whether &#8220;Register new userâ€ is checked.</p>
<h3>Focus</h3>
<p>It can be tedious to have to click between different fields on a form. iOS 15 makes it simple to automate that shifting focus.</p>
<p>Sticking with <a href="https://github.com/mongodb-developer/LiveTutorial2021/">LiveTutorial2021</a>, I want the &#8220;email address&#8221; field to be selected when the view opens. When the user types their address and hits ~~&#8221;return&#8221;~~ &#8220;next&#8221;, focus should move to the &#8220;password&#8221; field. When the user taps &#8220;go,&#8221; the app logs them in.</p>
<p>You can use the new <a href="https://developer.apple.com/documentation/swiftui/focusstate"><code>FocusState</code></a> SwiftUI property wrapper to create variables to represent the placement of focus in the view. It can be a boolean to flag whether the associated field is in focus. In our login view, we have two fields that we need to switch focus between and so we use the <code>enum</code> option instead.</p>
<p>In <a href="https://github.com/mongodb-developer/LiveTutorial2021/blob/main/iOS/LiveChat/LiveChat/Views/LoginView.swift"><code>LoginView</code></a>, I define the <code>Field</code> enumeration type to represent whether the username (email address) or password is in focus. I then create the <code>focussedField</code> <code>@FocusState</code> variable to store the value using the <code>Field</code> type:</p>
<pre><code class="swift">enum Field: Hashable {
   case username
   case password
}

@FocusState private var focussedField: Field?
</code></pre>
<p>I use the <code>.focussed</code> modifier to bind <code>focussedField</code> to the two fields:</p>
<pre><code class="swift">TextField("email address", text: $email)
   .focused($focussedField, equals: .username)
   ...
SecureField("password", text: $password)
    .focused($focussedField, equals: .password)
   ...
</code></pre>
<p>It&#8217;s a two-way binding. If the user selects the email field, then <code>focussedField</code> is set to <code>.username</code>. If the code sets <code>focussedField</code> to <code>.password</code>, then focus switches to the password field.</p>
<p>This next step feels like a hack, but I&#8217;ve not found a better solution yet. When the view is loaded, the code waits half a second before setting focus to the username field. Without the delay, the focus isn&#8217;t set:</p>
<pre><code class="swift">VStack(spacing: 16) {
   ...
}
.onAppear {
   DispatchQueue.main.asyncAfter(deadline: .now() + 0.5) {
       focussedField = .username
    ...
   }
}
</code></pre>
<p>The final step is to shift focus to the password field when the user hits the &#8220;next&#8221; key in the username field:</p>
<pre><code class="swift">TextField("email address", text: $email)
   .onSubmit { focussedField = .password }
   ...
</code></pre>
<p>This is the complete body from <a href="https://github.com/mongodb-developer/LiveTutorial2021/blob/main/iOS/LiveChat/LiveChat/Views/LoginView.swift"><code>LoginView</code></a>:</p>
<pre><code class="swift">var body: some View {
   VStack(spacing: 16) {
       Spacer()
       TextField("email address", text: $email)
           .focused($focussedField, equals: .username)
           .submitLabel(.next)
           .onSubmit { focussedField = .password }
       SecureField("password", text: $password)
           .focused($focussedField, equals: .password)
           .onSubmit(userAction)
           .submitLabel(.go)
       Button(action: { newUser.toggle() }) {
           HStack {
               Image(systemName: newUser ? "checkmark.square" : "square")
               Text("Register new user")
               Spacer()
           }
       }
       Button(action: userAction) {
           Text(newUser ? "Register new user" : "Log in")
       }
       .buttonStyle(.borderedProminent)
       .controlSize(.large)
       Spacer()
   }
   .onAppear {
       DispatchQueue.main.asyncAfter(deadline: .now() + 0.5) {
           focussedField = .username
       }
   }
   .padding()
}
</code></pre>
<h2>Buttons</h2>
<h3>Formatting</h3>
<p>Previously, I&#8217;ve created custom SwiftUI views to make buttons look likeâ€¦. buttons.</p>
<p>Things get simpler in iOS 15.</p>
<p>In <a href="https://github.com/mongodb-developer/LiveTutorial2021/blob/main/iOS/LiveChat/LiveChat/Views/LoginView.swift"><code>LoginView</code></a>, I added two new modifiers to my register/login button:</p>
<pre><code class="swift">Button(action: userAction) {
   Text(newUser ? "Register new user" : "Log in")
}
.buttonStyle(.borderedProminent)
.controlSize(.large)
</code></pre>
<p>Before making this change, I experimented with other button styles:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/button_styles_7882dc43b7.png" alt="Xcode. Showing button source code and the associated previews"></p>
<h3>Confirmation</h3>
<p>It&#8217;s very easy to accidentally tap the &#8220;Logout&#8221; button, and so I wanted to add this confirmation dialog:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/confirm_logout_e913c93674.png" alt="Dialog for the user to confirm that they wish to log out"></p>
<p>Again, iOS 15 makes this simple.</p>
<p>This is the modified version of the <code>LogoutButton</code> view:</p>
<pre><code class="swift">struct LogoutButton: View {
   ...
   @State private var isConfirming = false

   var body: some View {
       Button("Logout") { isConfirming = true }
       .confirmationDialog("Are you sure want to logout",
                           isPresented: $isConfirming) {
           Button(action: logout) {
               Text("Confirm Logout")
           }
           Button("Cancel", role: .cancel) {}
       }
   }
   ...
}
</code></pre>
<p>These are the changes I made:</p>
<ul>
<li>Added a new state variable (<code>isConfirming</code>)</li>
<li>Changed the logout button&#8217;s action from calling the <code>logout</code> function to setting <code>isConfirming</code> to <code>true</code>
</li>
<li>Added the <a href="https://developer.apple.com/documentation/swiftui/view/confirmationdialog(_:ispresented:titlevisibility:presenting:actions:)-9ibgk"><code>confirmationDialog</code></a> modifier to the button, providing three things:
<ul>
<li>The dialog title (I didn&#8217;t override the <code>titleVisibility</code> option and so the system decides whether this should be shown)</li>
<li>A binding to <code>isConfirming</code> that controls whether the dialog is shown or not</li>
<li>A view containing the contents of the dialog:
<ul>
<li>A button to logout the user</li>
<li>A cancel button</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>Material</h2>
<p>I&#8217;m no designer, and this is <em>blurring</em> the edges of what changes I consider worth adding.</p>
<p>The <a href="https://github.com/realm/RChat/">RChat</a> app may have to wait a moment while the backend MongoDB Realm application confirms that the user has been authenticated and logged in. I superimpose a progress view while that&#8217;s happening:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/busy_62dee69adb.png" alt="A semi-transparrent overlay to indicate that the apps is working on something"></p>
<p>To make it look a bit more professional, I can update <a href="https://github.com/realm/RChat/blob/ios15/RChat-iOS/RChat/Views/Components/OpaqueProgressView.swift"><code>OpaqueProgressView</code></a> to use <a href="https://developer.apple.com/documentation/swiftui/material">Material</a> to blur the content that&#8217;s behind the overlay. To get this effect, I update the background modifier for the <code>VStack</code>:</p>
<pre><code class="swift">var body: some View {
   VStack {
       if let message = message {
           ProgressView(message)
       } else {
           ProgressView()
       }
   }
   .padding(Dimensions.padding)
   .background(.ultraThinMaterial,
               in: RoundedRectangle(cornerRadius: Dimensions.cornerRadius))
}
</code></pre>
<p>The result looks like this:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/busy_material_35e6fedf53.png" alt="A semi-transparrent overlay, with the background blurred, to indicate that the apps is working on something"></p>
<h2>Developer Tools</h2>
<p>Finally, there are a couple of enhancements that are helpful during your development phase.</p>
<h3>Landscape Previews</h3>
<p>I&#8217;m a big fan of Xcode&#8217;s &#8220;Canvas&#8221; previews. Previews let you see what your view will look like. Previews update in more or less real time as you make code changes. You can even display multiple previews at once for example:</p>
<ul>
<li>For different devices: <code>.previewDevice(PreviewDevice(rawValue: "iPhone 12 Pro Max"))</code>
</li>
<li>For dark mode: <code>.preferredColorScheme(.dark)</code>
</li>
</ul>
<p>A glaring omission was that there was no way to preview landscape mode. That&#8217;s fixed in iOS 15 with the addition of the <a href="https://developer.apple.com/documentation/SwiftUI/View/previewInterfaceOrientation(_:)"><code>.previewInterfaceOrientation</code></a> modifier.</p>
<p>For example, this code will show two devices in the preview. The first will be in portrait mode. The second will be in landscape and dark mode:</p>
<pre><code class="swift">struct CurrencyRow_Previews: PreviewProvider {
   static var previews: some View {
       Group {
           List {
               CurrencyRowView(value: 3.23, symbol: "USD", baseValue: .constant(1.0))
               CurrencyRowView(value: 1.0, symbol: "GBP", baseValue: .constant(10.0))
           }
           List {
               CurrencyRowView(value: 3.23, symbol: "USD", baseValue: .constant(1.0))
               CurrencyRowView(value: 1.0, symbol: "GBP", baseValue: .constant(10.0))
           }
           .preferredColorScheme(.dark)
           .previewInterfaceOrientation(.landscapeLeft)
       }
   }
}
</code></pre>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/preview_demo_12b5116b98.gif" alt="Animation of Xcode preview. Shows that the preview updates in real time as the code is changed. There are previews for both landscape and portrait modes"></p>
<h3>Self._printChanges</h3>
<p>SwiftUI is very smart at automatically refreshing views when associated state changes. But sometimes, it can be hard to figure out exactly why a view is or isn&#8217;t being updated.</p>
<p>iOS 15 adds a way to print out what pieces of state data have triggered each refresh for a view. Simply call <code>Self._printChanges()</code> from the body of your view. For example, I updated <a href="https://github.com/mongodb-developer/LiveTutorial2021/blob/main/iOS/LiveChat/LiveChat/Views/ContentView.swift"><code>ContentView</code></a> for the LiveChat app:</p>
<pre><code class="swift">struct ContentView: View {
   @State private var username = ""

   var body: some View {
       print(Self._printChanges())
       return NavigationView {
           Group {
               if app.currentUser == nil {
                   LoginView(username: $username)
               } else {
                   ChatRoomsView(username: username)
               }
           }
           .navigationBarTitle(username, displayMode: .inline)
           .navigationBarItems(trailing: app.currentUser != nil ? LogoutButton(username: $username) : nil) }
    }
}
</code></pre>
<p>If I log in and check the Xcode console, I can see that it&#8217;s the update to <code>username</code> that triggered the refresh (rather than <code>app.currentUser</code>):</p>
<pre><code class="swift">ContentView: _username changed.
</code></pre>
<p>There can be a lot of these messages, and so remember to turn them off before going into production.</p>
<h2>Conclusion</h2>
<p>SwiftUI is developing at pace. With each iOS release, there is less and less reason to not use it for all/some of your mobile app.</p>
<p>This post describes how to use some of the iOS 15 SwiftUI features that caught my attention. I focussed on the features that I could see would instantly benefit my most recent mobile apps. In this article, I&#8217;ve shown how those apps could be updated to use these features.</p>
<p>There are lots of features that I didn&#8217;t include here. A couple of notable omissions are:</p>
<ul>
<li>
<a href="https://developer.apple.com/documentation/swiftui/asyncimage"><code>AsyncImage</code></a> is going to make it far easier to work with images that are stored in the cloud. I didn&#8217;t need it for any of my current apps, but I&#8217;ve no doubt that I&#8217;ll be using it in a project soon.</li>
<li>The <a href="https://developer.apple.com/documentation/swiftui/anyview/task(priority:_:)/"><code>task</code></a> view modifier is going to have a significant effect on how people run asynchronous code when a view is loaded. I plan to cover this in a future article that takes a more general look at how to handle concurrency with Realm.</li>
<li>Adding a toolbar to your keyboards (e.g., to let the user switch between input fields).</li>
</ul>
<p>If you have any questions or comments on this post (or anything else Realm-related), then please raise them on our <a href="https://www.mongodb.com/community/forums/c/realm-sdks/58">community forum</a>. To keep up with the latest Realm news, follow <a href="https://twitter.com/realm">@realm</a> on Twitter and join the <a href="https://live.mongodb.com/realm-global-community/">Realm global community</a>.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/realm/most-useful-ios-15-swiftui-features" data-via="wpbeginner" data-text="Most Useful iOS 15 SwiftUI Features" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/realm/most-useful-ios-15-swiftui-features"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/realm/most-useful-ios-15-swiftui-features" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Frealm%2Fmost-useful-ios-15-swiftui-features&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../category/mongodb/realm/index.html" rel="category tag">Realm</a> | 
Tags: <a href="./ios/index.html" rel="tag">ios</a>, <a href="./realm/index.html" rel="tag">Realm</a>, <a href="./swift/index.html" rel="tag">Swift</a>, <a href="./swiftui/index.html" rel="tag">SwiftUI</a>
</div>

			</div>			<div id="post-4633" class="post-4633 post type-post status-publish format-standard has-post-thumbnail hentry category-realm tag-realm tag-swift tag-swiftui">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../mongodb/realm/build-offline-first-mobile-apps-by-caching-api-results-in-realm/index.html">September 14, 2021</a>
			</div>
	<div class="postcomments">
		<a href="./../mongodb/realm/build-offline-first-mobile-apps-by-caching-api-results-in-realm/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../mongodb/realm/build-offline-first-mobile-apps-by-caching-api-results-in-realm/index.html" rel="bookmark">Build Offline-First Mobile Apps by Caching API Results in Realm</a></h2>
				
				<div class="entry">
					<img width="150" height="150" src="./../wp-content/uploads/2021/09/Twitter_1024x512-150x150.png" class="alignleft wp-post-image" alt="" decoding="async" loading="lazy" srcset="./../wp-content/uploads/2021/09/Twitter_1024x512-150x150.png 150w, ./../wp-content/uploads/2021/09/Twitter_1024x512-144x144.png 144w" sizes="auto, (max-width: 150px) 100vw, 150px">					<p>Note that this post was originally published at <a href="https://www.mongodb.com/developer/how-to/realm-api-cache/">Build Offline-First Mobile Apps by Caching API Results in Realm</a>.</p>
<h2>Introduction</h2>
<p>When building a mobile app, there&#8217;s a good chance that you want it to pull in data from a cloud serviceâ€”whether from your own or from a third party. While other technologies are growing (e.g., <a href="https://docs.mongodb.com/realm/graphql/">GraphQL</a> and <a href="https://docs.mongodb.com/realm/sync/">MongoDB Realm Sync</a>), <a href="https://en.wikipedia.org/wiki/Representational_state_transfer">REST APIs</a> are still prevalent.</p>
<p>It&#8217;s easy to make a call to a REST API endpoint from your mobile app, but what happens when you lose network connectivity? What if you want to slice and dice that data after you&#8217;ve received it? How many times will your app have to fetch the same data (consuming data bandwidth and battery capacity each time)? How will your users react to a sluggish app that&#8217;s forever fetching data over the internet?</p>
<p>By caching the data from API calls in Realm, the data is always available to your app. This leads to higher availability, faster response times, and reduced network and battery consumption.</p>
<p>This article shows how the <a href="https://github.com/realm/RCurrency">RCurrency</a> mobile app fetches exchange rate data from a <a href="https://exchangerate.host/">public API</a>, and then caches it in Realm for always-on, local access.</p>
<h3>Is Using the API from Your Mobile App the Best Approach?</h3>
<p>This app only reads data through the API. Writing an offline-first app that needs to reliably update cloud data via an API is a <strong>far</strong> more complex affair. If you need to update cloud data when offline, then I&#8217;d strongly recommend you consider <a href="https://docs.mongodb.com/realm/sync/">MongoDB Realm Sync</a>.</p>
<p>Many APIs throttle your request rate or charge per request. That can lead to issues as your user base grows. A more scalable approach is to have your backend Realm app fetch the data from the API and store it in Atlas. Realm Sync then makes that data available locally on every user&#8217;s mobile deviceâ€”without the need for any additional API calls.</p>
<h2>Prerequisites</h2>
<ul>
<li><a href="https://github.com/realm/realm-cocoa">Realm-Cocoa 10.13.0+</a></li>
<li>Xcode 13</li>
<li>iOS 15</li>
</ul>
<h2>The RCurrency Mobile App</h2>
<p>The <a href="https://github.com/realm/RCurrency">RCurrency</a> app is a simple exchange rate app. It&#8217;s intended for uses such as converting currencies when traveling.</p>
<p>You choose a base currency and a list of other currencies you want to convert between.</p>
<p>When opened for the first time, RCurrency uses a REST API to retrieve exchange rates, and stores the data in Realm. From that point on, the app uses the data that&#8217;s stored in Realm. Even if you force-close the app and reopen it, it uses the local data.</p>
<p>If the stored rates are older than today, the app will fetch the latest rates from the API and replace the Realm data.</p>
<p>The app supports pull-to-refresh to fetch and store the latest exchange rates from the API.</p>
<p>You can alter the amount of any currency, and the amounts for all other currencies are instantly recalculated.</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/R_Currency_demo_9820e35730.gif" alt="Animation of the RCurrency app running on an iPhone. Includes the user selecting currencies, changing amounts and observing the amounts changing for other currencies"></p>
<h2>The REST API</h2>
<p>I&#8217;m using the API provided by <a href="https://exchangerate.host/">exchangerate.host</a>. The API is a free service that provides a simple API to fetch currency exchange rates.</p>
<p>One of the reasons I picked this API is that it doesn&#8217;t require you to register and then manage access keys/tokens. It&#8217;s not rocket science to handle that complexity, but I wanted this app to focus on when to fetch data, and what to do once you receive it.</p>
<p>The app uses a single endpoint (where you can replace <code>USD</code> and <code>EUR</code> with the currencies you want to convert between):</p>
<pre><code class="js">https://api.exchangerate.host/convert?from=USD&amp;to=EUR
</code></pre>
<p>You can try <a href="https://api.exchangerate.host/convert?from=USD&amp;to=EUR">calling that endpoint directly from your browser</a>.</p>
<p>The endpoint responds with a JSON document:</p>
<pre><code class="js">{
  "motd": {
    "msg": "If you or your company use this project or like what we doing, please consider backing us so we can continue maintaining and evolving this project.",
    "url": "https://exchangerate.host/#/donate"
  },
  "success": true,
  "query": {
    "from": "USD",
    "to": "EUR",
    "amount": 1
  },
  "info": {
    "rate": 0.844542
  },
  "historical": false,
  "date": "2021-09-02",
  "result": 0.844542
}
</code></pre>
<p>Note that the exchange rate for each currency is only updated once every 24 hours. That&#8217;s fine for our app that&#8217;s helping you decide whether you can afford that baseball cap when you&#8217;re on vacation. If you&#8217;re a currency day-trader, then you should look elsewhere.</p>
<h2>The RCurrency App Implementation</h2>
<h3>Data Model</h3>
<p>JSON is the language of APIs. That&#8217;s great news as most modern programming languages (including Swift) make it super easy to convert between JSON strings and native objects.</p>
<p>The app stores the results from the API query in objects of type <code>Rate</code>. To make it as simple as possible to receive and store the results, I made the <a href="https://github.com/realm/RCurrency/blob/main/iOS-SwiftUI/RCurrency/RCurrency/Model/Rate.swift"><code>Rate</code> class</a> match the JSON format of the API results:</p>
<pre><code class="swift">class Rate: Object, ObjectKeyIdentifiable, Codable {
    var motd = Motd()
    var success = false
    @Persisted var query: Query?
    var info = Info()
    @Persisted var date: String
    @Persisted var result: Double
}

class Motd: Codable {
    var msg = ""
    var url = ""
}

class Query: EmbeddedObject, ObjectKeyIdentifiable, Codable {
    @Persisted var from: String
    @Persisted var to: String
    var amount = 0
}

class Info: Codable {
    var rate = 0.0
}
</code></pre>
<p>Note that only the fields annotated with <code>@Persisted</code> will be stored in Realm.</p>
<p>Swift can automatically convert between <code>Rate</code> objects and the JSON strings returned by the API because we make the class comply with the <a href="https://developer.apple.com/documentation/swift/codable"><code>Codable</code> protocol</a>.</p>
<p>There are two other top-level classes used by the app.</p>
<p><a href="https://github.com/realm/RCurrency/blob/main/iOS-SwiftUI/RCurrency/RCurrency/Model/Symbols.swift"><code>Symbols</code></a> stores all of the supported currency symbols. In the app, the list is bootstrapped from a fixed list. For future-proofing, it would be better to fetch them from an API:</p>
<pre><code class="swift">class Symbols {
    var symbols = Dictionary&lt;String, String&gt;()
}

extension Symbols {
    static var data = Symbols()


    static func loadData() {
        data.symbols["AED"] = "United Arab Emirates Dirham"
        data.symbols["AFN"] = "Afghan Afghani"
        data.symbols["ALL"] = "Albanian Lek"
        ...
    }
}
</code></pre>
<p><code>UserSymbols</code> is used to store the user&#8217;s chosen base currency and the list of currencies they&#8217;d like to see exchange rates for:</p>
<pre><code class="swift">class UserSymbols: Object, ObjectKeyIdentifiable {
    @Persisted var baseSymbol: String
    @Persisted var symbols: List&lt;String&gt;
}
</code></pre>
<p>An instance of <code>UserSymbols</code> is stored in Realm so that the user gets the same list whenever they open the app.</p>
<h3>
<code>Rate</code> Data Lifecycle</h3>
<p>This flowchart shows how the exchange rate for a single currency (represented by the <code>symbol</code> string) is managed when the <code>CurrencyRowContainerView</code> is used to render data for that currency:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Rendering_a_Currency_flowchart_c92433a8dc.png" alt="Flowchart showing how the app fetches data from the API and stored in in Realm. The mobile app's UI always renders what's stored in MongoDB. The following sections will describe each block in the flow diagram."></p>
<p>Note that the actual behavior is a little more subtle than the diagram suggests. SwiftUI ties the Realm data to the UI. If stage #2 finds the data in Realm, then it will immediately get displayed in the view (stage #8). The code will then make the extra checks and refresh the Realm data if needed. If and when the Realm data is updated, SwiftUI will automatically refresh the UI to render it.</p>
<p>Let&#8217;s look at each of those steps in turn.</p>
<h4>#1 <code>CurrencyContainerView</code> loaded for currency represented by <code>symbol</code>
</h4>
<p><a href="https://github.com/realm/RCurrency/blob/main/iOS-SwiftUI/RCurrency/RCurrency/Views/CurrencyList/CurrencyListContainerView.swift"><code>CurrencyListContainerView</code></a> iterates over each of the currencies that the user has selected. For each currency, it creates a <a href="https://github.com/realm/RCurrency/blob/main/iOS-SwiftUI/RCurrency/RCurrency/Views/CurrencyItem/CurrencyRowContainerView.swift"><code>CurrencyRowContainerView</code></a> and passes in strings representing the base currency (<code>baseSymbol</code>) and the currency we want an exchange rate for (<code>symbol</code>):</p>
<pre><code class="swift">List {
   ForEach(userSymbols.symbols, id: \.self) { symbol in
       CurrencyRowContainerView(baseSymbol: userSymbols.baseSymbol,
                                   baseAmount: $baseAmount,
                                   symbol: symbol,
                                   refreshNeeded: refreshNeeded)
   }
   .onDelete(perform: deleteSymbol)
}
</code></pre>
<h4>#2 <code>rate</code> = FetchFromRealm(<code>symbol</code>)</h4>
<p><a href="https://github.com/realm/RCurrency/blob/main/iOS-SwiftUI/RCurrency/RCurrency/Views/CurrencyItem/CurrencyRowContainerView.swift"><code>CurrencyRowContainerView</code></a> then uses the <code>@ObservedResults</code> property wrapper to query all <code>Rate</code> objects that are already stored in Realm:</p>
<pre><code class="swift">struct CurrencyRowContainerView: View {
   @ObservedResults(Rate.self) var rates
   ...
}
</code></pre>
<p>The view then filters those results to find one for the requested <code>baseSymbol</code>/<code>symbol</code> pair:</p>
<pre><code class="swift">var rate: Rate? {
   rates.filter(
       NSPredicate(format: "query.from = %@ AND query.to = %@",
                   baseSymbol, symbol)).first
}
</code></pre>
<h4>#3 <code>rate</code> found?</h4>
<p>The view checks whether <code>rate</code> is set or not (i.e., whether a matching object was found in Realm). If <code>rate</code> is set, then it&#8217;s passed to <code>CurrencyRowDataView</code> to render the details (step #8). If <code>rate</code> is <code>nil</code>, then a placeholder &#8220;Loading Data&#8230;&#8221; <code>TextView</code> is rendered, and <code>loadData</code> is called to fetch the data using the API (step #4-3):</p>
<pre><code class="swift">var body: some View {
   if let rate = rate {
       HStack {
           CurrencyRowDataView(rate: rate, baseAmount: $baseAmount, action: action)
           ...
       }
   } else {
       Text("Loading Data...")
           .onAppear(perform: loadData)
   }
}
</code></pre>
<h4>#4-3 Fetch <code>rate</code> from APIÂ â€” No matching object found in Realm</h4>
<p>The API URL is formed by inserting the base currency (<code>baseSymbol</code>) and the target currency (<code>symbol</code>) into a template string. <code>loadData</code> then sends the request to the API endpoint and handles the response:</p>
<pre><code class="swift">private func loadData() {
   guard let url = URL(string: "https://api.exchangerate.host/convert?from=\(baseSymbol)&amp;to=\(symbol)") else {
       print("Invalid URL")
       return
   }
   let request = URLRequest(url: url)
   print("Network request: \(url.description)")
   URLSession.shared.dataTask(with: request) { data, response, error in
       guard let data = data else {
           print("Error fetching data: \(error?.localizedDescription ?? "Unknown error")")
           return
       }
       if let decodedResponse = try? JSONDecoder().decode(Rate.self, from: data) {
           // TODO: Step #5-3
       } else {
           print("No data received")
       }
   }
   .resume()
}
</code></pre>
<h4>#5-3 StoreInRealm(<code>rate</code>) â€” No matching object found in Realm</h4>
<p><code>Rate</code> objects stored in Realm are displayed in our SwiftUI views. Any data changes that impact the UI must be done on the main thread. When the API endpoint sends back results, our code receives them in a callback thread, and so we must use <code>DispatchQueue</code> to run our closure in the main thread so that we can add the resulting <code>Rate</code> object to Realm:</p>
<pre><code class="swift">if let decodedResponse = try? JSONDecoder().decode(Rate.self, from: data) {
   DispatchQueue.main.async {
       $rates.append(decodedResponse)
   }
} else {
   print("No data received")
}
</code></pre>
<p>Notice how simple it is to convert the JSON response into a Realm <code>Rate</code> object and store it in our local realm!</p>
<h4>#6 Refresh Requested?</h4>
<p>RCurrency includes a <a href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-enable-pull-to-refresh">pull-to-refresh</a> feature which will fetch fresh exchange rate data for each of the user&#8217;s currency symbols. We add the refresh functionality by appending the <code>.refreshable</code> modifier to the <code>List</code> of rates in <a href="https://github.com/realm/RCurrency/blob/main/iOS-SwiftUI/RCurrency/RCurrency/Views/CurrencyList/CurrencyListContainerView.swift"><code>CurrencyListContainerView</code></a>:</p>
<pre><code class="swift">List {
   ...
}
.refreshable(action: refreshAll)
</code></pre>
<p><code>refreshAll</code> sets the <code>refreshNeeded</code> variable to <code>true</code>, waits a second to allow SwiftUI to react to the change, and then sets it back to <code>false</code>:</p>
<pre><code class="swift">private func refreshAll() {
   refreshNeeded = true
   DispatchQueue.main.asyncAfter(deadline: .now() + 1.0) {
       refreshNeeded = false
   }
}
</code></pre>
<p><code>refreshNeeded</code> is passed to each instance of <code>CurrencyRowContainerView</code>:</p>
<pre><code class="swift">CurrencyRowContainerView(baseSymbol: userSymbols.baseSymbol,
                        baseAmount: $baseAmount,
                        symbol: symbol,
                        refreshNeeded: refreshNeeded)
</code></pre>
<p><a href="https://github.com/realm/RCurrency/blob/main/iOS-SwiftUI/RCurrency/RCurrency/Views/CurrencyItem/CurrencyRowContainerView.swift"><code>CurrencyRowContainerView</code></a> checks <code>refreshNeeded</code>. If <code>true</code>, it displays a temporary refresh image and invokes <code>refreshData</code> (step #4-6):</p>
<pre><code class="swift">if refreshNeeded {
   Image(systemName: "arrow.clockwise.icloud")
       .onAppear(perform: refreshData)
}
</code></pre>
<h4>#4-6 Fetch <code>rate</code> from APIÂ â€” Refresh requested</h4>
<p><code>refreshData</code> fetches the data in exactly the same way as <code>loadData</code> in step #4-3:</p>
<pre><code class="swift">private func refreshData() {
   guard let url = URL(string: "https://api.exchangerate.host/convert?from=\(baseSymbol)&amp;to=\(symbol)") else {
       print("Invalid URL")
       return
   }
   let request = URLRequest(url: url)
   print("Network request: \(url.description)")
   URLSession.shared.dataTask(with: request) { data, response, error in
       guard let data = data else {
           print("Error fetching data: \(error?.localizedDescription ?? "Unknown error")")
           return
       }
       if let decodedResponse = try? JSONDecoder().decode(Rate.self, from: data) {
           DispatchQueue.main.async {
               // TODO: #5-5
           }
       } else {
           print("No data received")
       }
   }
   .resume()
}
</code></pre>
<p>The difference is that in this case, there may already be a <code>Rate</code> object in Realm for this currency pair, and so the results are handled differently&#8230;</p>
<h4>#5-6 StoreInRealm(<code>rate</code>) â€” Refresh requested</h4>
<p>If the <code>Rate</code> object for this currency pair had been found in Realm, then we reference it with <code>existingRate</code>. <code>existingRate</code> is then updated with the API results:</p>
<pre><code class="swift">if let decodedResponse = try? JSONDecoder().decode(Rate.self, from: data) {
   DispatchQueue.main.async {
       if let existingRate = rate {
           do {
               let realm = try Realm()
               try realm.write() {
                   guard let thawedrate = existingRate.thaw() else {
                       print("Couldn't thaw existingRate")
                       return
                   }
                   thawedrate.date = decodedResponse.date
                   thawedrate.result = decodedResponse.result
               }
           } catch {
               print("Unable to update existing rate in Realm")
           }
       }
   }
}
</code></pre>
<h4>#7 <code>rate</code> stale?</h4>
<p>The exchange rates available through the API are updated daily. The date that the rate applies to is included in the API response, and itâ€™s stored in the Realm <code>Rate</code> object. When displaying the exchange rate data, <a href="https://github.com/realm/RCurrency/blob/main/iOS-SwiftUI/RCurrency/RCurrency/Views/CurrencyItem/CurrencyRowDataView.swift"><code>CurrencyRowDataView</code></a> invokes <code>loadData</code>:</p>
<pre><code class="swift">var body: some View {
   CurrencyRowView(value: (rate.result) * baseAmount,
                   symbol: rate.query?.to ?? "",
                   baseValue: $baseAmount,
                   action: action)
       .onAppear(perform: loadData)
}
</code></pre>
<p><code>loadData</code> checks that the existing Realm <code>Rate</code> object applies to today. If not, then it will refresh the data (stage 4-7):</p>
<pre><code class="swift">private func loadData() {
   if !rate.isToday {
       // TODO: 4-7
   }
}
</code></pre>
<p><code>isToday</code> is a <a href="https://github.com/realm/RCurrency/blob/main/iOS-SwiftUI/RCurrency/RCurrency/Model/Rate.swift"><code>Rate</code></a> method to check whether the stored data matches the current date:</p>
<pre><code class="swift">extension Rate {
   var isToday: Bool {
       let today = Date().description.prefix(10)
       return  date == today
   }
}
</code></pre>
<h4>#4-7 Fetch <code>rate</code> from APIÂ â€” <code>rate</code> stale</h4>
<p>By now, the code to fetch the data from the API should be familiar:</p>
<pre><code class="swift">private func loadData() {
   if !rate.isToday {
       guard let query = rate.query else {
           print("Query data is missing")
           return
       }
       guard let url = URL(string: "https://api.exchangerate.host/convert?from=\(query.from)&amp;to=\(query.to)") else {
           print("Invalid URL")
           return
       }
       let request = URLRequest(url: url)
       URLSession.shared.dataTask(with: request) { data, response, error in
           guard let data = data else {
               print("Error fetching data: \(error?.localizedDescription ?? "Unknown error")")
               return
           }
           if let decodedResponse = try? JSONDecoder().decode(Rate.self, from: data) {
               DispatchQueue.main.async {
                   // TODO: #5.7
               }
           } else {
               print("No data received")
           }
       }
       .resume()
   }
}
</code></pre>
<h4>#5-7 StoreInRealm(<code>rate</code>) â€” <code>rate</code> stale</h4>
<p><code>loadData</code> copies the new <code>date</code> and exchange rate (<code>result</code>) to the stored Realm <code>Rate</code> object:</p>
<pre><code class="swift">if let decodedResponse = try? JSONDecoder().decode(Rate.self, from: data) {
   DispatchQueue.main.async {
       $rate.date.wrappedValue = decodedResponse.date
       $rate.result.wrappedValue = decodedResponse.result
   }
}
</code></pre>
<h4>#8 View rendered with <code>rate</code>
</h4>
<p><a href="https://github.com/realm/RCurrency/blob/main/iOS-SwiftUI/RCurrency/RCurrency/Views/CurrencyItem/CurrencyRowView.swift"><code>CurrencyRowView</code></a> receives the raw exchange rate data, and the amount to convert. Itâ€™s responsible for calculating and rendering the results:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Single_Rate_Rendered_84c0c03e6a.png" alt="Screen capture showing the row for a single currency. In this case it shows the US flag, the &quot;USD&quot; symbol and the amount (3.23...)"></p>
<p>The number shown in this view is part of a <code>TextField</code>, which the user can overwrite:</p>
<pre><code class="swift">@Binding var baseValue: Double
...
TextField("Amount", text: $amount)
   .keyboardType(.decimalPad)
   .onChange(of: amount, perform: updateValue)
   .font(.largeTitle)
</code></pre>
<p>When the user overwrites the number, the <code>onChange</code> function is called which recalculates <code>baseValue</code> (the value of the base currency that the user wants to convert):</p>
<pre><code class="swift">private func updateValue(newAmount: String) {
   guard let newValue = Double(newAmount) else {
       print("\(newAmount) cannot be converted to a Double")
       return
   }
   baseValue = newValue / rate
}
</code></pre>
<p>As <code>baseValue</code> was passed in as a binding, the new value percolates up the view hierarchy, and all of the currency values are updated. As the exchange rates are held in Realm, all of the currency values are recalculated without needing to use the API:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/change_values_fd69a8240b.gif" alt="Animation showing the app running on an iPhone. When the user changes the amount for 1 currency, the amounts for all of the others changes immediately"></p>
<h2>Conclusion</h2>
<p>REST APIs let your mobile apps act on a vast variety of cloud data. The downside is that APIs can&#8217;t help you when you don&#8217;t have access to the internet. They can also make your app seem sluggish, and your users may get frustrated when they have to wait for data to be downloaded.</p>
<p>A common solution is to use Realm to cache data from the API so that it&#8217;s always available and can be accessed locally in an instant.</p>
<p>This article has shown you a typical data lifecycle that you can reuse in your own apps. You&#8217;ve also seen how easy it is to store the JSON results from an API call in your Realm database:</p>
<pre><code class="swift">if let decodedResponse = try? JSONDecoder().decode(Rate.self, from: data) {
   DispatchQueue.main.async {
       $rates.append(decodedResponse)
   }
}
</code></pre>
<p>We&#8217;ve focussed on using a read-only API. Things get complicated very quickly when your app starts modifying data through the API. What should your app do when your device is offline?</p>
<ul>
<li>Don&#8217;t allow users to do anything that requires an update?</li>
<li>Allow local updates and maintain a list of changes that you iterate through when back online?
<ul>
<li>Will some changes you accept from the user have to be backed out once back online and you discover conflicting changes from other users?</li>
</ul>
</li>
</ul>
<p>If you need to modify data that&#8217;s accessed by other users or devices, consider <a href="https://docs.mongodb.com/realm/sync/">MongoDB Realm Sync</a> as an alternative to accessing APIs directly from your app. It will save you thousands of lines of tricky code!</p>
<p>The API you&#8217;re using may throttle access or charge per request. You can create a backend MongoDB Realm app to fetch the data from the API just once, and then use Realm Sync to handle the fan-out to all instances of your mobile app.</p>
<p>If you have any questions or comments on this post (or anything else Realm-related), then please raise them on our <a href="https://www.mongodb.com/community/forums/c/realm-sdks/58">community forum</a>. To keep up with the latest Realm news, follow <a href="https://twitter.com/realm">@realm</a> on Twitter and join the <a href="https://live.mongodb.com/realm-global-community/">Realm global community</a>.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/realm/build-offline-first-mobile-apps-by-caching-api-results-in-realm" data-via="wpbeginner" data-text="Build Offline-First Mobile Apps by Caching API Results in Realm" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/realm/build-offline-first-mobile-apps-by-caching-api-results-in-realm"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/realm/build-offline-first-mobile-apps-by-caching-api-results-in-realm" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Frealm%2Fbuild-offline-first-mobile-apps-by-caching-api-results-in-realm&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../category/mongodb/realm/index.html" rel="category tag">Realm</a> | 
Tags: <a href="./realm/index.html" rel="tag">Realm</a>, <a href="./swift/index.html" rel="tag">Swift</a>, <a href="./swiftui/index.html" rel="tag">SwiftUI</a>
</div>

			</div>			<div id="post-4626" class="post-4626 post type-post status-publish format-standard hentry category-mongodb category-realm tag-ios tag-swift tag-swiftui">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../mongodb/migrating-your-ios-apps-synced-realm-schema-in-production/index.html">September 2, 2021</a>
			</div>
	<div class="postcomments">
		<a href="./../mongodb/migrating-your-ios-apps-synced-realm-schema-in-production/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../mongodb/migrating-your-ios-apps-synced-realm-schema-in-production/index.html" rel="bookmark">Migrating Your iOS App&#8217;s Synced Realm Schema in Production</a></h2>
				
				<div class="entry">
										<h2>Introduction</h2>
<p>In the <a href="https://www.mongodb.com/developer/how-to/realm-schema-migration">previous post in this series</a>, we saw how to migrate your Realm data when you upgraded your iOS app with a new schema. But, that only handled the data in your local, standalone Realm database. What if you&#8217;re using <a href="https://docs.mongodb.com/realm/sync/">MongoDB Realm Sync</a> to replicate your local Realm data with other instances of your mobile app and with MongoDB Atlas? That&#8217;s what this article will focus on.</p>
<p>We&#8217;ll start with the original <a href="https://www.mongodb.com/developer/how-to/building-a-mobile-chat-app-using-realm-new-way/">RChat app</a>. We&#8217;ll then extend the iOS app and backend Realm schema to add a new feature that allows chat messages to be tagged as high priority. The next (and perhaps surprisingly more complicated from a Realm perspective) upgrade is to make the <code>author</code> attribute of the existing <code>ChatMessage</code> object non-optional.</p>
<p>You can find all of the code for this post in the RChat repo under these branches:</p>
<ul>
<li><a href="https://github.com/realm/RChat">Starting point</a></li>
<li><a href="https://github.com/realm/RChat/tree/new-schema">Upgrade #1</a></li>
<li><a href="https://github.com/realm/RChat/tree/v2-schema">Upgrade #2</a></li>
</ul>
<h2>Prerequisites</h2>
<p><a href="https://github.com/realm/realm-cocoa/releases">Realm Cocoa 10.13.0</a> or later (for versions of the app that you&#8217;re upgrading <strong>to</strong>)</p>
<h2>Catch-Up â€” The RChat App</h2>
<p>RChat is a basic chat app:</p>
<ul>
<li>Users can register and log in using their email address and a password.</li>
<li>Users can create chat rooms and include other users in those rooms.</li>
<li>Users can post messages to a chat room (optionally including their location and photos).</li>
<li>All members of a chatroom can see messages sent to the room by themselves or other users.</li>
</ul>
<p><iframe loading="lazy" width="600" height="340" src="https://www.youtube.com/embed/BlV9El_MJqk" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></p>
<h2>Upgrade #1: Add a High-Priority Flag to Chat Messages</h2>
<p>The first update is to allow a user to tag a message as being high-priority as they post it to the chat room:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Set_Priority_a2c8f60550.png" alt="Screenshot showing the option to click a thermometer button to tag the message as urgent"></p>
<p>That message is then highlighted with bold text and a &#8220;hot&#8221; icon in the list of chat messages:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/View_Priority_1991c9d4bf.png" alt="Screenshot showing that a high-priority message has bold text and a hot thermometer icon"></p>
<h3>Updating the Backend Realm Schema</h3>
<p>Adding a new field is an <a href="https://docs.mongodb.com/realm/sync/synced-schema-overview/">additive change</a>â€”meaning that you don&#8217;t need to restart sync (which would require every deployed instance of the RChat mobile app to recognize the change and start sync from scratch, potentially losing local changes).</p>
<p>We add the new <code>isHighPriority</code> bool to our Realm schema through the Realm UI:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Update_Schema_v1_b9ff24b45c.png" alt="Screenshot from the RealmUI showing that the isHighPriority bool has been added to the schema"></p>
<p>We also make <code>isHighPriority</code> a required (non-optional field).</p>
<p>The resulting schema looks like this:</p>
<pre><code class="js">{
   "bsonType": "object",
   "properties": {
     "_id": {
       "bsonType": "string"
     },
     "author": {
       "bsonType": "string"
     },
     "image": {
       "bsonType": "object",
       "properties": {
         "_id": {
           "bsonType": "string"
         },
         "date": {
           "bsonType": "date"
         },
         "picture": {
           "bsonType": "binData"
         },
         "thumbNail": {
           "bsonType": "binData"
         }
       },
       "required": [
         "_id",
         "date"
       ],
       "title": "Photo"
     },
     "isHighPriority": {
       "bsonType": "bool"
     },
     "location": {
       "bsonType": "array",
       "items": {
         "bsonType": "double"
       }
     },
     "partition": {
       "bsonType": "string"
     },
     "text": {
       "bsonType": "string"
     },
     "timestamp": {
       "bsonType": "date"
     }
   },
   "required": [
     "_id",
     "partition",
     "text",
     "timestamp",
     "isHighPriority"
   ],
   "title": "ChatMessage"
 }
</code></pre>
<p>Note that existing versions of our iOS RChat app can continue to work with our updated backend Realm app, even though their local <code>ChatMessage</code> Realm objects don&#8217;t include the new field.</p>
<h3>Updating the iOS RChat App</h3>
<p>While existing versions of the iOS RChat app can continue to work with the updated Realm backend app, they can&#8217;t use the new <code>isHighPriority</code> field as it isn&#8217;t part of the <code>ChatMessage</code> object.</p>
<p>To add the new feature, we need to update the mobile app after deploying the updated Realm backend application.</p>
<p>The first change is to add the <code>isHighPriority</code> field to the <code>ChatMessage</code> class:</p>
<pre><code class="swift">class ChatMessage: Object, ObjectKeyIdentifiable {
   @Persisted(primaryKey: true) var _id = UUID().uuidString
   @Persisted var partition = "" // "conversation=&lt;conversation-id&gt;"
   @Persisted var author: String? // username
   @Persisted var text = ""
   @Persisted var image: Photo?
   @Persisted var location = List&lt;Double&gt;()
   @Persisted var timestamp = Date()
   @Persisted var isHighPriority = false
   ...
}
</code></pre>
<p>As seen in the <a href="https://www.mongodb.com/developer/how-to/realm-schema-migration">previous post in this series</a>, Realm can automatically update the local realm to include this new attribute and initialize it to <code>false</code>. Unlike with standalone realms, we **don&#8217;t*- need to signal to the Realm SDK that we&#8217;ve updated the schema by providing a schema version.</p>
<p>The new version of the app will happily exchange messages with instances of the original app on other devices (via our updated backend Realm app).</p>
<h2>Upgrade #2: Make <code>author</code> a Non-Optional Chat Message field</h2>
<p>When the initial version of RChat was written, the <code>author</code> field of <code>ChatMessage</code> was declared as being optional. We&#8217;ve since realized that there are no scenarios where we wouldn&#8217;t want the author included in a chat message. To make sure that no existing or future client apps neglect to include the author, we need to update our schema to make <code>author</code> a required field.</p>
<p>Unfortunately, changing a field from optional to required (or vice versa) is a <a href="https://docs.mongodb.com/realm/sync/synced-schema-overview/#destructive-changes">destructive change</a>, and so would break sync for any deployed instances of the RChat app.</p>
<p>Oops!</p>
<p>This means that there&#8217;s extra work needed to make the upgrade seamless for the end users. We&#8217;ll go through the process now.</p>
<h3>Updating the Backend Realm Schema</h3>
<p>The change we need to make to the schema is destructive. This means that the new document schema is incompatible with the schema that&#8217;s currently being used in our mobile app.</p>
<p>If RChat wasn&#8217;t already deployed on the devices of hundreds of millions of users (we can dream!), then we could update the Realm schema for the <code>ChatMessage</code> collection and restart Realm Sync. During development, we can simply remove the original RChat mobile app and then install an updated version on our test devices.</p>
<p>To avoid that trauma for our end users, we leave the <code>ChatMessage</code> collection&#8217;s schema as is and create a <a href="https://docs.mongodb.com/realm/sync/migrate-schema-partner-collection/#partner-collections">partner collection</a>. The partner collection (<code>ChatMessageV2</code>) will contain the same data as <code>ChatMessage</code>, except that its schema makes <code>author</code> a required field.</p>
<p>These are the steps we&#8217;ll go through to create the partner collection:</p>
<ul>
<li>Define a Realm schema for the <code>ChatMessageV2</code> collection.</li>
<li>Run an <a href="https://docs.mongodb.com/manual/aggregation/">aggregation</a> to copy all of the documents from <code>ChatMessage</code> to <code>ChatMessageV2</code>. If <code>author</code> is missing from a <code>ChatMessage</code> document, then the aggregation will add it.</li>
<li>Add a trigger to the <code>ChatMessage</code> collection to propagate any changes to <code>ChatMessageV2</code> (adding <code>author</code> if needed).</li>
<li>Add a trigger to the <code>ChatMessageV2</code> collection to propagate any changes to <code>ChatMessage</code>.</li>
</ul>
<h4>Define the Schema for the Partner Collection</h4>
<p>From the Realm UI, copy the schema from the <code>ChatMessage</code> collection.</p>
<p>Click the button to create a new schema:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/add_collection_c16ec9a063.png" alt="Showing a plus button in the Realm UI to add a new collection"></p>
<p>Set the database and collection name before clicking &#8220;Add Collection&#8221;:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/config_collection_324bc0182e.png" alt="Setting the database and collection names in the Realm UI"></p>
<p>Paste in the schema copied from <code>ChatMessage</code>, add <code>author</code> to the <code>required</code> section, change the <code>title</code> to <code>ChatMessageV2</code>, and the click the &#8220;SAVE&#8221; button:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/define_schema_be6ae7c555.png" alt="Adding &quot;author&quot; to the required attribute list and naming the class ChatMessageV2 in the Realm UI"></p>
<p>This is the resulting schema:</p>
<pre><code class="js">{
   "bsonType": "object",
   "properties": {
     "_id": {
       "bsonType": "string"
     },
     "author": {
       "bsonType": "string"
     },
     "image": {
       "bsonType": "object",
       "properties": {
         "_id": {
           "bsonType": "string"
         },
         "date": {
           "bsonType": "date"
         },
         "picture": {
           "bsonType": "binData"
         },
         "thumbNail": {
           "bsonType": "binData"
         }
       },
       "required": [
         "_id",
         "date"
       ],
       "title": "Photo"
     },
     "isHighPriority": {
       "bsonType": "bool"
     },
     "location": {
       "bsonType": "array",
       "items": {
         "bsonType": "double"
       }
     },
     "partition": {
       "bsonType": "string"
     },
     "text": {
       "bsonType": "string"
     },
     "timestamp": {
       "bsonType": "date"
     }
   },
   "required": [
     "_id",
     "partition",
     "text",
     "timestamp",
     "isHighPriority",
     "author"
   ],
   "title": "ChatMessageV2"
 }
</code></pre>
<h4>Copy Existing Data to the Partner Collection</h4>
<p>We&#8217;re going to use an <a href="https://docs.mongodb.com/manual/aggregation/">aggregation pipeline</a> to copy and transform the existing data from the original collection (<code>ChatMessage</code>) to the partner collection (<code>ChatMessageV2</code>).</p>
<p>You may want to pause sync just before you run the aggregation, and then unpause it after you enable the trigger on the <code>ChatMessage</code> collection in the next step:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/pause_sync_707605a511.png" alt="Pressing a button to pause Realm sync in the Realm UI"></p>
<p>The end users can continue to create new messages while sync is paused, but those messages won&#8217;t be published to other users until sync is resumed. By pausing sync, you can ensure that all new messages will make it into the partner collection (and so be visible to users running the new version of the mobile app).</p>
<p>If pausing sync is too much of an inconvenience, then you could create a temporary trigger on the <code>ChatMessage</code> collection that will copy and transform document inserts to the <code>ChatMessageV2</code> collection (it&#8217;s a subset of the <code>ChatMessageProp</code> trigger we&#8217;ll define in the next section.).</p>
<p>From the Atlas UI, select &#8220;Collections&#8221; -> &#8220;ChatMessage&#8221;, &#8220;New Pipeline From Text&#8221;:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/add_aggregation_2e84c4a8df.png" alt="Navigating through &quot;Atlas/ChatMessage/Collections/New Pipeline from Text&quot; in the Realm UI"></p>
<p>Paste in this aggregation pipeline and click the &#8220;Create New&#8221; button:</p>
<pre><code class="js">[
 {
   '$addFields': {
     'author': {
       '$convert': {
         'input': '$author',
         'to': 'string',
         'onError': 'unknown',
         'onNull': 'unknown'
       }
     }
   }
 },
 {
   '$merge': {
     into: "ChatMessageV2",
     on: "_id",
     whenMatched: "replace",
     whenNotMatched: "insert"
   }
 }
]
</code></pre>
<p>This aggregation will take each <code>ChatMessage</code> document, set <code>author</code> to &#8220;unknown&#8221; if it&#8217;s not already set, and then add it to the <code>ChatMessageV2</code> collection.</p>
<p>Click &#8220;MERGE DOCUMENTS&#8221;:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/merge_documents_8b40ae6ce6.png" alt="Clicking the &quot;Merge Documents&quot; button in the Realm UI"></p>
<p><code>ChatMessageV2</code> now contains a (possibly transformed) copy of every document from <code>ChatMessage</code>. But, changes to one collection won&#8217;t be propagated to the other. To address that, we add a database trigger to each collectionâ€¦</p>
<h4>Add Database Triggers</h4>
<p>We need to create two <a href="https://docs.mongodb.com/realm/functions/">Realm Functions</a>â€”one to copy/transfer documents to <code>ChatMessageV2</code>, and one to copy documents to <code>ChatMessage</code>.</p>
<p>From the &#8220;Functions&#8221; section of the Realm UI, click &#8220;Create New Function&#8221;:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/new_function_3fd3b90a11.png" alt="Clicking the &quot;Create New Function&quot; button in the Realm UI"></p>
<p>Name the function <code>copyToChatMessageV2</code>. Set the authentication method to &#8220;System&#8221;â€”this will circumvent any access permissions on the <code>ChatMessageV2</code> collection. Ensure that the &#8220;Private&#8221; switch is turned onâ€”that means that the function can be called from a trigger, but not directly from a frontend app. Click &#8220;Save&#8221;:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/configure_function_6acb29f42b.png" alt="Set the name to &quot;copyToChatMessageV2&quot;, authentication to &quot;System&quot; and &quot;Private&quot; to &quot;On&quot;. Then click the &quot;Save&quot; button in the Realm UI"></p>
<p>Paste this code into the function editor and save:</p>
<pre><code class="js">exports = function (changeEvent) {
   const db = context.services.get("mongodb-atlas").db("RChat");


   if (changeEvent.operationType === "delete") {
     return db.collection("ChatMessageV2").deleteOne({ _id: changeEvent.documentKey._id });
   }


   const author = changeEvent.fullDocument.author ? changeEvent.fullDocument.author : "Unknown";
   const pipeline = [
     { $match: { _id: changeEvent.documentKey._id } },
     {
       $addFields: {
         author: author,
       }
     },
     { $merge: "ChatMessageV2" }];


   return db.collection("ChatMessage").aggregate(pipeline);
};
</code></pre>
<p>This function will receive a <code>ChatMessage</code> document from our trigger. If the operation that triggered the function is a delete, then this function deletes the matching document from <code>ChatMessageV2</code>. Otherwise, the function either copies <code>author</code> from the incoming document or sets it to &#8220;Unknown&#8221; before writing the transformed document to <code>ChatMessageV2</code>. We could initialize <code>author</code> to any string, but I&#8217;ve used &#8220;Unknown&#8221; to tell the user that we don&#8217;t know who the author was.</p>
<p>Create the <code>copyToChatMessage</code> function in the same way:</p>
<pre><code class="js">exports = function (changeEvent) {
   const db = context.services.get("mongodb-atlas").db("RChat");


   if (changeEvent.operationType === "delete") {
     return db.collection("ChatMessage").deleteOne({ _id: changeEvent.documentKey._id })
   }
    const pipeline = [
     { $match: { _id: changeEvent.documentKey._id } },
     { $merge: "ChatMessage" }]
   return db.collection("ChatMessageV2").aggregate(pipeline);
};
</code></pre>
<p>The final change needed to the backend Realm application is to add database triggers that invoke these functions.</p>
<p>From the &#8220;Triggers&#8221; section of the Realm UI, click &#8220;Add a Trigger&#8221;:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/configure_trigger_558a629423.png" alt="Click the &quot;Add a Trigger&quot; button in the Realm UI"></p>
<p>Configure the <code>ChatMessageProp</code> trigger as shown:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/trigger_settings_1601e02011.png" alt="In the Realm UI, set &quot;Trigger Type&quot; to &quot;Database&quot;. Set &quot;Name&quot; to &quot;ChatMessageProp&quot;. Enabled = On. Event Ordering = on. Cluster Name = Cluster 0. Database name = RChat. Collection name = ChatMessage. Check all operation types. Full Document = on. Document Preimage = off. Event Type = Function. Function = copyToChatMessageV2"></p>
<p>Repeat for <code>ChatMessageV2Change</code>:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/trigger2_settings_c55de55738.png" alt="In the Realm UI, set &quot;Trigger Type&quot; to &quot;Database&quot;. Set &quot;Name&quot; to &quot;ChatMessageProp&quot;. Enabled = On. Event Ordering = on. Cluster Name = Cluster 0. Database name = RChat. Collection name = ChatMessage. Check all operation types. Full Document = off. Document Preimage = off. Event Type = Function. Function = copyToChatMessage"></p>
<p>If you paused sync in the previous section, then you can now unpause it.</p>
<h3>Updating the iOS RChat App</h3>
<p>We want to ensure that users still running the old version of the app can continue to exchange messages with users running the latest version.</p>
<p>Existing versions of RChat will continue to work. They will create <code>ChatMessage</code> objects which will get synced to the <code>ChatMessage</code> Atlas collection. The database triggers will then copy/transform the document to the <code>ChatMessageV2</code> collection.</p>
<p>We now need to create a new version of the app that works with documents from the <code>ChatMessageV2</code> collection. We&#8217;ll cover that in this section.</p>
<p>Recall that we set <code>title</code> to <code>ChatMessageV2</code> in the partner collection&#8217;s schema. That means that to sync with that collection, we need to rename the <code>ChatMessage</code> class to <code>ChatMessageV2</code> in the iOS app.</p>
<p>Changing the name of the class throughout the app is made trivial by Xcode.</p>
<p>Open <code>ChatMessage.swift</code> and right-click on the class name (<code>ChatMessage</code>), select &#8220;Refactor&#8221; and then &#8220;Renameâ€¦&#8221;:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/refactor1_4c2d938e3d.png" alt="In Xcode, select the &quot;ChatMessage&quot; class name, right-click and select &quot;Refactor -> Rename&#8230;&quot;&#8221; /></p>
<p>Override the class name with <code>ChatMessageV2</code> and click &#8220;Rename&#8221;:</p>
<p><img decoding=" async></p>
<p>The final step is to make the author field mandatory. Remove the ? from the author attribute to make it non-optional:</p>
<pre><code class="swift">class ChatMessageV2: Object, ObjectKeyIdentifiable {
   @Persisted(primaryKey: true) var _id = UUID().uuidString
   @Persisted var partition = "" // "conversation=&lt;conversation-id&gt;"
   @Persisted var author: String
   ...
}
</code></pre>
<h2>Conclusion</h2>
<p>Modifying a Realm schema is a little more complicated when you&#8217;re using Realm Sync for a deployed app. You&#8217;ll have end users who are using older versions of the schema, and those apps need to continue to work.</p>
<p>Fortunately, the most common schema changes (adding or removing fields) are additive. They simply require updates to the back end and iOS schema.</p>
<p>Things get a little trickier for destructive changes, such as changing the type or optionality of an existing field. For these cases, you need to create and maintain a partner collection to avoid loss of data or service for your users.</p>
<p>This article has stepped through how to handle both additive and destructive schema changes, allowing you to add new features or fix issues in your apps without impacting users running older versions of your app.</p>
<p>Remember, you can find all of the code for this post in the RChat repo under these branches:</p>
<ul>
<li><a href="https://github.com/realm/RChat">Starting point</a></li>
<li><a href="https://github.com/realm/RChat/tree/new-schema">Upgrade #1</a></li>
<li><a href="https://github.com/realm/RChat/tree/v2-schema">Upgrade #2</a></li>
</ul>
<p>If you&#8217;re looking to upgrade the Realm schema for an iOS app that <strong>isn&#8217;t</strong> using Realm Sync, then refer to the <a href="https://www.mongodb.com/developer/how-to/realm-schema-migration">previous post in this series</a>.</p>
<p>If you have any questions or comments on this post (or anything else Realm-related), then please raise them on our <a href="https://www.mongodb.com/community/forums/c/realm-sdks/58">community forum</a>. To keep up with the latest Realm news, follow <a href="https://twitter.com/realm">@realm</a> on Twitter and join the <a href="https://live.mongodb.com/realm-global-community/">Realm global community</a>.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/migrating-your-ios-apps-synced-realm-schema-in-production" data-via="wpbeginner" data-text="Migrating Your iOS App&#8217;s Synced Realm Schema in Production" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/migrating-your-ios-apps-synced-realm-schema-in-production"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/migrating-your-ios-apps-synced-realm-schema-in-production" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Fmigrating-your-ios-apps-synced-realm-schema-in-production&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../category/mongodb/index.html" rel="category tag">MongoDB</a>, <a href="./../category/mongodb/realm/index.html" rel="category tag">Realm</a> | 
Tags: <a href="./ios/index.html" rel="tag">ios</a>, <a href="./swift/index.html" rel="tag">Swift</a>, <a href="./swiftui/index.html" rel="tag">SwiftUI</a>
</div>

			</div>			<div id="post-4623" class="post-4623 post type-post status-publish format-standard has-post-thumbnail hentry category-mongodb category-realm tag-ios tag-realm tag-swift tag-swiftui">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../mongodb/migrating-your-ios-apps-realm-schema-in-production/index.html">August 27, 2021</a>
			</div>
	<div class="postcomments">
		<a href="./../mongodb/migrating-your-ios-apps-realm-schema-in-production/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../mongodb/migrating-your-ios-apps-realm-schema-in-production/index.html" rel="bookmark">Migrating Your iOS App&#8217;s Realm Schema in Production</a></h2>
				
				<div class="entry">
					<img width="150" height="150" src="./../wp-content/uploads/2021/08/Twitter_1024x512-150x150.png" class="alignleft wp-post-image" alt="" decoding="async" loading="lazy" srcset="./../wp-content/uploads/2021/08/Twitter_1024x512-150x150.png 150w, ./../wp-content/uploads/2021/08/Twitter_1024x512-144x144.png 144w" sizes="auto, (max-width: 150px) 100vw, 150px">					<h2>Introduction</h2>
<p><a href="https://en.wikipedia.org/wiki/Murphy%27s_law">Murphy&#8217;s law</a> dictates that as soon as your mobile app goes live, you&#8217;ll receive a request to add a new feature. Then another. Then another.</p>
<p>This is fine if these features don&#8217;t require any changes to your data schema. But, that isn&#8217;t always the case.</p>
<p>Fortunately, Realm has built-in functionality to make schema migration easier.</p>
<p>This tutorial will step you through updating an existing mobile app to add some new features that require changes to the schema. In particular, we&#8217;ll look at the Realm migration code that ensures that no existing data is lost when the new app versions are rolled out to your production users.</p>
<p>We&#8217;ll use the <a href="https://www.mongodb.com/developer/how-to/realm-swiftui-scrumdinger-migration/">Scrumdinger app that I modified in a previous post to show how Apple&#8217;s sample Swift app could be ported to Realm</a>. The starting point for the app can be found in <a href="https://github.com/realm/Scrumdinger/tree/realm">this branch of our Scrumdinger repo</a> and the final version is in <a href="https://github.com/realm/Scrumdinger/tree/new-schema">this branch</a>.</p>
<p>Note that the app we&#8217;re using for this post doesn&#8217;t use <a href="https://docs.mongodb.com/realm/sync/">MongoDB Realm Sync</a>. If it did, then the schema migration process would be very differentâ€”I&#8217;ll cover that in a future tutorial, but for now, you can check out the <a href="https://docs.mongodb.com/realm/sync/migrate-schema-partner-collection/">docs</a>.</p>
<h2>Prerequisites</h2>
<p>This tutorial has a dependency on <a href="https://github.com/realm/realm-cocoa/releases">Realm-Cocoa 10.13.0+</a>.</p>
<h2>Baseline App/Realm Schema</h2>
<p>As a reminder, the starting point for this tutorial is the <a href="https://github.com/realm/scrumdinger/tree/realm">&#8220;realm&#8221; branch of the Scrumdinger repo</a>.</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/scrumdinger_original_b6a15f10ea.gif" alt="Animated gif of the original Scrumdinger app in action"></p>
<p>There are two Realm model classes that we&#8217;ll extend to add new features to Scrumdinger. The first, <a href="https://github.com/realm/Scrumdinger/blob/realm/Scrumdinger/Models/DailyScrum.swift">DailyScrum</a>, represents one scrum:</p>
<pre><code class="swift">class DailyScrum: Object, ObjectKeyIdentifiable {
   @Persisted var title = ""
   @Persisted var attendeeList = RealmSwift.List&lt;String&gt;()
   @Persisted var lengthInMinutes = 0
   @Persisted var colorComponents: Components?
   @Persisted var historyList = RealmSwift.List&lt;History&gt;()


   var color: Color { Color(colorComponents ?? Components()) }
   var attendees: [String] { Array(attendeeList) }
   var history: [History] { Array(historyList) }
   ...
}
</code></pre>
<p>The second, <a href="https://github.com/realm/Scrumdinger/blob/realm/Scrumdinger/Models/History.swift">History</a>, represents the minutes of a meeting from one of the user&#8217;s scrums:</p>
<pre><code class="swift">class History: EmbeddedObject, ObjectKeyIdentifiable {
   @Persisted var date: Date?
   @Persisted var attendeeList = List&lt;String&gt;()
   @Persisted var lengthInMinutes: Int = 0
   @Persisted var transcript: String?
   var attendees: [String] { Array(attendeeList) }
   ...
}
</code></pre>
<p>We can use <a href="https://docs.mongodb.com/realm/studio/">Realm Studio</a> to examine the contents of our Realm database after the <code>DailyScrum</code> and <code>History</code> objects have been created:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Daily_Scrum_original_117e226072.png" alt="DailyScrum data shown in RealmStudio"></p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/History_original_fcc4e0b78d.png" alt="History data shown in RealmStudio"></p>
<p><a href="https://www.mongodb.com/developer/how-to/realm-ios-database-access-using-realm-studio/">Accessing Realm Data on iOS Using Realm Studio</a> explains how to locate and open the Realm files from your iOS simulator.</p>
<h2>Schema Change #1â€”Mark Scrums as Public/Private</h2>
<p>The first new feature we&#8217;ve been asked to add is a flag to indicate whether each scrum is public or private:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Scrumdinger_show_privacy_00eb2f407b.png" alt="Screen capture highlighting the new status - set to &quot;Private&quot;"></p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Scrumdinger_edit_privacy_8df1447d57.png" alt="Screen capture showing the user setting the meeting status to &quot;Public&quot;"></p>
<p>This feature requires the addition of a new <code>Bool</code> named <code>isPublic</code> to <a href="https://github.com/realm/Scrumdinger/blob/new-schema/Scrumdinger/Models/DailyScrum.swift">DailyScrum</a>:</p>
<pre><code class="swift">class DailyScrum: Object, ObjectKeyIdentifiable {
   @Persisted var title = ""
   @Persisted var attendeeList = RealmSwift.List&lt;String&gt;()
   @Persisted var lengthInMinutes = 0
   @Persisted var isPublic = false
   @Persisted var colorComponents: Components?
   @Persisted var historyList = RealmSwift.List&lt;History&gt;()


   var color: Color { Color(colorComponents ?? Components()) }
   var attendees: [String] { Array(attendeeList) }
   var history: [History] { Array(historyList) }
   ...
}
</code></pre>
<p>Remember that our original version of Scrumdinger is already in production, and the embedded Realm database is storing instances of <code>DailyScrum</code>. We don&#8217;t want to lose that data, and so we must migrate those objects to the new schema when the app is upgraded.</p>
<p>Fortunately, Realm has built-in functionality to automatically handle the addition and deletion of fields. When adding a field, Realm will use a default value (e.g., <code>0</code> for an <code>Int</code>, and <code>false</code> for a <code>Bool</code>).</p>
<p>If we simply upgrade the installed app with the one using the new schema, then we&#8217;ll get a fatal error. That&#8217;s because we need to tell Realm that we&#8217;ve updated the schema. We do that by setting the schema version to 1 (the version defaulted to 0 for the original schema):</p>
<pre><code class="swift">@main
struct ScrumdingerApp: SwiftUI.App {
   var body: some Scene {
       WindowGroup {
           NavigationView {
               ScrumsView()
                   .environment(\.realmConfiguration,
                       Realm.Configuration(schemaVersion: 1))
           }
       }
   }
}
</code></pre>
<p>After upgrading the app, we can use <a href="https://docs.mongodb.com/realm/studio/">Realm Studio</a> to confirm that our <code>DailyScrum</code> object has been updated to initialize <code>isPublic</code> to <code>false</code>:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Daily_Scrum_updated_19c30fabd6.png" alt="RealmStudio showing that the new, isPublic field has been initialised to false"></p>
<h2>Schema Change #2â€”Store The Number of Attendees at Each Meeting</h2>
<p>The second feature request is to show the number of attendees in the history from each meeting:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Scrumdinger_History_Change_5218655494.png" alt="Screen capture showing that the number of attendees is now displayed in the meeting minutes"></p>
<p>We could calculate the count every time that it&#8217;s needed, but we&#8217;ve decided to calculate it just once and then store it in our <a href="https://github.com/realm/Scrumdinger/blob/new-schema/Scrumdinger/Models/History.swift">History</a> object in a new field named <code>numberOfAttendees</code>:</p>
<pre><code class="swift">class History: EmbeddedObject, ObjectKeyIdentifiable {
   @Persisted var date: Date?
   @Persisted var attendeeList = List&lt;String&gt;()
   @Persisted var numberOfAttendees = 0
   @Persisted var lengthInMinutes: Int = 0
   @Persisted var transcript: String?
   var attendees: [String] { Array(attendeeList) }
   ...
}
</code></pre>
<p>We increment the schema version to 2. Note that the schema version applies to all Realm objects, and so we have to set the version to 2 even though this is the first time that we&#8217;ve changed the schema for <code>History</code>.</p>
<p>If we leave it to Realm to initialize <code>numberOfAttendees</code>, then it will set it to 0â€”which is not what we want. Instead, we provide a <code>migrationBlock</code> which initializes new fields based on the old schema version:</p>
<pre><code class="swift">@main
struct ScrumdingerApp: SwiftUI.App {
   var body: some Scene {
       WindowGroup {
           NavigationView {
               ScrumsView()
                   .environment(\.realmConfiguration, Realm.Configuration(
                       schemaVersion: 2,
                       migrationBlock: { migration, oldSchemaVersion in
                            if oldSchemaVersion &lt; 1 {
                                // Could init the `DailyScrum.isPublic` field here, but the default behavior of setting
                                // it to `false` is what we want.
                            }
                            if oldSchemaVersion &lt; 2 {
                                migration.enumerateObjects(ofType: History.className()) { oldObject, newObject in
                                    let attendees = oldObject!["attendeeList"] as? RealmSwift.List&lt;DynamicObject&gt;
                                    newObject!["numberOfAttendees"] = attendees?.count ?? 0
                                }
                            }
                            if oldSchemaVersion &lt; 3 {
                                // TODO: This is where you'd add you're migration code to go from version
                                // to version 3 when you next modify the schema
                            }
                        }
                   ))
           }
       }
   }
}
</code></pre>
<p>Note that all other fields are migrated automatically.</p>
<p>It&#8217;s up to you how you use data from the previous schema to populate fields in the new schema. E.g., if you wanted to combine <code>firstName</code> and <code>lastName</code> from the previous schema to populate a <code>fullName</code> field in the new schema, then you could do so like this:</p>
<pre><code class="swift">migration.enumerateObjects(ofType: Person.className()) { oldObject, newObject in
   let firstName = oldObject!["firstName"] as! String
   let lastName = oldObject!["lastName"] as! String
   newObject!["fullName"] = "\(firstName) \(lastName)"
}
</code></pre>
<p>We can&#8217;t know what &#8220;old version&#8221; of the schema will be already installed on a user&#8217;s device when it&#8217;s upgraded to the latest version (some users may skip some versions,) and so the <code>migrationBlock</code> must handle all previous versions. Best practice is to process the incremental schema changes sequentially:</p>
<ul>
<li>
<code>oldSchemaVersion &lt; 1</code> : Process the delta between v0 and v1</li>
<li>
<code>oldSchemaVersion &lt; 2</code> : Process the delta between v1 and v2</li>
<li>
<code>oldSchemaVersion &lt; 3</code> : Process the delta between v2 and v3</li>
<li>&#8230;</li>
</ul>
<p>Realm Studio shows that our code has correctly initialized <code>numberOfAttendees</code>:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/History_new_11564ec4b0.png" alt="Realm Studio showing that the numberOfAttendees field has been set to 2 â€“Â matching the number of attendees in the meeting history"></p>
<h2>Conclusion</h2>
<p>It&#8217;s almost inevitable that any successful mobile app will need some schema changes after it&#8217;s gone into production. Realm makes adapting to those changes simple, ensuring that users don&#8217;t lose any of their existing data when upgrading to new versions of the app.</p>
<p>For changes such as adding or removing fields, all you need to do as a developer is to increment the version with each new deployed schema. For more complex changes, you provide code that computes the values for fields in the new schema using data from the old schema.</p>
<p>This tutorial stepped you through adding two new features that both required schema changes. You can view the final app in the <a href="https://github.com/realm/Scrumdinger/tree/new-schema">new-schema branch of the Scrumdinger repo</a>.</p>
<h2>Next Steps</h2>
<p>This post focussed on schema migration for an iOS app. You can find some <a href="https://github.com/realm/realm-cocoa/tree/master/examples/ios/swift/Migration">more complex examples in the repo</a>.</p>
<p>If you&#8217;re working with an app for a different platform, then you can find instructions in the docs:</p>
<ul>
<li><a href="https://docs.mongodb.com/realm/sdk/node/examples/modify-an-object-schema/">Node.js</a></li>
<li><a href="https://docs.mongodb.com/realm/sdk/android/examples/modify-an-object-schema/">Android</a></li>
<li><a href="https://docs.mongodb.com/realm/sdk/android/examples/modify-an-object-schema/">iOS</a></li>
<li><a href="https://docs.mongodb.com/realm/sdk/dotnet/examples/modify-an-object-schema/">.NET</a></li>
<li><a href="https://docs.mongodb.com/realm/sdk/react-native/examples/modify-an-object-schema/">React Native</a></li>
</ul>
<p>If you&#8217;ve any questions about schema migration, or anything else related to Realm, then please post them to our <a href="https://www.mongodb.com/community/forums/c/realm-sdks/58">community forum</a>.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/migrating-your-ios-apps-realm-schema-in-production" data-via="wpbeginner" data-text="Migrating Your iOS App&#8217;s Realm Schema in Production" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/migrating-your-ios-apps-realm-schema-in-production"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/migrating-your-ios-apps-realm-schema-in-production" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Fmigrating-your-ios-apps-realm-schema-in-production&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../category/mongodb/index.html" rel="category tag">MongoDB</a>, <a href="./../category/mongodb/realm/index.html" rel="category tag">Realm</a> | 
Tags: <a href="./ios/index.html" rel="tag">ios</a>, <a href="./realm/index.html" rel="tag">Realm</a>, <a href="./swift/index.html" rel="tag">Swift</a>, <a href="./swiftui/index.html" rel="tag">SwiftUI</a>
</div>

			</div>			<div id="post-4620" class="post-4620 post type-post status-publish format-standard hentry category-realm tag-ios tag-mobile tag-mongodb tag-realm tag-swiftui">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../mongodb/realm/maps/index.html">July 12, 2021</a>
			</div>
	<div class="postcomments">
		<a href="./../mongodb/realm/maps/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../mongodb/realm/maps/index.html" rel="bookmark">Using Maps and Location Data in Your SwiftUI (+Realm) App</a></h2>
				
				<div class="entry">
										<h2>Introduction</h2>
<p>Embedding Apple Maps and location functionality in SwiftUI apps used to be a bit of a pain. It required writing your own SwiftUI wrapper around UIKit codeâ€”see these examples from the O-FISH app:</p>
<ul>
<li><a href="https://github.com/WildAid/o-fish-ios/blob/main/o-fish-ios/Helpers/LocationHelper.swift">Location helper</a></li>
<li><a href="https://github.com/WildAid/o-fish-ios/tree/main/o-fish-ios/Views/Components/Maps">Map views</a></li>
</ul>
<p>If you only need to support iOS14 and later, then you can <strong>forget most of that messy code &#x1f60a;</strong>. If you need to support iOS13â€”sorry, you need to go the O-FISH route!</p>
<p>iOS14 introduced the <a href="https://developer.apple.com/documentation/mapkit/map">Map</a> SwiftUI view (part of <a href="https://developer.apple.com/documentation/mapkit/map">Mapkit</a>) allowing you to embed maps directly into your SwiftUI apps without messy wrapper code.</p>
<p>This article shows you how to embed Apple Maps into your app views using Mapkit&#8217;s Map view. We&#8217;ll then look at how you can fetch the user&#8217;s current locationâ€”with their permission, of course!</p>
<p>Finally, we&#8217;ll see how to store the location data in Realm in a format that lets MongoDB Realm sync it to MongoDB Atlas. Once in Atlas, you can add a <a href="https://docs.mongodb.com/manual/core/2dsphere/">geospatial index</a> and use <a href="https://www.mongodb.com/products/charts">MongoDB Charts</a> to plot the data on a mapâ€”we&#8217;ll look at that too.</p>
<p>Most of the code snippets have been extracted from the <a href="https://github.com/realm/RChat">RChat app</a>. That app is a good place to see maps and location data in action. <a href="https://developer.mongodb.com/how-to/building-a-mobile-chat-app-using-realm-new-way/">Building a Mobile Chat App Using Realm â€“ The New and Easier Way</a> is a good place to learn more about the RChat appâ€”including how to enable <a href="https://docs.mongodb.com/realm/sync/">MongoDB Realm Sync</a>.</p>
<h2>Prerequisites</h2>
<ul>
<li>
<a href="https://github.com/realm/realm-cocoa/releases">Realm-Cocoa 10.8.0</a>+ (may work with some 10.7.X versions)</li>
<li>iOS 14.5+ (<a href="https://developer.apple.com/documentation/mapkit/map">Mapkit</a> was introduced in iOS 14.0 and so most features should work with earlier iOS 14.X versions)</li>
<li><a href="https://developer.apple.com/xcode/">XCode12+</a></li>
</ul>
<h2>How to Add an Apple Map to Your SwiftUI App</h2>
<p>To begin, let&#8217;s create a simple view that displays a map, the coordinates of the center of that map, and the zoom level:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/realm_map1_7ea7ecbf15.gif" alt="Gif of scrolling around an embedded Apple Map and seeing the reported coordinates changing"></p>
<p>With Mapkit and SwiftUI, this only takes a few lines of code:</p>
<pre><code class="swift">import MapKit
import SwiftUI

struct MyMapView: View {
    @State private var region: MKCoordinateRegion = MKCoordinateRegion(
        center: CLLocationCoordinate2D(latitude: MapDefaults.latitude, longitude: MapDefaults.longitude),
        span: MKCoordinateSpan(latitudeDelta: MapDefaults.zoom, longitudeDelta: MapDefaults.zoom))

    private enum MapDefaults {
        static let latitude = 45.872
        static let longitude = -1.248
        static let zoom = 0.5
    }

    var body: some View {
        VStack {
            Text("lat: \(region.center.latitude), long: \(region.center.longitude). Zoom: \(region.span.latitudeDelta)")
            .font(.caption)
            .padding()
            Map(coordinateRegion: $region,
                interactionModes: .all,
                showsUserLocation: true)
        }
    }
}
</code></pre>
<p>Note that <code>showsUserLocation</code> won&#8217;t work unless the user has already given the app permission to use their locationâ€”we&#8217;ll get to that.</p>
<p><code>region</code> is initialized to a starting location, but it&#8217;s updated by the <code>Map</code> view as the user scrolls and zooms in and out.</p>
<h3>Adding Bells and Whistles to Your Maps (Pins at Least)</h3>
<p>Pins can be added to a map in the form of &#8220;annotations.&#8221; Let&#8217;s start with a single pin:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/realm_map2_3812086195.png" alt="Embedded Apple Map showing a red pin"></p>
<p>Annotations are provided as an array of structs where each instance must contain the coordinates of the pin. The struct must also conform to the <a href="https://developer.apple.com/documentation/swift/identifiable">Identifiable</a> protocol:</p>
<pre><code class="swift">struct MyAnnotationItem: Identifiable {
    var coordinate: CLLocationCoordinate2D
    let id = UUID()
}
</code></pre>
<p>We can now create an array of <code>MyAnnotationItem</code> structs:</p>
<pre><code class="swift">let annotationItems = [
    MyAnnotationItem(coordinate: CLLocationCoordinate2D(
        latitude: MapDefaults.latitude,
        longitude: MapDefaults.longitude))]
</code></pre>
<p>We then pass <code>annotationItems</code> to the <code>MapView</code> and indicate that we want a <code>MapMarker</code> at the contained coordinates:</p>
<pre><code class="swift">Map(coordinateRegion: $region,
    interactionModes: .all,
    showsUserLocation: true,
    annotationItems: annotationItems) { item in
        MapMarker(coordinate: item.coordinate)
    }
</code></pre>
<p>That gives us the result we wanted.</p>
<p>What if we want multiple pins? Not a problem. Just add more <code>MyAnnotationItem</code> instances to the array.</p>
<p>All of the pins will be the same default color. But, what if we want different colored pins? It&#8217;s simple to extend our code to produce this:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/realm_map3_669f6ec179.png" alt="Embedded Apple Map showing red, yellow, and plue pins at different locations"></p>
<p>Firstly, we need to extend <code>MyAnnotationItem</code> to include an optional <code>color</code> and a <code>tint</code> that returns <code>color</code> if it&#8217;s been defined and &#8220;red&#8221; if not:</p>
<pre><code class="swift">struct MyAnnotationItem: Identifiable {
    var coordinate: CLLocationCoordinate2D
    var color: Color?
    var tint: Color { color ?? .red }
    let id = UUID()
}
</code></pre>
<p>In our sample data, we can now choose to provide a color for each annotation:</p>
<pre><code class="swift">let annotationItems = [
    MyAnnotationItem(
        coordinate: CLLocationCoordinate2D(
            latitude: MapDefaults.latitude,
            longitude: MapDefaults.longitude)),
    MyAnnotationItem(
        coordinate: CLLocationCoordinate2D(
            latitude: 45.8827419,
            longitude: -1.1932383),
        color: .yellow),
    MyAnnotationItem(
        coordinate: CLLocationCoordinate2D(
            latitude: 45.915737,
            longitude: -1.3300991),
        color: .blue)
]
</code></pre>
<p>The <code>MapView</code> can then use the <code>tint</code>:</p>
<pre><code class="swift">Map(coordinateRegion: $region,
    interactionModes: .all,
    showsUserLocation: true,
    annotationItems: annotationItems) { item in
    MapMarker(
        coordinate: item.coordinate,
        tint: item.tint)
}
</code></pre>
<p>If you get bored of pins, you can use <code>MapAnnotation</code> to use any view you like for your annotations:</p>
<pre><code class="swift">Map(coordinateRegion: $region,
    interactionModes: .all,
    showsUserLocation: true,
    annotationItems: annotationItems) { item in
    MapAnnotation(coordinate: item.coordinate) {
        Image(systemName: "gamecontroller.fill")
            .foregroundColor(item.tint)
    }
}
</code></pre>
<p>This is the result:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/realm_map5_8509602cd7.png" alt="Apple Map showing red, yellow and blue game controller icons at different locations on the map"></p>
<p>You could also include the name of the system image to use with each annotation.</p>
<p>This <a href="https://gist.github.com/am-MongoDB/3073226a84bf6deb6b2df7afcb21ca92">gist</a> contains the final code for the view.</p>
<h2>Finding Your User&#8217;s Location</h2>
<h3>Asking for Permission</h3>
<p>Apple is pretty vocal about respecting the privacy of their users, and so it shouldn&#8217;t be a shock that your app will have to request permission before being able to access a user&#8217;s location.</p>
<p>The first step is to add a key-value pair to your Xcode project to indicate that the app may request permission to access the user&#8217;s location, and what text should be displayed in the alert. You can add the pair to the &#8220;Info.plist&#8221; file:</p>
<pre><code>Privacy - Location When In Use Usage Description : We'll only use your location when you ask to include it in a message
</code></pre>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/Info_plist_1500a15e11.png" alt="Screenshot from Xcode showing the key-value pair for requesting permission for the app to access the user's location"></p>
<p>Once that setting has been added, the user should see an alert the first time that the app attempts to access their current location:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/request_access_to_location_08d1be66d1.png" alt="iPhone screenshot â€“ app is requesting permission to access the user's location"></p>
<h3>Accessing Current Location</h3>
<p>While Mapkit has made maps simple and native in SwiftUI, the same can&#8217;t be said for location data.</p>
<p>You need to create a SwiftUI wrapper for Apple&#8217;s <a href="https://developer.apple.com/documentation/corelocation">Core Location</a> functionality. There&#8217;s not a lot of value in explaining this boilerplate codeâ€”just copy this code from RChat&#8217;s <a href="https://github.com/realm/RChat/blob/main/RChat-iOS/RChat/Helpers/LocationHelper.swift">LocationHelper.swift</a> file, and paste it into your app:</p>
<pre><code class="swift">import CoreLocation

class LocationHelper: NSObject, ObservableObject {

    static let shared = LocationHelper()
    static let DefaultLocation = CLLocationCoordinate2D(latitude: 45.8827419, longitude: -1.1932383)

    static var currentLocation: CLLocationCoordinate2D {
        guard let location = shared.locationManager.location else {
            return DefaultLocation
        }
        return location.coordinate
    }

    private let locationManager = CLLocationManager()

    private override init() {
        super.init()
        locationManager.delegate = self
        locationManager.desiredAccuracy = kCLLocationAccuracyBest
        locationManager.requestWhenInUseAuthorization()
        locationManager.startUpdatingLocation()
    }
}

extension LocationHelper: CLLocationManagerDelegate {
    func locationManager(_ manager: CLLocationManager, didUpdateLocations locations: [CLLocation]) { }

    public func locationManager(_ manager: CLLocationManager, didFailWithError error: Error) {
        print("Location manager failed with error: \(error.localizedDescription)")
    }

    public func locationManager(_ manager: CLLocationManager, didChangeAuthorization status: CLAuthorizationStatus) {
        print("Location manager changed the status: \(status)")
    }
}
</code></pre>
<p>Once added, you can access the user&#8217;s location with this simple call:</p>
<pre><code class="swift">let location = LocationHelper.currentLocation
</code></pre>
<h3>Store Location Data in Your Realm Database</h3>
<h4>The Location Format Expected by MongoDB</h4>
<p>Realm doesn&#8217;t have a native type for a geographic location, and so it&#8217;s up to us how we choose to store it in a Realm Object. That is, unless we want to synchronize the data to MongoDB Atlas using MongoDB Realm Sync, and go on to use MongoDB&#8217;s geospatial functionality.</p>
<p>To make the best use of the location data in Atlas, we need to add a <a href="https://docs.mongodb.com/manual/geospatial-queries/#geospatial-indexes">geospatial index</a> to the field (which weâ€™ll see how to do soon.) That means storing the location in a <a href="https://docs.mongodb.com/manual/geospatial-queries/#geospatial-data">supported format</a>. Not all options will work with Realm Sync (e.g., it&#8217;s not guaranteed that attributes will appear in the same order in your Realm Object and the synced Atlas document). The most robust approach is to use an array where the first element is longitude and the second is latitude:</p>
<pre><code class="json">location: [&lt;longitude&gt;, &lt;latitude&gt;]
</code></pre>
<h4>Your Realm Object</h4>
<p>The RChat app gives users the option to include their location in a chat messageâ€”this means that we need to include the location in the <a href="https://github.com/realm/RChat/blob/main/RChat-iOS/RChat/Model/ChatMessage.swift">ChatMessage</a> Object:</p>
<pre><code class="swift">@objcMembers class ChatMessage: Object, ObjectKeyIdentifiable {
  â€¦
    let location = List&lt;Double&gt;()
  â€¦
    convenience init(author: String, text: String, image: Photo?, location: [Double] = []) {
        ...
    location.forEach { coord in
            self.location.append(coord)
      }
        ...
        }
    }
   â€¦.
}
</code></pre>
<p>The <code>location</code> array that&#8217;s passed to that initializer is formed like this:</p>
<pre><code class="swift">let location = LocationHelper.currentLocation
self.location = [location.longitude, location.latitude]
</code></pre>
<h2>Location Data in Your Backend MongoDB Realm App</h2>
<p>The easiest way to create your backend MongoDB Realm schema is to enable <a href="https://docs.mongodb.com/realm/sync/enable-development-mode/">Development Mode</a>â€”that way, the schema is automatically generated from your Swift Realm Objects.</p>
<p>This is the generated <a href="https://github.com/realm/RChat/blob/main/RChat-Realm/RChat/services/mongodb-atlas/rules/RChat.ChatMessage.json">schema</a> for our &#8220;ChatMessage&#8221; collection:</p>
<pre><code class="swift">{
    "bsonType": "object",
    "properties": {
      "_id": {
        "bsonType": "string"
      },
      ...
      "location": {
        "bsonType": "array",
        "items": {
          "bsonType": "double"
        }
      }
    },
    "required": [
      "_id",
      ...
    ],
    "title": "ChatMessage"
}
</code></pre>
<p>This is a document that&#8217;s been created from a synced Realm <code>ChatMessage</code> object:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/atlas_document_d09cb3be1d.png" alt="Screen capture of an Atlas document, which includes an array named location"></p>
<h3>Adding a Geospatial Index in Atlas</h3>
<p>Now that you have location data stored in Atlas, it would be nice to be able to work with itâ€”e.g., running <a href="https://docs.mongodb.com/manual/geospatial-queries/">geospatial queries</a>. To enable this, you need to add a <a href="https://docs.mongodb.com/manual/geospatial-queries/#geospatial-indexes">geospatial index</a> to the <code>location</code> field.</p>
<p>From the Atlas UI, select the &#8220;Indexes&#8221; tab for your collection and click &#8220;CREATE INDEX&#8221;:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/geo_index1_604fcbcd13.png" alt="Atlas screen capture of creating a new index"></p>
<p>You should then configure a <code>2dsphere</code> index:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/geo_index2_8878556cfc.png" alt="Atlas screen capture of creating a new 2dsphere index"></p>
<p>Most chat messages won&#8217;t include the user&#8217;s location and so I set the <code>sparse</code> option for efficiency.</p>
<p>Note that you&#8217;ll get an error message if your ChatMessage collection contains any documents where the value in the location attribute isn&#8217;t in a valid geospatial format.</p>
<p>Atlas will then build the index. This will be very quick, unless you already have a huge number of documents containing the location field. Once complete, you can move onto the next section.</p>
<h3>Plotting Your Location Data in MongoDB Charts</h3>
<p><a href="https://www.mongodb.com/products/charts">MongoDB Charts</a> is a simple way to visualize MongoDB data. You can access it through the same UI as Realm and Atlas. Just click on the &#8220;Charts&#8221; button:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/select_charts_9c8caa71c0.png" alt="Atlas screen capture of MongoDB Charts button"></p>
<p>The first step is to click the &#8220;Add Data Source&#8221; button:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/charts_data_source_4cbf88fea5.png" alt="Charts screen capture of adding a new data source"></p>
<p>Select your Atlas cluster:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/charts_select_cluster_b6d35ea00e.png" alt="Charts screen capture of adding Atlas cluster as a data source"></p>
<p>Select the <code>RChat.ChatMessage</code> collection:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/charts_select_collections_4f0dc0577d.png" alt="Charts screen capture of selecting the ChatMessage collection in the RChat database"></p>
<p>Click â€œFinish.â€ Youâ€™ll be taken to the default Dashboards view, which is empty for now. Click &#8220;Add Dashboard&#8221;:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/charts_dashboard1_b25eb3e015.png" alt="Charts screen capture of adding a new dashboard"></p>
<p>In your new dashboard, click &#8220;ADD CHART&#8221;:</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/charts_add_chart_f00639d1a1.png" alt="Charts screen capture of adding a new chart"></p>
<p>Configure your chart as shown here by:<br>
&#8211; Setting the chart type to &#8220;Geospatial&#8221; and the sub-type to &#8220;Scatter.&#8221;<br>
&#8211; Dragging the &#8220;location&#8221; attribute to the coordinates box.<br>
&#8211; Dragging the &#8220;author&#8221; field to the &#8220;Color&#8221; box.</p>
<p><img decoding="async" src="https://mongodb-devhub-cms.s3.us-west-1.amazonaws.com/charts_create_chart_81189874ac.png" alt="Charts screen capture of configuring a new chart"></p>
<p>Once you&#8217;ve created your chart, you can <a href="https://docs.mongodb.com/charts/saas/embed-chart-anon-auth/#std-label-anon-embedding-charts">embed it</a> in web apps, etc. That&#8217;s beyond the scope of this article, but check out the <a href="https://docs.mongodb.com/charts/saas/">MongoDB Charts docs</a> if you&#8217;re interested.</p>
<h2>Conclusion</h2>
<p>SwiftUI makes it easy to embed Apple Maps in your SwiftUI apps. As with most Apple frameworks, there are extra maps features available if you break out from SwiftUI, but I&#8217;d suggest that the simplicity of working with SwiftUI is enough incentive for you to avoid that unless you have a compelling reason.</p>
<p>Accessing location information from within SwiftUI still feels a bit of a hack, but in reality, you cut and paste the helper code once, and then you&#8217;re good to go.</p>
<p>By storing the location as a <code>[longitude, latitude]</code> array (<code>List</code>) in your Realm database, it&#8217;s simple to sync it with MongoDB Atlas. Once in Atlas, you have the full power of MongoDB&#8217;s geospatial functionality to work your location data.</p>
<p>If you have questions, please head to our <a href="https://community.mongodb.com/">developer community website</a> where the MongoDB engineers and the MongoDB community will help you build your next big idea with MongoDB.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/realm/maps" data-via="wpbeginner" data-text="Using Maps and Location Data in Your SwiftUI (+Realm) App" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/realm/maps"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/realm/maps" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Frealm%2Fmaps&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../category/mongodb/realm/index.html" rel="category tag">Realm</a> | 
Tags: <a href="./ios/index.html" rel="tag">ios</a>, <a href="./mobile/index.html" rel="tag">mobile</a>, <a href="./mongodb/index.html" rel="tag">mongodb</a>, <a href="./realm/index.html" rel="tag">Realm</a>, <a href="./swiftui/index.html" rel="tag">SwiftUI</a>
</div>

			</div>			<div id="post-4604" class="post-4604 post type-post status-publish format-standard has-post-thumbnail hentry category-realm tag-ios tag-mobile tag-realm tag-swift tag-swiftui">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../mongodb/realm/new-article-on-migrating-apples-scrumdinger-tutorial-app-to-realm/index.html">April 12, 2021</a>
			</div>
	<div class="postcomments">
		<a href="./../mongodb/realm/new-article-on-migrating-apples-scrumdinger-tutorial-app-to-realm/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../mongodb/realm/new-article-on-migrating-apples-scrumdinger-tutorial-app-to-realm/index.html" rel="bookmark">New article on migrating Apple&#8217;s Scrumdinger tutorial app to Realm</a></h2>
				
				<div class="entry">
					<img width="150" height="150" src="./../wp-content/uploads/2021/04/scrumdinger-screenshot-150x150.png" class="alignleft wp-post-image" alt="" decoding="async" loading="lazy" srcset="./../wp-content/uploads/2021/04/scrumdinger-screenshot-150x150.png 150w, ./../wp-content/uploads/2021/04/scrumdinger-screenshot-144x144.png 144w" sizes="auto, (max-width: 150px) 100vw, 150px">					
Apple published a great <a rel="noreferrer noopener" href="https://developer.apple.com/tutorials/app-dev-training" target="_blank">tutorial</a> to teach developers how to create iOS apps using Swift and SwiftUI. I particularly like it because it doesn&#8217;t make any assumptions about existing UIKit experience, making it ideal for developers new to iOS. That tutorial is built around an <a rel="noreferrer noopener" href="https://github.com/realm/Scrumdinger" target="_blank">app named &#8220;Scrumdinger,&#8221;</a> which is designed to facilitate daily <a rel="noreferrer noopener" href="https://en.wikipedia.org/wiki/Scrum_(software_development)" target="_blank">scrum</a> meetings.




<div style="height:36px" aria-hidden="true" class="wp-block-spacer"></div>




Apple&#8217;s Scrumdinger implementation saves the app data to a local file whenever the user minimizes the app, and loads it again when they open the app. It seemed an interesting exercise to modify Scrumdinger to use Realm rather than a flat file to persist the data. So. I wrote <a rel="noreferrer noopener" href="https://developer.mongodb.com/how-to/realm-swiftui-scrumdinger-migration" target="_blank">&#8220;Adapting Apple&#8217;s Scrumdinger SwiftUI Tutorial App to Use Realm&#8221;</a> to step through what changes were required to rebase Scrumdinger onto Realm.




<div style="height:37px" aria-hidden="true" class="wp-block-spacer"></div>




An immediate benefit of the move is that changes are now persisted immediately, so nothing is lost if the device or app crashes. It&#8217;s beyond the scope of this article, but now that the app data is stored in Realm, it would be straightforward to add enhancements such as:




<ul class="wp-block-list">
<li>Search meeting minutes for a string.- Filter minutes by date or attendees.</li>
<li>Sync data so that the same user can see all of their data on multiple iOS (and optionally, Android) devices.</li>
<li>Use <a rel="noreferrer noopener" href="https://docs.mongodb.com/realm/sync/partitioning/" target="_blank">Realm Sync Partitions</a> to share scrum data between team members.</li>
<li>Sync the data to MongoDB Atlas so that it can be accessed by web apps or through a GraphQL API</li>
</ul>





					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/realm/new-article-on-migrating-apples-scrumdinger-tutorial-app-to-realm" data-via="wpbeginner" data-text="New article on migrating Apple&#8217;s Scrumdinger tutorial app to Realm" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/realm/new-article-on-migrating-apples-scrumdinger-tutorial-app-to-realm"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/realm/new-article-on-migrating-apples-scrumdinger-tutorial-app-to-realm" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Frealm%2Fnew-article-on-migrating-apples-scrumdinger-tutorial-app-to-realm&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../category/mongodb/realm/index.html" rel="category tag">Realm</a> | 
Tags: <a href="./ios/index.html" rel="tag">ios</a>, <a href="./mobile/index.html" rel="tag">mobile</a>, <a href="./realm/index.html" rel="tag">Realm</a>, <a href="./swift/index.html" rel="tag">Swift</a>, <a href="./swiftui/index.html" rel="tag">SwiftUI</a>
</div>

			</div>      
							<div class="more_posts">
					<span class="post_links"> &nbsp; </span>
				</div>
						

					
	</div>
		
		
<div id="sidebar">
	<ul>

<li id="search-2" class="widget widget_search"><form role="search" method="get" id="searchform" class="searchform" action=".//">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s">
					<input type="submit" id="searchsubmit" value="Search">
				</div>
			</form></li>

		<li id="recent-posts-2" class="widget widget_recent_entries">
		<h2 class="widgettitle">Recent Posts</h2>

		<ul>
											<li>
					<a href="./../mongodb/building-a-collaborative-ios-minesweeper-game-with-realm/index.html">Building a collaborative iOS Minesweeper game with Realm</a>
									</li>
											<li>
					<a href="./../mongodb/using-realm-flexible-sync-in-your-app-an-ios-tutorial/index.html">Using Realm Flexible Sync in Your Appâ€”an iOS Tutorial</a>
									</li>
											<li>
					<a href="./../mongodb/realm-swift-type-projections/index.html">Realm-Swift Type Projections</a>
									</li>
											<li>
					<a href="./../mongodb/introducing-flexible-sync-preview-the-next-iteration-of-realm-sync/index.html">Introducing Flexible Sync (Preview) â€“ The Next Iteration of Realm Sync</a>
									</li>
											<li>
					<a href="./../mongodb/goodbye-nspredicate-hello-realm-swift-query-api/index.html">Goodbye NSPredicate, hello Realm Swift Query API</a>
									</li>
					</ul>

		</li>
<li id="text-2" class="widget widget_text">			<div class="textwidget">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-5257306915232759";
/* Clusterdb-home */
google_ad_slot = "1624229680";
google_ad_width = 200;
google_ad_height =600;
//--></script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
</div>
		</li>
<li id="recent-comments-2" class="widget widget_recent_comments">
<h2 class="widgettitle">Recent Comments</h2>
<ul id="recentcomments">
<li class="recentcomments">
<span class="comment-author-link"><a href="http://mikael.ronstrom@blogspot.com/" class="url" rel="ugc external nofollow">Mikael RonstrÃ¶m</a></span> on <a href="./../mysql-cluster/mysql-cluster-running-on-raspberry-pi/index.html#comment-787242">MySQL Cluster running on Raspberry Pi</a>
</li>
<li class="recentcomments">
<span class="comment-author-link">andrew</span> on <a href="./../mysql-cluster/setting-up-mysql-asynchronous-replication-for-high-availability/index.html#comment-668717">Setting up MySQL Asynchronous Replication for High Availability</a>
</li>
<li class="recentcomments">
<span class="comment-author-link"><a href="http://www.suksesonline.com/" class="url" rel="ugc external nofollow">Betty</a></span> on <a href="./../mysql-cluster/setting-up-mysql-asynchronous-replication-for-high-availability/index.html#comment-668713">Setting up MySQL Asynchronous Replication for High Availability</a>
</li>
<li class="recentcomments">
<span class="comment-author-link">Sai Krishnan</span> on <a href="./../mysql-cluster/get-mysql-replication-up-and-running-in-5-minutes/index.html#comment-661143">Get MySQL Replication up and running in 5 minutes</a>
</li>
<li class="recentcomments">
<span class="comment-author-link">Nayan</span> on <a href="./../mysql-cluster/get-mysql-replication-up-and-running-in-5-minutes/index.html#comment-660628">Get MySQL Replication up and running in 5 minutes</a>
</li>
</ul>
</li>
<li id="categories-2" class="widget widget_categories">
<h2 class="widgettitle">Categories</h2>

			<ul>
					<li class="cat-item cat-item-2">
<a href="./../category/me/index.html">Me</a>
</li>
	<li class="cat-item cat-item-146">
<a href="./../category/mongodb/index.html">MongoDB</a>
</li>
	<li class="cat-item cat-item-3">
<a href="./../category/mysql/index.html">MySQL</a>
</li>
	<li class="cat-item cat-item-4">
<a href="./../category/mysql-cluster/index.html">MySQL Cluster</a>
</li>
	<li class="cat-item cat-item-131">
<a href="./../category/mysql-fabric/index.html">MySQL Fabric</a>
</li>
	<li class="cat-item cat-item-5">
<a href="./../category/mysql-replication/index.html">MySQL Replication</a>
</li>
	<li class="cat-item cat-item-214">
<a href="./../category/mongodb/realm/index.html">Realm</a>
</li>
	<li class="cat-item cat-item-1">
<a href="./../category/uncategorized/index.html">Uncategorized</a>
</li>
			</ul>

			</li>
<li id="tag_cloud-2" class="widget widget_tag_cloud">
<h2 class="widgettitle">Tags</h2>
<div class="tagcloud">
<a href="./7-4/index.html" class="tag-cloud-link tag-link-137 tag-link-position-1" style="font-size: 9.0632911392405pt;" aria-label="7.4 (7 items)">7.4</a>
<a href="./apache-kafka/index.html" class="tag-cloud-link tag-link-169 tag-link-position-2" style="font-size: 8.620253164557pt;" aria-label="Apache Kafka (6 items)">Apache Kafka</a>
<a href="./cluster/index.html" class="tag-cloud-link tag-link-18 tag-link-position-3" style="font-size: 8.620253164557pt;" aria-label="Cluster (6 items)">Cluster</a>
<a href="./ha/index.html" class="tag-cloud-link tag-link-41 tag-link-position-4" style="font-size: 15.354430379747pt;" aria-label="HA (40 items)">HA</a>
<a href="./high-availability/index.html" class="tag-cloud-link tag-link-43 tag-link-position-5" style="font-size: 15.26582278481pt;" aria-label="High Availability (39 items)">High Availability</a>
<a href="./ios/index.html" class="tag-cloud-link tag-link-215 tag-link-position-6" style="font-size: 10.658227848101pt;" aria-label="ios (11 items)">ios</a>
<a href="./java/index.html" class="tag-cloud-link tag-link-47 tag-link-position-7" style="font-size: 8.620253164557pt;" aria-label="Java (6 items)">Java</a>
<a href="./javascript/index.html" class="tag-cloud-link tag-link-48 tag-link-position-8" style="font-size: 10.303797468354pt;" aria-label="javascript (10 items)">javascript</a>
<a href="./mcm/index.html" class="tag-cloud-link tag-link-56 tag-link-position-9" style="font-size: 8pt;" aria-label="MCM (5 items)">MCM</a>
<a href="./mean/index.html" class="tag-cloud-link tag-link-186 tag-link-position-10" style="font-size: 8pt;" aria-label="MEAN (5 items)">MEAN</a>
<a href="./memcached/index.html" class="tag-cloud-link tag-link-57 tag-link-position-11" style="font-size: 8pt;" aria-label="Memcached (5 items)">Memcached</a>
<a href="./mobile/index.html" class="tag-cloud-link tag-link-211 tag-link-position-12" style="font-size: 8pt;" aria-label="mobile (5 items)">mobile</a>
<a href="./mongodb/index.html" class="tag-cloud-link tag-link-150 tag-link-position-13" style="font-size: 16.417721518987pt;" aria-label="mongodb (53 items)">mongodb</a>
<a href="./mongodb-3-2/index.html" class="tag-cloud-link tag-link-153 tag-link-position-14" style="font-size: 8pt;" aria-label="MongoDB 3.2 (5 items)">MongoDB 3.2</a>
<a href="./mongodb-atlas/index.html" class="tag-cloud-link tag-link-163 tag-link-position-15" style="font-size: 9.0632911392405pt;" aria-label="MongoDB Atlas (7 items)">MongoDB Atlas</a>
<a href="./mongodb-mobile/index.html" class="tag-cloud-link tag-link-212 tag-link-position-16" style="font-size: 8pt;" aria-label="MongoDB Mobile (5 items)">MongoDB Mobile</a>
<a href="./mongodb-stitch/index.html" class="tag-cloud-link tag-link-204 tag-link-position-17" style="font-size: 12.253164556962pt;" aria-label="MongoDB Stitch (17 items)">MongoDB Stitch</a>
<a href="./mysql/index.html" class="tag-cloud-link tag-link-147 tag-link-position-18" style="font-size: 22pt;" aria-label="MySQL (229 items)">MySQL</a>
<a href="./mysql-5-6/index.html" class="tag-cloud-link tag-link-64 tag-link-position-19" style="font-size: 10.924050632911pt;" aria-label="MySQL 5.6 (12 items)">MySQL 5.6</a>
<a href="./mysql-cluster/index.html" class="tag-cloud-link tag-link-148 tag-link-position-20" style="font-size: 21.46835443038pt;" aria-label="MySQL Cluster (198 items)">MySQL Cluster</a>
<a href="./mysql-cluster-70/index.html" class="tag-cloud-link tag-link-69 tag-link-position-21" style="font-size: 13.936708860759pt;" aria-label="MySQL Cluster 7.0 (27 items)">MySQL Cluster 7.0</a>
<a href="./mysql-cluster-7-1/index.html" class="tag-cloud-link tag-link-70 tag-link-position-22" style="font-size: 15.177215189873pt;" aria-label="MySQL Cluster 7.1 (38 items)">MySQL Cluster 7.1</a>
<a href="./mysql-cluster-7-2/index.html" class="tag-cloud-link tag-link-71 tag-link-position-23" style="font-size: 14.556962025316pt;" aria-label="MySQL Cluster 7.2 (32 items)">MySQL Cluster 7.2</a>
<a href="./mysql-cluster-7-3/index.html" class="tag-cloud-link tag-link-72 tag-link-position-24" style="font-size: 12.253164556962pt;" aria-label="MySQL Cluster 7.3 (17 items)">MySQL Cluster 7.3</a>
<a href="./mysql-cluster-7-4/index.html" class="tag-cloud-link tag-link-134 tag-link-position-25" style="font-size: 11.278481012658pt;" aria-label="MySQL Cluster 7.4 (13 items)">MySQL Cluster 7.4</a>
<a href="./mysql-cluster-cge/index.html" class="tag-cloud-link tag-link-73 tag-link-position-26" style="font-size: 17.569620253165pt;" aria-label="MySQL Cluster CGE (72 items)">MySQL Cluster CGE</a>
<a href="./mysql-cluster-manager/index.html" class="tag-cloud-link tag-link-74 tag-link-position-27" style="font-size: 12.607594936709pt;" aria-label="MySQL Cluster Manager (19 items)">MySQL Cluster Manager</a>
<a href="./mysql-enterprise-monitor/index.html" class="tag-cloud-link tag-link-76 tag-link-position-28" style="font-size: 9.0632911392405pt;" aria-label="MySQL Enterprise Monitor (7 items)">MySQL Enterprise Monitor</a>
<a href="./mysql-fabric-2/index.html" class="tag-cloud-link tag-link-132 tag-link-position-29" style="font-size: 9.0632911392405pt;" aria-label="mysql fabric (7 items)">mysql fabric</a>
<a href="./mysql-replication/index.html" class="tag-cloud-link tag-link-149 tag-link-position-30" style="font-size: 15.354430379747pt;" aria-label="MySQL Replication (40 items)">MySQL Replication</a>
<a href="./mysql-utilities/index.html" class="tag-cloud-link tag-link-78 tag-link-position-31" style="font-size: 8pt;" aria-label="MySQL Utilities (5 items)">MySQL Utilities</a>
<a href="./ndb-api/index.html" class="tag-cloud-link tag-link-80 tag-link-position-32" style="font-size: 10.303797468354pt;" aria-label="NDB API (10 items)">NDB API</a>
<a href="./node-js/index.html" class="tag-cloud-link tag-link-83 tag-link-position-33" style="font-size: 10.303797468354pt;" aria-label="node.js (10 items)">node.js</a>
<a href="./nosql/index.html" class="tag-cloud-link tag-link-84 tag-link-position-34" style="font-size: 12.784810126582pt;" aria-label="NoSQL (20 items)">NoSQL</a>
<a href="./performance/index.html" class="tag-cloud-link tag-link-97 tag-link-position-35" style="font-size: 9.9493670886076pt;" aria-label="Performance (9 items)">Performance</a>
<a href="./realm/index.html" class="tag-cloud-link tag-link-213 tag-link-position-36" style="font-size: 11.721518987342pt;" aria-label="Realm (15 items)">Realm</a>
<a href="./replication/index.html" class="tag-cloud-link tag-link-104 tag-link-position-37" style="font-size: 10.924050632911pt;" aria-label="Replication (12 items)">Replication</a>
<a href="./secondary/index.html" class="tag-cloud-link tag-link-138 tag-link-position-38" style="font-size: 11.278481012658pt;" aria-label="secondary (13 items)">secondary</a>
<a href="./serverless/index.html" class="tag-cloud-link tag-link-208 tag-link-position-39" style="font-size: 8.620253164557pt;" aria-label="serverless (6 items)">serverless</a>
<a href="./sharding/index.html" class="tag-cloud-link tag-link-129 tag-link-position-40" style="font-size: 8pt;" aria-label="sharding (5 items)">sharding</a>
<a href="./swift/index.html" class="tag-cloud-link tag-link-216 tag-link-position-41" style="font-size: 10.303797468354pt;" aria-label="Swift (10 items)">Swift</a>
<a href="./swiftui/index.html" class="tag-cloud-link tag-link-217 tag-link-position-42" style="font-size: 10.303797468354pt;" aria-label="SwiftUI (10 items)">SwiftUI</a>
<a href="./webcast/index.html" class="tag-cloud-link tag-link-124 tag-link-position-43" style="font-size: 8pt;" aria-label="Webcast (5 items)">Webcast</a>
<a href="./webinar/index.html" class="tag-cloud-link tag-link-125 tag-link-position-44" style="font-size: 12.430379746835pt;" aria-label="webinar (18 items)">webinar</a>
<a href="./windows/index.html" class="tag-cloud-link tag-link-127 tag-link-position-45" style="font-size: 9.0632911392405pt;" aria-label="Windows (7 items)">Windows</a>
</div>
</li>
<li id="theme_socialmedia-2" class="widget theme_socialmedia">			<div class="widget-social-icons">
				
			<a href="http://twitter.com/andrewmorgan"><img src="./../wp-content/themes/zeesynergie/images/icons/twitter.png" alt="twitter"></a><a href="http://www.facebook.com/andrewjamesmorgan"><img src="./../wp-content/themes/zeesynergie/images/icons/facebook.png" alt="facebook"></a><a href="https://plus.google.com/u/0/100605473697871424413/posts"><img src="./../wp-content/themes/zeesynergie/images/icons/googleplus.png" alt="googleplus"></a><a href="http://www.linkedin.com/profile/view?id=16709956"><img src="./../wp-content/themes/zeesynergie/images/icons/linkedin.png" alt="linkedin"></a><a href="http://www.flickr.com/photos/andrewjamesmorgan/"><img src="./../wp-content/themes/zeesynergie/images/icons/flickr.png" alt="flickr"></a><a href="http://www.youtube.com/channel/UCodtDakJ4VdeSCzS3P3rIsw"><img src="./../wp-content/themes/zeesynergie/images/icons/youtube.png" alt="youtube"></a>			</div>
		</li>
<li id="archives-2" class="widget widget_archive">
<h2 class="widgettitle">Archives</h2>

			<ul>
					<li><a href="./../2022/03/index.html">March 2022</a></li>
	<li><a href="./../2022/02/index.html">February 2022</a></li>
	<li><a href="./../2022/01/index.html">January 2022</a></li>
	<li><a href="./../2021/12/index.html">December 2021</a></li>
	<li><a href="./../2021/11/index.html">November 2021</a></li>
	<li><a href="./../2021/09/index.html">September 2021</a></li>
	<li><a href="./../2021/08/index.html">August 2021</a></li>
	<li><a href="./../2021/07/index.html">July 2021</a></li>
	<li><a href="./../2021/06/index.html">June 2021</a></li>
	<li><a href="./../2021/05/index.html">May 2021</a></li>
	<li><a href="./../2021/04/index.html">April 2021</a></li>
	<li><a href="./../2021/02/index.html">February 2021</a></li>
	<li><a href="./../2021/01/index.html">January 2021</a></li>
	<li><a href="./../2020/12/index.html">December 2020</a></li>
	<li><a href="./../2019/03/index.html">March 2019</a></li>
	<li><a href="./../2019/01/index.html">January 2019</a></li>
	<li><a href="./../2018/12/index.html">December 2018</a></li>
	<li><a href="./../2018/11/index.html">November 2018</a></li>
	<li><a href="./../2018/10/index.html">October 2018</a></li>
	<li><a href="./../2018/09/index.html">September 2018</a></li>
	<li><a href="./../2017/09/index.html">September 2017</a></li>
	<li><a href="./../2017/03/index.html">March 2017</a></li>
	<li><a href="./../2017/02/index.html">February 2017</a></li>
	<li><a href="./../2017/01/index.html">January 2017</a></li>
	<li><a href="./../2016/12/index.html">December 2016</a></li>
	<li><a href="./../2016/11/index.html">November 2016</a></li>
	<li><a href="./../2016/09/index.html">September 2016</a></li>
	<li><a href="./../2016/01/index.html">January 2016</a></li>
	<li><a href="./../2015/11/index.html">November 2015</a></li>
	<li><a href="./../2015/10/index.html">October 2015</a></li>
	<li><a href="./../2015/09/index.html">September 2015</a></li>
	<li><a href="./../2015/06/index.html">June 2015</a></li>
	<li><a href="./../2015/04/index.html">April 2015</a></li>
	<li><a href="./../2015/03/index.html">March 2015</a></li>
	<li><a href="./../2015/02/index.html">February 2015</a></li>
	<li><a href="./../2015/01/index.html">January 2015</a></li>
	<li><a href="./../2014/12/index.html">December 2014</a></li>
	<li><a href="./../2014/11/index.html">November 2014</a></li>
	<li><a href="./../2014/10/index.html">October 2014</a></li>
	<li><a href="./../2014/09/index.html">September 2014</a></li>
	<li><a href="./../2014/08/index.html">August 2014</a></li>
	<li><a href="./../2014/07/index.html">July 2014</a></li>
	<li><a href="./../2014/06/index.html">June 2014</a></li>
	<li><a href="./../2014/05/index.html">May 2014</a></li>
	<li><a href="./../2014/04/index.html">April 2014</a></li>
	<li><a href="./../2014/03/index.html">March 2014</a></li>
	<li><a href="./../2014/02/index.html">February 2014</a></li>
	<li><a href="./../2014/01/index.html">January 2014</a></li>
	<li><a href="./../2013/12/index.html">December 2013</a></li>
	<li><a href="./../2013/11/index.html">November 2013</a></li>
	<li><a href="./../2013/09/index.html">September 2013</a></li>
	<li><a href="./../2013/08/index.html">August 2013</a></li>
	<li><a href="./../2013/07/index.html">July 2013</a></li>
	<li><a href="./../2013/06/index.html">June 2013</a></li>
	<li><a href="./../2013/05/index.html">May 2013</a></li>
	<li><a href="./../2013/03/index.html">March 2013</a></li>
	<li><a href="./../2013/02/index.html">February 2013</a></li>
	<li><a href="./../2013/01/index.html">January 2013</a></li>
	<li><a href="./../2012/12/index.html">December 2012</a></li>
	<li><a href="./../2012/11/index.html">November 2012</a></li>
	<li><a href="./../2012/09/index.html">September 2012</a></li>
	<li><a href="./../2012/07/index.html">July 2012</a></li>
	<li><a href="./../2012/06/index.html">June 2012</a></li>
	<li><a href="./../2012/05/index.html">May 2012</a></li>
	<li><a href="./../2012/04/index.html">April 2012</a></li>
	<li><a href="./../2012/03/index.html">March 2012</a></li>
	<li><a href="./../2012/02/index.html">February 2012</a></li>
	<li><a href="./../2012/01/index.html">January 2012</a></li>
	<li><a href="./../2011/12/index.html">December 2011</a></li>
	<li><a href="./../2011/11/index.html">November 2011</a></li>
	<li><a href="./../2011/10/index.html">October 2011</a></li>
	<li><a href="./../2011/09/index.html">September 2011</a></li>
	<li><a href="./../2011/07/index.html">July 2011</a></li>
	<li><a href="./../2011/06/index.html">June 2011</a></li>
	<li><a href="./../2011/05/index.html">May 2011</a></li>
	<li><a href="./../2011/04/index.html">April 2011</a></li>
	<li><a href="./../2011/03/index.html">March 2011</a></li>
	<li><a href="./../2011/02/index.html">February 2011</a></li>
	<li><a href="./../2011/01/index.html">January 2011</a></li>
	<li><a href="./../2010/12/index.html">December 2010</a></li>
	<li><a href="./../2010/11/index.html">November 2010</a></li>
	<li><a href="./../2010/10/index.html">October 2010</a></li>
	<li><a href="./../2010/09/index.html">September 2010</a></li>
	<li><a href="./../2010/08/index.html">August 2010</a></li>
	<li><a href="./../2010/07/index.html">July 2010</a></li>
	<li><a href="./../2010/06/index.html">June 2010</a></li>
	<li><a href="./../2010/05/index.html">May 2010</a></li>
	<li><a href="./../2010/04/index.html">April 2010</a></li>
	<li><a href="./../2010/03/index.html">March 2010</a></li>
	<li><a href="./../2010/02/index.html">February 2010</a></li>
	<li><a href="./../2010/01/index.html">January 2010</a></li>
	<li><a href="./../2009/12/index.html">December 2009</a></li>
	<li><a href="./../2009/11/index.html">November 2009</a></li>
	<li><a href="./../2009/10/index.html">October 2009</a></li>
	<li><a href="./../2009/09/index.html">September 2009</a></li>
	<li><a href="./../2009/08/index.html">August 2009</a></li>
	<li><a href="./../2009/07/index.html">July 2009</a></li>
	<li><a href="./../2009/06/index.html">June 2009</a></li>
	<li><a href="./../2009/05/index.html">May 2009</a></li>
	<li><a href="./../2009/04/index.html">April 2009</a></li>
			</ul>

			</li>
	
	</ul>
</div>	</div>
	
	</div>
	<div id="footer">
		<div id="foot">
			Supported by <a href="http://www.thievesgarden.co.uk/" title="Maidenhead Accommodation - self catering apartment to rent" target="Thieves Garden">Thieves Garden - Maidenhead self catering apartment</a> and <a href="http://www.oleronvilla.com/" title="Ile d'Oleron Holiday Home to rent" target="Oleron Villa">Oleron Villa holiday home on Ile d'Oleron</a>.			<div class="credit_link">	<a href="http://themezee.com/">Theme by ThemeZee</a>
</div>
			<div class="clear"></div>
		</div>
	</div>
</div>
	<!-- Powered by WPtouch: 4.3.39 -->
</body>
</html>