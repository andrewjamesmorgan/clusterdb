<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>MySQL Replication &#8211; Andrew Morgan on Databases</title>
	<atom:link href="/tag/mysql-replication/feed" rel="self" type="application/rss+xml" />
	<link>/</link>
	<description>Database technologies - especially around scalability and High Availability</description>
	<lastBuildDate>Wed, 18 Feb 2015 15:17:35 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	
	<item>
		<title>Choosing the right MySQL HA Solution &#8211; free webinar</title>
		<link>/mysql-cluster/choosing-the-right-mysql-ha-solution-free-webinar</link>
					<comments>/mysql-cluster/choosing-the-right-mysql-ha-solution-free-webinar#respond</comments>
		
		<dc:creator><![CDATA[andrew]]></dc:creator>
		<pubDate>Wed, 18 Feb 2015 15:17:35 +0000</pubDate>
				<category><![CDATA[MySQL Cluster]]></category>
		<category><![CDATA[HA]]></category>
		<category><![CDATA[High Availability]]></category>
		<category><![CDATA[MySQL]]></category>
		<category><![CDATA[mysql fabric]]></category>
		<category><![CDATA[MySQL Replication]]></category>
		<category><![CDATA[secondary]]></category>
		<guid isPermaLink="false">/?p=4035</guid>

					<description><![CDATA[I&#8217;ll be presenting a webinar tomorrow (Thursday 19th February) on MySQL High Availability options for MySQL &#8211; what they are and how to choose the most appropriate one for your application. As always, the webinar is free but you should register here. Even if you can&#8217;t attend, it&#8217;s worth registering as you&#8217;ll be sent a]]></description>
										<content:encoded><![CDATA[<p><a href="/wp-content/uploads/2013/10/MySQL-HA-Logo1.png"><img fetchpriority="high" decoding="async" class="aligncenter size-full wp-image-2970" src="/wp-content/uploads/2013/10/MySQL-HA-Logo1.png" alt="MySQL-HA-Logo1.png" width="950" height="100" srcset="/wp-content/uploads/2013/10/MySQL-HA-Logo1.png 950w, /wp-content/uploads/2013/10/MySQL-HA-Logo1-300x31.png 300w" sizes="(max-width: 950px) 100vw, 950px" /></a>I&#8217;ll be presenting a webinar tomorrow (Thursday 19th February) on MySQL High Availability options for MySQL &#8211; what they are and how to choose the most appropriate one for your application.</p>
<p>As always, the webinar is free but you should <a title="Register for free webinar - Achieving MySQL High Availability, Learn to Select Your Best Option" href="http://www.mysql.com/news-and-events/web-seminars/achieving-mysql-ha-learn-to-select-best-option/" target="_blank">register here</a>. Even if you can&#8217;t attend, it&#8217;s worth registering as you&#8217;ll be sent a link to the replay as soon as it&#8217;s available.</p>
<p><span style="color: #333399;">How important is your data? Can you afford to lose it? What about just some of it? What would be the impact if you couldn&#8217;t access it for a minute, an hour, a day or a week?</span></p>
<p><span style="color: #333399;">Different applications can have very different requirements for High Availability. Some need 100% data reliability with 24x7x365 read &amp; write access while many others are better served by a simpler approach with more modest HA ambitions.</span></p>
<p><span style="color: #333399;">MySQL has an array of High Availability solutions ranging from simple backups, through replication and shared storage clustering &#8211; all the way up to 99.999% available shared nothing, geographically replicated clusters. These solutions also have different &#8216;bonus&#8217; features such as full InnoDB compatibility, in-memory real-time performance, linear scalability and SQL &amp; NoSQL APIs.</span></p>
<p><span style="color: #333399;">The purpose of this webinar is to help you decide where your application sits in terms of HA requirements and discover which of the MySQL solutions best fit the bill. It will also cover what you need outside of the database to ensure High Availability &#8211; state of the art monitoring being a prime example.</span></p>
<p><span style="color: #333399;">WHEN:</span></p>
<ul>
<li><span style="color: #333399;">Thu, Feb 19: 09:00 Pacific time (America)</span></li>
<li><span style="color: #333399;">Thu, Feb 19: 10:00 Mountain time (America)</span></li>
<li><span style="color: #333399;">Thu, Feb 19: 11:00 Central time (America)</span></li>
<li><span style="color: #333399;">Thu, Feb 19: 12:00 Eastern time (America)</span></li>
<li><span style="color: #333399;">Thu, Feb 19: 15:00 São Paulo time</span></li>
<li><span style="color: #333399;">Thu, Feb 19: 17:00 UTC</span></li>
<li><span style="color: #333399;">Thu, Feb 19: 17:00 Western European time</span></li>
<li><span style="color: #333399;">Thu, Feb 19: 18:00 Central European time</span></li>
<li><span style="color: #333399;">Thu, Feb 19: 19:00 Eastern European time</span></li>
<li><span style="color: #333399;">Thu, Feb 19: 22:30 India, Sri Lanka</span></li>
<li><span style="color: #333399;">Fri, Feb 20: 01:00 Singapore/Malaysia/Philippines time</span></li>
<li><span style="color: #333399;">Fri, Feb 20: 01:00 China time</span></li>
<li><span style="color: #333399;">Fri, Feb 20: 02:00 日本</span></li>
<li><span style="color: #333399;">Fri, Feb 20: 04:00 NSW, ACT, Victoria, Tasmania (Australia)</span></li>
</ul>
]]></content:encoded>
					
					<wfw:commentRss>/mysql-cluster/choosing-the-right-mysql-ha-solution-free-webinar/feed</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
		<item>
		<title>MySQL Cluster 7.4.3 RELEASE CANDIDATE now available</title>
		<link>/mysql-cluster/mysql-cluster-7-4-3-release-candidate-now-available</link>
					<comments>/mysql-cluster/mysql-cluster-7-4-3-release-candidate-now-available#comments</comments>
		
		<dc:creator><![CDATA[andrew]]></dc:creator>
		<pubDate>Thu, 22 Jan 2015 10:03:00 +0000</pubDate>
				<category><![CDATA[MySQL Cluster]]></category>
		<category><![CDATA[HA]]></category>
		<category><![CDATA[MySQL]]></category>
		<category><![CDATA[MySQL Cluster 7.4]]></category>
		<category><![CDATA[MySQL Replication]]></category>
		<category><![CDATA[Performance]]></category>
		<guid isPermaLink="false">/?p=3990</guid>

					<description><![CDATA[Oracle have just made availble the Release Candidate for MySQL Cluster 7.4 (MySQL Cluster 7.4.3) &#8211; it can be downloaded from the development release tab here. Note that this is not a GA release and so we wouldn&#8217;t recommend using it in production. The delta between this RC and the 7.4.2 DMR can be viewed]]></description>
										<content:encoded><![CDATA[<p><a href="/wp-content/uploads/2014/07/MySQL_Cluster_400.png"><img decoding="async" src="/wp-content/uploads/2014/07/MySQL_Cluster_400.png" alt="MySQL Cluster Logo" width="400" height="168" class="alignright size-full wp-image-3934" srcset="/wp-content/uploads/2014/07/MySQL_Cluster_400.png 400w, /wp-content/uploads/2014/07/MySQL_Cluster_400-300x126.png 300w" sizes="(max-width: 400px) 100vw, 400px" /></a></p>
<p>Oracle have just made availble the <strong>Release Candidate</strong> for MySQL Cluster 7.4 (MySQL Cluster 7.4.3) &#8211; it can be <a href="http://dev.mysql.com/downloads/cluster/" title="download the MySQL Cluster 7.4.3 Release Candidate" target="_blank">downloaded from the development release tab here</a>. Note that this is not a GA release and so we wouldn&#8217;t recommend using it in production.</p>
<p>The delta between this RC and the 7.4.2 DMR can be viewed in the <a href="http://dev.mysql.com/doc/relnotes/mysql-cluster/7.4/en/mysql-cluster-news-5-6-22-ndb-7-4-3.html" title="MySQL Cluster 7.4.3 Release Notes" target="_blank">MySQL Cluster 7.4.3 Release Notes</a></p>
<p>There are three main focus areas for this RC and the purpose of this post is to briefly introduce them:</p>
<ul>
<li>Active-Active (Multi-Master) Replication</li>
<li>Performance</li>
<li>Operational improvements (speeding up of restarts; enhanced memory reporting)</li>
</ul>
<h2>Active-Active (Multi-Master) Replication</h2>
<p>MySQL Cluster allows bi-directional replication between two (or more) clusters. Replication within each cluster is synchronous but between clusters it is asynchronous which means the following scenario is possible:</p>
<table summary="Active-Active asynchronous replication can lead to inconsistencies between databases" width="260" border="1" align="center">
<caption align="center">Conflict with asynchronous replication</caption>
<tbody>
<tr>
<th scope="col" align="center" width="80">Site A</th>
<th scope="col" align="center" width="100">Replication</th>
<th scope="col" align="center" width="80">Site B</th>
</tr>
<tr>
<td align="center">x == 10</td>
<td></td>
<td align="center">x == 10</td>
</tr>
<tr>
<td align="center">x = 11</td>
<td></td>
<td align="center">x = 20</td>
</tr>
<tr>
<td></td>
<td align="center">&#8212; x=11 &#8211;&gt;</td>
<td align="center">x == 11</td>
</tr>
<tr>
<td align="center">x==20</td>
<td align="center">&lt;&#8211; x=20 &#8212;</td>
<td></td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>In this example a value (column for a row in a table) is set to 11 on site A and the change is queued for replication to site B. In the mean time, an application sets the value to 20 on site B and that change is queued for replication to site A. Once both sites have received and applied the replicated change from the other cluster site A contains the value 20 while site B contains 11 &#8211; in other words the databases are now inconsistent.</p>
<h2>How MySQL Cluster implements eventual consistency</h2>
<p>There are two phases to establishing consistency between both clusters after an inconsistency has been introduced:</p>
<ol>
<li>Detect that a conflict has happened</li>
<li>Resolve the inconsistency</li>
</ol>
<p>The following animation illustrates how MySQL Cluster 7.2 detects that an inconsistency has been introduced by the asynchronous, active-active replication:</p>
<div id="attachment_2149" style="width: 610px" class="wp-caption alignnone"><a href="/wp-content/uploads/2011/11/ReflectingGCI1.gif"><img decoding="async" aria-describedby="caption-attachment-2149" class="size-full wp-image-2149" title="ReflectingGCI" src="/wp-content/uploads/2011/11/ReflectingGCI1.gif" alt="" width="600" height="463" /></a><p id="caption-attachment-2149" class="wp-caption-text">Detecting conflicts</p></div>
<p>While we typically consider the 2 clusters in an active-active replication configuration to be peers, in this case we designate one to be the primary and the other the secondary. Reads and writes can still be sent to either cluster but it is the responsibility of the primary to identify that a conflict has arisen and then remove the inconsistency.</p>
<p>A logical clock is used to identify (in relative terms) when a change is made on the primary &#8211; for those who know something of the MySQL Cluster internals, we use the index of the Global Checkpoint that the update is contained in. For all tables that have this feature turned on, an extra, hidden column is automatically added on the primary &#8211; this represents the value of the logical clock when the change was made.</p>
<p>Once the change has been applied on the primary, there is a &#8220;window of conflict&#8221; for the effected row(s) during which if a different change is made to the same row(s) on the secondary then there will be an inconsistency. Once the slave on the secondary has applied the change from the primary, it will send a replication event back to the slave on the primary, containing the primary&#8217;s clock value associated with the changes that have just been applied on the secondary. (Remember that the clock is actually the Global Checkpoint Index and so this feature is sometimes referred to as Reflected GCI). Once the slave on the primary has received this event, it knows that all changes tagged with a clock value no later than the reflected GCI are now safe &#8211; the window of conflict has closed.</p>
<p>If an application modifies this same row on the secondary before the replication event from the primary was applied then it will send an associated replication event to the slave on the primary <strong>before</strong> it reflects the new GCI. The slave on the primary will process this replication event and compare the clock value recorded with the effected rows with the latest reflected GCI; as the clock value for the conflicting row is higher the primary recognises that a conflict has occured and will launch the algorithm to resolve the inconsistency.</p>
<p><a href="/wp-content/uploads/2014/09/Screen-Shot-2014-09-25-at-13.34.15.png"><img loading="lazy" decoding="async" src="/wp-content/uploads/2014/09/Screen-Shot-2014-09-25-at-13.34.15-300x109.png" alt="Options for MySQL Cluster replication conflict detection/resolution" width="300" height="109" class="alignright size-medium wp-image-3950" srcset="/wp-content/uploads/2014/09/Screen-Shot-2014-09-25-at-13.34.15-300x109.png 300w, /wp-content/uploads/2014/09/Screen-Shot-2014-09-25-at-13.34.15-1024x372.png 1024w, /wp-content/uploads/2014/09/Screen-Shot-2014-09-25-at-13.34.15-900x327.png 900w, /wp-content/uploads/2014/09/Screen-Shot-2014-09-25-at-13.34.15.png 1728w" sizes="auto, (max-width: 300px) 100vw, 300px" /></a></p>
<p>After a conflict has been detected, you have the option of having the database simply report the conflict to the application or have it roll back just the conflicting row or the entire transaction and all subsequent transactions that were dependent on it.</p>
<p>So &#8211; what&#8217;s new in 7.4?</p>
<ul>
<li>Detects conflicts between inserts and updates</li>
<li>Option to roll back entire transaction (and dependent transactions) rather than just the conflicting row</li>
<li>All conflicts are handled before switching primary &#8211; avoiding potential race conditions</li>
</ul>
<h3>Performance</h3>
<p><a href="/wp-content/uploads/2014/09/Screen-Shot-2014-09-25-at-13.35.23.png"><img loading="lazy" decoding="async" src="/wp-content/uploads/2014/09/Screen-Shot-2014-09-25-at-13.35.23-300x197.png" alt="MySQL CLuster Read-Write Performance" width="300" height="197" class="alignright size-medium wp-image-3952" srcset="/wp-content/uploads/2014/09/Screen-Shot-2014-09-25-at-13.35.23-300x197.png 300w, /wp-content/uploads/2014/09/Screen-Shot-2014-09-25-at-13.35.23.png 864w" sizes="auto, (max-width: 300px) 100vw, 300px" /></a><br />
Being a scaled-out, in-memory, real-time database, MySQL Cluster performance has always been great but we continue to work on making it faster each release. In particular, we want to keep pace with the trend of having more and more cores rather than faster ones. 7.4 continues along the path of better exploiting multiple cores &#8211; as can be seen from these benchmark results.<br />
<a href="/wp-content/uploads/2014/09/Screen-Shot-2014-09-25-at-13.35.15.png"><img loading="lazy" decoding="async" src="/wp-content/uploads/2014/09/Screen-Shot-2014-09-25-at-13.35.15-300x199.png" alt="MySQL CLuster 7.4 Read Performance" width="300" height="199" class="alignright size-medium wp-image-3951" srcset="/wp-content/uploads/2014/09/Screen-Shot-2014-09-25-at-13.35.15-300x199.png 300w, /wp-content/uploads/2014/09/Screen-Shot-2014-09-25-at-13.35.15.png 842w" sizes="auto, (max-width: 300px) 100vw, 300px" /></a><br />
Just make sure that you&#8217;re using the multi-threaded data node (ndbmtd rather than ndbd) and have <a href="http://dev.mysql.com/doc/refman/5.6/en/mysql-cluster-programs-ndbmtd.html" title="MySQL Cluster - configuring multi-threaded datanodes" target="_blank">configured how many threads it should use</a>.</p>
<h3>Faster Restarts</h3>
<p>You can restart MySQL Cluster processes (nodes) without losing database service (for example if adding extra memory to a server) and so on the face of it, the speed of the restarts isn&#8217;t that important. Having said that, while the node is restarting you&#8217;ve lost some of your high-availability which for super-critical applications can make you nervous. Additionally, faster restarts mean that you can complete maintenance activities faster &#8211; for example, a software upgrade requires a rolling restart of all of the nodes &#8211; if you have 48 data nodes then you want each of the data nodes to restart as quickly as possible.</p>
<p>MySQL 7.4 includes a number of optimisations to the restart code and so if you&#8217;re already using MySQL Cluster, it might be interesting to see how much faster it gets for your application. We also have some extra optimisations in the works that you can expect to see in later 7.4 versions.</p>
<h3>Extra Memory Reporting</h3>
<p>MySQL Cluster presents a lot of monitoring information through the <a href="http://dev.mysql.com/doc/refman/5.6/en/mysql-cluster-ndbinfo.html" title="ndbinfo database" target="_blank">ndbinfo database</a> and in 7.4 we&#8217;ve added some extra information on how memory is used for individual tables.</p>
<p>For example; to see how much memory is being used by each data node for a particular table&#8230;</p>
<pre style="font: normal normal normal 9px Consolas, Monaco, 'Courier New', Courier, monospace; padding-left: 30px; color: #000080;">
mysql> CREATE DATABASE clusterdb;USE clusterdb;
mysql> CREATE TABLE simples (id INT NOT NULL AUTO_INCREMENT PRIMARY KEY) ENGINE=NDB;
mysql> SELECT node_id AS node, fragment_num AS frag, \
        fixed_elem_alloc_bytes alloc_bytes, \
        fixed_elem_free_bytes AS free_bytes, \
        fixed_elem_free_rows AS spare_rows \
        FROM ndbinfo.memory_per_fragment \
        WHERE fq_name LIKE '%simples%';
+------+------+-------------+------------+------------+
| node | frag | alloc_bytes | free_bytes | spare_rows |
+------+------+-------------+------------+------------+
|    1 |    0 |      131072 |       5504 |        172 |
|    1 |    2 |      131072 |       1280 |         40 |
|    2 |    0 |      131072 |       5504 |        172 |
|    2 |    2 |      131072 |       1280 |         40 |
|    3 |    1 |      131072 |       3104 |         97 |
|    3 |    3 |      131072 |       4256 |        133 |
|    4 |    1 |      131072 |       3104 |         97 |
|    4 |    3 |      131072 |       4256 |        133 |
+------+------+-------------+------------+------------+
</pre>
<p>When you delete rows from a MySQL Cluster table, the memory is not actually freed up and so if you check the existing <a href="http://dev.mysql.com/doc/refman/5.6/en/mysql-cluster-ndbinfo-memoryusage.html" title="memoryusage table" target="_blank">memoryusage table</a> you won&#8217;t see a change. This memory will be reused when you add new rows to that same table. In MySQL Cluster 7.4, it&#8217;s possible to see how much memory is in that state for a table&#8230;</p>
<pre style="font: normal normal normal 9px Consolas, Monaco, 'Courier New', Courier, monospace; padding-left: 30px; color: #000080;">
mysql> SELECT node_id AS node, fragment_num AS frag, \
        fixed_elem_alloc_bytes alloc_bytes, \
        fixed_elem_free_bytes AS free_bytes, \
        fixed_elem_free_rows AS spare_rows \
        FROM ndbinfo.memory_per_fragment \
        WHERE fq_name LIKE '%simples%';
+------+------+-------------+------------+------------+
| node | frag | alloc_bytes | free_bytes | spare_rows |
+------+------+-------------+------------+------------+
|    1 |    0 |      131072 |       5504 |        172 |
|    1 |    2 |      131072 |       1280 |         40 |
|    2 |    0 |      131072 |       5504 |        172 |
|    2 |    2 |      131072 |       1280 |         40 |
|    3 |    1 |      131072 |       3104 |         97 |
|    3 |    3 |      131072 |       4256 |        133 |
|    4 |    1 |      131072 |       3104 |         97 |
|    4 |    3 |      131072 |       4256 |        133 |
+------+------+-------------+------------+------------+
mysql> DELETE FROM clusterdb.simples LIMIT 1;
mysql> SELECT node_id AS node, fragment_num AS frag, \
        fixed_elem_alloc_bytes alloc_bytes, \
        fixed_elem_free_bytes AS free_bytes, \
        fixed_elem_free_rows AS spare_rows \
        FROM ndbinfo.memory_per_fragment \
        WHERE fq_name LIKE '%simples%';
+------+------+-------------+------------+------------+
| node | frag | alloc_bytes | free_bytes | spare_rows |
+------+------+-------------+------------+------------+
|    1 |    0 |      131072 |       5504 |        172 |
|    1 |    2 |      131072 |       1312 |         41 |
|    2 |    0 |      131072 |       5504 |        172 |
|    2 |    2 |      131072 |       1312 |         41 |
|    3 |    1 |      131072 |       3104 |         97 |
|    3 |    3 |      131072 |       4288 |        134 |
|    4 |    1 |      131072 |       3104 |         97 |
|    4 |    3 |      131072 |       4288 |        134 |
+------+------+-------------+------------+------------+
</pre>
<p>As a final example, we can check whether a table is being evenly sharded accross the data nodes (in this case a realy bad sharding key was chosen)&#8230;</p>
<pre style="font: normal normal normal 9px Consolas, Monaco, 'Courier New', Courier, monospace; padding-left: 30px; color: #000080;">
mysql> CREATE TABLE simples (id INT NOT NULL AUTO_INCREMENT, \
        species VARCHAR(20) DEFAULT "Human", 
        PRIMARY KEY(id, species)) engine=ndb PARTITION BY KEY(species);

// Add some data

mysql> SELECT node_id AS node, fragment_num AS frag, \
        fixed_elem_alloc_bytes alloc_bytes, \
        fixed_elem_free_bytes AS free_bytes, \
        fixed_elem_free_rows AS spare_rows \
        FROM ndbinfo.memory_per_fragment \
        WHERE fq_name LIKE '%simples%';
+------+------+-------------+------------+------------+
| node | frag | alloc_bytes | free_bytes | spare_rows |
+------+------+-------------+------------+------------+
|    1 |    0 |           0 |          0 |          0 |
|    1 |    2 |      196608 |      11732 |        419 |
|    2 |    0 |           0 |          0 |          0 |
|    2 |    2 |      196608 |      11732 |        419 |
|    3 |    1 |           0 |          0 |          0 |
|    3 |    3 |           0 |          0 |          0 |
|    4 |    1 |           0 |          0 |          0 |
|    4 |    3 |           0 |          0 |          0 |
+------+------+-------------+------------+------------+
</pre>
<p>If you get chance to try out this new release then please let us know how you get on &#8211; either through a comment on this blog, a <a href="http://bugs.mysql.com/" title="MySQL bug report" target="_blank">MySQL bug report</a> or a post to the <a href="http://forums.mysql.com/list.php?25" title="MySQL Cluster Forum" target="_blank">MySQL Cluster Forum</a>.</p>
]]></content:encoded>
					
					<wfw:commentRss>/mysql-cluster/mysql-cluster-7-4-3-release-candidate-now-available/feed</wfw:commentRss>
			<slash:comments>2</slash:comments>
		
		
			</item>
		<item>
		<title>MySQL Replication: What’s New in MySQL 5.7 and Beyond &#8211; webinar replay</title>
		<link>/mysql-replication/mysql-replication-whats-new-in-mysql-5-7-and-beyond-webinar-replay</link>
					<comments>/mysql-replication/mysql-replication-whats-new-in-mysql-5-7-and-beyond-webinar-replay#respond</comments>
		
		<dc:creator><![CDATA[andrew]]></dc:creator>
		<pubDate>Mon, 01 Dec 2014 09:23:23 +0000</pubDate>
				<category><![CDATA[MySQL Replication]]></category>
		<category><![CDATA[HA]]></category>
		<category><![CDATA[High Availability]]></category>
		<category><![CDATA[MySQL]]></category>
		<category><![CDATA[Replication]]></category>
		<category><![CDATA[secondary]]></category>
		<guid isPermaLink="false">/?p=3980</guid>

					<description><![CDATA[Luís Soares and I recently hosted a webinar which explained the latest developments in MySQL Replication. The webinar replay is now available to download from here. Details: Continuing in the footsteps of its predecessor, MySQL 5.7 is set to be a groundbreaking release. In this webinar, the engineers behind the product provide insights into what’s]]></description>
										<content:encoded><![CDATA[<p><a href="/wp-content/uploads/2014/03/MySQL_Replication.png"><img loading="lazy" decoding="async" class="alignright size-medium wp-image-3803" src="/wp-content/uploads/2014/03/MySQL_Replication-300x101.png" alt="MySQL Replication Logo" width="300" height="101" srcset="/wp-content/uploads/2014/03/MySQL_Replication-300x101.png 300w, /wp-content/uploads/2014/03/MySQL_Replication-1024x347.png 1024w, /wp-content/uploads/2014/03/MySQL_Replication-900x305.png 900w, /wp-content/uploads/2014/03/MySQL_Replication.png 1240w" sizes="auto, (max-width: 300px) 100vw, 300px" /></a>Luís Soares and I recently hosted a webinar which explained the latest developments in MySQL Replication.</p>
<p>The webinar replay is now <a title="MySQL 5.7 latest developments" href="http://event.on24.com/eventRegistration/EventLobbyServlet?target=lobby.jsp&amp;eventid=880903&amp;sessionid=1&amp;key=C7FC018C0640492A4A758F6DCE77C87F&amp;eventuserid=109013173" target="_blank">available to download from here</a>.</p>
<p><iframe loading="lazy" src="//www.slideshare.net/slideshow/embed_code/42205145" width="476" height="400" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe></p>
<h3>Details:</h3>
<p>Continuing in the footsteps of its predecessor, MySQL 5.7 is set to be a groundbreaking release. In this webinar, the engineers behind the product provide insights into what’s new for MySQL replication in the latest 5.7 Development Milestone Release and review the early access features available via labs.mysql.com. The next generation of replication features cover several technical areas such as better semi-synchronous replication, an enhanced multithreaded slave (per-transaction parallelism), improved monitoring with performance schema tables, online configuration changes, options for fine-tuning replication performance, support for more-advanced topologies with multisource replication, and much more. This is also a great chance to learn about MySQL Group Replication &#8211; the next generation of active-active, update-anywhere replication for MySQL.</p>
<p>Seize the opportunity to learn how you will be able to leverage MySQL 5.7 replication to grow your business.</p>
]]></content:encoded>
					
					<wfw:commentRss>/mysql-replication/mysql-replication-whats-new-in-mysql-5-7-and-beyond-webinar-replay/feed</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
		<item>
		<title>Upcoming Webinar &#8211; MySQL Replication: What’s New in MySQL 5.7 and Beyond</title>
		<link>/mysql-replication/upcoming-webinar-mysql-replication-whats-new-in-mysql-5-7-and-beyond</link>
					<comments>/mysql-replication/upcoming-webinar-mysql-replication-whats-new-in-mysql-5-7-and-beyond#respond</comments>
		
		<dc:creator><![CDATA[andrew]]></dc:creator>
		<pubDate>Mon, 24 Nov 2014 16:47:32 +0000</pubDate>
				<category><![CDATA[MySQL Replication]]></category>
		<category><![CDATA[HA]]></category>
		<category><![CDATA[High Availability]]></category>
		<category><![CDATA[MySQL]]></category>
		<category><![CDATA[Replication]]></category>
		<category><![CDATA[secondary]]></category>
		<guid isPermaLink="false">/?p=3972</guid>

					<description><![CDATA[On Tuesday 25th November, Luís Soares and I will be hosting a webinar which explains the latest developments in MySQL Replication. As always the webinar is free but please register here. Details: Continuing in the footsteps of its predecessor, MySQL 5.7 is set to be a groundbreaking release. In this webinar, the engineers behind the]]></description>
										<content:encoded><![CDATA[<p><a href="/wp-content/uploads/2014/03/MySQL_Replication.png"><img loading="lazy" decoding="async" class="alignright size-medium wp-image-3803" src="/wp-content/uploads/2014/03/MySQL_Replication-300x101.png" alt="MySQL Replication Logo" width="300" height="101" srcset="/wp-content/uploads/2014/03/MySQL_Replication-300x101.png 300w, /wp-content/uploads/2014/03/MySQL_Replication-1024x347.png 1024w, /wp-content/uploads/2014/03/MySQL_Replication-900x305.png 900w, /wp-content/uploads/2014/03/MySQL_Replication.png 1240w" sizes="auto, (max-width: 300px) 100vw, 300px" /></a>On Tuesday 25th November, Luís Soares and I will be hosting a webinar which explains the latest developments in MySQL Replication. As always the webinar is free but please <a href="http://www.mysql.com/news-and-events/web-seminars/mysql-replication-whats-new-in-mysql-5-7-and-beyond/" title="MySQL Replication: What’s New in MySQL 5.7 and Beyond" target="_blank">register here</a>.</p>
<h3>Details:</h3>
<p>Continuing in the footsteps of its predecessor, MySQL 5.7 is set to be a groundbreaking release. In this webinar, the engineers behind the product provide insights into what’s new for MySQL replication in the latest 5.7 Development Milestone Release and review the early access features available via labs.mysql.com. The next generation of replication features cover several technical areas such as better semi-synchronous replication, an enhanced multithreaded slave (per-transaction parallelism), improved monitoring with performance schema tables, online configuration changes, options for fine-tuning replication performance, support for more-advanced topologies with multisource replication, and much more. This is also a great chance to learn about MySQL Group Replication &#8211; the next generation of active-active, update-anywhere replication for MySQL.</p>
<p>Seize the opportunity to learn how you will be able to leverage MySQL 5.7 replication to grow your business.</p>
<h3>When:</h3>
<ul>
<li>Tue, Nov 25: 09:00 Pacific time (America)</li>
<li>Tue, Nov 25: 10:00 Mountain time (America)</li>
<li>Tue, Nov 25: 11:00 Central time (America)</li>
<li>Tue, Nov 25: 12:00 Eastern time (America)</li>
<li>Tue, Nov 25: 15:00 São Paulo time</li>
<li>Tue, Nov 25: 17:00 UTC</li>
<li>Tue, Nov 25: 17:00 Western European time</li>
<li>Tue, Nov 25: 18:00 Central European time</li>
<li>Tue, Nov 25: 19:00 Eastern European time</li>
<li>Tue, Nov 25: 22:30 India, Sri Lanka</li>
<li>Wed, Nov 26: 01:00 Singapore/Malaysia/Philippines time</li>
<li>Wed, Nov 26: 01:00 China time</li>
<li>Wed, Nov 26: 02:00 日本</li>
<li>Wed, Nov 26: 04:00 NSW, ACT, Victoria, Tasmania (Australia) </li>
</ul>
<p>Even if you can&#8217;t join the live webinar, it&#8217;s worth registering as you&#8217;ll be emailed a link to the replay as soon as it&#8217;s available.</p>
]]></content:encoded>
					
					<wfw:commentRss>/mysql-replication/upcoming-webinar-mysql-replication-whats-new-in-mysql-5-7-and-beyond/feed</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
		<item>
		<title>MySQL Replication &#8211; Multi-Threaded Slave just got a whole lot faster</title>
		<link>/mysql-replication/mysql-replication-multi-threaded-slave-just-got-a-whole-lot-faster</link>
					<comments>/mysql-replication/mysql-replication-multi-threaded-slave-just-got-a-whole-lot-faster#comments</comments>
		
		<dc:creator><![CDATA[andrew]]></dc:creator>
		<pubDate>Wed, 02 Apr 2014 22:17:30 +0000</pubDate>
				<category><![CDATA[MySQL Replication]]></category>
		<category><![CDATA[MySQL]]></category>
		<category><![CDATA[MySQL 5.7]]></category>
		<guid isPermaLink="false">/?p=3874</guid>

					<description><![CDATA[A new MySQL MySQL 5.7 Multi-threaded slave labs load has now been published on MySQL Labs. This represents a signifficant step in the process of speeding up the processing of replication events on the slave &#8211; letting it keep up with the master. The original implementation of MTS made a simple assumption about what events]]></description>
										<content:encoded><![CDATA[<p><a href="/wp-content/uploads/2014/03/MySQL_Replication.png"><img loading="lazy" decoding="async" src="/wp-content/uploads/2014/03/MySQL_Replication-300x101.png" alt="MySQL Replication Logo" width="300" height="101" class="alignright size-medium wp-image-3803" srcset="/wp-content/uploads/2014/03/MySQL_Replication-300x101.png 300w, /wp-content/uploads/2014/03/MySQL_Replication-1024x347.png 1024w, /wp-content/uploads/2014/03/MySQL_Replication-900x305.png 900w, /wp-content/uploads/2014/03/MySQL_Replication.png 1240w" sizes="auto, (max-width: 300px) 100vw, 300px" /></a><br />
A new MySQL <a href="labs.mysql.com" title="MySQL 5.7 Multi-threaded slave labs load" target="blank">MySQL 5.7 Multi-threaded slave labs load</a> has now been published on <a href="labs.mysql.com" title="MySQL Labs" target="blank">MySQL Labs</a>. This represents a signifficant step in the process of speeding up the processing of replication events on the slave &#8211; letting it keep up with the master.</p>
<p>The original implementation of MTS made a simple assumption about what events could safely be applied in parallel (with no dependency on the ordering). That assumption was that different schemas had no dependencies on each other and so if you had 5 schemas then one event from each schema could be applied in parallel (this is described in <a href="/mysql-replication/mysql-5-6-ga-replication-enhancements" title="MySQL 5.6 GA – Replication Enhancements" target="blank">MySQL 5.6 GA – Replication Enhancements</a>). This approach delivered a much higher throughput on the slave but only if you were using multiple schemas &#8211; perfect for many deployments (such as multi-tenant systems) but if you only had a single database then it didn&#8217;t help.</p>
<p>Last year we released a new version which removed that dependency on multiple schemas &#8211; allowing events to be applied to the same schema in parallel. For this implementation the new assumption was that if a set of transactions were part of the same binlog group commit on the master then the locking on the master has already determined that they&#8217;re indepent of each other and so that same set of events can be applied in parallel on the slave.</p>
<p>The latest enhancement is to allow the user to tune how many transactions are likely to be in each of those BGC buckets. This is done at the expense of delaying commits on the master and can be controlled by specifying the longest time that the system should wait (<code>binlog-group-commit-delay</code>) and the maximum number of transactions that should be committed together (<code>binlog-group-commit-count</code>). Initial benchmark results are very possitive &#8211; a 6X throughput (if willing to tolerate a small impact to the latency on the master) or 3X with no impact to the master.</p>
<p><a href="/wp-content/uploads/2014/04/Screen-Shot-2014-04-02-at-10.03.58.png"><img loading="lazy" decoding="async" src="/wp-content/uploads/2014/04/Screen-Shot-2014-04-02-at-10.03.58.png" alt="Multi-Threaded slave performance gains" width="1480" height="930" class="aligncenter size-full wp-image-3875" srcset="/wp-content/uploads/2014/04/Screen-Shot-2014-04-02-at-10.03.58.png 1480w, /wp-content/uploads/2014/04/Screen-Shot-2014-04-02-at-10.03.58-300x188.png 300w, /wp-content/uploads/2014/04/Screen-Shot-2014-04-02-at-10.03.58-1024x643.png 1024w, /wp-content/uploads/2014/04/Screen-Shot-2014-04-02-at-10.03.58-900x565.png 900w" sizes="auto, (max-width: 1480px) 100vw, 1480px" /></a><br />
This is a feature where the mileage will definitely vary depending on your application and how you tune these two new parameters and so I&#8217;d certainly recommend that you try it out for yourselves. As always we&#8217;re anxious to get your feedback &#8211; for example through comments on this post or on the <a href="http://forums.mysql.com/list.php?26" title="MySQL Replication forum" target="blank">MySQL Replication forum</a>.</p>
]]></content:encoded>
					
					<wfw:commentRss>/mysql-replication/mysql-replication-multi-threaded-slave-just-got-a-whole-lot-faster/feed</wfw:commentRss>
			<slash:comments>1</slash:comments>
		
		
			</item>
		<item>
		<title>Advanced MySQL Replication Architectures and Latest Developments &#8211; On-Demand webinar + Q&#038;A</title>
		<link>/mysql-replication/advanced-mysql-replication-architectures-and-latest-developments-on-demand-webinar-qa</link>
					<comments>/mysql-replication/advanced-mysql-replication-architectures-and-latest-developments-on-demand-webinar-qa#respond</comments>
		
		<dc:creator><![CDATA[andrew]]></dc:creator>
		<pubDate>Thu, 27 Mar 2014 16:01:35 +0000</pubDate>
				<category><![CDATA[MySQL Replication]]></category>
		<category><![CDATA[HA]]></category>
		<category><![CDATA[High Availability]]></category>
		<category><![CDATA[MySQL]]></category>
		<guid isPermaLink="false">/?p=3864</guid>

					<description><![CDATA[We recently hosted a live webinar covering advanced MySQL Replication topics as well as the latest developments. The webinar charts and replay are now available here. Below, you&#8217;ll find the questions raised by the audience together with the responses given. More details on what was covered&#8230; The biggest Web sites in the world rely on]]></description>
										<content:encoded><![CDATA[<p><a href="/wp-content/uploads/2014/03/MySQL_Replication.png"><img loading="lazy" decoding="async" src="/wp-content/uploads/2014/03/MySQL_Replication-300x101.png" alt="MySQL Replication Logo" width="300" height="101" class="alignright size-medium wp-image-3803" srcset="/wp-content/uploads/2014/03/MySQL_Replication-300x101.png 300w, /wp-content/uploads/2014/03/MySQL_Replication-1024x347.png 1024w, /wp-content/uploads/2014/03/MySQL_Replication-900x305.png 900w, /wp-content/uploads/2014/03/MySQL_Replication.png 1240w" sizes="auto, (max-width: 300px) 100vw, 300px" /></a><br />
We recently hosted a live webinar covering advanced MySQL Replication topics as well as the latest developments. <a href="http://www.mysql.com/news-and-events/web-seminars/advanced-mysql-replication-architectures-and-latest-developments/" title="Advanced MySQL Replication Architectures and Latest Developments - on-demand webinar" target="blank">The webinar charts and replay are now available here</a>. Below, you&#8217;ll find the questions raised by the audience together with the responses given.</p>
<p>More details on what was covered&#8230;</p>
<p>The biggest Web sites in the world rely on MySQL Replication to scale-out and provide High Availability for their data. Extend your knowledge of how MySQL Replication works and what you can achieve with it; join us for this technical webinar to explore some of the more advanced replication architectures as well as some of the latest product developments:</p>
<ul>
<li>Replication topologies, including master-slave, circular and multi-master</li>
<li>Load balancing and query splitting</li>
<li>Data aggregation with multi-source replication</li>
<li>Global Transaction IDs and auto-failover with recovery</li>
<li>Getting the best replication throughput</li>
<li>Heterogeneous replication with the Binlog API</li>
</ul>
<h2>Questions &#038; Answers</h2>
<ul>
<li><strong>Is the <code>server_uuid</code> constant in the lifetime of a MySQL server?</strong>: Yes, <code>server_uuid</code> it&#8217;s persisted in a file in the <code>data_dir</code>.</li>
<li><strong>How are the servers syncronized after a failure?</strong>: When slave connects to master it will inform master which GTIDs it already has, (whether just received or actually or applied), and the master will send what is missing.</li>
<li><strong>Are all the features being described available now in the latest community MySQL version?</strong>: Everything that is described is available to the community. Some features are currently in Development Milestone or labs releases but that is made clear in the charts.</li>
<li><strong>What is the maximum number of Slaves per Master and are there restrictions to the distance between Master and Slave?</strong>: There is no maximum number of slaves per master, that value depends on hardware and workload. There is an overhead on the master for each of the slaves (though this is reducing); you always have the option of replicating to another one or MySQL Servers and then use them as replication masters to fan out to many more slaves (those servers can even use the Black Hole storage engine so that they don&#8217;t even store the data. No distance limits, but with longer distances the network latency will increase. If using the default asynchronous replication, this latency has not effect other than possibly the slave(s) running slightly further behind but if using semi-synchronous replication then the transactions will take longer to commit.</li>
<li><strong>Is there a maximum number of worker threads that can be configured, or is it just dependient on your server hardware?</strong>: The maximum number of worker thread is 1024, but the real limitation is hardware.</li>
<li><strong>Is there a form of automatic client rerouting as a result of Switch/Failover?</strong>: Yes &#8211; MySQL Fabric which is also covered in this session.</li>
<li><strong>what&#8217;s the resolution of the timestamp?</strong>: Replication timestamp resolution is microseconds.</li>
<li><strong>Are all of these replication features available in both Synchronous and Asynchronous modes?</strong>: There is no synchronous mode, but they all work with both asynchronous and  semi-synchronous replication.</li>
<li><strong>Why is semi-sync replication only available as plugin? It makes it harder to setup with the present restrictions.</strong>: By implementing features as plugins, we can evolve the software faster by implementing them in new modules rather than in the large, complex MySQL Server code base. It also means that we can iterate more frequently as it doesn&#8217;t need to be tied to a MySQL Server release.</li>
<li><strong>Does semi-synchronous replication wait for all slaves or just a single one?</strong>: You can specify  how many slaves need to respond with the <clode>rpl_semi_sync_master_wait_slave_count</clode> option.</li>
<li><strong>In case of one master one slave, where slave can overtake master role in case of crash. Won&#8217;t it introduce split-brain scenario ? Does mysql have rollback settings in case of master crash?</strong>: Monitoring tools should ensure that the master has crashed crashed, or if it suspects that it became irresponsible then it should kill the master before performing the failover. Alternatively, take a look at MySQL Fabric.</li>
<li><strong>For now I have impression that if I want clients to automatically load balance read &#038; writes between masters/slaves then I should do this using mysql proxy. Is this still the best practice?</strong>: What language are you using &#8211; this functionality is built into some connectors (for exampe for PHP and Java)? Alternatively you could look at MySQL Fabric or hardware or software load ballancers.	</li>
<li><strong>How are autoincrement columns handled in MySQL Fabric when you have mulitiple HA Groups?</strong>: The first thing to point out is that an auto-increment column cannot be used as the sharding key. You can use <code>auto_increment_increment</code> and <code>auto_increment_offset</code> to make sure that you don&#8217;t repeat values on different shards (e.g. if you have 2 shards then odd values coule be on one and even on the other.</li>
<li><strong>Is MySQL Fabric queried for every transaction or query (and so becomes a single-point-of-falire)?</strong>: No, the connectors hold a cache of the routing data and so will use that rather than constantly querying the MySQL Fabric process.</li>
<li><strong>Does the Replication include DDL changes, not just DML?</strong>: Yes it does.</li>
<li><strong>How do I scale out write operation in MySQL 5.6</strong>: That&#8217;s where MySQL Fabric comes in, when we reach the write saturation point on master.</li>
<li><strong>Is NDB storage engine is good option for write operation scale out?</strong>: It can be a great solution but it will depend on how your data is structured and accessed. Take a look at the<a href="http://www.mysql.com/why-mysql/white-papers/mysql-cluster-evaluation-guide/" title="MySQL Cluster Evaluation Guide - Designing, Evaluating and Benchmarking MySQL Cluster" target="blank">MySQL Cluster Evaluation Guide &#8211; Designing, Evaluating and Benchmarking MySQL Cluster</a> as this will help you figure out if MySQL Cluster (NDB) is going to be the right option for your application</li>
<li><strong>But fabric still in beta version right?</strong>: Correct &#8211; it isn&#8217;t ready for production yet (at the time of writing this is true but be sure to check if you&#8217;re reading this laster!).</li>
<li><strong>Are the benchmarks of <code>sync_binlog</code> done with SSD or HDD machines?</strong>: SSD &#8211; see <a href="http://mysqlmusings.blogspot.fr/2012/06/binary-log-group-commit-in-mysql-56.html" title="Binary Log Group Commit in MySQL 5.6" target="blank">this blog post</a>. <strong>Should we expect the same results with HDDs?</strong>: Yes, but with different orders of magnitude. Note that all benchmarks were made with SSDs, so we are comparing equal hardware on 5.5 and 5.6.</li>
</ul>
]]></content:encoded>
					
					<wfw:commentRss>/mysql-replication/advanced-mysql-replication-architectures-and-latest-developments-on-demand-webinar-qa/feed</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
		<item>
		<title>Advanced MySQL Replication Architectures and Latest Developments &#8211; free webinar</title>
		<link>/mysql-replication/advanced-mysql-replication-architectures-and-latest-developments-free-webinar-2</link>
					<comments>/mysql-replication/advanced-mysql-replication-architectures-and-latest-developments-free-webinar-2#respond</comments>
		
		<dc:creator><![CDATA[andrew]]></dc:creator>
		<pubDate>Tue, 18 Mar 2014 09:08:26 +0000</pubDate>
				<category><![CDATA[MySQL Replication]]></category>
		<category><![CDATA[HA]]></category>
		<category><![CDATA[High Availability]]></category>
		<category><![CDATA[MySQL]]></category>
		<category><![CDATA[Replication]]></category>
		<guid isPermaLink="false">/?p=3805</guid>

					<description><![CDATA[This Thursday (20th March 2014) we&#8217;ll be hosted a free webinar covering advanced MySQL Replication topics as well as the latest developments. As always, the webinar is free but you need to register here &#8211; even if you can&#8217;t join live, you&#8217;ll then be sent a link to the replay. More details on what to]]></description>
										<content:encoded><![CDATA[<p><a href="/wp-content/uploads/2014/03/MySQL_Replication.png"><img loading="lazy" decoding="async" src="/wp-content/uploads/2014/03/MySQL_Replication-300x101.png" alt="MySQL Replication Logo" width="300" height="101" class="alignright size-medium wp-image-3803" srcset="/wp-content/uploads/2014/03/MySQL_Replication-300x101.png 300w, /wp-content/uploads/2014/03/MySQL_Replication-1024x347.png 1024w, /wp-content/uploads/2014/03/MySQL_Replication-900x305.png 900w, /wp-content/uploads/2014/03/MySQL_Replication.png 1240w" sizes="auto, (max-width: 300px) 100vw, 300px" /></a><br />
This Thursday (20th March 2014) we&#8217;ll be hosted a free webinar covering advanced MySQL Replication topics as well as the latest developments. As always, the webinar is free but you need to <a href="http://www.mysql.com/news-and-events/web-seminars/advanced-mysql-replication-architectures-and-latest-developments/" title="Advanced MySQL Replication Architectures and Latest Developments - free webinar" target="_blank">register here</a> &#8211; even if you can&#8217;t join live, you&#8217;ll then be sent a link to the replay.</p>
<p>More details on what to expect&#8230;</p>
<p>The biggest Web sites in the world rely on MySQL Replication to scale-out and provide High Availability for their data. Extend your knowledge of how MySQL Replication works and what you can achieve with it; join us for this technical webinar to explore some of the more advanced replication architectures as well as some of the latest product developments:</p>
<ul>
<li>Replication topologies, including master-slave, circular and multi-master</li>
<li>Load balancing and query splitting</li>
<li>Data aggregation with multi-source replication</li>
<li>Global Transaction IDs and auto-failover with recovery</li>
<li>Getting the best replication throughput</li>
<li>Heterogeneous replication with the Binlog API</li>
</ul>
<p>WHO:</p>
<ul>
<li>Andrew Morgan, Principal MySQL Product Manager</li>
<li>Lars Thalmann, Director, MySQL Replication, Backup and Connectors</li>
</ul>
<p>WHEN:</p>
<ul>
<li>Thu, Mar 20: 09:00 Pacific time (America)</li>
<li>Thu, Mar 20: 10:00 Mountain time (America)</li>
<li>Thu, Mar 20: 11:00 Central time (America)</li>
<li>Thu, Mar 20: 12:00 Eastern time (America)</li>
<li>Thu, Mar 20: 13:00 São Paulo time</li>
<li>Thu, Mar 20: 16:00 UTC</li>
<li>Thu, Mar 20: 16:00 Western European time</li>
<li>Thu, Mar 20: 17:00 Central European time</li>
<li>Thu, Mar 20: 18:00 Eastern European time</li>
<li>Thu, Mar 20: 21:30 India, Sri Lanka</li>
<li>Fri, Mar 21: 00:00 Singapore/Malaysia/Philippines time</li>
<li>Fri, Mar 21: 00:00 China time</li>
<li>Fri, Mar 21: 01:00 日本</li>
<li>Fri, Mar 21: 03:00 NSW, ACT, Victoria, Tasmania (Australia)</li>
</ul>
]]></content:encoded>
					
					<wfw:commentRss>/mysql-replication/advanced-mysql-replication-architectures-and-latest-developments-free-webinar-2/feed</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
		<item>
		<title>Webinar &#8211; What&#8217;s New in MySQL Replication</title>
		<link>/mysql-replication/webinar-whats-new-in-mysql-replication</link>
					<comments>/mysql-replication/webinar-whats-new-in-mysql-replication#respond</comments>
		
		<dc:creator><![CDATA[andrew]]></dc:creator>
		<pubDate>Fri, 06 Dec 2013 17:16:04 +0000</pubDate>
				<category><![CDATA[MySQL Replication]]></category>
		<category><![CDATA[HA]]></category>
		<category><![CDATA[MySQL]]></category>
		<category><![CDATA[MySQL 5.7]]></category>
		<guid isPermaLink="false">/?p=2973</guid>

					<description><![CDATA[On Friday (22/11/2013), we hosted webinar covering the new replication features in the MySQL 5.7 DMR as well as in MySQL Labs. You can now view the webinar replay here. It’s a very exciting time for MySQL Replication! MySQL 5.6 contains numerous new replication features and Oracle recently announced&#8230; The second Development Milestone Release of]]></description>
										<content:encoded><![CDATA[<p><a href="/wp-content/uploads/2013/11/MySQL_Replication_and_HA.png"><img loading="lazy" decoding="async" class="size-medium wp-image-2976 alignright" alt="MySQL Replication logo" src="/wp-content/uploads/2013/11/MySQL_Replication_and_HA-300x101.png" width="300" height="101" srcset="/wp-content/uploads/2013/11/MySQL_Replication_and_HA-300x101.png 300w, /wp-content/uploads/2013/11/MySQL_Replication_and_HA-1024x347.png 1024w, /wp-content/uploads/2013/11/MySQL_Replication_and_HA.png 1240w" sizes="auto, (max-width: 300px) 100vw, 300px" /></a>On Friday (22/11/2013), we hosted webinar covering the new replication features in the MySQL 5.7 DMR as well as in MySQL Labs. You can now <a href="http://www.mysql.com/news-and-events/web-seminars/mysql-replication-discover-whats-new/" title="MySQL 5.7 Replication enhancements - webinar" target="_blank">view the webinar replay here</a>. </p>
<p>It’s a very exciting time for MySQL Replication! MySQL 5.6 contains numerous new replication features and Oracle recently announced&#8230;</p>
<ul>
<li>The second Development Milestone Release of MySQL 5.7, introducing yet again new replication features and enhancements including optimized multi-threaded slave, better consistency with semi-synchronous replication, and improved monitoring with new Performance Schema tables.</li>
<li>Early access to multi-source replication via <a title="Get multi-source MySQL Replication from MySQL Labs" href="http://labs.mysql.com/" target="_blank">labs.mysql.com</a></li>
</ul>
<p>During the live webinar, attendees asked questions and the MySQL Replication engineers answered them; this Q&#038;A is included here:</p>
<ul>
<li><strong>Can we have Master &#038; Slave on different versions of MySQL? Like Master is with 5.1 &#038; Slave with 5.6?</strong> In general, cross version replication to a next higher version on slave is supported unless the behaviour of SQL statements change in the different versions. For more details, please look at the <a href="http://dev.mysql.com/doc/refman/5.6/en/replication-compatibility.html" title="documentation on MySQL Replication cross-version compatibility" target="_blank"> documentation on MySQL Replication cross-version compatibility</a>.</li>
<li><strong>The MySQL Replication topology discussed here supports asynchronous replication. How is Synchronous replicaiton is possible with mysql?</strong> With the loss-less semi-synchronouse replication, you&#8217;re getting very close to synchronous replication in that when your transaction has committed, you can be sure that the change has been received by a slave and so is safe. If you want truly synchronous replication then you can use MySQL Cluster (the NDBCLUSTER storage engine); typically this synchronous replication would be within a data center but you can split the cluster if you have a real need. You can <a href="http://www.youtube.com/watch?v=DnWItDTZL2c" title="MySQL Cluster demo video" target="_blank">watch this demo video of MySQL Cluster</a>.</li>
<li><strong>When Slave says it is x seconds behind, what does that means? Does it means slave would require x seconds to recover and reach the master&#8217;s current position?</strong> When the slave SQL thread is actively processing updates, this field is the number of seconds that have elapsed since the timestamp of the most recent event on the master executed by that thread.</li>
<li><strong>What is default setting for the <a href="http://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_rpl_semi_sync_master_wait_point" title="rpl_semi_sync_master_wait_point documentation" target="_blank">rpl_semi_sync_master_wait_point</a> setting.</strong> after_sync</li>
<li><strong>What is the best mechanism in MySQL Community Edition for backing up InnoDB tables?</strong> <a href="http://dev.mysql.com/doc/refman/5.7/en/mysqldump.html" title="mysqldump database backup command">mysqldump</a> has <a href="http://dev.mysql.com/doc/refman/5.7/en/mysqldump.html#option_mysqldump_single-transaction" target="_blank">&#8211;single-transaction option</a>, which is mainly useful for InnoDB tables with REPEATABLE READ isolation level. In short, for Community Edition mysqldump is the best solution. But for Enterprise Edition, there is <a href="http://www.mysql.com/products/enterprise/backup.html" title="MySQL Enterprise Backup" target="_blank">MySQL Enterprise Backup</a>.</li>
<li><strong>How can I verify that my slave DB is in sync with the master? Is there something similar to the archive log sequence number verification in Oracle. we know there are some paramerts from show slave status output. But is there any other way to verify the sync status using MySQL tables?</strong> In MySQL 5.6, if you set master_info_repository and <a href="http://dev.mysql.com/doc/refman/5.6/en/replication-options-slave.html#sysvar_relay_log_info_repository" target="_blank">relay_log_info_repository</a> to TABLE the status information is put into the mysql.slave_relay_log_info and mysql.slave_master_info tables. And in MySQL 5.7 the status is put in performance_schema you can query the status using SQL.</li>
<li><strong>Does multi-source replication require the use of GTIDs?</strong> No &#8211; you just need to make sure that GTIDs are either enabled on the slave and all masters or disabled on all of them.</li>
<li><strong>If multi-source can work without GTIDs, how do you prevent a transaction executed on A which is replicated to B and C, from being replicated back again to C and B via the replication channel from B to C and C to B ?</strong> Without GTIDs, the transactions are re executed (in the above scenario) if the schema developer *doesn&#8217;t* take care of fixing the keys. If there is a conflict on a key, the Slave errors out. So, In short, MSR doesn&#8217;t involve itself with conflict detection and resolution. When using positions, the schema developer has to make sure that multisourced slave receives correct data to avoid reexecution of transactions.</li>
<li><strong>In loss-less semi-sync, how can the transaction be written in the binary log of the master without the master committing the transaction? Does this stall the transaction on the master (until a commit is written to the binary log)?</strong> When using this feature, a commit has two phases (which is same as an XA transaction) &#8211; first there is a prepare phase and then the commit phase. The binary log is written after the prepare phase but before commit phase(internally, it is part of the commit phase but happens before the engine commit).</li>
<li><strong>With parallel replication, is the binary logs order preserved on the slave (compared to the master), even if the transactions are applied in parallel? Asked in another way, can 2 slaves of the same master have different binlogs?</strong> No, the order will be different when multi-threaded slave feature is on.</li>
<li><strong>Are you working with an easier way to create a replication setup &#8211; like automatically copying the master database to the slave (something like you had for MyISAM before)?</strong> Take a look at <a href="http://dev.mysql.com/doc/workbench/en/utils-manuals.html" title="MySQL Utilities" target="_blank">MySQL Utilities</a> as there are lots of new tools in there 2 help setup, monitor and manage replication.</li>
<li><strong>You guys have multiple blogs and it is a shame to not present this information in a common place.</strong> That&#8217;s been something that we&#8217;ve been discussing as well. Of course they get aggregated through planet.mysql.com and there is also a <a href="/mysql-replication/mysql-5-7-2-dmr-and-labs-new-replication-features" title="MySQL 5.7 replication enhancements" target="_blank">summary blog</a> pointing to the others.</li>
<li><strong>In Loss-Less Semi-Sync replication, what happens if the slave dies, before it receives the change in the relay. Is there a timeout which then commits and ack the data to the master?</strong> Yes, there is a timeout. After the timeout, it commits and falls back to normal asynchronous replication. The timeout is specified by the variable <a href="http://dev.mysql.com/doc/refman/5.6/en/server-system-variables.html#sysvar_rpl_semi_sync_master_timeout" target="_blank">rpl_semi_sync_master_timeout</a>. Currently you cannot turn off this behavior, but you can set the timeout very very high. For more information, see the <a href="http://dev.mysql.com/doc/refman/5.6/en/replication-semisync-installation.html" target="_blank" title="MySQL Semisynchronous Replication Installation and Configuration">configuration guide</a>.</li>
]]></content:encoded>
					
					<wfw:commentRss>/mysql-replication/webinar-whats-new-in-mysql-replication/feed</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
		<item>
		<title>MySQL 5.7.2 DMR and Labs &#8211; new replication features</title>
		<link>/mysql-replication/mysql-5-7-2-dmr-and-labs-new-replication-features</link>
					<comments>/mysql-replication/mysql-5-7-2-dmr-and-labs-new-replication-features#respond</comments>
		
		<dc:creator><![CDATA[andrew]]></dc:creator>
		<pubDate>Sat, 21 Sep 2013 16:33:57 +0000</pubDate>
				<category><![CDATA[MySQL Replication]]></category>
		<category><![CDATA[HA]]></category>
		<category><![CDATA[High Avail]]></category>
		<category><![CDATA[MySQL]]></category>
		<category><![CDATA[MySQL 5.7]]></category>
		<guid isPermaLink="false">/?p=2953</guid>

					<description><![CDATA[With today&#8217;s announcement of the second MySQL 5.7 Development Milestone Release and a new labs release it&#8217;s a very exciting time for MySQL Replication. MySQL 5.6 contained a lot of new content to make replication faster, easier to use and more reliable (Global Transaction Identifiers, Multi-Threaded Slaves, Binary Log Group Commit, Optimized Row Based Replication,]]></description>
										<content:encoded><![CDATA[<p>With today&#8217;s <a href="http://www.oracle.com/us/corporate/press/2020378">announcement of the second MySQL 5.7 Development Milestone Release</a> and a <a href="http://labs.mysql.com/" title="Download Multi-Source replication from MySQL Labs">new labs release</a> it&#8217;s a very exciting time for MySQL Replication. <a href="/mysql-replication/mysql-5-6-ga-replication-enhancements/">MySQL 5.6</a> contained a lot of new content to make replication faster, easier to use and more reliable (Global Transaction Identifiers, Multi-Threaded Slaves, Binary Log Group Commit, Optimized Row Based Replication, Crash Safe Replication, Replication Event Checksums, Time Delayed Replication &amp; Informational Logs) and now we want to improve things even further.</p>
<p>The new DMR has something for everyone. </p>
<p>With the improvements to Semi-Synchronous Replication, the application developer can be confident that when a transaction has been commited, the changes have been safely copied to one or more slaves and so whatever happens, that change will not be lost. Further, we now prevent other application threads seeing those changes until they&#8217;ve been received by the slave and so the application cannot start acting on the new data until it&#8217;s known to be safe. This is an important improvement in consistency which moves more of the onus from the application developer onto the database.</p>
<p>DBAs want replication to be fast &#8211; in particular for the slave(s) not to fall behind the master. <a href="/mysql-replication/mysql-5-6-ga-replication-enhancements/">MySQL 5.6</a> made some massive improvements in this area &#8211; both on the master and the slave. A number of users though were unable to exploit the Multi-Threaded Slave (MTS) feature as relied on the use of multiple schemas (databases) to get changes applied in parallel. In the new MySQL 5.7 DMR we&#8217;ve included a new option for MTS where changes can be applied in parallel &#8211; <strong>even within the same schema</strong>. A second performance feature improves throughput on the master &#8211; where the dump thread no longer needs to lock the binary log &#8211; refer to this engineering Blog on <a href="http://my-replication-life.blogspot.com/2013/09/dump-thread-enhancement.html" title="Dump Thread Enhancement on MySQL 5.7.2 - engineering Blog">Dump Thread Enhancement in MySQL 5.7.2</a> for more details.</p>
<p>DBAs also want to monitor the status of replication and for years have relied on the <span style="font: normal normal normal 12px/18px Consolas, Monaco, 'Courier New', Courier, monospace; color: #000080;">SHOW SLAVE STATUS</span> command. As replication has evolved, <span style="font: normal normal normal 12px/18px Consolas, Monaco, 'Courier New', Courier, monospace; color: #000080;">SHOW SLAVE STATUS</span> has become less suitable &#8211; we needed a solution that could properly model the more sophisticated replication architectures (including GTIDs and MTS) now possible. The approach we&#8217;ve taken is to provide this information through the <span style="font: normal normal normal 12px/18px Consolas, Monaco, 'Courier New', Courier, monospace; color: #000080;">performance_schema</span>. </p>
<p>Note that the earlier MySQL 5.7 DMR added non-blocking <span style="font: normal normal normal 12px/18px Consolas, Monaco, 'Courier New', Courier, monospace; color: #000080;">SHOW SLAVE STATUS</span>, idempotent and <span style="font: normal normal normal 12px/18px Consolas, Monaco, 'Courier New', Courier, monospace; color: #000080;">&#8211;rewrite-db</span> options for <span style="font: normal normal normal 12px/18px Consolas, Monaco, 'Courier New', Courier, monospace; color: #000080;">mysqlbinlog</span> &#8211; these are still available in the new DMR.</p>
<p>The new features are described in a little more detail in the following sections (together with links to more technical content from the MySQL Engineeing team).</p>
<h2 id="loss-less-semi-synchronous-replication">Loss-less Semi-Synchronous Replication</h2>
<div id="attachment_2957" style="width: 234px" class="wp-caption alignright"><a href="/wp-content/uploads/2013/09/Intra-Schema-Semi-sync-replication.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-2957" class="size-medium wp-image-2957" alt="Intra-Schema Semi-Synchronous Replication" src="/wp-content/uploads/2013/09/Intra-Schema-Semi-sync-replication-224x300.png" width="224" height="300" /></a><p id="caption-attachment-2957" class="wp-caption-text">Intra-Schema Semi-Synchronous Replication</p></div>
<p>When using semi-synchronous replication in previous releases, the processing of the transaction on the master would wait for the slave&#8217;s acknowledgement <em>after</em> the change had been written to the storage engine but before the commit was acknowledged to the client. This satisfied the requirement that the application could be confident that if a transaction has been commited (and an acknowledgement received for the commit) then the update would not be lost. It did however leave a window where a user on another connection could read the new data from the master (because it has been written to the storage engine and the locks have been released) before the change had been received by the slave and safely stored in its relay log &#8211; that user could then start acting on that data but if the master failed at that point then that original update could still be lost and so the user would be acting on what is now inaccurate data.</p>
<p>This feature removes the above race condition by making the master wait for the update to be received by the slave <em>before</em> writing it to the storage engine and releasing the locks.</p>
<p>The functionality is enabled by default and shouldn&#8217;t have any negative impacts (for example on peformance) but it you&#8217;d like to disable it then you can do so using <span style="font: normal normal normal 12px/18px Consolas, Monaco, 'Courier New', Courier, monospace; color: #000080;">rpl_semi_sync_master_wait_point = AFTER_SYNC</span>.</p>
<p>You can read more details on this in this <a href="http://my-replication-life.blogspot.com/2013/09/loss-less-semi-synchronous-replication.html" title="Loss-less Semi-Synchronous Replication on MySQL 5.7.2 blog">Loss-less Semi-Synchronous Replication on MySQL 5.7.2 blog</a> from the MySQL engineering team.</p>
<h2 id="intra-schema-multi-threaded-slaves">Intra-Schema Multi-Threaded Slaves</h2>
<p>DBAs want replication to be fast &#8211; in particular for the slave(s) not to fall behind the master. If there is a short but heavy burst of writes on the master then the slave falls behind (and there is a risk of lost data if the master fails during this period) but if the write-rate is sustained then the slave would fall further and further behind indefinitely. The ongoing challenge has been that the master gets faster and faster as more cores and clients are added but applying these changes asynchronously on the slave is more complex as you need to maintain some form of ordering in order to always have a consistent data set. </p>
<p>The earliest solution to maintaining ordering/consistency was for the slave to apply all of the changes serially, in a single thread &#8211; this ensured that changes were applied in the same order as on the master and so guaranteed the slave always contained a consistent view. Unfortunately this meant that the slave applier thread could only exploit a single core which is very wasteful in modern systems.</p>
<p><a href="/mysql-replication/mysql-5-6-ga-replication-enhancements/">MySQL 5.6</a> made some massive improvements for many use cases by allowing the slave to apply updates in parallel using multiple threads. The assumption made was that data was held in multiple schemas (databases) and that there were no dependencies between the data in those different schemas. In this way all of the updates for a schema would be applied in order by a single thread (ensuring consistency) but updates to other schemas could be handled by additional threads. This allowed the slave to work many times faster but was limited to those use cases that met the assumptions.</p>
<p>In the second MySQL 5.7 DMR we introduce a new option that enables the slave to safely apply updates in parallel &#8211; even when all of the data is held within a single schema and no assumptions can be made about the independence between any rows from any tables. To avoid conflicts/divergence from the master, the slave must ensure that any transactions that are applied in parallel don&#8217;t read or write any overlapping rows. The good news is that this grouping on non-overlapping transactions is already being figured out on the master as part of the binary log group commit functionality (introduced in <a href="/mysql-replication/mysql-5-6-ga-replication-enhancements/">MySQL 5.6</a>) as row level locking means that overlapping transactions cannot be part of the same group commit. </p>
<p>MySQL 5.7 adds a logical clock/counter to the master which is used to tag transactions that are part of the same group commit&#8217;s prepare phase. The slave can then use that information &#8211; knowing that it is safe to apply all of the transactions with the same logical clock value in any order (and so can use multiple threads). </p>
<p>Activating the functionality is very straight-forward and the key step is to set <span style="font: normal normal normal 12px/18px Consolas, Monaco, 'Courier New', Courier, monospace; color: #000080;">slave-parallel-type = LOGICAL_CLOCK</span> but see this blog from the MySQL engineering team: <a href="http://binlogtorelaylog.blogspot.com/2013/09/enhancedMTS-configuration.html" title="MySQL 5.7 Enhanced MTS: configuring slave for Intra-database parallelization">using the intra-schema MTS functionality</a> for more detailed instructions. Note that there is another blog in the series &#8211; that <a href="http://binlogtorelaylog.blogspot.com/2013/09/enhancedMTS-deepdive.html" title="MySQL 5.7: MySQL 5.7: Enhanced Multi-threaded slaves">blog provides a detailed view of how the intra-schema MTS is implemented</a>.</p>
<h2 id="replication-performance-schema">Replication Performance Schema</h2>
<p>With the ever increasing sophistication of MySQL Replication, presenting all of the information in <span style="font: normal normal normal 12px/18px Consolas, Monaco, 'Courier New', Courier, monospace; color: #000080;">SHOW SLAVE STATUS</span> has become unwieldy with data for multiple slave applier threads, GTID sets etc. What would be much more convenient is if this information were presented in tables so that the user could get exactly the information they needed using SQL queries (plus of course we can lay out the data in an understandable (relational) way and can access the information from stored procedures). MySQL 5.7.2 does just this by adding MySQL Replication tables to the <a href="http://dev.mysql.com/doc/refman/5.7/en/performance-schema-replication-tables.html" title="MySQL performance_schema documentation">MySQL performance_schema</a>.</p>
<p>This feature introduces 6 new <a href="http://dev.mysql.com/doc/refman/5.7/en/performance-schema-replication-tables.html" title="MySQL performance_schema documentation">performance_schema</a> tables: <span style="font: normal normal normal 12px/18px Consolas, Monaco, 'Courier New', Courier, monospace; color: #000080;">replication_connection_configuration, replication_connection_status, replication_execute_configuration, replication_execute_status, replication_execute_status_by_coordinator, replication_execute_status_by_worker</span>.</p>
<p>Shivji from the MySQL engineering team has written a great <a href="http://shivjijha.blogspot.com/2013/09/Introducing-the-performance-schema-tables-to-monitor-MySQL-replication.html" title="Introducing the performance schema tables to monitor MySQL replication">blog post on what&#8217;s in the new performance_schema tables and how to interpret the results</a>.</p>
<h2 id="multi-source-replication-labs">Multi-Source Replication &#8211; <em>LABS</em></h2>
<div id="attachment_2956" style="width: 310px" class="wp-caption alignright"><a href="/wp-content/uploads/2013/09/Multi-Source-Replication.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-2956" src="/wp-content/uploads/2013/09/Multi-Source-Replication-300x261.png" alt="Multi-Source Replication" width="300" height="261" class="size-medium wp-image-2956" /></a><p id="caption-attachment-2956" class="wp-caption-text">Multi-Source Replication</p></div>
<p>MySQL replication is very flexible in the way that networks of masters and slaves that can be built up; a master can replicate to multiple slaves, a master can itself be a slave of another master, you can create a replication ring&#8230;. The one caveat to this has always been that a slave server can only have a single master (MySQL Cluster is an exception to this rule).</p>
<p>Why might you want to do this? There are a few use cases around consolidating data from multiple MySQL Servers into one:<br />
  &#8211; Where each of the masters is for a different shard (where the application is responsible for the sharding) and you want to be able to run reports over all of that data to produce a consolidated view<br />
  &#8211; You want to avoid the expense of dedicating a slave server to each master server<br />
  &#8211; A remote location may require less throughput and so a single server can service all of the traffic for all of the data &#8211; the &#8216;super-slave&#8217; gives it a low-overhead, local database to access all of the data<br />
  &#8211; The &#8216;super-slave&#8217; is used as a point where you can perform backups for all of the data</p>
<p>It&#8217;s possible to have a slave time-slice between multiple masters with a bit of scripting but that isn&#8217;t an ideal solution. You can also add an additional repliation layer (such as writing your own code to use the binary log API) but it would be much simpler if it were built into MySQL itself.</p>
<p>In this <a href="http://labs.mysql.com/" title="Download multi-source replication from MySQL Labs">labs</a> (i.e. for test only, not to be deployed!) release we allow a slave to simultaneously receive and process replication events from multiple masters &#8211; exactly what our users have been asking for.</p>
<p>What&#8217;s more, we&#8217;ve also ensured that this new functionality is compatible with the other enhancements that have been made to the MySQL Replication architecture &#8211; this includes loss-less semi-synchronus replication; and intra-schema multi-threaded slaves (as well as the existing per-database MTS). This means that you don&#8217;t have to choose between all of these tempting features &#8211; the keys to the candy store are yours! </p>
<p>It&#8217;s likely that not all of the masters will be the same, have the same maintenance schedules etc. and so it makes sense to be able to manage each of the relationships independently. In this <a href="http://labs.mysql.com/" title="Download multi-source replication from MySQL Labs">labs</a> release you can manage each master independently, including the relevant server variables <em>but</em> the same replication filters are currently applied to the replication events from all of the masters &#8211; we recognise that this isn&#8217;t ideal but this is cuurently an early access release and it&#8217;s something we intend to address in future versions.</p>
<p>At the moment there&#8217;s no limit to the number of masters that can replicate to a specific slave &#8211; in the final version we&#8217;re likely to apply a configurable limit.</p>
<p>Because this further complicates the information that would need to be included in <span style="font: normal normal normal 12px/18px Consolas, Monaco, 'Courier New', Courier, monospace; color: #000080;">SHOW SLAVE STATUS</span>, most of the detailed information is instead presented in the Performance Schema.</p>
<p>It should be pointed out that there is no conflict detection or resolution built into this feature &#8211; it is the responsibility of the application to make sure that the masters are working on distinct data sets (or that they&#8217;re comfortable with the results of any conflicts).</p>
<p>For more technical details, refer to this <a href="http://on-mysql-replication.blogspot.com/2013/09/feature-preview-mysql-multi-source-replication.html" title="Multi-Source Replication blog post">engineering blog post on multi-source replication</a>.</p>
<h2 id="summary">Summary</h2>
<p>There&#8217;s a lot of exciting new content in the MySQL 5.7.2 DMR (<a href="http://dev.mysql.com/downloads/mysql/#downloads" title="Download MySQL 5.7.2 Development Milestone Release">download here</a>) and the Mulit-Source Replication labs release (<a href="http://labs.mysql.com/" title="Download multi-source replication from MySQL Labs">download here</a>). The reason these features has been released is that we value early feedback from our community and customers &#8211; please try them out and let us know what we&#8217;re getting right and what needs to be enhanced!</p>
]]></content:encoded>
					
					<wfw:commentRss>/mysql-replication/mysql-5-7-2-dmr-and-labs-new-replication-features/feed</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
		<item>
		<title>MySQL Cluster Asynchronous Replication &#8211; conflict detection &#038; resolution</title>
		<link>/mysql-cluster/mysql-cluster-asynchronous-replication-conflict-detection-resolution1</link>
					<comments>/mysql-cluster/mysql-cluster-asynchronous-replication-conflict-detection-resolution1#respond</comments>
		
		<dc:creator><![CDATA[andrew]]></dc:creator>
		<pubDate>Wed, 11 Sep 2013 08:29:40 +0000</pubDate>
				<category><![CDATA[MySQL Cluster]]></category>
		<category><![CDATA[MySQL Replication]]></category>
		<category><![CDATA[HA]]></category>
		<category><![CDATA[High Availability]]></category>
		<category><![CDATA[MySQL]]></category>
		<category><![CDATA[MySQL Cluster CGE]]></category>
		<category><![CDATA[Replication]]></category>
		<guid isPermaLink="false">/?p=387</guid>

					<description><![CDATA[I was rooting through past blog entries and I stumbled accross a draft post on setting up multi-master (update anywhere) asynchronous replication for MySQL Cluster. The post never quite got finished and published and while the material is now 4 years old it may still be helpfull to some and so I&#8217;m posting it now.]]></description>
										<content:encoded><![CDATA[<p>I was rooting through past blog entries and I stumbled accross a draft post on setting up multi-master (update anywhere) asynchronous replication for MySQL Cluster. The post never quite got finished and published and while the material is now 4 years old it may still be helpfull to some and so I&#8217;m posting it now. Note that a lot has happened with MySQL Cluster in the last 4 years and in this area, the most notable change has been the <a href="" target="_blank" title="Enhanced conflict resolution with MySQL Cluster active-active replication" alt="Enhanced conflict resolution with MySQL Cluster active-active replication">Enhanced conflict resolution with MySQL Cluster active-active replication</a> feature introduced in MySQL Cluster 7.2 and if you&#8217;re only dealing with a pair of Clusters, that&#8217;s your best option as it removed the need for you to maintain the timestamp columns and backs out entire transactions rather than just the conflicting rows. So when would you use this &#8220;legacy&#8221; method? The main use case is when you want conflict detection/resolution among a ring of more than 2 Clusters. Note also that MySQL 5.6 (and so MySQL Cluster 7.3) added microsecond precision to timestamps and so you may not need the custom plugin that this post referred to.</p>
<p>Anyway, here&#8217;s the original post&#8230;</p>
<p>&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;<br />
MySQL Cluster asynchronous replication allows you to run in a multi-master mode with the application making changes to both sites (or more than 2 sites using a replication ring). As the replication is asynchronous, if the application(s) modified the same row on both sites at &#8216;about the same time&#8217; then there is a potential for a collision. Left to their own devices, each site would store (and provide to the application) different data indefinitely. This article explains how to use MySQL Cluster collision detection and resolution to cope with this.</p>
<div id="attachment_437" style="width: 310px" class="wp-caption alignright"><a href="/wp-content/uploads/2009/08/Replication_Conflict.jpg"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-437" class="size-medium wp-image-437" title="Multi-master replication leading to inconsistencies" alt="Fig. 1 Multi-master replication leading to inconsistencies" src="/wp-content/uploads/2009/08/Replication_Conflict-300x178.jpg" width="300" height="178" srcset="/wp-content/uploads/2009/08/Replication_Conflict-300x178.jpg 300w, /wp-content/uploads/2009/08/Replication_Conflict.jpg 590w" sizes="auto, (max-width: 300px) 100vw, 300px" /></a><p id="caption-attachment-437" class="wp-caption-text">Fig. 1 Multi-master replication leading to inconsistencies</p></div>
<p>Fig. 1 shows the timeline that can result in a conflict. The same or two different applications make a change to the same row in the table but to the 2 different instances of MySQL Cluster. Each cluster synchronously replicates the data amongst its local data node in order to provide local High Availability (everything there is safe!). At some point later (normally a fraction of a second), the changes are replicated to the remote site asynchronously &#8211; this delay opens a window for a conflict where Cluster 2 is updated by the application just before it receives the earlier update from Cluster 1. Cluster 2 will overwrite it&#8217;s row with the value (5) it has received but only after its earlier change (directly from the application) is written to the binary log ready for replication to Cluster 1 which in turn will cause that value (15) to be stored by Cluster 1. Each Cluster instance replicates what it believes to be the correct data to the other site &#8211; overwriting what that site had previously stored. In our example, that leaves one database holding the value 15 for key &#8216;A&#8217; while the other stores 5.</p>
<p>It&#8217;s often the case that the application will tend to go to the same site during a particular time when accessing the same data and so the chances of a conflict are reduced but the application may still want to guard against (even rare) race conditions. If replication slows down (for example due to a backlog of updates to be applied) or stops temporarily (for example due to network failure to the geographically remote site) then the chances of a collision greatly increase.</p>
<p>For information on setting up multi-master asynchronous replication with MySQL Cluster, please take a look at <a href="/mysql-cluster/setting-up-mysql-asynchronous-replication-for-high-availability/" target="_blank">Setting up MySQL Asynchronous Replication for High Availability</a>.</p>
<h3>Conflict Detection &amp; Resolution using MySQL Cluster</h3>
<p>MySQL Cluster provides two different schemes to handle these collisions/conflicts. The first scheme (referred to as &#8220;greatest timestamp wins&#8221;) detects that a conflict occurs and automatically resolves it (the change most recently received from the application is stored on both Clusters). The second scheme (referred to as &#8220;same value wins&#8221;) detects that a conflict has occurred but <strong>does not fix it</strong> &#8211; instead the conflict is recorded in such a way that the application (or user) can figure out how best to resolve it based on a full understanding of the schema, what the data means and how it&#8217;s used. It is up to the developer which approach they use (if any) &#8211; it is selected on a per-table basis.</p>
<h3>Common prerequisite steps</h3>
<p>These steps should be followed regardless of whether you want to use conflict resolution or conflict detection (where the application decides how to resolve it).</p>
<ol>
<li>Set up multi-master replication as described in <a href="/mysql-cluster/setting-up-mysql-asynchronous-replication-for-high-availability/" target="_blank">Setting up MySQL Asynchronous Replication for High Availability</a></li>
<li>Create the function &#8220;inttime&#8221; for use in the stored procedures as described in <a href="/mysql/creating-a-mysql-plugin-to-produce-an-interger-timestamp/" target="_blank">Creating a MySQL plugin to produce an integer timestamp</a> <strong>Note that you will need to install inttime.so on each host</strong></li>
</ol>
<h3>Setting up Automatic Conflict Resolution (Greatest timestamp wins)</h3>
<p>This is the simplest way to handle conflicts with MySQL Cluster when implementing multi-master asynchronous replication (actually, the simplest is to do nothing and accept that if your application(s) update the same row at about the same time at both Clusters then those Clusters may be left with different data until the application(s) next update that row).</p>
<p>Remember that this mechanism works by checking that the timestamp field of the update received by the slave is later than the one already stored. In the example that follows, the &#8216;ts&#8217; column is used for the timestamp.</p>
<p>Create the database on either cluster (replication will make sure that it appears in both Clusters):</p>
<pre style="font: normal normal normal 12px/18px Consolas, Monaco, 'Courier New', Courier, monospace; padding-left: 30px; color: #000080;">
mysql&gt; create database clusterdb;
</pre>
<p>Before creating the application tables, set  up the ndb_replication system table (again, in either Cluster):</p>
<pre style="font: normal normal normal 12px/18px Consolas, Monaco, 'Courier New', Courier, monospace; padding-left: 30px; color: #000080;">
mysql&gt; CREATE TABLE mysql.ndb_replication ( db VARBINARY(63), table_name VARBINARY(63), server_id INT UNSIGNED, binlog_type INT UNSIGNED, conflict_fn VARBINARY(128), PRIMARY KEY USING HASH (db, table_name, server_id) ) ENGINE=NDB PARTITION BY KEY(db,table_name);

mysql&gt; insert into mysql.ndb_replication values ('clusterdb', 'tab1', 7, NULL, 'NDB$MAX(ts)');
</pre>
<p>After that, you can create the application table:</p>
<pre style="font: normal normal normal 12px/18px Consolas, Monaco, 'Courier New', Courier, monospace; padding-left: 30px; color: #000080;">
cluster1 mysql&gt; use clusterdb;

cluster1 mysql&gt; create table tab1 (NAME varchar(30) not null primary key,VALUE int, ts BIGINT UNSIGNED default NULL) engine=ndb;
</pre>
<p>To test that the basic replication is working for this table, insert a row into cluster1, check it&#8217;s there in cluster2, add a second row to cluster2 and make sure it&#8217;s visible in cluster1:</p>
<pre style="font: normal normal normal 12px/18px Consolas, Monaco, 'Courier New', Courier, monospace; padding-left: 30px; color: #000080;">
cluster1 mysql&gt; insert into tab1 values ('Frederick', 1, 0);

cluster2 mysql&gt; use clusterdb;
cluster2 mysql&gt; select * from tab1;
+-----------+-------+------+
| NAME      | VALUE | ts   |
+-----------+-------+------+
| Frederick |     1 |    0 |
+-----------+-------+------+
1 row in set (0.00 sec)
cluster2 mysql&gt; insert into tab1 values ('William',20,0);

cluster1 mysql&gt; select * from tab1;
+-----------+-------+------+
| NAME      | VALUE | ts   |
+-----------+-------+------+
| Frederick |     1 |    0 |
| William   |    20 |    0 |
+-----------+-------+------+
2 rows in set (0.00 sec)
</pre>
<p>For both rows, the timestamp was set to 0 to represent &#8216;the start of time&#8217;, from this point on, whenever making a change to those rows, the timestamp should be increased. Later on on in this article, I&#8217;ll show how to automate that process.</p>
<p>We&#8217;re now ready to test that the conflict resolution is working; to do so replication is stopped (in both directions) to increase the window for a conflict and the same tuple updated on each Cluster. Replication is then restarted and then I&#8217;ll confirm that the last update wins on both clusters:</p>
<pre style="font: normal normal normal 12px/18px Consolas, Monaco, 'Courier New', Courier, monospace; padding-left: 30px; color: #000080;">
cluster1 mysql&gt; slave stop;

cluster2 mysql&gt; slave stop;

cluster1 mysql&gt; update tab1 set VALUE=10,ts=1 where NAME='Frederick';

cluster2 mysql&gt; update tab1 set VALUE=11,ts=2 where NAME='Frederick';

cluster1 mysql&gt; slave start;

cluster2 mysql&gt; slave start;

cluster1 mysql&gt; select * from tab1;
+-----------+-------+------+
| NAME      | VALUE | ts   |
+-----------+-------+------+
| William   |    20 |    0 |
| Frederick |    11 |    2 |
+-----------+-------+------+
2 rows in set (0.00 sec)

clusrer2 mysql&gt; select * from tab3;
+-----------+-------+------+
| NAME      | VALUE | ts   |
+-----------+-------+------+
| William   |    20 |    0 |
| Frederick |    11 |    2 |
+-----------+-------+------+
2 rows in set (0.00 sec)
</pre>
<p>This confirms that the later update (timestamp of 2) is stored in both Clusters &#8211; conflict resolved!</p>
<h3>Automating the timestamp column</h3>
<p>Manually setting the timestamp value is convenient when testing that the mechanism is working as expected could be a nuisance in a production environment (for example, you would need to get the clocks of all application nodes exactly in sync wherever in the world they&#8217;re located). This section describes how that can be automated using stored procedures (note that stored procedures don&#8217;t work when using the NDB API to make changes but in that situation it should be straight-forward to provide wrapper methods that manage the timestamp field). Note that the timestamp must be an integer field (and needs a high level of precision) and so you can&#8217;t use the regular MySQL TIMESTAMP type.</p>
<p>This mechanism assumes that you&#8217;ve built &#8220;inttime.so&#8221; and deployed it to the hosts running the mysqld processes for each cluster (refer to the prerequisite section).</p>
<pre style="font: normal normal normal 12px/18px Consolas, Monaco, 'Courier New', Courier, monospace; padding-left: 30px; color: #000080;">
cluster1 mysql&gt; create trigger tab1_insert before insert on tab3 for each row set NEW.ts=inttime;
cluster1 mysql&gt; create trigger tab1_update before update on tab3 for each row set NEW.ts=inttime;
cluster1 mysql&gt; insert into tab1 (NAME,VALUE) values ('James',10),('David',20);
cluster1 mysql&gt; select * from tab1;
+-----------+-------+------------------+
| NAME      | VALUE | ts               |
+-----------+-------+------------------+
| William   |    20 |                0 |
| David     |    20 | 1250090500370307 |
| James     |    10 | 1250090500370024 |
| Frederick |    11 |                2 |
+-----------+-------+------------------+
4 rows in set (0.00 sec)

cluster2 mysql&gt; update tab1 set VALUE=55 where NAME='William';
cluster2 mysql&gt; select * from tab1;
+-----------+-------+------------------+
| NAME      | VALUE | ts               |
+-----------+-------+------------------+
| James     |    10 | 1250090500370024 |
| Frederick |    11 |                2 |
| William   |    55 | 1250090607251846 |
| David     |    20 | 1250090500370307 |
+-----------+-------+------------------+
4 rows in set (0.00 sec)
</pre>
<h3>Setting up Conflict Detection (Same timestamp wins)</h3>
<p>With this method, conflicts are detected and recorded but not automatically resolved. The intent is to allow the application to decide how to handle the conflict based on an understanding of what the data means.</p>
<p>Create the database on either cluster (replication will make sure that it appears in both Clusters):</p>
<pre style="font: normal normal normal 12px/18px Consolas, Monaco, 'Courier New', Courier, monospace; padding-left: 30px; color: #000080;">
mysql&gt; create database clusterdb;
</pre>
<p>Before creating the application tables, set  up the ndb_replication system table (again, in either Cluster):</p>
<pre style="font: normal normal normal 12px/18px Consolas, Monaco, 'Courier New', Courier, monospace; padding-left: 30px; color: #000080;">
mysql&gt; CREATE TABLE mysql.ndb_replication ( db VARBINARY(63), table_name VARBINARY(63), server_id INT UNSIGNED, binlog_type INT UNSIGNED, conflict_fn VARBINARY(128), PRIMARY KEY USING HASH (db, table_name, server_id) ) ENGINE=NDB PARTITION BY KEY(db,table_name);

mysql&gt; insert into mysql.ndb_replication values ('clusterdb', 'SubStatus', 7, NULL, 'NDB$OLD(ts)');
</pre>
<p>After that, you can create the application table and its associated exception table:</p>
<pre style="font: normal normal normal 12px/18px Consolas, Monaco, 'Courier New', Courier, monospace; padding-left: 30px; color: #000080;">
cluster1 mysql&gt; use clusterdb;
cluster1 mysql&gt; create table SubStatus$EX (server_id INT UNSIGNED,master_server_id INT UNSIGNED,master_epoch BIGINT UNSIGNED,count INT UNSIGNED,sub_id int not null,notes VARCHAR(30) DEFAULT 'To be resolved', PRIMARY KEY (server_id, master_server_id, master_epoch, count)) engine=ndb;
cluster1 mysql&gt; create table SubStatus (sub_id int not null primary key, ActivationStatus varchar(20), ts BIGINT default 0) engine=ndb;
</pre>
<p>To test that the exception table gets filled in, add some rows to the table and then cause an update conflict (in a similar way to the conflict resolution example but after setting up the timestamp automation):</p>
<pre style="font: normal normal normal 12px/18px Consolas, Monaco, 'Courier New', Courier, monospace; padding-left: 30px; color: #000080;">
cluster1 mysql&gt; create trigger SubStatus_insert before insert on SubStatus for each row set NEW.ts=inttime();
cluster1 mysql&gt; insert into SubStatus (sub_id, ActivationStatus) values (1,'Active'),(2,'Deactivated');
cluster1 mysql&gt; select * from SubStatus;
+--------+------------------+------------------+
| sub_id | ActivationStatus | ts               |
+--------+------------------+------------------+
|      1 | Active           | 1250094170589948 |
|      2 | Deactivated      | 1250094170590250 |
+--------+------------------+------------------+
2 rows in set (0.00 sec)

cluster2 myql&gt; use clusterdb;
cluster2 mysql&gt; select * from SubStatus;
+--------+------------------+------------------+
| sub_id | ActivationStatus | ts               |
+--------+------------------+------------------+
|      1 | Active           | 1250094170589948 |
|      2 | Deactivated      | 1250094170590250 |
+--------+------------------+------------------+
2 rows in set (0.00 sec)

cluster1 mysql&gt; slave stop;

cluster2 mysql&gt; slave stop;

...
</pre>
<p>(at this point, just go on to test as with the conflict resoultion example but in this case expect to see that the confict is <strong>not</strong> resolved but an entry is added into the conflict table).</p>
<p>Of course, you can always add a trigger on the conflict table and use that to spur the application into initiating its own conflict resolution algorithm.</p>
]]></content:encoded>
					
					<wfw:commentRss>/mysql-cluster/mysql-cluster-asynchronous-replication-conflict-detection-resolution1/feed</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
	</channel>
</rss>
