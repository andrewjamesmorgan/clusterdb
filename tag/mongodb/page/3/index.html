<!DOCTYPE html>
<!-- HTML 5 --><html lang="en-US">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<link rel="pingback" href="./../../../xmlrpc.php">
	
	<title>mongodb | Andrew Morgan on Databases | Page 3</title>

<meta name="robots" content="max-image-preview:large">
	<style>img:is([sizes="auto" i], [sizes^="auto," i]) { contain-intrinsic-size: 3000px 1500px }</style>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="alternate" type="application/rss+xml" title="Andrew Morgan on Databases &raquo; Feed" href="./../../../feed/index.html">
<link rel="alternate" type="application/rss+xml" title="Andrew Morgan on Databases &raquo; Comments Feed" href="./../../../comments/feed/index.html">
<link rel="alternate" type="application/rss+xml" title="Andrew Morgan on Databases &raquo; mongodb Tag Feed" href="./../feed/index.html">
		<!-- This site uses the Google Analytics by MonsterInsights plugin v9.2.2 - Using Analytics tracking - https://www.monsterinsights.com/ -->
		<!-- Note: MonsterInsights is not currently configured on this site. The site owner needs to authenticate with Google Analytics in the MonsterInsights settings panel. -->
					<!-- No tracking code set -->
				<!-- / Google Analytics by MonsterInsights -->
		<script type="text/javascript">
/* <![CDATA[ */
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/www.clusterdb.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=81fb77f64976ac32efe42aab69fdb5e4"}};
/*! This file is auto-generated */
!function(i,n){var o,s,e;function c(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function p(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data),r=(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0),new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data));return t.every(function(e,t){return e===r[t]})}function u(e,t,n){switch(t){case"flag":return n(e,"üè≥Ô∏è‚Äç‚ößÔ∏è","üè≥Ô∏è‚Äã‚ößÔ∏è")?!1:!n(e,"üá∫üá≥","üá∫‚Äãüá≥")&&!n(e,"üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø","üè¥‚ÄãÛ†Åß‚ÄãÛ†Å¢‚ÄãÛ†Å•‚ÄãÛ†ÅÆ‚ÄãÛ†Åß‚ÄãÛ†Åø");case"emoji":return!n(e,"üê¶‚Äç‚¨õ","üê¶‚Äã‚¨õ")}return!1}function f(e,t,n){var r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):i.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0}),o=(a.textBaseline="top",a.font="600 32px Arial",{});return e.forEach(function(e){o[e]=t(a,e,n)}),o}function t(e){var t=i.createElement("script");t.src=e,t.defer=!0,i.head.appendChild(t)}"undefined"!=typeof Promise&&(o="wpEmojiSettingsSupports",s=["flag","emoji"],n.supports={everything:!0,everythingExceptFlag:!0},e=new Promise(function(e){i.addEventListener("DOMContentLoaded",e,{once:!0})}),new Promise(function(t){var n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),p.toString()].join(",")+"));",r=new Blob([e],{type:"text/javascript"}),a=new Worker(URL.createObjectURL(r),{name:"wpTestEmojiSupports"});return void(a.onmessage=function(e){c(n=e.data),a.terminate(),t(n)})}catch(e){}c(n=f(s,u,p))}t(n)}).then(function(e){for(var t in e)n.supports[t]=e[t],n.supports.everything=n.supports.everything&&n.supports[t],"flag"!==t&&(n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&n.supports[t]);n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&!n.supports.flag,n.DOMReady=!1,n.readyCallback=function(){n.DOMReady=!0}}).then(function(){return e}).then(function(){var e;n.supports.everything||(n.readyCallback(),(e=n.source||{}).concatemoji?t(e.concatemoji):e.wpemoji&&e.twemoji&&(t(e.twemoji),t(e.wpemoji)))}))}((window,document),window._wpemojiSettings);
/* ]]> */
</script>
<style id="wp-emoji-styles-inline-css" type="text/css">img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}</style>
<link rel="stylesheet" id="wp-block-library-css" href="./../../../wp-includes/css/dist/block-library/style.min.css?ver=81fb77f64976ac32efe42aab69fdb5e4" type="text/css" media="all">
<style id="classic-theme-styles-inline-css" type="text/css">/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}</style>
<style id="global-styles-inline-css" type="text/css">:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
:root :where(.wp-block-pullquote){font-size: 1.5em;line-height: 1.6;}</style>
<link rel="stylesheet" id="plyr-css-css" href="./../../../wp-content/plugins/easy-video-player/lib/plyr.css?ver=81fb77f64976ac32efe42aab69fdb5e4" type="text/css" media="all">
<link rel="stylesheet" id="zeeSynergie_stylesheet-css" href="./../../../wp-content/themes/zeesynergie/style.css?ver=81fb77f64976ac32efe42aab69fdb5e4" type="text/css" media="all">
<link rel="stylesheet" id="zeeSynergie_colorscheme-css" href="./../../../wp-content/themes/zeesynergie/includes/css/colorschemes/blue.css?ver=81fb77f64976ac32efe42aab69fdb5e4" type="text/css" media="all">
<link rel="stylesheet" id="themezee_default_font-css" href="http://fonts.googleapis.com/css?family=Paytone+One&#038;ver=81fb77f64976ac32efe42aab69fdb5e4" type="text/css" media="all">
<script type="text/javascript" src="./../../../wp-content/plugins/easy-video-player/lib/plyr.min.js?ver=81fb77f64976ac32efe42aab69fdb5e4" id="plyr-js-js"></script>
<script type="text/javascript" src="./../../../wp-includes/js/jquery/jquery.min.js?ver=3.7.1" id="jquery-core-js"></script>
<script type="text/javascript" src="./../../../wp-includes/js/jquery/jquery-migrate.min.js?ver=3.4.1" id="jquery-migrate-js"></script>
<script type="text/javascript" src="./../../../wp-content/themes/zeesynergie/includes/js/jquery.cycle.all.min.js?ver=81fb77f64976ac32efe42aab69fdb5e4" id="zee_jquery-cycle-js"></script>
<link rel="https://api.w.org/" href="./../../../wp-json/index.html">
<link rel="alternate" title="JSON" type="application/json" href="./../../../wp-json/wp/v2/tags/150/index.html">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="./../../../xmlrpc.php?rsd">

<style data-context="foundation-flickity-css">/*! Flickity v2.0.2
http://flickity.metafizzy.co
---------------------------------------------- */.flickity-enabled{position:relative}.flickity-enabled:focus{outline:0}.flickity-viewport{overflow:hidden;position:relative;height:100%}.flickity-slider{position:absolute;width:100%;height:100%}.flickity-enabled.is-draggable{-webkit-tap-highlight-color:transparent;tap-highlight-color:transparent;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.flickity-enabled.is-draggable .flickity-viewport{cursor:move;cursor:-webkit-grab;cursor:grab}.flickity-enabled.is-draggable .flickity-viewport.is-pointer-down{cursor:-webkit-grabbing;cursor:grabbing}.flickity-prev-next-button{position:absolute;top:50%;width:44px;height:44px;border:none;border-radius:50%;background:#fff;background:hsla(0,0%,100%,.75);cursor:pointer;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.flickity-prev-next-button:hover{background:#fff}.flickity-prev-next-button:focus{outline:0;box-shadow:0 0 0 5px #09f}.flickity-prev-next-button:active{opacity:.6}.flickity-prev-next-button.previous{left:10px}.flickity-prev-next-button.next{right:10px}.flickity-rtl .flickity-prev-next-button.previous{left:auto;right:10px}.flickity-rtl .flickity-prev-next-button.next{right:auto;left:10px}.flickity-prev-next-button:disabled{opacity:.3;cursor:auto}.flickity-prev-next-button svg{position:absolute;left:20%;top:20%;width:60%;height:60%}.flickity-prev-next-button .arrow{fill:#333}.flickity-page-dots{position:absolute;width:100%;bottom:-25px;padding:0;margin:0;list-style:none;text-align:center;line-height:1}.flickity-rtl .flickity-page-dots{direction:rtl}.flickity-page-dots .dot{display:inline-block;width:10px;height:10px;margin:0 8px;background:#333;border-radius:50%;opacity:.25;cursor:pointer}.flickity-page-dots .dot.is-selected{opacity:1}</style>
<style data-context="foundation-slideout-css">.slideout-menu{position:fixed;left:0;top:0;bottom:0;right:auto;z-index:0;width:256px;overflow-y:auto;-webkit-overflow-scrolling:touch;display:none}.slideout-menu.pushit-right{left:auto;right:0}.slideout-panel{position:relative;z-index:1;will-change:transform}.slideout-open,.slideout-open .slideout-panel,.slideout-open body{overflow:hidden}.slideout-open .slideout-menu{display:block}.pushit{display:none}</style>
<script type="text/javascript">
				//<![CDATA[
					jQuery(document).ready(function($) {
						$('#nav ul').css({display: 'none'}); // Opera Fix
						$('#nav li').hover(function(){
							$(this).find('ul:first').css({visibility: 'visible',display: 'none'}).show().css({opacity:0}).animate({opacity:1},400);
						},function(){
							$(this).find('ul:first').css({visibility: 'hidden'});
						});
					});
				//]]>
				</script><style type="text/css"></style>
<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
<style type="text/css" id="custom-background-css">body.custom-background { background-color: #89a5bf; }</style>
	<style>.ios7.web-app-mode.has-fixed header{ background-color: rgba(3,122,221,.88);}</style>
</head>

<body class="archive paged tag tag-mongodb tag-150 custom-background paged-3 tag-paged-3">
<div id="wrapper">

	<div id="header">

		<div id="head">
			<div id="logo">
									<a href="./../../../index.html"><h1>Andrew Morgan on Databases</h1></a>
                                        <!-- <a href=".//"><h1>MySQL Cluster, Replication, Fabric...</h1></a>  ZXZX -->					
							</div>
			<div id="socialmedia_icons">
				<a href="http://twitter.com/andrewmorgan"><img src="./../../../wp-content/themes/zeesynergie/images/icons/twitter.png" alt="twitter"></a><a href="http://www.facebook.com/andrewjamesmorgan"><img src="./../../../wp-content/themes/zeesynergie/images/icons/facebook.png" alt="facebook"></a><a href="https://plus.google.com/u/0/100605473697871424413/posts"><img src="./../../../wp-content/themes/zeesynergie/images/icons/googleplus.png" alt="googleplus"></a><a href="http://www.linkedin.com/profile/view?id=16709956"><img src="./../../../wp-content/themes/zeesynergie/images/icons/linkedin.png" alt="linkedin"></a><a href="http://www.flickr.com/photos/andrewjamesmorgan/"><img src="./../../../wp-content/themes/zeesynergie/images/icons/flickr.png" alt="flickr"></a><a href="http://www.youtube.com/channel/UCodtDakJ4VdeSCzS3P3rIsw"><img src="./../../../wp-content/themes/zeesynergie/images/icons/youtube.png" alt="youtube"></a>				<div class="clear"></div>
			</div>
			<div class="clear"></div>
		</div>
		
		<div id="navi_container">
			<div id="navi">
				<ul id="nav" class="menu">
<li class="page_item page-item-1011"><a href="./../../../about/index.html">About</a></li>
</ul>			</div>
		</div>
		<div class="clear"></div>
	</div>
	
	<div id="container">
	
			<div id="custom_header">
			<img src="./../../../wp-content/uploads/2015/06/cropped-ClusterDB-logo-header.png">
		</div>
	
	<div id="wrap">
		<div id="content">
		
		<h2 class="arh">Tag Archive for mongodb</h2>
				
					<div id="post-4520" class="post-4520 post type-post status-publish format-standard hentry category-mongodb tag-mongodb tag-mongodb-stitch tag-rest-api">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../../../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../../../mongodb/building-a-rest-api-with-mongodb-stitch/index.html">September 19, 2018</a>
			</div>
	<div class="postcomments">
		<a href="./../../../mongodb/building-a-rest-api-with-mongodb-stitch/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../../../mongodb/building-a-rest-api-with-mongodb-stitch/index.html" rel="bookmark">Building a REST API with MongoDB Stitch</a></h2>
				
				<div class="entry">
										<p>One of the great things about MongoDB Stitch is that it often removes the need to build REST APIs to grant access to your data from frontend applications ‚Äì simply use <a href="https://docs.mongodb.com/stitch/getting-started/configure-rules-based-access-to-mongodb/" title="MongoDB Stitch QueryAnywhere">Stitch QueryAnywhere</a> to make MongoDB queries from your frontend code. However, there are often cases where you need to open up some of your data to other applications which don&#8217;t use the <a href="https://docs.mongodb.com/stitch/" title="MongoDB Stitch client APIs">Stitch SDK</a> ‚Äì fortunately, Stitch makes it incredibly easy to build REST APIs for these occasions.</p>
<p>I enjoy tracking my location by checking into Swarm/FourSquare, but I want to get some extra value from that data ‚Äì that means getting it into a MongoDB collection.</p>
<p>FourSquare provides an <a href="https://ifttt.com/foursquare">IFTTT service</a> that&#8217;s triggered whenever you check in ‚Äì by linking that to the <a href="https://ifttt.com/services/maker_webhooks">Maker service</a> to send an HTTP <code>POST</code> request, I can forward that check-in data to Stitch. This is where Stitch comes in; a simple Stitch HTTP service webhook receives that <code>POST</code> request and writes the data to MongoDB:</p>
<pre><code class="js">exports = function(payload) {
  var queryArg = payload.query.arg || '';
  var body = {};
  if (payload.body) {
  body = EJSON.parse(payload.body.text());
  }

  var owner_id = context.functions.execute("ownerFromEmail", body.email);
  var checkin = {
    owner_id: owner_id.owner_id,
    email: body.email,
    venueName: body.venue,
    date: body.checkinDate,
    url: body.url,
    locationImg: body.location + "&amp;key=" + context.values.get("GoogleMapsStaticKey")
  };

  return context.functions.execute("checkin", checkin);
};
</code></pre>
<p>The webhook uses the <code>checkin</code> function:</p>
<pre><code class="js">exports = function(checkin){
    var atlas = context.services.get("mongodb-atlas");
    var checkinColl = atlas.db("trackme").collection("checkins");
    try {
      checkinColl.insertOne(checkin);
    } catch (e) {
      console.log("Error inserting checkin doc: " + e);
      return e.message();
    }
};
</code></pre>
<p>Note that when configuring the HTTP service, I set an API key that the requestor must include as a <code>secret</code> query parameter:</p>
<p><img decoding="async" src="https://webassets.mongodb.com/_com_assets/cms/configure_http_service-16rtnndw0y.png" alt="Secure Stitch webhook with secret"></p>
<p><img decoding="async" src="https://webassets.mongodb.com/_com_assets/cms/IFTTT_FourSquare-zngprpzu1y.png" alt="IFTTT FourSquare applet"></p>
<p>Now that the data is in MongoDB, there&#8217;s no limit to what I can do with it. For example, I want a dashboard for my check-in data, and one thing I want to include is a graph on my most frequent check-ins:</p>
<p><img decoding="async" src="https://webassets.mongodb.com/_com_assets/cms/Checkin_Graph-03om2rc3s3.png" alt="Foursquare check-in grapsh"></p>
<p>To implement that, I write a new Stitch function:</p>
<pre><code class="js">exports = function(limit){
    var atlas = context.services.get("mongodb-atlas");
    var checkinColl = atlas.db("trackme").collection("checkins");
    var checkins = checkinColl.aggregate([
      {$match: {owner_id: context.user.id}},
      {$group: {
        _id: "$venueName",
        count: {$sum: 1}
      }},
      {$sort: {count: -1}},
      {$limit: limit},
      {$project: {
        venue: "$_id",
        _id: 0,
        count: 1
      }}
    ]).toArray();
    return checkins;
};
</code></pre>
<p>From the frontend application, it then takes a single method call to retrieve the data:</p>
<pre><code class="js">this.props.stitchClient
    .executeFunction('popularCheckins', 10)
    .then(
      checkinData =&gt; {
        this.setState({checkins: checkinData});
        this.createBarChart();
      },
      error =&gt; {
        console.log(
          "Failed to fetch most popular check-ins: "
          + error)
    })
</code></pre>
<p>You can recreate this Stitch and frontend app for your self by <a href="https://github.com/am-MongoDB/trackme_MongoDB_Stitch" title="MongoDB Stitch checkin app">downloading the app from GitHub</a> and <a href="https://docs.mongodb.com/stitch/import-export/create-stitch-app/" title="Import an application into MongoDB Stitch">importing it into Stitch</a>.</p>
<p>Creating your first Stitch app? Start with one of the <a href="https://docs.mongodb.com/stitch/tutorials/" title="MongoDB Stitch serverless platform ‚Äì tutorials">Stitch tutorials</a>.</p>
<p>Want to learn more about MongoDB Stitch? Read the <a href="https://www.mongodb.com/collateral/mongodb-stitch-serverless-platform" title="MongoDB Stitch serverless platform architecture white paper">white paper</a>.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/building-a-rest-api-with-mongodb-stitch" data-via="wpbeginner" data-text="Building a REST API with MongoDB Stitch" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/building-a-rest-api-with-mongodb-stitch"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/building-a-rest-api-with-mongodb-stitch" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Fbuilding-a-rest-api-with-mongodb-stitch&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../../../category/mongodb/index.html" rel="category tag">MongoDB</a> | 
Tags: <a href="./../../mongodb/index.html" rel="tag">mongodb</a>, <a href="./../../mongodb-stitch/index.html" rel="tag">MongoDB Stitch</a>, <a href="./../../rest-api/index.html" rel="tag">rest api</a>
</div>

			</div>			<div id="post-4517" class="post-4517 post type-post status-publish format-standard has-post-thumbnail hentry category-mongodb tag-iot tag-mongodb tag-mongodb-stitch tag-serverless">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../../../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../../../mongodb/recording-sensor-data-with-mongodb-stitch-electric-imp/index.html">September 18, 2018</a>
			</div>
	<div class="postcomments">
		<a href="./../../../mongodb/recording-sensor-data-with-mongodb-stitch-electric-imp/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../../../mongodb/recording-sensor-data-with-mongodb-stitch-electric-imp/index.html" rel="bookmark">Recording sensor data with MongoDB Stitch &#038; Electric Imp</a></h2>
				
				<div class="entry">
					<img width="150" height="150" src="./../../../wp-content/uploads/2018/09/old_school_IoT-150x150.jpg" class="alignleft wp-post-image" alt="Old school IoT" decoding="async" srcset="./../../../wp-content/uploads/2018/09/old_school_IoT-150x150.jpg 150w, ./../../../wp-content/uploads/2018/09/old_school_IoT-144x144.jpg 144w" sizes="(max-width: 150px) 100vw, 150px">					<p>My early experiments with IoT involved standalone sensors, breakout boards, Arduinos, Raspberry Pis, and a soldering iron. It was a lot of fun, but it took ages to build even the simplest of projects.</p>
<p>Therefore, I was super excited when I discovered that Electric Imp had a self-contained <a href="https://store.electricimp.com/products/impexplorer-developer-kit?variant=31118866130">IoT hardware developer kit</a> <strong>and</strong> a <a href="https://developer.electricimp.com/libraries/webservices/mongodbstitch">library</a> to access <a href="https://www.mongodb.com/cloud/stitch" title="MongoDB Stitch Serverless Platform">MongoDB Stitch</a> directly.</p>
<p><img decoding="async" src="https://webassets.mongodb.com/_com_assets/cms/impExplorer-opi47819wd.jpg" alt="Electric Imp impExplorer IoT development kit"></p>
<p>My first experiment with Electric Imp took sensor data (temperature, humidity, air pressure, light level, and orientation) from the device, and stored it in MongoDB.</p>
<p>The Electric Imp code (written in <a href="http://www.squirrel-lang.org/" title="Squirrel programming language">Squirrel</a>) is split into 2 parts:<br>
&#8211; On-device code ‚Äì sends sensor data to the agent<br>
&#8211; Agent code, running in Electric Imp&#8217;s cloud ‚Äì forwards the data to Stitch</p>
<p>This post focuses on the integration between the Electric Imp agent code and Stitch, but those interested can <a href="https://github.com/am-MongoDB/MongoDB-Stitch-Imp_IoT/blob/master/electricImp/device.nut" title="Send data from Electric Imp impExplorer to agent">view the device code</a>.</p>
<p>The agent code receives the readings from the device, and then it uses the Electric Imp MongoDB Stitch library to forward them to Stitch:</p>
<pre><code class="squirel">#require "MongoDBStitch.agent.lib.nut:1.0.0"

//Create the connection to Stitch
stitch &lt;- MongoDBStitch("imptemp-sobpa");

//Add an API key to link this device to a specific Stitch User
const API_KEY = "hNErDmBw1zYGOfpaSv4Pf5kaNQrIaxOHLZgj0vExzDcxWf9GAEX055l1mXXX";

//Ensure you are authenticated to Stitch
stitch.loginWithApiKey(API_KEY);

function log(data) {
    stitch.executeFunction("Imp_Write", [data], function (error, response) {
        if (error) {
            server.log("error: " + error.details);
        } else {
            server.log("temperature sent");
        }
    });
}

// Register a function to receive sensor data from the device
device.on("reading.sent", log);
</code></pre>
<p>Note that you will need to create the <code>API_KEY</code> through the Stitch UI.</p>
<p><img decoding="async" src="https://webassets.mongodb.com/_com_assets/cms/electricImp_MongoDB_Stitch-a9ibd5y5ki.png" alt="impExplorer sends readings to Electric Imp agent which sends them to MongoDB Stitch to store in MongoDB Atlas"></p>
<p>The <code>Imp_Write</code> function receives the readings from the agent, retrieves outside weather data from <a href="http://www.darksky.net/">DarkSky.net</a>, and stores the data in the <code>TempData</code> <a href="https://www.mongodb.com/cloud/atlas" title="MongoDB Atlas database as a service">MongoDB Atlas</a> collection:</p>
<pre><code class="js">exports = function(data){

  //Get the current time
  var now = new Date();

  var darksky = context.services.get("darksky");
  var mongodb = context.services.get("mongodb-atlas");
  var TempData = mongodb.db("Imp").collection("TempData");

  // Fetch the current weather from darksky.net

  darksky.get({"url": "https://api.darksky.net/forecast/" + 
    context.values.get("DarkSkyKey") + '/' + 
    context.values.get("DeviceLocation") +
    "?exclude=minutely,hourly,daily,alerts,flags&amp;units=auto"
  }).then(response =&gt; {
    var darkskyJSON = EJSON.parse(response.body.text()).currently;

    var status =
      {
        "Timestamp": now.getTime(),
        "Date": now,
        "Readings": data,
        "External": darkskyJSON,
      };
    status.Readings.light = (100*(data.light/65536));
    context.functions.execute("controlHumidity", data.temp, data.humid);
    TempData.insertOne(status).then(
      results =&gt; {
        console.log("Successfully wrote document to TempData");
      },
      error =&gt; {
        console.log("Error writing to TempData collection: " + error);
      });
  });
};
</code></pre>
<p><code>ImpWrite</code> also calls the <code>controlHumidity</code> method ‚Äì find more on that in <a href="https://www.mongodb.com/blog/post/controlling-humidity-with-a-mongodb-stitch-http-service-and-ifttt" title="Controlling humidity with a MongoDB Stitch HTTP service and IFTTT">this post</a>.</p>
<p>You can recreate the Stitch app for yourself by <a href="https://github.com/am-MongoDB/MongoDB-Stitch-Imp_IoT" title="MongoDB Stitch app to control a dehumidifier using IFTTT and ElectricImp">downloading the app from GitHub</a> and <a href="https://docs.mongodb.com/stitch/import-export/create-stitch-app/" title="Import an application into MongoDB Stitch">importing it into Stitch</a>. You&#8217;ll need to set some of your own keys first (including the details of your IFTTT webhook address) ‚Äì details are in the <a href="https://github.com/am-MongoDB/MongoDB-Stitch-Imp_IoT/blob/master/README.md">README</a>. The repo also includes the Electric Imp code for the agent and device.</p>
<p>Creating your first Stitch app? Start with one of the <a href="https://docs.mongodb.com/stitch/tutorials/" title="MongoDB Stitch serverless platform ‚Äì tutorials">Stitch tutorials</a>.</p>
<p>Want to learn more about MongoDB Stitch? Read the <a href="https://www.mongodb.com/collateral/mongodb-stitch-serverless-platform" title="MongoDB Stitch serverless platform architecture white paper">MongoDB Stitch white paper</a>.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/recording-sensor-data-with-mongodb-stitch-electric-imp" data-via="wpbeginner" data-text="Recording sensor data with MongoDB Stitch &#038; Electric Imp" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/recording-sensor-data-with-mongodb-stitch-electric-imp"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/recording-sensor-data-with-mongodb-stitch-electric-imp" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Frecording-sensor-data-with-mongodb-stitch-electric-imp&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../../../category/mongodb/index.html" rel="category tag">MongoDB</a> | 
Tags: <a href="./../../iot/index.html" rel="tag">IoT</a>, <a href="./../../mongodb/index.html" rel="tag">mongodb</a>, <a href="./../../mongodb-stitch/index.html" rel="tag">MongoDB Stitch</a>, <a href="./../../serverless/index.html" rel="tag">serverless</a>
</div>

			</div>			<div id="post-4511" class="post-4511 post type-post status-publish format-standard has-post-thumbnail hentry category-mongodb tag-ifttt tag-iot tag-mongodb tag-mongodb-stitch">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../../../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../../../mongodb/controlling-humidity-with-a-mongodb-stitch-http-service-and-ifttt/index.html">September 17, 2018</a>
			</div>
	<div class="postcomments">
		<a href="./../../../mongodb/controlling-humidity-with-a-mongodb-stitch-http-service-and-ifttt/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../../../mongodb/controlling-humidity-with-a-mongodb-stitch-http-service-and-ifttt/index.html" rel="bookmark">Controlling humidity with a MongoDB Stitch HTTP service and IFTTT</a></h2>
				
				<div class="entry">
					<img width="150" height="150" src="./../../../wp-content/uploads/2018/09/MongoDB_IFTTT-150x150.png" class="alignleft wp-post-image" alt="" decoding="async" srcset="./../../../wp-content/uploads/2018/09/MongoDB_IFTTT-150x150.png 150w, ./../../../wp-content/uploads/2018/09/MongoDB_IFTTT-144x144.png 144w" sizes="(max-width: 150px) 100vw, 150px">					<p>I&#8217;ve long been a fan of using <a href="https://ifttt.com/">IFTTT</a> as a quick and easy way to automate my home/life by connecting cloud and IoT services. My IFTTT Applets are what make my study lights flash when my Amazon Alexa timer expires in the kitchen; they&#8217;re what add my FourSquare check-ins to my Google calendar and MongoDB database.</p>
<p>I have a dumb dehumidifier in my study, and I wanted to make it a bit smarter using <a href="https://www.mongodb.com/cloud/stitch" title="MongoDB Stitch ‚Äì serverless platform for MongoDB">MongoDB Stitch</a>. I use an <a href="https://developer.electricimp.com/libraries/webservices/mongodbstitch">ElectricImp IoT device</a> to send periodic temperature and humidity sensor readings to my Stitch app. The Stitch app then fetches weather data from <a href="https://darksky.net/">DarkSky.net</a> and stores the combined data in a MongoDB collection. I have a dashboard that lets me view that data over time.</p>
<p>Based on the latest humidity and temperature, a Stitch function decides whether to turn the humidifier on or off. The function then uses a <a href="https://docs.mongodb.com/stitch/reference/partner-services/http/" title="Use any REST API with the MongoDB Stitch REST API">Stitch HTTP service</a> I created to send a request an IFTTT Maker service webhook with the desired state (<code>on|off</code>).</p>
<pre><code class="js">exports = function(temp, humidity){

  var IFTTT = context.services.get("IFTTT");

  // The humidifier is very inefficient if room is too cold, so only turn
  // it on if the humidity is too high and temperature is high enough

  var state = "dry";

  if (temp &gt; context.values.get("minTemp")) {
    if (humidity &gt; context.values.get("maxHumidity")) {
        state = "damp";
    }
  }

  IFTTT.get({"url": "https://maker.ifttt.com/trigger/" + 
    state + "/with/key/" + 
    context.values.get("MakerIFTTKey")})
  .then(() =&gt; {
    console.log("Sent IFTTT request");
  });
};
</code></pre>
<p>The webhook uses the <a href="https://ifttt.com/kasa">TP-Link Kasa IFTTT service</a> to send an <code>on|off</code> request to my smart plug:</p>
<p><img decoding="async" src="https://webassets.mongodb.com/_com_assets/cms/MongoDB_IFTTT-vbnx495cp3.png" alt="IFTTT Webhook to turn plug onn" title="Maker webhook in IFTTT"></p>
<p>You can recreate this Stitch app for your self by <a href="https://github.com/am-MongoDB/MongoDB-Stitch-Imp_IoT" title="MongoDB Stitch app to control a dehumidifier using IFTTT and ElectricImp">downloading the app from GitHub</a> and <a href="https://docs.mongodb.com/stitch/import-export/create-stitch-app/" title="Import an application into MongoDB Stitch">importing into Stitch</a>. You&#8217;ll need to set some of your own keys first (including the details of your IFTTT webhook address) ‚Äì details are in the <a href="https://github.com/am-MongoDB/MongoDB-Stitch-Imp_IoT/blob/master/README.md">README</a>. The repo also includes the ElectricImp device and agent code.</p>
<p>Creating your first Stitch app? Start with one of the <a href="https://docs.mongodb.com/stitch/tutorials/" title="MongoDB Stitch serverless platform ‚Äì tutorials">Stitch tutorials</a>.</p>
<p>Want to learn more about MongoDB Stitch? Read the <a href="https://www.mongodb.com/collateral/mongodb-stitch-serverless-platform" title="MongoDB Stitch serverless platform architecture white paper">white paper</a>.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/controlling-humidity-with-a-mongodb-stitch-http-service-and-ifttt" data-via="wpbeginner" data-text="Controlling humidity with a MongoDB Stitch HTTP service and IFTTT" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/controlling-humidity-with-a-mongodb-stitch-http-service-and-ifttt"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/controlling-humidity-with-a-mongodb-stitch-http-service-and-ifttt" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Fcontrolling-humidity-with-a-mongodb-stitch-http-service-and-ifttt&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../../../category/mongodb/index.html" rel="category tag">MongoDB</a> | 
Tags: <a href="./../../ifttt/index.html" rel="tag">IFTTT</a>, <a href="./../../iot/index.html" rel="tag">IoT</a>, <a href="./../../mongodb/index.html" rel="tag">mongodb</a>, <a href="./../../mongodb-stitch/index.html" rel="tag">MongoDB Stitch</a>
</div>

			</div>			<div id="post-4455" class="post-4455 post type-post status-publish format-standard hentry category-mongodb tag-baas tag-mean tag-mern tag-mongodb tag-mongodb-stitch">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../../../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../../../mongodb/mongodb-stitch-the-latest-and-best-way-to-build-your-app/index.html">September 5, 2017</a>
			</div>
	<div class="postcomments">
		<a href="./../../../mongodb/mongodb-stitch-the-latest-and-best-way-to-build-your-app/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../../../mongodb/mongodb-stitch-the-latest-and-best-way-to-build-your-app/index.html" rel="bookmark">MongoDB Stitch ‚Äì the latest, and best way to build your app</a></h2>
				
				<div class="entry">
										<h1>MongoDB Stitch ‚Äì the latest, and best way to build your app</h1>
<p>In a recent <a href="./../../../mongodb/modern-application-stack-part-1-introducing-the-mean-stack/index.html" title="Building apps with the MEAN stack or MERN stack">6 part blog series on the MEAN &amp; MERN stacks</a>, I stepped through how you can build modern applications on a stack of MongoDB, Node.js, Express, and Angular or React. What if there was a service that took care of everything apart from the from application frontend (Angular, React, or other technology)? [MongoDB Stitch](.//mongodb/modern-application-stack-part-1-introducing-the-mean-stack ‚ÄúBackend as a Service for MongoDB‚Äù) is that service, it&#8217;s a new backend as a service (BaaS) for applications usinf MongoDB.</p>
<p>The purpose of this post is to introduce what MongoDB Stitch is and, most importantly, demonstrate exactly how you use it ‚Äì both configuring your app through the Stitch backend UI, and invoking that app backend from your frontend code or other services. Note that MongoDB Stitch is currently in beta and so you should expect the UI to evolve over the coming weeks and months. The <a href="https://docs.mongodb.com/stitch/tutorials/" title="MongoDB Stitch BaaS tutorials">tutorials</a> in the <a href="https://docs.mongodb.com/stitch/" title="MongoDB Stitch BaaS documentation">Stitch documentation</a> provide always up-to-date examples for creating Stitch applications.</p>
<h2>What is MongoDB Stitch?</h2>
<p>MongoDB Stitch is a BaaS, giving developers a REST-like API (plus SDKs for JavaScript, iOS, and Android) to MongoDB, and composability with other services, backed by a robust permissioning system for configuring fine-grained data access controls.</p>
<p>Stitch allows developers to focus on building applications rather than on managing data manipulation code or service integration. As application and display logic continues to move into the frontend web and mobile tiers, the remaining backend is often dominated by code to handle storing and retrieving data from a database, enforcing security and data privacy, and integrating various services. MongoDB Stitch provides that same functionality declaratively, rather than using procedural boilerplate backend code.</p>
<p>The data access rules in MongoDB stitch are entirely declarative and designed to be expressive enough to handle any application, including sensitive data such as payment details. For a given collection, you can restrict what operations are permitted and what fields can be accessed ‚Äì according to user id, role, or custom criteria. Access can even be limited to specific aggregations ‚Äì allowing analysts to work with the data without exposing any individual&#8217;s private information.</p>
<p>If you already have data in MongoDB Atlas, you can start by safely exposing it to new applications via Stitch&#8217;s API ‚Äì perhaps allowing read access to specific fields. You can authenticate users through built-in integrations with auth providers.</p>
<p>In my <a href="./../../../mongodb/modern-application-stack-part-1-introducing-the-mean-stack/index.html" title="Building apps with the MEAN and MERN stacks">previous blog series</a>, I detailed how to work with the technologies that are typically used to make up a modern application backend: MongoDB for the database, Node.js to run the backend logic, and a framework such as Express to provide a REST API:</p>
<div id="attachment_4457" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/000_MEAN_MERN_Stack.png"><img fetchpriority="high" decoding="async" aria-describedby="caption-attachment-4457" src="./../../../wp-content/uploads/2017/09/000_MEAN_MERN_Stack-1024x450.png" alt="MEAN Stack and MERN Stack" width="480" height="211" class="size-large wp-image-4457" srcset="./../../../wp-content/uploads/2017/09/000_MEAN_MERN_Stack-1024x450.png 1024w, ./../../../wp-content/uploads/2017/09/000_MEAN_MERN_Stack-300x132.png 300w, ./../../../wp-content/uploads/2017/09/000_MEAN_MERN_Stack-768x338.png 768w, ./../../../wp-content/uploads/2017/09/000_MEAN_MERN_Stack.png 1819w" sizes="(max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4457" class="wp-caption-text">MEAN Stack and MERN Stack</p>
</div>
<p>Stitch, greatly simplifies your development and ops efforts for new applications by providing the entire backend as managed service. Even your frontend application code is simplified, as Stitch provides idiomatic SDKs for JavaScript, iOS, and Android ‚Äì so you don&#8217;t need to code HTTP requests directly. Further, the SDK/API isn&#8217;t limited to just accessing MongoDB data, you can also use it for any other service registered with your Stitch application backend.</p>
<div id="attachment_4458" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/00_MongoDB_Stitch_architecture.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4458" src="./../../../wp-content/uploads/2017/09/00_MongoDB_Stitch_architecture-562x1024.png" alt="MongoDB Stitch BaaS architecture" width="480" height="875" class="size-large wp-image-4458" srcset="./../../../wp-content/uploads/2017/09/00_MongoDB_Stitch_architecture-562x1024.png 562w, ./../../../wp-content/uploads/2017/09/00_MongoDB_Stitch_architecture-165x300.png 165w, ./../../../wp-content/uploads/2017/09/00_MongoDB_Stitch_architecture-768x1400.png 768w, ./../../../wp-content/uploads/2017/09/00_MongoDB_Stitch_architecture.png 1631w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4458" class="wp-caption-text">MongoDB Stitch BaaS architecture</p>
</div>
<h2>Building an application with MongoDB Stitch</h2>
<p>You can <a href="https://www.mongodb.com/cloud/stitch" title="MongoDB Stitch Backend as a Service for MongoDB">get started with MongoDB Stitch for free</a> ‚Äì use it with your free MongoDB Atlas cluster. If you already registered for MongoDB Atlas then you can create your MongoDB Stitch apps with your existing Atlas group.</p>
<h3>Creating your application in MongoDB Stitch</h3>
<p>The app that we&#8217;re building will record user check-ins (from FourSquare or an iOS app or an iOS Workflow applet) in MongoDB Atlas, and then make them visible to the user and their friends through a React/JavaScript web app.</p>
<p>As we work through the tutorial, no previous knowledge is assumed, but at points, you may need to refer back to the <a href="./../../../mongodb/modern-application-stack-part-1-introducing-the-mean-stack/index.html" title="MEAN &amp; MERN stacks">earlier blog series</a> (e.g. for details on <a href="./../../../mongodb/the-modern-application-stack-part-5-using-reactjs-es6-jsx-to-build-a-ui-the-rise-of-mern/index.html" title="ReactJS">creating a React application frontend</a>).</p>
<p>If you haven&#8217;t done so already, <a href="https://www.mongodb.com/cloud/atlas" title="MongoDB Atlas Database as a Service for MongoDB">create a new MongoDB Atlas cluster</a>, selecting the <em>M0</em> instance type for the free tier (if you already have an Atlas cluster, feel free to use that):</p>
<div id="attachment_4495" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/0100_Create_Atlas_cluster.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4495" src="./../../../wp-content/uploads/2017/09/0100_Create_Atlas_cluster-1024x652.png" alt="Creating a MongoDB Atlas cluster" width="480" height="306" class="size-large wp-image-4495" srcset="./../../../wp-content/uploads/2017/09/0100_Create_Atlas_cluster-1024x652.png 1024w, ./../../../wp-content/uploads/2017/09/0100_Create_Atlas_cluster-300x191.png 300w, ./../../../wp-content/uploads/2017/09/0100_Create_Atlas_cluster-768x489.png 768w, ./../../../wp-content/uploads/2017/09/0100_Create_Atlas_cluster.png 1320w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4495" class="wp-caption-text">Creating a MongoDB Atlas cluster</p>
</div>
<p>After the cluster has spun up, click on <em>Stitch Apps</em> and then <em>Create New Application</em>:</p>
<div id="attachment_4459" style="width: 885px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/01_Select_or_create_MongoDB_Stitch_App.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4459" src="./../../../wp-content/uploads/2017/09/01_Select_or_create_MongoDB_Stitch_App.png" alt="Create new MongoDB Stitch application" width="875" height="503" class="size-full wp-image-4459" srcset="./../../../wp-content/uploads/2017/09/01_Select_or_create_MongoDB_Stitch_App.png 875w, ./../../../wp-content/uploads/2017/09/01_Select_or_create_MongoDB_Stitch_App-300x172.png 300w, ./../../../wp-content/uploads/2017/09/01_Select_or_create_MongoDB_Stitch_App-768x441.png 768w" sizes="auto, (max-width: 875px) 100vw, 875px"></a><p id="caption-attachment-4459" class="wp-caption-text">Create new MongoDB Stitch application</p>
</div>
<p>Give the application a name and ensure that the correct Atlas cluster is selected:</p>
<div id="attachment_4460" style="width: 881px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/02_Create_MongoDB_Stitch_App.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4460" src="./../../../wp-content/uploads/2017/09/02_Create_MongoDB_Stitch_App.png" alt="Name your MongoDB Stitch BaaS appName your MongoDB Stitch BaaS app" width="871" height="511" class="size-full wp-image-4460" srcset="./../../../wp-content/uploads/2017/09/02_Create_MongoDB_Stitch_App.png 871w, ./../../../wp-content/uploads/2017/09/02_Create_MongoDB_Stitch_App-300x176.png 300w, ./../../../wp-content/uploads/2017/09/02_Create_MongoDB_Stitch_App-768x451.png 768w" sizes="auto, (max-width: 871px) 100vw, 871px"></a><p id="caption-attachment-4460" class="wp-caption-text">Name your MongoDB Stitch BaaS appName your MongoDB Stitch BaaS app</p>
</div>
<p>Once you&#8217;ve created the application, take a note of its <em>App ID</em> (in this example <code>trackme-pkjif</code>) as this will be needed by your application&#8217;s frontend:</p>
<div id="attachment_4461" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/03_Created_MongoDB_Stitch_app.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4461" src="./../../../wp-content/uploads/2017/09/03_Created_MongoDB_Stitch_app-1024x659.png" alt="MongoDB Stitch BaaS application details" width="480" height="309" class="size-large wp-image-4461" srcset="./../../../wp-content/uploads/2017/09/03_Created_MongoDB_Stitch_app-1024x659.png 1024w, ./../../../wp-content/uploads/2017/09/03_Created_MongoDB_Stitch_app-300x193.png 300w, ./../../../wp-content/uploads/2017/09/03_Created_MongoDB_Stitch_app-768x494.png 768w, ./../../../wp-content/uploads/2017/09/03_Created_MongoDB_Stitch_app.png 1162w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4461" class="wp-caption-text">MongoDB Stitch BaaS application details</p>
</div>
<h3>Backend database and rules</h3>
<p>Select the <em>mongodb-atlas</em> service, followed by the <em>Rules</em> tab ‚Äì this is where you define who can access what data from the MongoDB database:</p>
<div id="attachment_4462" style="width: 642px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/04_New_collection_rules.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4462" src="./../../../wp-content/uploads/2017/09/04_New_collection_rules.png" alt="MongoDB Stitch BaaS data rules" width="632" height="443" class="size-full wp-image-4462" srcset="./../../../wp-content/uploads/2017/09/04_New_collection_rules.png 632w, ./../../../wp-content/uploads/2017/09/04_New_collection_rules-300x210.png 300w" sizes="auto, (max-width: 632px) 100vw, 632px"></a><p id="caption-attachment-4462" class="wp-caption-text">MongoDB Stitch BaaS data rules</p>
</div>
<p>Set the database name to <code>trackme</code> and the collection to <code>checkins</code>:</p>
<div id="attachment_4463" style="width: 655px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/05_Collection_rule_names.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4463" src="./../../../wp-content/uploads/2017/09/05_Collection_rule_names.png" alt="MongoDB Stitch ‚Äì naming a collection" width="645" height="470" class="size-full wp-image-4463" srcset="./../../../wp-content/uploads/2017/09/05_Collection_rule_names.png 645w, ./../../../wp-content/uploads/2017/09/05_Collection_rule_names-300x219.png 300w" sizes="auto, (max-width: 645px) 100vw, 645px"></a><p id="caption-attachment-4463" class="wp-caption-text">MongoDB Stitch ‚Äì naming a collection</p>
</div>
<div id="attachment_4464" style="width: 589px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/06_Select_Collection.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4464" src="./../../../wp-content/uploads/2017/09/06_Select_Collection.png" alt="MongoDB Stitch - select collection" width="579" height="418" class="size-full wp-image-4464" srcset="./../../../wp-content/uploads/2017/09/06_Select_Collection.png 579w, ./../../../wp-content/uploads/2017/09/06_Select_Collection-300x217.png 300w" sizes="auto, (max-width: 579px) 100vw, 579px"></a><p id="caption-attachment-4464" class="wp-caption-text">MongoDB Stitch &#8211; select collection</p>
</div>
<p>A typical record from the <code>track.checkins</code> collection will look like this:</p>
<pre><code>db.checkins.find().sort({_id: -1}).skip(2).limit(1).pretty()
{
    "_id" : ObjectId("597f14fe4fdd1f5eb78e142f"),
    "owner_id" : "596ce3304fdd1f3e885999cb",
    "email" : "me@gmail.com",
    "venueName" : "Starbucks",
    "date" : "July 31, 2017 at 12:27PM",
    "url" : "http://4sq.com/LuzfAn",
    "locationImg" : "http://maps.google.com/maps/api/staticmap?center=51.522058,-0.722497&amp;zoom=16&amp;size=710x440&amp;maptype=roadmap&amp;sensor=false&amp;markers=color:red%7C51.522058,-0.722497&amp;key=AIzaSyC2e-2nWNBM0VZMERf2I6m_PLZE4R2qAoM"
}
</code></pre>
<p>Select the <em>Field Rules</em> tab and note the default read and write rules for the <em>Top-Level</em> document:</p>
<div id="attachment_4465" style="width: 632px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/07_Collection_write_rule.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4465" src="./../../../wp-content/uploads/2017/09/07_Collection_write_rule.png" alt="Defining a MongoDB Stitch write rule" width="622" height="603" class="size-full wp-image-4465" srcset="./../../../wp-content/uploads/2017/09/07_Collection_write_rule.png 622w, ./../../../wp-content/uploads/2017/09/07_Collection_write_rule-300x291.png 300w" sizes="auto, (max-width: 622px) 100vw, 622px"></a><p id="caption-attachment-4465" class="wp-caption-text">Defining a MongoDB Stitch write rule</p>
</div>
<p>The default read rule is:</p>
<pre><code>{
  "owner_id": "%%user.id"
}
</code></pre>
<p>With this configuration, a document can only be read from this collection if its <code>owner_id</code> field matches the <code>id</code> of the application user making the request (i.e. a user can only read their own data). <code>%%user</code> is an <a href="https://docs.mongodb.com/stitch/reference/expansions/">expansion</a> which gives the rule access to information about the application end-user making the request ‚Äì here we&#8217;re interested in their unique identifier (<code>id</code>). Whenever a user adds a document to a collection, Stitch will set the <code>owner_id</code> to the ID of that user.</p>
<p>Overwrite the write rule with the following, then press <em>SAVE</em>:</p>
<pre><code>{
  "%or": [
    {
      "%%prevRoot.owner_id": "%%user.id"
    },
    {
      "%%prevRoot": {
        "%exists": 0
      }
    }
  ]
}
</code></pre>
<p><a href="https://docs.mongodb.com/stitch/reference/expansions/" title="MongoDB Stitch expansions documentation"><code>%%prevRoot</code></a> is another expansion, representing the state of the document before the operation. You can read the above logic as: &#8220;Allow the write to succeed if either the the same user previously added the document or the document didn&#8217;t exist (i.e. it&#8217;s an insert)&#8221;.</p>
<p>In addition to general rules for the document, read/write rules can be added for individual fields. Select the <code>owner_id</code> field and ensure that the validation rule is set to:</p>
<pre><code>{
  "%or": [
    {
      "%%prev": "%%user.id"
    },
    {
      "%%prev": {
        "%exists": false
      }
    }
  ]
}
</code></pre>
<div id="attachment_4466" style="width: 636px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/08_Field_validation_rule.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4466" src="./../../../wp-content/uploads/2017/09/08_Field_validation_rule.png" alt="MongoDB Stitch field validation rule" width="626" height="655" class="size-full wp-image-4466" srcset="./../../../wp-content/uploads/2017/09/08_Field_validation_rule.png 626w, ./../../../wp-content/uploads/2017/09/08_Field_validation_rule-287x300.png 287w" sizes="auto, (max-width: 626px) 100vw, 626px"></a><p id="caption-attachment-4466" class="wp-caption-text">MongoDB Stitch field validation rule</p>
</div>
<p>Filters control which documents a user sees when viewing a collection:</p>
<div id="attachment_4467" style="width: 640px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/09_Leave_default_filters.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4467" src="./../../../wp-content/uploads/2017/09/09_Leave_default_filters.png" alt="MongoDB Stitch collection filter" width="630" height="419" class="size-full wp-image-4467" srcset="./../../../wp-content/uploads/2017/09/09_Leave_default_filters.png 630w, ./../../../wp-content/uploads/2017/09/09_Leave_default_filters-300x200.png 300w" sizes="auto, (max-width: 630px) 100vw, 630px"></a><p id="caption-attachment-4467" class="wp-caption-text">MongoDB Stitch collection filter</p>
</div>
<p>Ensure that <em>When</em> == <code>{"%%true": true}</code> and <em>Match Expression</em> == <code>{"owner_id": "%%user.id"}</code>.  This means that the filter is always applied and that a user will only see their own documents.</p>
<p>You should also add rules for the <code>trackme.users</code> collection, where a typical document will look like:</p>
<pre><code>&gt; db.users.findOne()
{
    "_id" : ObjectId("596e354f46224c3c723d968a"),
    "owner_id" : "596ce47c4fdd1f3e88599ac4",
    "userData" : {
        "email" : "andrew.morgan@mongodb.com",
        "name" : "Andrew Morgan",
        "picture" : "https://lh4.googleusercontent.com/-lCBSTZFxhw0/AAAAAAAAAAI/AAAAAAAAAB4/vX9Sg4dO8xE/photo.jpg"
    },
    "friends" : [
        "billy@gmail.com",
        "granny@hotmail.com"
    ]
}
</code></pre>
<p>Setup <code>trackme.users</code> with the same rules and filters as <code>trackme.checkins</code>.</p>
<h3>Values/constants</h3>
<p>Stitch provides a simple and secure way to store <a href="https://docs.mongodb.com/stitch/reference/values/">values</a> associated with your application ‚Äì a perfect example is your keys for public cloud services. Set up the following values:</p>
<div id="attachment_4468" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/10_define_values.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4468" src="./../../../wp-content/uploads/2017/09/10_define_values-1024x844.png" alt="Define MongoDB Stitch BaaS values" width="480" height="396" class="size-large wp-image-4468" srcset="./../../../wp-content/uploads/2017/09/10_define_values-1024x844.png 1024w, ./../../../wp-content/uploads/2017/09/10_define_values-300x247.png 300w, ./../../../wp-content/uploads/2017/09/10_define_values-768x633.png 768w, ./../../../wp-content/uploads/2017/09/10_define_values.png 1078w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4468" class="wp-caption-text">Define MongoDB Stitch BaaS values</p>
</div>
<p>By default, your WebHooks, named pipelines, and frontend application code can read the values. By setting the value to be private, you prevent access from your frontend code (or any other users of the Stitch API). The example <a href="https://github.com/am-MongoDB/trackme_MongoDB_Stitch/blob/master/src/text.checkin.component.js" title="ReactJS code to work with MongoDB Stitch">React frontend code</a> refers to the <code>twilioNumber</code> value (<code>%%values.twilioNumber</code>) when building a pipeline (if you wanted to keep the value more secure then you could implement a named pipeline to send the Twilio message and make <code>twilioNumber</code> private):</p>
<pre><code>this.props.stitchClient.executePipeline([
  {
    service: "myTwilio",
    action: "send",
    args: {
      to: this.state.textNumber,
      from: 
        "%%values.twilioNumber",  // Relies on twilioNumber not being private
      body: name + " last checked into " + venue
    }
  }
])
</code></pre>
<h3>Authentication providers</h3>
<p>A key feature of Stitch is authenticating your app‚Äôs end users ‚Äì after which you can configure precisely what data and services they‚Äôre entitled to access (e.g., to view documents that they created through their actions in the app). The following <a href="https://docs.mongodb.com/stitch/authentication/" title="MongoDB Stitch BaaS authentication documentation">types of authentication</a> are all supported:</p>
<ul>
<li>
<strong>Anonymous</strong> (the user doesn‚Äôt need to register or log in, but they‚Äôre still assigned an ID which is used to control what they see)</li>
<li><strong><a href="https://docs.mongodb.com/stitch/auth/email-auth/" title="MongoDB Stitch email/password authentication docs">Email/Password</a></strong></li>
<li><strong><a href="https://docs.mongodb.com/stitch/auth/google-auth/" title="MongoDB Stitch Google authentication docs">Google</a></strong></li>
<li><strong><a href="https://docs.mongodb.com/stitch/auth/facebook-auth/" title="MongoDB Stitch Facebook authentication docs">Facebook</a></strong></li>
<li>
<strong><a href="https://docs.mongodb.com/stitch/auth/custom-auth/" title="MongoDB Stitch custom authentication docs">Custom</a></strong> (using JSON web tokens)</li>
</ul>
<p>From the Authentication section of the Stitch UI, turn on Google authentication, providing the <em>Client ID</em> and <em>Client Secret</em> <a href="https://docs.mongodb.com/stitch/auth/google-auth/" title="&quot;MongoDB Stitch BaaS ‚Äì using Google authentication credentials">generated by Google</a>. If you are running your app on your local machine then add <code>http://localhost:3000/</code> as a <em>Redirect URI</em>; if hosting externally, add the DNS hostname. Enable <em>Name</em>, <em>Picture</em>, and <em>Email</em> so that your app has access to those user credentials from Google. Click <em>Save</em>.</p>
<div id="attachment_4469" style="width: 1009px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/11_Add_Google_authentication.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4469" src="./../../../wp-content/uploads/2017/09/11_Add_Google_authentication.png" alt="MongoDB Stitch BaaS ‚Äì adding Google authentication" width="999" height="641" class="size-full wp-image-4469" srcset="./../../../wp-content/uploads/2017/09/11_Add_Google_authentication.png 999w, ./../../../wp-content/uploads/2017/09/11_Add_Google_authentication-300x192.png 300w, ./../../../wp-content/uploads/2017/09/11_Add_Google_authentication-768x493.png 768w" sizes="auto, (max-width: 999px) 100vw, 999px"></a><p id="caption-attachment-4469" class="wp-caption-text">MongoDB Stitch BaaS ‚Äì adding Google authentication</p>
</div>
<p>Turn on Facebook authentication, providing the <em>Client ID</em> and <em>Client Secret</em> <a href="https://docs.mongodb.com/stitch/auth/facebook-auth/" title="Facebook authentication with MongoDB Stitch">generated by Facebook</a>. If you are running your app on your local machine then add <code>http://localhost:3000/</code> as a <em>Redirect URI</em>; if hosting externally, add the DNS hostname. Enable <em>Name</em>, <em>Picture</em>, and <em>Email</em> so that your app has access to those user credentials from Facebook. Click <em>Save</em>.</p>
<div id="attachment_4470" style="width: 859px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/12_Add_Facebook_authentication.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4470" src="./../../../wp-content/uploads/2017/09/12_Add_Facebook_authentication.png" alt="MongoDB Stitch BaaS - adding Facebook authentication" width="849" height="643" class="size-full wp-image-4470" srcset="./../../../wp-content/uploads/2017/09/12_Add_Facebook_authentication.png 849w, ./../../../wp-content/uploads/2017/09/12_Add_Facebook_authentication-300x227.png 300w, ./../../../wp-content/uploads/2017/09/12_Add_Facebook_authentication-768x582.png 768w" sizes="auto, (max-width: 849px) 100vw, 849px"></a><p id="caption-attachment-4470" class="wp-caption-text">MongoDB Stitch BaaS &#8211; adding Facebook authentication</p>
</div>
<div id="attachment_4471" style="width: 996px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/13_No_other_auth_providers.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4471" src="./../../../wp-content/uploads/2017/09/13_No_other_auth_providers.png" alt="MongoDB Stitch BaaS authentication providers" width="986" height="563" class="size-full wp-image-4471" srcset="./../../../wp-content/uploads/2017/09/13_No_other_auth_providers.png 986w, ./../../../wp-content/uploads/2017/09/13_No_other_auth_providers-300x171.png 300w, ./../../../wp-content/uploads/2017/09/13_No_other_auth_providers-768x439.png 768w" sizes="auto, (max-width: 986px) 100vw, 986px"></a><p id="caption-attachment-4471" class="wp-caption-text">MongoDB Stitch BaaS authentication providers</p>
</div>
<h3>Adding other services (Slack &amp; Twilio)</h3>
<p>Stitch has some services pre-integrated, for others, you can use the <a href="https://docs.mongodb.com/stitch/services/http/" title="MongoDB Stitch HTTP service">HTTP Service</a>.</p>
<p>When a user checks in, a notification will be sent to a Slack channel using Stitch‚Äôs [Slack Service](https://docs.mongodb.com/stitch/services/slack/ &#8220;MongoDB Stitch Slack service). Click on <em>Add Service</em> and then select <em>Slack</em>, name the service <code>mySlack</code> (your pipelines and WebHooks can refer to the service using that name), and then click <em>Add service</em>.</p>
<div id="attachment_4472" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/14_Add_Slack.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4472" src="./../../../wp-content/uploads/2017/09/14_Add_Slack-1024x739.png" alt="MongoDB Stitch, adding Slack service" width="480" height="346" class="size-large wp-image-4472" srcset="./../../../wp-content/uploads/2017/09/14_Add_Slack-1024x739.png 1024w, ./../../../wp-content/uploads/2017/09/14_Add_Slack-300x217.png 300w, ./../../../wp-content/uploads/2017/09/14_Add_Slack-768x555.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4472" class="wp-caption-text">MongoDB Stitch, adding Slack service</p>
</div>
<p>In the <em>Config</em> tab, enter the <em>Team ID</em> and <em>Incoming WebhookURL</em> <a href="https://docs.mongodb.com/stitch/services/slack/#set-up-slack" title="MongoDB Stitch Slack docs">provided by Slack</a>:</p>
<div id="attachment_4473" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/15_Configure_Slack.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4473" src="./../../../wp-content/uploads/2017/09/15_Configure_Slack-1024x638.png" alt="MongoDB Stitch configuring Slack service" width="480" height="299" class="size-large wp-image-4473" srcset="./../../../wp-content/uploads/2017/09/15_Configure_Slack-1024x638.png 1024w, ./../../../wp-content/uploads/2017/09/15_Configure_Slack-300x187.png 300w, ./../../../wp-content/uploads/2017/09/15_Configure_Slack-768x479.png 768w, ./../../../wp-content/uploads/2017/09/15_Configure_Slack.png 1482w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4473" class="wp-caption-text">MongoDB Stitch configuring Slack service</p>
</div>
<p>There is no need to add any WebHooks (the app will send out Slack messages but will not receive any). On the <em>Rules</em> tab, enable <em>Post</em> (as the Stitch app must use the HTTP POST method to send messages to Stitch‚Äôs API), and then <em>Save</em>:</p>
<div id="attachment_4474" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/16_Slack_rules.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4474" src="./../../../wp-content/uploads/2017/09/16_Slack_rules-1024x523.png" alt="MongoDB Stitch adding Slack rules" width="480" height="245" class="size-large wp-image-4474" srcset="./../../../wp-content/uploads/2017/09/16_Slack_rules-1024x523.png 1024w, ./../../../wp-content/uploads/2017/09/16_Slack_rules-300x153.png 300w, ./../../../wp-content/uploads/2017/09/16_Slack_rules-768x393.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4474" class="wp-caption-text">MongoDB Stitch adding Slack rules</p>
</div>
<p>From the React web app, a logged-in user has the option to send an SMS text message, containing their latest check-in, to a phone number of their choice. To enable that service, you must configure the <a href="https://docs.mongodb.com/stitch/services/twilio/" title="MongoDB Stitch Twilio service docs">Twilio Service</a> through the Slack UI:</p>
<div id="attachment_4475" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/17_Configure_Twilio.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4475" src="./../../../wp-content/uploads/2017/09/17_Configure_Twilio-1024x642.png" alt="MongoDB Stitch, configuring Twilio service" width="480" height="301" class="size-large wp-image-4475" srcset="./../../../wp-content/uploads/2017/09/17_Configure_Twilio-1024x642.png 1024w, ./../../../wp-content/uploads/2017/09/17_Configure_Twilio-300x188.png 300w, ./../../../wp-content/uploads/2017/09/17_Configure_Twilio-768x481.png 768w, ./../../../wp-content/uploads/2017/09/17_Configure_Twilio.png 1544w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4475" class="wp-caption-text">MongoDB Stitch, configuring Twilio service</p>
</div>
<p>The values to use for the <em>SSID</em> and the <em>Auth Token</em> can be retrieved after <a href="https://docs.mongodb.com/stitch/services/twilio/" title="Twilio docs for MongoDB Stitch">registering with Twilio</a>. As with Slack, the app will not accept incoming messages from Twilio, and so there is no need to define any incoming WebHooks. In the <em>Rules</em> tab, enable the <em>Send</em> action and click <em>Save</em>:</p>
<div id="attachment_4476" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/18_Twilio_Rules.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4476" src="./../../../wp-content/uploads/2017/09/18_Twilio_Rules-1024x525.png" alt="Configure Twilio rules in MongoDB Stitch" width="480" height="246" class="size-large wp-image-4476" srcset="./../../../wp-content/uploads/2017/09/18_Twilio_Rules-1024x525.png 1024w, ./../../../wp-content/uploads/2017/09/18_Twilio_Rules-300x154.png 300w, ./../../../wp-content/uploads/2017/09/18_Twilio_Rules-768x394.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4476" class="wp-caption-text">Configure Twilio rules in MongoDB Stitch</p>
</div>
<h3>Named service pipelines</h3>
<p>Service <a href="https://docs.mongodb.com/stitch/pipelines/" title="MongoDB Stitch service pipelines docs">pipelines</a> are used to execute a sequence of actions. As with the Stitch features you‚Äôve already seen, pipelines are defined using JSON documents. You can create pipelines on the fly in your application code, or you can preconfigure <a href="https://docs.mongodb.com/stitch/reference/namedpipelines/" title="MongoDB Stitch named pipelines docs">Named Pipelines</a>. The advantages of named pipelines are:</p>
<ul>
<li>Code reuse: you can create the named pipeline once in the Stich backend, and then invoke it from multiple frontend locations (e.g., from multiple places in a web app, as well as from iOS and Android apps).</li>
<li>Simpler code: keep the frontend application code clean by hiding the pipeline‚Äôs details in the Stitch backend.</li>
<li>Enhanced security: access to secret resources, such as API keys, can be encapsulated within the Stitch backend. The alternative is to code them in the device-side code, where a user may attempt to reverse-engineer them.</li>
</ul>
<p>When creating a named pipeline, there is a set of information you must always provide:</p>
<ul>
<li>The <strong>name</strong> of the pipeline. The name is how your frontend application code, WebHooks, or other named pipelines can execute this pipeline.</li>
<li>Whether the pipeline is <strong>private</strong>. If set to <code>true</code>, you can only invoke the pipeline from within the Stitch backend (from another named pipeline or a WebHook). If set to <code>false</code> then you can also invoke it directly from your application‚Äôs frontend code (or from Stitch‚Äôs <em>Debug Console</em>).</li>
<li>If a service accessed by your pipeline would otherwise be blocked by that resource‚Äôs rules (e.g. a MongoDB document only being readable by the user that created it), enabling <em>Skip Rules</em> overrides those rules.</li>
<li>You can control under what scenarios a pipeline is allowed to run by providing a JSON document ‚Äì if it evaluates to <code>true</code> then the pipeline can run. </li>
<li>You can define a set of <strong>Parameters</strong> that you can provide when invoking the pipeline. You can also tag as <strong>Required</strong>, those parameters which you must always provide.</li>
<li>The <strong>Output Type</strong> indicates whether the pipeline will return a <em>Single Document</em>, <em>Boolean</em>, or <em>Array</em>.</li>
<li>The rest of the pipeline definition consists of one or more stages, where each stage passes its results as input to the next. For each stage, you define:
<ul>
<li>Which <strong>Service</strong> to use (e.g. MongoDB, Twilio, Slack, or <em>built-in</em> (such as expressions, or literals))</li>
<li>The <strong>Action</strong> associated with that service (e.g. for a MongoDB service, you might pick <code>find</code> or <code>insert</code>)</li>
<li>The body of the action</li>
<li>
<strong>Bind Data to %%Vars</strong> lets you create variables based on other values. When defining the value of one of these variables, you can use expansions such as:
<ul>
<li>
<strong><code>%%args.parameter-name</code></strong> to access parameters passed to the pipeline</li>
<li>
<strong><code>%%item.field-name</code></strong> to access the results of the previous stage</li>
<li>
<strong><code>%%values.value-name</code></strong> to access pre-defined values/constants</li>
</ul>
</li>
<li>You can access the variable values from the <em>Action</em> document using <code>%%vars.variable-name</code>.</li>
</ul>
</li>
</ul>
<p>The first pipeline to create is <code>recentCheckins</code> which returns an array of the user‚Äôs most recent check-ins. When invoking the pipeline, the caller must provide a single parameter (<code>number</code>) which specifies how many check-ins it should return:</p>
<div id="attachment_4477" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/19_recentCheckins_pipeline.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4477" src="./../../../wp-content/uploads/2017/09/19_recentCheckins_pipeline-1024x891.png" alt="Creating MongoDB Stitch named pipeline" width="480" height="418" class="size-large wp-image-4477" srcset="./../../../wp-content/uploads/2017/09/19_recentCheckins_pipeline-1024x891.png 1024w, ./../../../wp-content/uploads/2017/09/19_recentCheckins_pipeline-300x261.png 300w, ./../../../wp-content/uploads/2017/09/19_recentCheckins_pipeline-768x668.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4477" class="wp-caption-text">Creating MongoDB Stitch named pipeline</p>
</div>
<p>Note that the <code>trackme.checkins</code> collection already includes filters and rules to ensure that a user only sees their own check-ins and so the <code>query</code> subdocument can be empty.</p>
<p>Create the pipeline by pasting in the <em>Action</em> and <em>Bind Data To %%Vars</em> documents:</p>
<p><em>Action</em>:</p>
<pre><code>{
  "database": "trackme",
  "collection": "checkins",
  "query": {},
  "sort": {
    "_id": -1
  },
  "project": {},
  "limit": "%%vars.limit"
}
</code></pre>
<p>If you&#8217;re not familiar with the <a href="https://docs.mongodb.com/manual/tutorial/query-documents/" title="MongoDB query language docs">MongoDB Query Language</a>, this searches the <code>trackme.checkins</code> collection, reverse sorts on the <code>_id</code> (most recently inserted documents have the highest value), and then discards all but the first <code>%%vars.limit</code> documents.</p>
<p><em>Bind Data To %%Vars</em>:</p>
<pre><code>{
  "limit": "%%args.number"
}
</code></pre>
<p>This creates a <code>LET</code> statement where <code>%%vars.limit</code> is bound to the <code>number</code> parameter which the caller passes to the pipeline.</p>
<p>The second named pipeline to define is <code>friendsCheckins</code> to retrieve the most recent check-ins of users who have befriended the current user. Again, the caller must provide a parameter indicating the total number of check-ins it should return:</p>
<div id="attachment_4478" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/20_friendsCheckins_pipeline.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4478" src="./../../../wp-content/uploads/2017/09/20_friendsCheckins_pipeline-1024x756.png" alt="Define friendsCheckin named pipeline in MongoDB Stitch" width="480" height="354" class="size-large wp-image-4478" srcset="./../../../wp-content/uploads/2017/09/20_friendsCheckins_pipeline-1024x756.png 1024w, ./../../../wp-content/uploads/2017/09/20_friendsCheckins_pipeline-300x221.png 300w, ./../../../wp-content/uploads/2017/09/20_friendsCheckins_pipeline-768x567.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4478" class="wp-caption-text">Define friendsCheckin named pipeline in MongoDB Stitch</p>
</div>
<p>Create the pipeline by pasting in the <em>Action</em> and <em>Bind Data To %%Vars</em> documents:</p>
<p><em>Action</em>:</p>
<pre><code>{
  "database": "trackme",
  "collection": "users",
  "pipeline": [
    {
      "$match": {
        "owner_id": "%%vars.owner_id"
      }
    },
    {
      "$project": {
        "userData.email": 1,
        "_id": 0
      }
    },
    {
      "$lookup": {
        "from": "users",
        "localField": "userData.email",
        "foreignField": "friends",
        "as": "friendedMe"
      }
    },
    {
      "$project": {
        "friendedMe.owner_id": 1
      }
    },
    {
      "$unwind": {
        "path": "$friendedMe"
      }
    },
    {
      "$lookup": {
        "from": "checkins",
        "localField": "friendedMe.owner_id",
        "foreignField": "owner_id",
        "as": "friendsCheckins"
      }
    },
    {
      "$project": {
        "friendsCheckins": 1
      }
    },
    {
      "$unwind": {
        "path": "$friendsCheckins"
      }
    },
    {
      "$sort": {
        "friendsCheckins._id": -1
      }
    },
    {
      "$limit": "%%vars.number"
    },
    {
      "$group": {
        "_id": "$friendsCheckins.email",
        "checkins": {
          "$push": {
            "venueName": "$friendsCheckins.venueName",
            "date": "$friendsCheckins.date",
            "url": "$friendsCheckins.url",
            "locationImg": "$friendsCheckins.locationImg"
          }
        }
      }
    }
  ]
}
</code></pre>
<p>If you‚Äôre not familiar with the format of this action, take a look at the <a href="https://docs.mongodb.com/manual/core/aggregation-pipeline/" title="MongoDB aggregation pipeline docs">MongoDB Aggregation Pipeline</a>.</p>
<p><em>Bind Data To %%Vars</em>:</p>
<pre><code>{
  "number": "%%args.number",
  "owner_id": "%%user.id"
}
</code></pre>
<p>As before, this makes the values passed in as parameters accessible to the pipeline&#8217;s action section.</p>
<p>Before letting the user add a new email address to their array of friends, it&#8217;s useful if you check that they aren&#8217;t already friends:</p>
<div id="attachment_4479" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/21_alreadyAFriend_pipeline.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4479" src="./../../../wp-content/uploads/2017/09/21_alreadyAFriend_pipeline-1024x733.png" alt="Define the alreadyAFriend named pipeline in MongoDB Stitch" width="480" height="344" class="size-large wp-image-4479" srcset="./../../../wp-content/uploads/2017/09/21_alreadyAFriend_pipeline-1024x733.png 1024w, ./../../../wp-content/uploads/2017/09/21_alreadyAFriend_pipeline-300x215.png 300w, ./../../../wp-content/uploads/2017/09/21_alreadyAFriend_pipeline-768x550.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4479" class="wp-caption-text">Define the alreadyAFriend named pipeline in MongoDB Stitch</p>
</div>
<p><em>Action</em>:</p>
<pre><code>{
  "database": "trackme",
  "collection": "users",
  "query": {
    "friends": "%%vars.email"
  }
}
</code></pre>
<p>Because of the filter on the <code>trackme.users</code> collection, <code>find</code> operation will only look at this user, and so all the query needs to do is check if the provided email address already exists in the document&#8217;s array of friends.</p>
<p>Bind Data To %%Vars:</p>
<pre><code>{
  "email": "%%args.friendsEmail"
}
</code></pre>
<p>Once your application has checked that the requested friend isn&#8217;t already listed, you can call the <code>addFrriend</code> pipeline to add their email address:</p>
<div id="attachment_4480" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/22_addFriend_pipeline.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4480" src="./../../../wp-content/uploads/2017/09/22_addFriend_pipeline-1024x761.png" alt="Define the addFriend named pipeline in MongoDB Stitch" width="480" height="357" class="size-large wp-image-4480" srcset="./../../../wp-content/uploads/2017/09/22_addFriend_pipeline-1024x761.png 1024w, ./../../../wp-content/uploads/2017/09/22_addFriend_pipeline-300x223.png 300w, ./../../../wp-content/uploads/2017/09/22_addFriend_pipeline-768x570.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4480" class="wp-caption-text">Define the addFriend named pipeline in MongoDB Stitch</p>
</div>
<p><em>Action</em>:</p>
<pre><code>{
  "database": "trackme",
  "collection": "users",
  "query": {},
  "update": {
    "$push": {
      "friends": "%%vars.email"
    }
  },
  "upsert": false,
  "multi": false
}
</code></pre>
<p><em>Bind Data To %%Vars</em>:</p>
<pre><code>{
  "email": "%%args.friendsEmail"
}
</code></pre>
<p>When a user checks in through FourSquare or our iOS Workflow app, we identify them by their email address rather than their <code>owner_id</code>; the <code>ownerFromEmail</code> pipeline retrieves the user&#8217;s <code>owner_id</code> using the <code>email</code> parameter:</p>
<div id="attachment_4481" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/23_ownerFromEmail_pipeline.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4481" src="./../../../wp-content/uploads/2017/09/23_ownerFromEmail_pipeline-1024x766.png" alt="Define the ownerFromEmail named pipeline in MongoDB Stitch" width="480" height="359" class="size-large wp-image-4481" srcset="./../../../wp-content/uploads/2017/09/23_ownerFromEmail_pipeline-1024x766.png 1024w, ./../../../wp-content/uploads/2017/09/23_ownerFromEmail_pipeline-300x224.png 300w, ./../../../wp-content/uploads/2017/09/23_ownerFromEmail_pipeline-768x574.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4481" class="wp-caption-text">Define the ownerFromEmail named pipeline in MongoDB Stitch</p>
</div>
<p>Note that <em>Skip Rules</em> is enabled for the pipeline, so that it&#8217;s able to search all documents in the <code>trackme.users</code> collection. For extra security, we make it <em>Private</em> so that it can only be executed by other pipelines or WebHooks that we create.</p>
<p><em>Action</em>:</p>
<pre><code>{
  "database": "trackme",
  "collection": "users",
  "query": {
    "userData.email": "%%vars.email"
  },
  "project": {
    "_id": 0,
    "owner_id": 1
  },
  "limit": 1
}
</code></pre>
<p><em>Bind Data To %%Vars</em>:</p>
<pre><code>{
  "email": "%%args.email"
}
</code></pre>
<p>When a user checks in, we want to send a notification to our Slack channel ‚Äì create the <code>slackCheckin</code> pipeline to do so:</p>
<div id="attachment_4482" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/24_slackCheckin_pipeline.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4482" src="./../../../wp-content/uploads/2017/09/24_slackCheckin_pipeline-1024x836.png" alt="Define the slackCheckin named pipeline in MongoDB Stitch" width="480" height="392" class="size-large wp-image-4482" srcset="./../../../wp-content/uploads/2017/09/24_slackCheckin_pipeline-1024x836.png 1024w, ./../../../wp-content/uploads/2017/09/24_slackCheckin_pipeline-300x245.png 300w, ./../../../wp-content/uploads/2017/09/24_slackCheckin_pipeline-768x627.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4482" class="wp-caption-text">Define the slackCheckin named pipeline in MongoDB Stitch</p>
</div>
<p>The pipeline uses the <code>mySlack</code> service that we created earlier. Again, set it to <em>Private</em> so that it can only be called from other WebHooks or named pipelines.</p>
<p><em>Action</em>:</p>
<pre><code>{
  "channel": "trackme",
  "username": "%%vars.name",
  "text": "%%vars.text",
  "iconUrl": "%%values.stitchLogo"
}
</code></pre>
<p><em>Bind Data To %%Vars</em>:</p>
<pre><code>{
  "name": "%%args.email",
  "text": {
    "%concat": [
      "I just checked into ",
      "%%args.venue",
      ". ",
      "%%args.location"
    ]
  }
}
</code></pre>
<h3>Working with other services ‚Äì the HTTP service and WebHooks</h3>
<p>The HTTP service fulfills two roles:</p>
<ul>
<li>Makes outgoing HTTP calls to services (either public web services or your microservices)</li>
<li>Accepts incoming HTTP requests (through Stitch WebHooks) ‚Äì allowing external services to trigger actions within your Stitch application</li>
</ul>
<p>The TrackMe application uses WebHooks to receive notifications whenever one of our users checks in through FourSquare or the iOS Workflow app.</p>
<p>Create a new HTTP service called <code>externalCheckin</code>:</p>
<div id="attachment_4483" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/25_Add_http_service.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4483" src="./../../../wp-content/uploads/2017/09/25_Add_http_service-1024x776.png" alt="Create externalCheckin HTTP service in MongoDB Stitch" width="480" height="364" class="size-large wp-image-4483" srcset="./../../../wp-content/uploads/2017/09/25_Add_http_service-1024x776.png 1024w, ./../../../wp-content/uploads/2017/09/25_Add_http_service-300x227.png 300w, ./../../../wp-content/uploads/2017/09/25_Add_http_service-768x582.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4483" class="wp-caption-text">Create externalCheckin HTTP service in MongoDB Stitch</p>
</div>
<p>There&#8217;s no need to define any (outgoing) rules as our application doesn&#8217;t use this service to send out any requests.</p>
<p>Create the <code>fourSquareCheckin</code> WebHook:</p>
<div id="attachment_4485" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/26_FourSquare_Checkin_WebHook.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4485" src="./../../../wp-content/uploads/2017/09/26_FourSquare_Checkin_WebHook-1024x846.png" alt="Define fourSquareCheckin WebHook in MongoDB Stitch" width="480" height="397" class="size-large wp-image-4485" srcset="./../../../wp-content/uploads/2017/09/26_FourSquare_Checkin_WebHook-1024x846.png 1024w, ./../../../wp-content/uploads/2017/09/26_FourSquare_Checkin_WebHook-300x248.png 300w, ./../../../wp-content/uploads/2017/09/26_FourSquare_Checkin_WebHook-768x635.png 768w, ./../../../wp-content/uploads/2017/09/26_FourSquare_Checkin_WebHook.png 1453w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4485" class="wp-caption-text">Define fourSquareCheckin WebHook in MongoDB Stitch</p>
</div>
<p>To prevent another application sending your application bogus check-ins, enable <em>Require Secret As Query Param</em> and provide a secret (I&#8217;ve used <code>667</code>, but for a production app, you&#8217;d want a stronger secret).</p>
<p>The WebHook consists of two stages. The first stage (Stage 0) uses the <em>built-in</em> <em>expression</em> action to build a JSON document containing the check-in data. Note that we form the <code>locationImg</code> field by adding our <code>GoogleMapsStaticKey</code> value to the end of the received URL (so that the new URL can be used by the frontend application code to retrieve the map image from Google).</p>
<p><em>Action (first stage)</em>:</p>
<pre><code>{
  "expression": {
    "owner_id": "%%vars.owner.owner_id",
    "email": "%%vars.email",
    "venueName": "%%vars.venue",
    "date": "%%vars.date",
    "url": "%%vars.url",
    "locationImg": {
      "%concat": [
        "%%vars.location",
        "&amp;key=",
        "%%values.GoogleMapsStaticKey"
      ]
    }
  }
}
</code></pre>
<p>When creating the variables to construct the expression, <code>%%vars.owner</code> is formed by invoking our <code>ownerFromEmail</code> named pipeline ‚Äì passing in the received <code>email</code> address from the received HTTP body.</p>
<p><em>Bind Data To %%Vars (first stage)</em>:</p>
<pre><code>{
  "owner": {
    "%pipeline": {
      "name": "ownerFromEmail",
      "args": {
        "email": "%%args.body.email"
      }
    }
  },
  "email": "%%args.body.email",
  "venue": "%%args.body.venue",
  "date": "%%args.body.checkinDate",
  "url": "%%args.body.url",
  "location": "%%args.body.location",
  "slackDummy": {
    "%pipeline": {
      "name": "slackCheckin",
      "args": {
        "email": "%%args.body.email",
        "venue": "%%args.body.venue",
        "location": {
          "%concat": [
            "%%args.body.location",
            "&amp;key=",
            "%%values.GoogleMapsStaticKey"
          ]
        }
     }
    }
  }
}
</code></pre>
<p>When defining the variables, we also create a dummy variable (<code>slackDummy</code>) so that we can invoke the <code>slackCheckin</code> pipeline as a side effect.</p>
<p>The second stage takes that document and stores it in the <code>trackme.checkins</code> collection.</p>
<p><em>Action (second stage)</em>:</p>
<pre><code>{
  "database": "trackme",
  "collection": "checkins"
}
</code></pre>
<p>Take a note of the WebHook URL (<code>https://stitch.mongodb.com/api/client/v1.0/app/trackme-pkjif/svc/externalCheckin/incomingWebhook/598081f44fdd1f5eb7900c16</code> in this example) as this is where other services must send requests.</p>
<p>The second WebHook (<code>appCheckin)</code> will be invoked from the iOS Workflow app; it&#8217;s very similar to  <code>fourSquareCheckin</code> but there&#8217;s no need to add the Google Maps key as for these check-ins, <code>locationImg</code> is the <a>Imgur</a> URL of a photo taken by the user at the venue.</p>
<div id="attachment_4486" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/27_appCheckin_WebHook.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4486" src="./../../../wp-content/uploads/2017/09/27_appCheckin_WebHook-1024x790.png" alt="Define appCheckin WebHook in MongoDB Stitch" width="480" height="370" class="size-large wp-image-4486" srcset="./../../../wp-content/uploads/2017/09/27_appCheckin_WebHook-1024x790.png 1024w, ./../../../wp-content/uploads/2017/09/27_appCheckin_WebHook-300x232.png 300w, ./../../../wp-content/uploads/2017/09/27_appCheckin_WebHook-768x593.png 768w, ./../../../wp-content/uploads/2017/09/27_appCheckin_WebHook.png 1451w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4486" class="wp-caption-text">Define appCheckin WebHook in MongoDB Stitch</p>
</div>
<p><em>Action (first stage)</em>:</p>
<pre><code>{
  "expression": {
    "owner_id": "%%vars.owner.owner_id",
    "email": "%%vars.email",
    "venueName": "%%vars.venue",
    "date": "%%vars.date",
    "url": "%%vars.url",
    "locationImg": "%%vars.location"
  }
}
</code></pre>
<p><em>Bind Data To %%Vars (first stage)</em>:</p>
<pre><code>{
  "owner": {
    "%pipeline": {
      "name": "ownerFromEmail",
      "args": {
        "email": "%%args.body.email"
      }
    }
  },
  "email": "%%args.body.email",
  "venue": "%%args.body.venue",
  "date": "%%args.body.date",
  "url": "%%args.body.url",
  "location": "%%args.body.location",
  "slackDummy": {
    "%pipeline": {
      "name": "slackCheckin",
      "args": {
        "email": "%%args.body.email",
        "venue": "%%args.body.venue",
        "location": {
          "%concat": [
            "%%args.body.location",
            "&amp;key=",
            "%%values.GoogleMapsStaticKey"
          ]
        }
      }
    }
  }
}
</code></pre>
<p><em>WebHook definition (second stage)</em>:</p>
<pre><code>{
  "database": "trackme",
  "collection": "checkins"
}
</code></pre>
<p>Take a note for the Webhook URL.</p>
<h2>Checking into the app using WebHooks</h2>
<h3>Capturing FourSquare check-ins (via IFTTT)</h3>
<p><a href="https://ifttt.com/" title="If This Then That">IFTTT</a> (If This Then That) is a free cloud service which allows you to automate tasks by combining existing services (Google Docs, Facebook, Instagram, Hue lights, Nest thermostats, GitHub, Trello, Dropbox,&#8230;). The name of the service comes from the simple pattern used for each Applet (automation rule): &#8220;<strong>IF T</strong>his event occurs in service x <strong>T</strong>hen trigger <strong>T</strong>hat action in service y&#8221;.</p>
<p>IFTTT includes a <a href="https://ifttt.com/maker_webhooks" title="Maker HTTP service in IFTTT">Maker</a> service which can handle web requests (triggers) or send web requests (actions). In this case, you can create an Applet to invoke our <code>fourSquareCheckin</code> WebHook whenever you check in using the Swarm (Foursquare) app:</p>
<div id="attachment_4487" style="width: 294px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/28_IFTTT_Applet.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4487" src="./../../../wp-content/uploads/2017/09/28_IFTTT_Applet-284x1024.png" alt="Define IFTTT applet for MongoDB Stitch app" width="284" height="1024" class="size-large wp-image-4487" srcset="./../../../wp-content/uploads/2017/09/28_IFTTT_Applet-284x1024.png 284w, ./../../../wp-content/uploads/2017/09/28_IFTTT_Applet-83x300.png 83w, ./../../../wp-content/uploads/2017/09/28_IFTTT_Applet.png 528w" sizes="auto, (max-width: 284px) 100vw, 284px"></a><p id="caption-attachment-4487" class="wp-caption-text">Define IFTTT applet for MongoDB Stitch app</p>
</div>
<p>Note that you form the URL: (<code>https://stitch.mongodb.com/api/client/v1.0/app/trackme-pkjif/svc/externalCheckin/incomingWebhook/598081f44fdd1f5eb7900c16?secret=667</code>) from the WebHook URL, with the addition of the <code>secret</code> parameter.</p>
<p>The HTTP method is set to POST and the body is a JSON document formed from several variables provided by the FourSquare service:</p>
<pre><code>{
    "email":"me@gmail.com",
    "venue":"{{VenueName}}",
    "checkinDate":"{{CheckinDate}}",
    "url":"{{VenueUrl}}",
    "location":"{{VenueMapImageUrl}}"
}
</code></pre>
<p>In this example, the email is hard-coded, and so all check-ins will be registered by the same user. A production application would need a better solution.</p>
<h3>Checking in from an iPhone (via the Workflow iOS app)</h3>
<p><a href="https://workflow.is/">iOS Workflow</a> has some similarities with IFTTT, but there are also some significant differences:</p>
<ul>
<li>Workflow runs on your iOS device rather than in the cloud.</li>
<li>You trigger Workflows by performing actions on your iOS device (e.g. pressing a button); external events from cloud service trigger IFTTT actions.</li>
<li>Workflow allows much more involved patterns than IFTTT; it can loop, invoke multiple services, perform calculations, access local resources (e.g. camera and location information) on your device, and much more.</li>
</ul>
<p>Implementing a Workflow involves dragging actions into the work area and then adding attributes to those actions (such as the URL for the TrackMe <code>appCheckin</code> WebHook). The result of one action is automatically used as the input to the next in the workflow. Results can also be stored in variables for use by later actions.</p>
<p>The TrackMe workflow:<br>
* Retrieve the current location from your device &amp; fetch details venue details<br>
* If the venue details isn&#8217;t a URL then fetch an Apple Maps URL<br>
* Take a new photo and upload it to Imgur<br>
* Create a URL to invoke Trackme (ending in <code>?secret=668</code>)<br>
* Perform an HTTP POST to this URL, including check-in details in the body</p>
<p>This is the Check In workflow:</p>
<div id="attachment_4487" style="width: 294px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/28_IFTTT_Applet.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4487" src="./../../../wp-content/uploads/2017/09/28_IFTTT_Applet-284x1024.png" alt="Define IFTTT applet for MongoDB Stitch app" width="284" height="1024" class="size-large wp-image-4487" srcset="./../../../wp-content/uploads/2017/09/28_IFTTT_Applet-284x1024.png 284w, ./../../../wp-content/uploads/2017/09/28_IFTTT_Applet-83x300.png 83w, ./../../../wp-content/uploads/2017/09/28_IFTTT_Applet.png 528w" sizes="auto, (max-width: 284px) 100vw, 284px"></a><p id="caption-attachment-4487" class="wp-caption-text">Define IFTTT applet for MongoDB Stitch app</p>
</div>
<p>You can see the Workflow applet in action here:</p>
<div id="attachment_4489" style="width: 202px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/29_iTrackMe_iOS.gif"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4489" src="./../../../wp-content/uploads/2017/09/29_iTrackMe_iOS.gif" alt="Trackme MongoDB Stitch iOS Workflow in action" width="192" height="338" class="size-full wp-image-4489"></a><p id="caption-attachment-4489" class="wp-caption-text">Trackme MongoDB Stitch iOS Workflow in action</p>
</div>
<p>Checking the <em>trackme</em> Slack channel confirms that the checkin was received. Note that you also check the results of the request in the *Logs * section of the <a href="https://stitch.mongodb.com/" title="MongoDB Stitch BaaS admin UI">Stitch Admin UI</a>.</p>
<div id="attachment_4492" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/32_Slacked_checkin.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4492" src="./../../../wp-content/uploads/2017/09/32_Slacked_checkin-1024x694.png" alt="Check-in data shown in Slack" width="480" height="325" class="size-large wp-image-4492" srcset="./../../../wp-content/uploads/2017/09/32_Slacked_checkin-1024x694.png 1024w, ./../../../wp-content/uploads/2017/09/32_Slacked_checkin-300x203.png 300w, ./../../../wp-content/uploads/2017/09/32_Slacked_checkin-768x521.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4492" class="wp-caption-text">Check-in data shown in Slack</p>
</div>
<h2>Building a frontend app using React</h2>
<p>In <a href="./../../../mongodb/the-modern-application-stack-part-5-using-reactjs-es6-jsx-to-build-a-ui-the-rise-of-mern/index.html" title="Building a webapp frontend with ReactJS">The Modern Application Stack &#8211; Part 5: Using ReactJS, ES6 &amp; JSX to Build a UI (the rise of MERN)</a>, I covered developing an application frontend using React. In this post, I don&#8217;t rehash the introduction to React, instead, I focus on how the React application interacts with its Stitch backend.</p>
<p>If you read my <a href="./../../../mongodb/the-modern-application-stack-part-5-using-reactjs-es6-jsx-to-build-a-ui-the-rise-of-mern/index.html" title="ReactJS web apps">earlier post</a> then you may recall that it included writing a data service to handle interactions with the backend (<a href="./../../../mongodb/the-modern-application-stack-part-5-using-reactjs-es6-jsx-to-build-a-ui-the-rise-of-mern/index.html" title="Mongopop app in ReactJS">Mongopop</a>) REST API; this isn&#8217;t required for the TrackMe frontend as the Stitch SDK provides access to the backend.</p>
<p>The TrackMe application frontend allows a user to:</p>
<ul>
<li>Log in using Google or Facebook authentication</li>
<li>View their most recent check-ins</li>
<li>View the most recent check-ins of users that have added them to their list of friends</li>
<li>Add another user to their list of friends</li>
<li>Use Twilio to send an SMS text to any number, containing the user&#8217;s latest check-in information</li>
</ul>
<p>Download the full application can from the <a href="https://github.com/am-MongoDB/trackme_MongoDB_Stitch"><em>trackme_MongoDB_Stitch</em> GitHub project</a>.</p>
<div id="attachment_4490" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/30_React_App_display.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4490" src="./../../../wp-content/uploads/2017/09/30_React_App_display-1024x961.png" alt="TrackMe ReactJS Web app frontend for MongoDB Stitch" width="480" height="450" class="size-large wp-image-4490" srcset="./../../../wp-content/uploads/2017/09/30_React_App_display-1024x961.png 1024w, ./../../../wp-content/uploads/2017/09/30_React_App_display-300x282.png 300w, ./../../../wp-content/uploads/2017/09/30_React_App_display-768x721.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4490" class="wp-caption-text">TrackMe ReactJS Web app frontend for MongoDB Stitch</p>
</div>
<p>To run the TrackMe frontend:</p>
<pre><code>git clone https://github.com/am-MongoDB/trackme_MongoDB_Stitch.git
cd trackme_MongoDB_Stitch
npm install
</code></pre>
<p>Edit the value of <code>appId</code> in <code>src/config.js</code>; replacing <code>trackme-xxxx</code> with the value for your Stitch app (found in the <em>Clients</em> tab in the Stitch console after creating your MongoDB Stitch app).</p>
<pre><code>npm start
</code></pre>
<h2>ReactJS Javascript (ES6) Client Code</h2>
<p>The application&#8217;s React frontend is made up of the <em>Trackme</em> component which embeds four sub-components:</p>
<div id="attachment_4493" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/33_ReactComponents.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4493" src="./../../../wp-content/uploads/2017/09/33_ReactComponents-1024x884.png" alt="React components making up the TrackMe web app" width="480" height="414" class="size-large wp-image-4493" srcset="./../../../wp-content/uploads/2017/09/33_ReactComponents-1024x884.png 1024w, ./../../../wp-content/uploads/2017/09/33_ReactComponents-300x259.png 300w, ./../../../wp-content/uploads/2017/09/33_ReactComponents-768x663.png 768w, ./../../../wp-content/uploads/2017/09/33_ReactComponents.png 1390w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4493" class="wp-caption-text">React components making up the TrackMe web app</p>
</div>
<p>Any Stitch JavaScript application must start by importing the Stitch SKD <code>StitchClient</code>. The code then uses  <code>StitchClient</code> to connect to MongoDB Stitch in the <em>Trackme</em> component&#8217;s constructor function within <a href="https://github.com/am-MongoDB/trackme_MongoDB_Stitch/blob/master/src/App.js" title="App.js React code"><code>App.js</code></a>. After instantiating <code>stitchClient</code>, it&#8217;s used to connect to the <code>trackme</code> database, followed by the <code>checkins</code>, and <code>user</code> collections:</p>
<pre><code>import { StitchClient } from 'mongodb-stitch';
import config from './config';
...
class Trackme extends React.Component {
  constructor(props) {
    super(props);
        ...
    this.appId = config.appId;
        ...
    let options = {};

    this.stitchClient = new StitchClient(this.appId, options);

    this.db = this.stitchClient.service("mongodb",
        "mongodb-atlas").db("trackme");

    this.checkins = this.db.collection("checkins");
    this.users = this.db.collection("users");
    }
...
}
</code></pre>
<p><code>stitchClient</code> is passed down to  <a href="https://github.com/am-MongoDB/trackme_MongoDB_Stitch/blob/master/src/login.component.js" title="Login component code for TrackMe React app"><code>src/login.component.js</code></a>, where a single line of code (<code>this.props.stitchClient.authWithOAuth("facebook")</code>) can be used to authenticate using Facebook:</p>
<pre><code>&lt;div
  onClick={() =&gt; 
    this.props.stitchClient.authWithOAuth("facebook")}
  className="signin-button"&gt;
  &lt;div className="facebook-signin-logo" /&gt;
  &lt;span className="signin-button-text"&gt;
    Sign in with Facebook
  &lt;/span&gt;
&lt;/div&gt;
</code></pre>
<p>The same component can use Google to authenticate in the same way:</p>
<pre><code>&lt;div
  onClick={() =&gt; 
    this.props.stitchClient.authWithOAuth("google")}
  className="signin-button"
&gt;
  ...
  &lt;span className="signin-button-text"&gt;
    Sign in with Google
  &lt;/span&gt;
&lt;/div&gt;
</code></pre>
<p>Whichever authentication method was used, common code displays the user&#8217;s name and avatar (in <a href="https://github.com/am-MongoDB/trackme_MongoDB_Stitch/blob/master/src/login.component.js" title="Login ReactJS component for TrackMe"><code>src/login.component.js</code></a>):</p>
<pre><code>this.props.stitchClient.userProfile()
.then(
  userData =&gt; {
    ...
    this.setState({userData: userData.data});
    ...
  },
  error =&gt; {
    // User hasn't authenticated yet
  })
...
{this.state.userData &amp;&amp; 
    this.state.userData.picture
  ? &lt;img src={this.state.userData.picture}
    className="profile-pic" alt="mug shot"/&gt;
  : null}
&lt;span className="login-text"&gt;
  &lt;span className="username"&gt;
    {this.state.userData &amp;&amp; this.state.userData.name 
      ? this.state.userData.name
      : "?"}
  &lt;/span&gt;
&lt;/span&gt;
</code></pre>
<p>Common code can logout the user (in <a href="https://github.com/am-MongoDB/trackme_MongoDB_Stitch/blob/master/src/login.component.js" title="Login component code"><code>src/login.component.js</code></a>):</p>
<pre><code>this.props.stitchClient.logout()
</code></pre>
<p>Once logged in, the application frontend can start making use of the services that we&#8217;ve configured for this app through the Stitch UI. In this case, we directly insert or update the user&#8217;s details in the <code>trackme.users</code> collection (in <a href="https://github.com/am-MongoDB/trackme_MongoDB_Stitch/blob/master/src/login.component.js" title="Login code for React MongoDB Stitch app"><code>src/login.component.js</code></a>):</p>
<pre><code>this.props.userCollection.updateOne(
  {},  /* We don't need to identify the 
        user in the query as the 
        pipeline's filter will handle
        that.*/
  { 
    $set: {
      owner_id: 
      this.props.stitchClient.authedId(),
      userData: userData.data
    }
  },
  {upsert: true})
.then(
  result=&gt;{},
  error=&gt;{console.log("Error: " + error)}
  );
</code></pre>
<p>While that code is using the Stitch SDK/API, it is invoking the MongoDB Atlas service in a traditional manner by performing an <code>updateOne</code> operation <strong>but</strong> the Stitch filters and rules we&#8217;ve configured for the <code>users</code> collection will still be enforced.</p>
<p>In this React application frontend, I have intentionally used a variety of different ways to interact with Stitch ‚Äì you will later see how to call a named pipeline and how to construct and execute a new pipeline on the fly.</p>
<p>When adding a new friend, two of the named pipelines we created through the Stitch UI (<code>alreadyAFriend</code> &amp; <code>addFriend</code>) are executed to add a new email address to the list if and only if it isn&#8217;t already there (<a href="https://github.com/am-MongoDB/trackme_MongoDB_Stitch/blob/master/src/addfriend.component.js" title="AddFriend component code for MongoDB Stitch app"><code>src/addfriend.component.js</code></a>):</p>
<pre><code>import { builtins } from 'mongodb-stitch';
...
this.props.stitchClient
  .executePipeline([
    builtins.namedPipeline('alreadyAFriend',
      {friendsEmail: email})])
  .then(
    response =&gt; {
      if (response.result[0]) {
        this.setState({error: email + 
          " has already been included as a friend."});
      } else
      {
        this.props.stitchClient
          .executePipeline([
            builtins.namedPipeline(
              'addFriend', {friendsEmail: email})])
          .then(
            response =&gt; {
              if (response.result[0]) {
                this.setState({success: 
                  email + " added as a friend; they can now see your checkins."});
              } else {
                this.setState({
                  error: "Failed to add " + email + " as a friend"});
              }
            },
            error =&gt; {
              this.setState({error: "Error: " + error});
              console.log({error: "Error: "+ error});
            }
          )
      }
    },
    error =&gt; {
      this.setState({error: "Error: " + error});
      console.log({error: "Error: " + error});
    }
  )
...
</code></pre>
<p><a href="https://github.com/am-MongoDB/trackme_MongoDB_Stitch/blob/master/src/text.checkin.component.js" title="Checkin component React code for MongoDB Stitch app"><code>src/text.checkin.component.js</code></a> finds the latest checkin (for this user), and then creates and executes a new service pipeline on the fly ‚Äì sending the venue name to the requested phone number via Twilio:</p>
<pre><code>this.props.checkins.find({},
  {sort: {_id: -1}, limit: 1})
.then (
  response =&gt; {
    venue = response[0].venueName;
    this.props.stitchClient.userProfile()
    .then (
      response =&gt; {
        name = response.data.name;
      })
    .then (
      response =&gt; {

        this.props.stitchClient
          .executePipeline([
            {
              service: "myTwilio",
              action: "send",
              args: {
                to: this.state.textNumber,
                from: "%%values.twilioNumber",
                body: name + " last cheked into " + venue
              }
            }
          ])
          .then(
            response =&gt; {
              this.setState({success: "Text has been sent to " +
                this.state.textNumber});
            },
            error =&gt; {
              this.setState({error: "Failed to send text: " + error});
              console.log({error: "Failed to send text: " + error});
          })
    })
  },
    error =&gt; {
    this.setState({error: "Failed to read the latest checkin: " + error});
    }
  )
</code></pre>
<p>Note that the pipeline refers to <code>%%values.twilioNumber</code> ‚Äì this is why that value couldn&#8217;t be tagged as <em>Private</em> within the Stitch UI.</p>
<p>This is the result:</p>
<div id="attachment_4491" style="width: 880px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/31_Text_message_from_Twilio.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4491" src="./../../../wp-content/uploads/2017/09/31_Text_message_from_Twilio.png" alt="Text message from Twilio ‚Äì via MongoDB Stitch" width="870" height="166" class="size-full wp-image-4491" srcset="./../../../wp-content/uploads/2017/09/31_Text_message_from_Twilio.png 870w, ./../../../wp-content/uploads/2017/09/31_Text_message_from_Twilio-300x57.png 300w, ./../../../wp-content/uploads/2017/09/31_Text_message_from_Twilio-768x147.png 768w" sizes="auto, (max-width: 870px) 100vw, 870px"></a><p id="caption-attachment-4491" class="wp-caption-text">Text message from Twilio ‚Äì via MongoDB Stitch</p>
</div>
<p>The checkins for the user and their friends are displayed in the <code>Checkins</code> component in <a href="https://github.com/am-MongoDB/trackme_MongoDB_Stitch/blob/master/src/checkins.component.js" title="Checkins ReactJS component for MongoDB Stitch app"><code>src/checkins.component.js</code></a>. The following code invokes the <code>recentCheckins</code> named pipeline (including the <code>number</code> parameter to request the 10 most recent checkins):</p>
<pre><code>this.props.stitchClient.executePipeline([
    builtins.namedPipeline('recentCheckins', {number: 10})])
  .then(
    checkinData =&gt; {
      this.setState({checkins: checkinData.result[0].map((checkin, index) =&gt; 
        &lt;li key={index}&gt;
          &lt;a href={checkin.url} target="_Blank"&gt;{checkin.venueName}&lt;/a&gt; ¬†
          ( {checkin.date} )
           &lt;br/&gt;
           &lt;img src={checkin.locationImg} className="mapImg" 
            alt={"map of " + checkin.venueName}/&gt;
        &lt;/li&gt;
      )})
    },
    error =&gt; {
      console.log("Failed to fetch checkin data: " + error)
  })
</code></pre>
<p>A similar code block executes the <code>friendsCheckin</code> named pipeline and then loops over each of the friends, displaying the latest checkins for each one:</p>
<pre><code>this.props.stitchClient
  .executePipeline([
    builtins.namedPipeline('friendsCheckins', {number: 10})])
  .then(
    friendData =&gt; {
      this.setState({friendsCheckins: 
        friendData.result[0].map((friend, friendIndex) =&gt;
          &lt;li key={friendIndex}&gt;
            &lt;strong&gt;{friend._id}&lt;/strong&gt;
            &lt;ul&gt;
              {friend.checkins.map((checkin) =&gt;
                &lt;li&gt;
                  &lt;a href={checkin.url} target="_Blank"&gt; {checkin.venueName}&lt;/a&gt;
                    ¬†( {checkin.date} ) &lt;br/&gt;
                    &lt;img src={checkin.locationImg} className="mapImg" 
                      alt={"map of " + checkin.venueName}/&gt;
                &lt;/li&gt;
              )}
            &lt;/ul&gt;
          &lt;/li&gt;
        )
      })
    },
    error =&gt; {
      console.log("Failed to fetch friends' data: " + error)
  })
</code></pre>
<h2>Continue accessing your data from existing applications (Amazon Alexa skill)</h2>
<p>Not every MongoDB Stitch use-case involves building a greenfield app on top of a brand new data set. It&#8217;s common that you already have a critical application, storing data in MongoDB, and you want to safely allow new apps or features to use some of that same data.</p>
<p>The good news is that your existing application can continue without any changes, and Stitch can be added to control access from any new applications. To illustrate this, you can reuse the <em>Mongo</em> Alexa Skill created in <a href="./../../../mongodb/rest-mobile-app-amazon-alexa-cloud-services/index.html" title="Writing an Amazon Alexa skill for MongoDB">my earlier post</a>. The JavaScript code needs a sight adjustment (due to a change I made to the schema) ‚Äì use <a href="https://github.com/am-MongoDB/trackme_MongoDB_Stitch/blob/master/alexa/index.js" title="Amazon Alexa skill for MongoDB Stitch data"><code>alexa/index.js</code></a>.</p>
<div id="attachment_4494" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/34_Alexa_stack.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4494" src="./../../../wp-content/uploads/2017/09/34_Alexa_stack-1024x607.png" alt="Architecture for Amazon Alexa reading data from MongoDB Atlas" width="480" height="285" class="size-large wp-image-4494" srcset="./../../../wp-content/uploads/2017/09/34_Alexa_stack-1024x607.png 1024w, ./../../../wp-content/uploads/2017/09/34_Alexa_stack-300x178.png 300w, ./../../../wp-content/uploads/2017/09/34_Alexa_stack-768x455.png 768w, ./../../../wp-content/uploads/2017/09/34_Alexa_stack.png 1880w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4494" class="wp-caption-text">Architecture for Amazon Alexa reading data from MongoDB Atlas</p>
</div>
<p>The Alexa skill uses the Express/Node.js REST API implemented in <a href="./../../../mongodb/the-modern-application-stack-part-3-building-a-rest-api-using-express-js/index.html" title="Building a REST API for MongoDB">The Modern Application Stack ‚Äì Part 3: Building a REST API Using Express.js</a>.</p>
<h2>Conclusion</h2>
<p>MongoDB Stitch lets you focus on building applications rather than on managing data manipulation code, service integration, or backend infrastructure. Whether you‚Äôre just starting up and want a fully managed backend as a service, or you‚Äôre part of an enterprise and want to expose existing MongoDB data to new applications, Stitch lets you focus on building the app users want, not on writing boilerplate backend logic.</p>
<p>In this post, you&#8217;ve learned how to:</p>
<ul>
<li>Create a new MongoDB Stitch app that lets you access data stored in MongoDB Atlas</li>
<li>Integrate with authentication providers such as Google and Facebook</li>
<li>Configure data access controls ‚Äì ensuring that application end-users can access just the information they&#8217;re entitled to</li>
<li>Enable access to the Slack, and Twilio services</li>
<li>Define constants/values that you can use securely within your application backend, without exposing them to your frontend code, or the outside world</li>
<li>Implement named pipelines to access MongoDB and your other services</li>
<li>Implement WebHooks that allow external services to trigger events in your application</li>
<li>Invoke your new WebHooks from other applications</li>
<li>Implement your application frontend in React/JavaScript
<ul>
<li>Authenticate users using Google and Facebook</li>
<li>Use the MongoDB Query Language to &#8220;directly&#8221; access your data through Stitch</li>
<li>Execute names pipelines</li>
<li>Create and run new pipelines on the fly</li>
</ul>
</li>
<li>Continue to access the same MongoDB data from existing apps, using the MongoDB drivers</li>
</ul>
<p>When revisiting the original blog series, it&#8217;s interesting to assess what work could you could save:</p>
<ul>
<li>Part 1: <a href="./../../../mongodb/modern-application-stack-part-1-introducing-the-mean-stack/index.html" title="MEAN and MERN application stacks">Introducing The MEAN Stack and the young MERN upstart</a>
<ul>
<li>This is an introductory chapter, much of it is still relevant when using Stitch.</li>
</ul>
</li>
<li>Part 2: <a href="./../../../mongodb/mean_stack_2_mongodb_node_js/index.html" title="Using MongoDB with Node.js">Using MongoDB With Node.js</a>
<ul>
<li>The work in this chapter isn‚Äôt needed as Stitch works with MongoDB Atlas directly, removing the need to use the <a href="https://mongodb.github.io/node-mongodb-native/" title="Node.js driver for MongoDB">MongoDB Driver for Node.JS</a>.</li>
</ul>
</li>
<li>Part 3: <a href="./../../../mongodb/the-modern-application-stack-part-3-building-a-rest-api-using-express-js/index.html" title="Building a REST API for MongoDB using Express">Building a REST API with Express.js</a>
<ul>
<li>This chapter isn‚Äôt needed as Stitch provides the SDK/REST API to access your MongoDB data (and other services).</li>
</ul>
</li>
<li>Part 4: <a href="./../../../mongodb/the-modern-application-stack-part-4-building-a-client-ui-using-angular-2-formerly-angularjs-typescript/index.html" title="Building a MongoDB app wiht Angular2">Building a Client UI Using Angular 2 (formerly AngularJS) &amp; TypeScript</a>
<ul>
<li>Much of this chapter is still relevant if you‚Äôre looking to build your application frontend using Angular2, but the work to implement the data service isn‚Äôt needed when working with MongoDB Stitch.</li>
</ul>
</li>
<li>Part 5: <a href="./../../../mongodb/the-modern-application-stack-part-5-using-reactjs-es6-jsx-to-build-a-ui-the-rise-of-mern/index.html" title="Build a ReactJS app for MongoDB">Using ReactJS, ES6 &amp; JSX to Build a UI (the rise of MERN)</a>
<ul>
<li>Much of this chapter is still relevant if you‚Äôre looking to code your application frontend using React, but the work to implement the data service isn‚Äôt needed when working with MongoDB Stitch.</li>
</ul>
</li>
<li>Part 6: <a href="./../../../mongodb/rest-mobile-app-amazon-alexa-cloud-services/index.html" title="Building Amazon Alexa and other apps for MongoDB">Browsers Aren‚Äôt the Only UI ‚Äì Mobile Apps, Amazon Alexa, Cloud Services</a>
<ul>
<li>Covers much of the same ground as this post. Some of the examples can be simplified when using MongoDB Stitch, and the extending of the REST API to add new features isn‚Äôt necessary when using Stitch.</li>
</ul>
</li>
</ul>
<p>The following table summarizes the steps required to build an application without without the help of Stitch:</p>
<div id="attachment_4496" style="width: 635px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/09/35_simpler_with_stitch.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4496" src="./../../../wp-content/uploads/2017/09/35_simpler_with_stitch.png" alt="Development steps skipped when using MongoDB Stitch" width="625" height="707" class="size-full wp-image-4496" srcset="./../../../wp-content/uploads/2017/09/35_simpler_with_stitch.png 625w, ./../../../wp-content/uploads/2017/09/35_simpler_with_stitch-265x300.png 265w" sizes="auto, (max-width: 625px) 100vw, 625px"></a><p id="caption-attachment-4496" class="wp-caption-text">Development steps skipped when using MongoDB Stitch</p>
</div>
<p>Both MongoDB Atlas and <a href="https://www.mongodb.com/cloud/stitch" title="MongoDB Stitch ‚Äì Backend as a Service for MongoDB) come with a free tier ‚Äì so go ahead and [try it out for yourself](https://www.mongodb.com/cloud/stitch &quot;Try MongoDB Stitch - free tier">MongoDB Stitch</a>.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/mongodb-stitch-the-latest-and-best-way-to-build-your-app" data-via="wpbeginner" data-text="MongoDB Stitch ‚Äì the latest, and best way to build your app" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/mongodb-stitch-the-latest-and-best-way-to-build-your-app"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/mongodb-stitch-the-latest-and-best-way-to-build-your-app" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Fmongodb-stitch-the-latest-and-best-way-to-build-your-app&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../../../category/mongodb/index.html" rel="category tag">MongoDB</a> | 
Tags: <a href="./../../baas/index.html" rel="tag">BaaS</a>, <a href="./../../mean/index.html" rel="tag">MEAN</a>, <a href="./../../mern/index.html" rel="tag">mern</a>, <a href="./../../mongodb/index.html" rel="tag">mongodb</a>, <a href="./../../mongodb-stitch/index.html" rel="tag">MongoDB Stitch</a>
</div>

			</div>			<div id="post-4444" class="post-4444 post type-post status-publish format-standard hentry category-mongodb tag-angular tag-express tag-expressjs tag-mean-stack tag-mern-stack tag-mongodb tag-node-js tag-react tag-reactjs">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../../../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../../../mongodb/webinar-replay-developing-with-the-modern-app-stack-mean-and-mern-with-angular2-and-reactjs/index.html">March 31, 2017</a>
			</div>
	<div class="postcomments">
		<a href="./../../../mongodb/webinar-replay-developing-with-the-modern-app-stack-mean-and-mern-with-angular2-and-reactjs/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../../../mongodb/webinar-replay-developing-with-the-modern-app-stack-mean-and-mern-with-angular2-and-reactjs/index.html" rel="bookmark">Webinar Replay: Developing with the modern App Stack: MEAN and MERN (with Angular2 and ReactJS)</a></h2>
				
				<div class="entry">
										<p>Earlier this week, I presented a webinar on developing web and mobile applications using the MERN and MEAN stacks ‚Äì the <a href="https://www.mongodb.com/presentations/webinar-developing-with-the-modern-app-stack-mean-and-mern-with-angular2-and-reactjs" title="developing web and mobile applications using the MERN and MEAN stacks">replay and slides are now available</a>.</p>
<p><a href="./../../../wp-content/uploads/2017/03/Logo.png"><img loading="lazy" decoding="async" src="./../../../wp-content/uploads/2017/03/Logo.png" alt="MEAN and MERN Stacks" width="570" height="293" class="aligncenter size-full wp-image-4442" srcset="./../../../wp-content/uploads/2017/03/Logo.png 570w, ./../../../wp-content/uploads/2017/03/Logo-300x154.png 300w" sizes="auto, (max-width: 570px) 100vw, 570px"></a></p>
<h3>Details</h3>
<p>Users increasingly demand a far richer experience from web applications ‚Äì expecting the same level of performance and interactivity they get with native desktop and mobile apps.</p>
<p>At the same time, there&#8217;s pressure on developers to deliver new applications faster and continually roll-out enhancements, while ensuring that the application is highly available and can be scaled appropriately when needed.</p>
<p>Fortunately, there‚Äôs a set of open source technologies using JavaScript that make all of this possible.</p>
<p>Join this webinar to learn about the two dominant JavaScript web app stacks ‚Äì MEAN (MongoDB, Express, Angular, Node.js) and MERN (MongoDB, Express, React, Node.js).</p>
<p>These technologies are also used outside of the browser ‚Äì delivering the best user experience, regardless of whether accessing your application from the desktop, from a mobile app, or even using your voice.</p>
<p>By attending the webinar, you will learn:</p>
<ul>
<li>What these technologies and how they‚Äôre used in combination:
<ul>
<li>NodeJS</li>
<li>MongoDB</li>
<li>Express</li>
<li>Angular2</li>
<li>ReactJS</li>
</ul>
</li>
<li>How to get started building your own apps using these stacks</li>
<li>Some of the decisions to take:
<ul>
<li>Angular vs Angular2 vs ReactJS</li>
<li>Javascript vs ES6 vs Typescript</li>
<li>What should be implemented in the front-end vs the back-end</li>
</ul>
</li>
</ul>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/webinar-replay-developing-with-the-modern-app-stack-mean-and-mern-with-angular2-and-reactjs" data-via="wpbeginner" data-text="Webinar Replay: Developing with the modern App Stack: MEAN and MERN (with Angular2 and ReactJS)" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/webinar-replay-developing-with-the-modern-app-stack-mean-and-mern-with-angular2-and-reactjs"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/webinar-replay-developing-with-the-modern-app-stack-mean-and-mern-with-angular2-and-reactjs" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Fwebinar-replay-developing-with-the-modern-app-stack-mean-and-mern-with-angular2-and-reactjs&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../../../category/mongodb/index.html" rel="category tag">MongoDB</a> | 
Tags: <a href="./../../angular/index.html" rel="tag">angular</a>, <a href="./../../express/index.html" rel="tag">Express</a>, <a href="./../../expressjs/index.html" rel="tag">expressjs</a>, <a href="./../../mean-stack/index.html" rel="tag">mean stack</a>, <a href="./../../mern-stack/index.html" rel="tag">mern stack</a>, <a href="./../../mongodb/index.html" rel="tag">mongodb</a>, <a href="./../../node-js/index.html" rel="tag">node.js</a>, <a href="./../../react/index.html" rel="tag">REACT</a>, <a href="./../../reactjs/index.html" rel="tag">reactjs</a>
</div>

			</div>			<div id="post-4413" class="post-4413 post type-post status-publish format-standard hentry category-mongodb tag-alexa tag-amazon-alexa tag-mean tag-mern tag-mongodb tag-node-js tag-reactjs tag-rest-api">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../../../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../../../mongodb/rest-mobile-app-amazon-alexa-cloud-services/index.html">March 17, 2017</a>
			</div>
	<div class="postcomments">
		<a href="./../../../mongodb/rest-mobile-app-amazon-alexa-cloud-services/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../../../mongodb/rest-mobile-app-amazon-alexa-cloud-services/index.html" rel="bookmark">The Modern Application Stack &#8211; Part 6: Browsers Aren&#8217;t the Only UI ‚Äì Mobile Apps, Amazon Alexa, Cloud Services</a></h2>
				
				<div class="entry">
										<p>This is the sixth and final blog post in a series examining technologies such as <strong>MongoDB</strong> and <strong>REST APIs</strong> that are driving the development of modern web and mobile applications.</p>
<p><a href="./../../../mongodb/modern-application-stack-part-1-introducing-the-mean-stack/index.html" title="Bulding the MEAN stack and MERN stack for web and mobile apps"><em>Modern Application Stack ‚Äì Part 1: Introducing The MEAN Stack</em></a> introduced the technologies making up the MEAN (MongoDB, Express, Angular, Node.js) and MERN (MongoDB, Express, React, Node.js) stacks: why you might want to use them, and how to combine them to build your web application (or your native mobile or desktop app).</p>
<p>Subsequent posts focused on working through the end to end steps of building a real (albeit simple) application ‚Äì <em>MongoPop</em>.</p>
<p><a href="./../../../mongodb/mean_stack_2_mongodb_node_js/index.html" title="Using MongoDB with Node.js"><em>Part 2: Using MongoDB With Node.js</em></a> created an environment where we could work with a MongoDB database from Node.js; it also created a simplified interface to the MongoDB Node.js Driver.</p>
<p><a href="./../../../mongodb/the-modern-application-stack-part-3-building-a-rest-api-using-express-js/index.html" title="Building a REST API using Express"><em>Part 3: Building a REST API with Express.js</em></a> built on Part 2 by using Express.js to add a REST API which is used by the clients that we implement in the final 3 posts.</p>
<p><a href="./../../../mongodb/the-modern-application-stack-part-4-building-a-client-ui-using-angular-2-formerly-angularjs-typescript/index.html" title="Build an app front-end with Angular2 and Typescript"><em>Part 4: Building a Client UI Using Angular 2 (formerly AngularJS) &amp; TypeScript</em></a> completed the MEAN stack by adding an Angular 2 client.</p>
<p><a href="./../../../mongodb/the-modern-application-stack-part-5-using-reactjs-es6-jsx-to-build-a-ui-the-rise-of-mern/index.html" title="Building an application front-end with ReactJS and ES6">Part 5: Using ReactJS, ES6 &amp; JSX to Build a UI (the rise of MERN)</a> does the same but replaces Angular with ReactJS to complete the MERN stack.</p>
<p>Once your application back-end exposes a REST API, there are limitless ways that you or other developers can access it:</p>
<ul>
<li>A dedicated browser-based client, as seen in posts 4 and 5</li>
<li>A standalone native iOS or Android mobile app</li>
<li>Voice controlled appliances, such as Amazon&#8217;s Echo</li>
<li>IoT-enabled devices, such as remote sensors</li>
<li>Integrations with 3rd party applications</li>
</ul>
<p>This post takes a look at some of these approaches. Unlike some of the earlier posts, this one aims to go wide rather than deep ‚Äì touching on many technologies rather than diving too deeply into any one.</p>
<h4>Prerequisite ‚Äì the REST API</h4>
<p>Everything that follows assumes that you have the <em>Mongopop REST API</em> running ‚Äì if not, skip back to <a href="./../../../mongodb/the-modern-application-stack-part-3-building-a-rest-api-using-express-js/index.html"><em>Part 3: Building a REST API with Express.js</em></a>. Additionally, that API has been extended with 3 new routes (already included in the latest <a href="https://github.com/am-MongoDB/MongoDB-Mongopop" title="A web tool to populate a MongoDB Atlas instance with sample data using the MEAN and MERN stacks">GitHub repository</a>):</p>
<table class="table table-bordered" summary="Additional Express routes implemented for the Mongopop REST API">
<caption><strong>Additional Express routes implemented for the Mongopop REST API</strong></caption>
<thead>
<tr>
<th>Route</th>
<th>HTTP Method</th>
<th>Parameters</th>
<th>Response</th>
<th>Purpose
<pre style="border:0px; background-color:#fff; height:0px">                      </pre>
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<pre style="border:0px; background-color:#fff">/pop/checkIn</pre>
</td>
<td>POST</td>
<td>
<pre style="border:0px; background-color:#fff">
{       
    venue: string,
    date: string,
    url: string,
    location: string
}
        </pre>
</td>
<td>
<pre style="border:0px; background-color:#fff">
{
    success: boolean,
    error: string
}
        </pre>
</td>
<td>Stores the checkin data as a document in a collection.</td>
</tr>
<tr>
<td>
<pre style="border:0px; background-color:#fff">/pop/checkInCount</pre>
</td>
<td>GET</td>
<td></td>
<td>
<pre style="border:0px; background-color:#fff">
{
    success: boolean,
    count: number,
    error: string
}
        </pre>
</td>
<td>Returns a count for the total number of checkins.</td>
</tr>
<tr>
<td>
<pre style="border:0px; background-color:#fff">/pop/latestCheckIn</pre>
</td>
<td>GET</td>
<td></td>
<td>
<pre style="border:0px; background-color:#fff">
{
    success: boolean,
    venue: string,
    date: string,
    url: string,
    location: string,
    error: string
}
        </pre>
</td>
<td>Retrieves the most recent checkin.</td>
</tr>
</tbody>
</table>
<p>These route paths are implemented in the <a href="https://github.com/am-MongoDB/MongoDB-Mongopop/blob/master/routes/pop.js" title="Mongopop Express route implementation"><code>pop.js</code></a> module in the <a href="https://github.com/am-MongoDB/MongoDB-Mongopop" title="MEAN and MERN stack repo ‚Äì Mongopop">Mongopop repository</a>:</p>
<p><script src="https://gist.github.com/am-MongoDB/af586eec19d752aee544324d3f280e9c.js"></script></p>
<p><code>/pop/lastCheckIn</code> depends on a new method that has been added to <a href="https://github.com/am-MongoDB/MongoDB-Mongopop/blob/master/javascripts/db.js" title="MongoDB helper services for Express"><code>javascripts/db.js</code></a>:</p>
<p><script src="https://gist.github.com/am-MongoDB/347e1eb5496978d9d08f15f4147ee8c7.js"></script></p>
<p>The configuration file <a href="https://github.com/am-MongoDB/MongoDB-Mongopop/blob/master/config.js" title="Configuration file for Mongopop applications"><code>config.js</code></a> is also extended ‚Äì note that you should replace the value associated with the <code>makerMongoDBURI</code> field if you&#8217;re not running MongoDB on your local machine (e.g. with the URI provided by <a href="https://cloud.mongodb.com/" title="MongoDB as a service">MongoDB Atlas</a>:</p>
<p><script src="https://gist.github.com/am-MongoDB/ddc536f78ad54b1c29f32e1f1cb58141.js"></script></p>
<p>The implementation of these methods follows the same pattern as already seen ‚Äì refer back to <a href="./../../../mongodb/the-modern-application-stack-part-3-building-a-rest-api-using-express-js/index.html" title="Building a REST API for MongoDB with ExpressJS">Part 3</a> for details ‚Äì and so is not explained here.</p>
<h4>Repurposing Angular &amp; ReactJS code for native applications</h4>
<p>There are frameworks for both <a href="https://angular.io/" title="Angular for JavaScript application clients">Angular</a> and <a href="https://facebook.github.io/react/" title="ReactJS for JavaScript application clients">ReactJS</a> that enable web client application designs (and in some cases, code) to be reused for creating <em>native</em> iOS and Android apps.</p>
<p>One option for Angular is <a href="https://www.nativescript.org/" title="NativeScript for native Angular apps"><strong>NativeScript</strong></a>, in which you use Typescript/JavaScript with Angular to build native apps for multiple platforms from the same source code. Of course, to get the most out of those platforms, you may want or need to add platform-specific code.</p>
<p>React developers will find <a href="https://facebook.github.io/react-native/" title="React Native  for native ReactJS apps"><strong>React Native</strong></a> code very familiar, and applications are built from declarative components in the same way. The most obvious difference is that React Native code uses its own native components (e.g. <code>&lt;View&gt;</code> and <code>&lt;Text&gt;</code> rather that HTML elements such as <code>&lt;div&gt;</code> and <code>&lt;p&gt;</code>):</p>
<p><script src="https://gist.github.com/am-MongoDB/9d45645c7429ddfe699fa36944880ac2.js"></script></p>
<p>React Native provides the <a href="https://facebook.github.io/react-native/docs/network.html" title="Fetch API for React Native front-end apps">Fetch API</a> to make network requests; it follows a similar patter to <code>XMLHttpRequest</code> (React Native also includes <code>XMLHttpRequest</code> which can be used directly).</p>
<p>While it&#8217;s not as simple as just rebuilding your ReactJS or Angular code to produce native apps, the reuse of designs, skills and (some) code make it much more efficient than starting from scratch.</p>
<h4>Combining cloud services ‚Äì IFTTT</h4>
<p><a href="https://ifttt.com/discover" title="IF This Then That ‚Äì combine cloud services">IFTTT</a> (IF This Then That) is a free cloud service which allows you to automate tasks by combining existing services (Google Docs, Facebook, Instagram, Hue lights, Nest thermostats, GitHub, Trello, Dropbox,&#8230;). The name of the service comes from the simple pattern used for each Applet (automation rule): &#8220;<strong>IF T</strong>his event occurs in service x <strong>T</strong>hen trigger <strong>T</strong>hat action in service y&#8221;.</p>
<p>IFTTT includes a <a href="https://ifttt.com/maker" title="Accept HTTP triggers and make HTTP requests with IFTTT">Maker</a> service which can handle web requests (triggers) or send web requests (actions). In this case, I use it to invoke the <code>pop/checkIn</code> POST method from the Mongopop REST API whenever I check in using the <a href="https://www.swarmapp.com/">Swarm</a> (<a href="https://foursquare.com/">Foursquare</a>) app:</p>
<div id="attachment_4416" style="width: 323px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/03/FourSquare-Mongopop-IFTTT-Applet.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4416" src="./../../../wp-content/uploads/2017/03/FourSquare-Mongopop-IFTTT-Applet-313x1024.png" alt="Create Foursquare applet to make HTTP POST over REST API in IFTTT" width="313" height="1024" class="size-large wp-image-4416" srcset="./../../../wp-content/uploads/2017/03/FourSquare-Mongopop-IFTTT-Applet-313x1024.png 313w, ./../../../wp-content/uploads/2017/03/FourSquare-Mongopop-IFTTT-Applet-92x300.png 92w, ./../../../wp-content/uploads/2017/03/FourSquare-Mongopop-IFTTT-Applet.png 326w" sizes="auto, (max-width: 313px) 100vw, 313px"></a><p id="caption-attachment-4416" class="wp-caption-text">Create Foursquare applet to make HTTP POST over REST API in IFTTT</p>
</div>
<p>Note that the applet makes a POST request to the <code>http://your-mongopop-ip:3000/pop/checkIn</code> route. The body of the POST includes the required parameters ‚Äì provided as a JSON document. Each of the <code>VenueName</code>, <code>CheckinDate</code>, <code>VenueUrl</code>, and <code>VenueMapImageURL</code> values are /ingredients/ from the trigger (Foursquare) event.</p>
<div id="attachment_4417" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/03/IFTTT_Stack.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4417" src="./../../../wp-content/uploads/2017/03/IFTTT_Stack-1024x530.png" alt="IFTTT Stack - making REST calls" width="480" height="248" class="size-large wp-image-4417" srcset="./../../../wp-content/uploads/2017/03/IFTTT_Stack-1024x530.png 1024w, ./../../../wp-content/uploads/2017/03/IFTTT_Stack-300x155.png 300w, ./../../../wp-content/uploads/2017/03/IFTTT_Stack-768x398.png 768w, ./../../../wp-content/uploads/2017/03/IFTTT_Stack.png 1825w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4417" class="wp-caption-text">IFTTT Stack &#8211; making REST calls</p>
</div>
<p>Using the <a href="https://www.swarmapp.com/">Swarm app</a> I check into FourSquare:</p>
<p><iframe loading="lazy" width="560" height="315" src="https://www.youtube.com/embed/M5u-fudNEfA?rel=0" frameborder="0" allowfullscreen></iframe></p>
<p>We can confirm that the MongoDB collection has been updated after this check-in:</p>
<pre><code class="js">Cluster0-shard-0:PRIMARY&gt; use maker
switched to db maker

Cluster0-shard-0:PRIMARY&gt; db.foursq.find().sort({_id: -1}).limit(1).pretty()
{
    "_id" : ObjectId("58c272f842067a03283be544"),
    "venueName" : "Redroofs Theatre School",
    "date" : "March 10, 2017 at 09:23AM",
    "url" : "http://4sq.com/htwamV",
    "mapRef" : "http://maps.google.com/maps/api/staticmap?center=51.52212258991317,-0.7358344376428089&amp;zoom=16&amp;size=710x440&amp;maptype=roadmap&amp;sensor=false&amp;markers=color:red%7C51.52212258991317,-0.7358344376428089"
}
</code></pre>
<h4>Constructing an iOS/Apple Watch App to automate workflows</h4>
<p>The first example showed how to record a check-in into our own service as a side effect of checking into an existing service (Foursquare).</p>
<p>What if we wanted to create new, independent check-ins, from a mobile device? What if we also wanted to augment the check-ins with additional data? Another requirement could be to let our team know of the check-in through a <a href="https://slack.com/">Slack</a> channel.</p>
<p>A valid approach would be to build a new mobile client using React Native or NativeScript. Slack and Google Maps have their own REST APIs and so the new App could certainly integrate with them in addition to our Mongopop API. Before investing in that development work, it would be great to prototype the concept and see if it proves useful.</p>
<p>This is where we turn to the iOS <a href="https://workflow.is/" title="Integrate iOS apps using Workflow"><strong>Workflow</strong> app</a>. Workflow has a number of similarities to IFTTT but there are also some significant differences:</p>
<ul>
<li>Workflow runs on your iOS device rather than in the cloud.</li>
<li>Workflows are triggered by events on your iOS device (e.g. pressing a button) rather than an event in some cloud service.</li>
<li>Workflow allows much more complex patterns than &#8220;<strong>IF T</strong>his event occurs in service A <strong>T</strong>hen trigger <strong>T</strong>hat action in service B&#8221;; it can loop, invoke multiple services, perform calculations, access local resources (e.g. camera and location information) on your device, and much more.</li>
</ul>
<p>Both applications/Workflows that we build here can be run on an iPad, iPhone, or Apple Watch.</p>
<p>The first Workflow, <em>CheckIn</em>, performs these steps:</p>
<ul>
<li>Fetch the device&#8217;s current location</li>
<li>Retrieve any URL associated with that location
<ul>
<li>If none exists, fetch a map URL from Apple Maps</li>
</ul>
</li>
<li>Fetch a Google Street View image for the location
<ul>
<li>Upload this image to <a href="http://imgur.com/">Imgur</a>
</li>
<li>Send the image URL to <a href="https://slack.com/">Slack</a>
</li>
</ul>
</li>
<li>Send a POST request to the <code>/pop/checkIn</code> Mongopop route
<ul>
<li>The request includes the location, date/time, URL (either from the venue or Apple Maps), and the StreetView image</li>
</ul>
</li>
<li>Post the location and URL to Slack</li>
<li>Display error messages if anything fails</li>
</ul>
<div id="attachment_4419" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/03/Workflow_stack.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4419" src="./../../../wp-content/uploads/2017/03/Workflow_stack-1024x607.png" alt="iOS Workflow stack to make REST API calls" width="480" height="285" class="size-large wp-image-4419" srcset="./../../../wp-content/uploads/2017/03/Workflow_stack-1024x607.png 1024w, ./../../../wp-content/uploads/2017/03/Workflow_stack-300x178.png 300w, ./../../../wp-content/uploads/2017/03/Workflow_stack-768x455.png 768w, ./../../../wp-content/uploads/2017/03/Workflow_stack.png 1880w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4419" class="wp-caption-text">iOS Workflow stack to make REST API calls</p>
</div>
<p>Implementing a Workflow involves dragging actions into the work area and then adding attributes to those actions (such as the address of the Mongopop API). The result of one action is automatically used as the input to the next action in the workflow. Results can also be stored in variables for use by later actions.</p>
<p>This is the <em>Check In</em> workflow:</p>
<div id="attachment_4420" style="width: 160px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/03/Workflow_Checkin_Code.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4420" src="./../../../wp-content/uploads/2017/03/Workflow_Checkin_Code-150x1024.png" alt="iOS Workflow check-in code for REST API call" width="150" height="1024" class="size-large wp-image-4420" srcset="./../../../wp-content/uploads/2017/03/Workflow_Checkin_Code-150x1024.png 150w, ./../../../wp-content/uploads/2017/03/Workflow_Checkin_Code-44x300.png 44w, ./../../../wp-content/uploads/2017/03/Workflow_Checkin_Code-768x5246.png 768w, ./../../../wp-content/uploads/2017/03/Workflow_Checkin_Code.png 1303w" sizes="auto, (max-width: 150px) 100vw, 150px"></a><p id="caption-attachment-4420" class="wp-caption-text">iOS Workflow check-in code for REST API call</p>
</div>
<p>This video demonstrates the use of the app when run on an iPhone:</p>
<p><iframe loading="lazy" width="560" height="315" src="https://www.youtube.com/embed/lowpybR4zSA?rel=0" frameborder="0" allowfullscreen></iframe></p>
<p>The same app/workflow can be run from an Apple Watch:</p>
<div id="attachment_4421" style="width: 322px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/03/Checking_into_MongoDB_from_Apple_Watch.gif"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4421" src="./../../../wp-content/uploads/2017/03/Checking_into_MongoDB_from_Apple_Watch.gif" alt="Check-in via REST API with Apple Watch and iOS Workflow app" width="312" height="390" class="size-full wp-image-4421"></a><p id="caption-attachment-4421" class="wp-caption-text">Check-in via REST API with Apple Watch and iOS Workflow app</p>
</div>
<p>We can confirm that check-in record has been stored as a document in MongoDB Atlas (note that the database and collection names are defined in <code>config.js</code>):</p>
<pre><code class="js">Cluster0-shard-0:PRIMARY&gt; use maker
switched to db maker
Cluster0-shard-0:PRIMARY&gt; db.foursq.find().sort({_id: -1}).limit(1).pretty()
{
    "_id" : ObjectId("58c1505742067a03283be541"),
    "venueName" : "77-79 King St, Maidenhead SL6 1DU, UK",
    "date" : "9 Mar 2017, 12:53",
    "url" : "http://maps.apple.com/?q=77-79%20King%20St,%20Maidenhead%20SL6%201DU,%20UK&amp;ll=51.520409,-0.722196",
    "mapRef" : "http://i.imgur.com/w3KyIVU.jpg"
}
</code></pre>
<p>The second app/workflow retrieves and displays details of the most recent check-in. It performs these steps:</p>
<ul>
<li>Read from the <code>/pop/latestCheckIn</code> Mongopop REST API Route using GET. </li>
<li>If the results indicate a successful operation then:
<ul>
<li>Extract the location from the results</li>
<li>Display the location and prompt the user if they&#8217;d like to:
<ul>
<li>See the location data (image)</li>
<li>Follow the location&#8217;s URL (typically an Apple Maps link)</li>
<li>Finish</li>
</ul>
</li>
</ul>
</li>
<li>If the Mongopop operation fails, display an appropriate error. </li>
</ul>
<p>The full workflow is shown here:</p>
<div id="attachment_4422" style="width: 194px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/03/Workflow_Find_Code.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4422" src="./../../../wp-content/uploads/2017/03/Workflow_Find_Code-184x1024.png" alt="Find the latest check-in using REST API using Apple Watch" width="184" height="1024" class="size-large wp-image-4422" srcset="./../../../wp-content/uploads/2017/03/Workflow_Find_Code-184x1024.png 184w, ./../../../wp-content/uploads/2017/03/Workflow_Find_Code-54x300.png 54w" sizes="auto, (max-width: 184px) 100vw, 184px"></a><p id="caption-attachment-4422" class="wp-caption-text">Find the latest check-in using REST API using Apple Watch</p>
</div>
<p>Running the app on an iPad produces these results:</p>
<p><iframe loading="lazy" width="560" height="315" src="https://www.youtube.com/embed/IEuDkZ-9ZXc?rel=0" frameborder="0" allowfullscreen></iframe></p>
<p>Again, the same app can be run from an Apple Watch:</p>
<div id="attachment_4423" style="width: 322px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/03/Apple_Watch_reading_from_MongoDB.gif"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4423" src="./../../../wp-content/uploads/2017/03/Apple_Watch_reading_from_MongoDB.gif" alt="Find the latest check-in using REST API from Apple Watch" width="312" height="390" class="size-full wp-image-4423"></a><p id="caption-attachment-4423" class="wp-caption-text">Find the latest check-in using REST API from Apple Watch</p>
</div>
<h4>Hands-free ‚Äì Amazon Alexa Skills</h4>
<p>Two of today&#8217;s biggest industry trends are <strong>machine learning</strong> and <strong>serverless computing</strong>. Amazon&#8217;s <strong>Alexa</strong> service (typically accessed through Amazon&#8217;s <strong>Echo</strong> device) is at the forefront of both. In addition to interpreting voice commands for Amazon&#8217;s own services (e.g. ordering more coffee beans or playing a particular song), developers can implement their own <em>skills</em>. Many are publicly available from 3rd parties such as Nest, Harmony, and Spotify, but you&#8217;re free to implement and test your own ‚Äì submitting it for review and public use when ready.</p>
<p>The business logic behind Alexa skills are typically run within Amazon&#8217;s serverless computing service ‚Äì <strong>AWS Lambda</strong>. Lambda is a great product for services that handle low or bursty levels of traffic ‚Äì rather than paying a flat rate for a physical or virtual server, you pay a small fee for every event handled (and you even get a low-medium level of throughput for free). If your service really takes off then Lambda automatically scales out.</p>
<p>Assuming that you decide to use Lambda, there are three main components to your skill:</p>
<ul>
<li>The set of <strong>intents</strong> ‚Äì instructions that a user can give to Alexa</li>
<li>For each intent, a set of <em>utterances</em> that the user might say in order to signal that intent</li>
<li>The actual logic which is invoked whenever the user signals an intent ‚Äì implemented as a Lambda function</li>
</ul>
<p>The <strong>Mongo</strong> Alexa skill has 3 intents/commands:</p>
<ul>
<li>
<strong>WhereIntent</strong>: Find the most recent location that I checked in to</li>
<li>
<strong>CountIntent</strong>: Count how many times I&#8217;ve checked in</li>
<li>
<strong>HelpIntent</strong>: Explain what the available commands/intents are</li>
</ul>
<p>The intents are defined as a JSON document:</p>
<pre><code class="js">{"intents": [
    {"intent": "WhereIntent"},
    {"intent": "CountIntent"},
    {"intent": "AMAZON.HelpIntent"},
  ]
}
</code></pre>
<p>The utterances for each of those intents must also be defined:</p>
<pre><code class="js">WhereIntent where is andrew
WhereIntent where is he
WhereIntent where am i
WhereIntent where did he last check in
WhereIntent where did Andrew last check in
WhereIntent where did i last check in
WhereIntent last check in

CountIntent how many checkins
CountIntent how many times have I checked in
CountIntent how many times has Andrew checked in
CountIntent how many times has he checked in
CountIntent how many check ins
CountIntent check in count
</code></pre>
<p>Note that no utterances need to be added for the <code>AMAZON.HelpIntent</code> as that intent is built in.</p>
<p>The skill is created in the <a href="https://developer.amazon.com/">Amazon Developer Console</a> using the Alexa wizard; where the intentions and utterances can be added:</p>
<div id="attachment_4424" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/03/Add-Alexa-Intentions-Utterances.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4424" src="./../../../wp-content/uploads/2017/03/Add-Alexa-Intentions-Utterances-1024x842.png" alt="Add Alexa intentions and utterances" width="480" height="395" class="size-large wp-image-4424" srcset="./../../../wp-content/uploads/2017/03/Add-Alexa-Intentions-Utterances-1024x842.png 1024w, ./../../../wp-content/uploads/2017/03/Add-Alexa-Intentions-Utterances-300x247.png 300w, ./../../../wp-content/uploads/2017/03/Add-Alexa-Intentions-Utterances-768x632.png 768w, ./../../../wp-content/uploads/2017/03/Add-Alexa-Intentions-Utterances.png 1364w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4424" class="wp-caption-text">Add Alexa intentions and utterances</p>
</div>
<p>In the next screen, you indicate where the the skill&#8217;s business logic runs; in this case, I provide the Amazon Resource Name (ARN) of my Lambda function:</p>
<div id="attachment_4425" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/03/alexa-skill-business-logic.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4425" src="./../../../wp-content/uploads/2017/03/alexa-skill-business-logic-1024x825.png" alt="Locate Amazon Alexa&#039;s skill code" width="480" height="387" class="size-large wp-image-4425" srcset="./../../../wp-content/uploads/2017/03/alexa-skill-business-logic-1024x825.png 1024w, ./../../../wp-content/uploads/2017/03/alexa-skill-business-logic-300x242.png 300w, ./../../../wp-content/uploads/2017/03/alexa-skill-business-logic-768x619.png 768w, ./../../../wp-content/uploads/2017/03/alexa-skill-business-logic.png 1153w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4425" class="wp-caption-text">Locate Amazon Alexa&#8217;s skill code</p>
</div>
<p>The logic for the Mongo skill is implemented in the <a href="https://github.com/am-MongoDB/MongoDB-Alexa/blob/master/index.js" title="Amazon Alexa skill ‚Äì using Mongopop REST API"><code>index.js</code></a> file (part of the <a href="https://github.com/am-MongoDB/MongoDB-Alexa" title="Read and write to MongoDB from Amazon Alexa skill">MongoDB-Alexa GitHub repository</a>):</p>
<p><script src="https://gist.github.com/am-MongoDB/8bf49fd414d92ed00f021bafe4ba2c71.js"></script></p>
<p>As explained earlier, the aim of this post is to cover a broad set of technologies rather than going too deeply into any one but explaining a few concepts may help you understand what this code is doing:</p>
<ul>
<li>A <strong>handler</strong> is implemented for each of the intents; that handler is invoked when the user speaks one of the utterances associated with that intent</li>
<li>The handlers for the <code>CountIntent</code> and <code>WhereIntent</code> makes calls to the Mongopop REST API using the <code>request</code> function</li>
<li>The <strong>emit</strong> method is how the handlers can send results or errors back to the user (via Alexa)</li>
<li>The <strong>card</strong>, referred to by <code>tellWithCard</code>, is visual content (text and images) that are displayed in the Alexa app</li>
</ul>
<p>Note that this is a simple skill which receives a request and sends a single response. It is also possible to implement an interactive state machine where there&#8217;s a conversation between the user and Alexa &#8211; in those skills, the logic uses both the latest intent and the past context in deciding how to respond. Note that the Lambda function is always stateless and so all data should be stored in a database such as MongoDB.</p>
<p>The skill is deployed to AWS Lambda through the <a href="https://aws.amazon.com/">AWS Management Console</a>. The <a href="https://github.com/am-MongoDB/MongoDB-Alexa/blob/master/index.js" title="Amazon Alexa skill to access MongoDB"><code>index.js</code></a>, <a href="https://github.com/am-MongoDB/MongoDB-Alexa/blob/master/config_template.js">config.js</a> and <code>node_modules</code> directory (created by running <code>npm install</code>) should be archived into a single Zip file which is then uploaded to AWS:</p>
<div id="attachment_4426" style="width: 696px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/03/Archive-files.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4426" src="./../../../wp-content/uploads/2017/03/Archive-files.png" alt="Create zip file for Alexa skill to upload to AWS Lambda" width="686" height="393" class="size-full wp-image-4426" srcset="./../../../wp-content/uploads/2017/03/Archive-files.png 686w, ./../../../wp-content/uploads/2017/03/Archive-files-300x172.png 300w" sizes="auto, (max-width: 686px) 100vw, 686px"></a><p id="caption-attachment-4426" class="wp-caption-text">Create zip file for Alexa skill to upload to AWS Lambda</p>
</div>
<div id="attachment_4427" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/03/Upload-alexa-skill-lambda.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4427" src="./../../../wp-content/uploads/2017/03/Upload-alexa-skill-lambda-1024x577.png" alt="Upload zip file for Alexa skill to AWS Lambda" width="480" height="270" class="size-large wp-image-4427" srcset="./../../../wp-content/uploads/2017/03/Upload-alexa-skill-lambda-1024x577.png 1024w, ./../../../wp-content/uploads/2017/03/Upload-alexa-skill-lambda-300x169.png 300w, ./../../../wp-content/uploads/2017/03/Upload-alexa-skill-lambda-768x433.png 768w, ./../../../wp-content/uploads/2017/03/Upload-alexa-skill-lambda.png 1067w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4427" class="wp-caption-text">Upload zip file for Alexa skill to AWS Lambda</p>
</div>
<p>There are a number of extra configuration options ‚Äì such as the runtime environment to use (Node.js), the user role, the amount of memory to be made available to the function, and how long each invocation of the function should be allowed to run (the function is making external HTTP requests and so it may need a few seconds):</p>
<div id="attachment_4428" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/03/lambda-configuration.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4428" src="./../../../wp-content/uploads/2017/03/lambda-configuration-903x1024.png" alt="Configure AWS Lambda function for Amazon Alexa skill" width="480" height="544" class="size-large wp-image-4428" srcset="./../../../wp-content/uploads/2017/03/lambda-configuration-903x1024.png 903w, ./../../../wp-content/uploads/2017/03/lambda-configuration-264x300.png 264w, ./../../../wp-content/uploads/2017/03/lambda-configuration-768x871.png 768w, ./../../../wp-content/uploads/2017/03/lambda-configuration.png 990w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4428" class="wp-caption-text">Configure AWS Lambda function for Amazon Alexa skill</p>
</div>
<p>As a reminder, the user speaks to the Amazon Echo device, then the Alexa application invokes an AWS Lambda function, which implements the business logic for the Mongo skill, which then interacts with the MongoDB database via the Mongopop REST API:</p>
<div id="attachment_4429" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/03/Alexa_stack.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4429" src="./../../../wp-content/uploads/2017/03/Alexa_stack-1024x607.png" alt="Stack to have Alexa make REST API calls to Mongopop" width="480" height="285" class="size-large wp-image-4429" srcset="./../../../wp-content/uploads/2017/03/Alexa_stack-1024x607.png 1024w, ./../../../wp-content/uploads/2017/03/Alexa_stack-300x178.png 300w, ./../../../wp-content/uploads/2017/03/Alexa_stack-768x455.png 768w, ./../../../wp-content/uploads/2017/03/Alexa_stack.png 1880w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4429" class="wp-caption-text">Stack to have Alexa make REST API calls to Mongopop</p>
</div>
<p>To start, test the simplest intent ‚Äì asking the Mongo skill for help:</p>
<p><iframe loading="lazy" width="560" height="315" src="https://www.youtube.com/embed/Du_Ta3hyDFI?rel=0" frameborder="0" allowfullscreen></iframe></p>
<p>Note that the visual card can contain more information than Alexa&#8217;s spoken response. For example, if there is an error in the Mongopop back-end, the returned error message is displayed on the card.</p>
<p>Next, we can ask Alexa how many times I&#8217;ve checked in and where my last check-in was. Note that I could have used any of the utterances associated with these intents (and Alexa will automatically convert similar phrases):</p>
<p><iframe loading="lazy" width="560" height="315" src="https://www.youtube.com/embed/plMxxOeYquw?rel=0" frameborder="0" allowfullscreen></iframe></p>
<h4>Summary</h4>
<p>Previous posts stepped through building the Mongopop application back-end and then the creation of web client applications using Angular 2 and ReactJS.</p>
<p>This post explored some alternative ways to build client applications; in particular, it showed how to combine existing cloud services with a bit of new logic to create something brand new. We looked at a number of technologies to help build applications quickly and efficiently:</p>
<ul>
<li>IFTTT: Make events in one cloud service trigger actions in another</li>
<li>Workflow: Automate complex tasks involving multiple services on an iOS device</li>
<li>Amazon Alexa: Implement your own voice-controlled skills</li>
<li>AWS Lambda: Host and scale your business logic in the cloud while only paying for the transactions you process</li>
</ul>
<p>Increasingly, applications leverage multiple services (if only to allow the user to share their efforts on different social media networks). The key to all of these integrations is the REST APIs provided by each service. If you&#8217;ve jumped straight to this post then consider reading parts 1 through 3 to learn how to build your own REST API:</p>
<ul>
<li><a href="./../../../mongodb/modern-application-stack-part-1-introducing-the-mean-stack/index.html" title="MEAN stack, MERN stack">Part 1: Introducing The MEAN Stack (and the young MERN upstart)</a></li>
<li><a href="./../../../mongodb/mean_stack_2_mongodb_node_js/index.html" title="Using MongoDB With Node.js">Part 2: Using MongoDB With Node.js</a></li>
<li><a href="./../../../mongodb/the-modern-application-stack-part-3-building-a-rest-api-using-express-js/index.html" title="Building REST API for MongoDB using Express JS">Part 3: Building a REST API with Express.js</a></li>
<li><a href="./../../../mongodb/the-modern-application-stack-part-4-building-a-client-ui-using-angular-2-formerly-angularjs-typescript/index.html" title="Completing the MEAN stack ‚Äì Mongopop Angular2 client">Part 4: Building a Client UI Using Angular 2 (formerly AngularJS) &amp; TypeScript</a></li>
<li><a href="./../../../mongodb/the-modern-application-stack-part-5-using-reactjs-es6-jsx-to-build-a-ui-the-rise-of-mern/index.html" title="Building an application front-end with ReactJS and ES6">Part 5: Using ReactJS, ES6 &amp; JSX to Build a UI (the rise of MERN)</a></li>
<li><a href="./../../../mongodb/rest-mobile-app-amazon-alexa-cloud-services/index.html" title="Using REST APIs from mobile applications and Amazon Alexa">Part 6: Browsers Aren&#8217;t the Only UI ‚Äì Mobile Apps, Amazon Alexa, Cloud Services&#8230;</a></li>
</ul>
<h2>A simpler way to build your app ‚Äì MongoDB Stitch, Backend as a Service</h2>
<p><a href="https://www.mongodb.com/cloud/stitch">MongoDB Stitch</a> is a backend as a service (BaaS), giving developers a REST-like API to MongoDB, and composability with other services, backed by a robust system for configuring fine-grained data access controls. Stitch provides native SDKs for JavaScript, iOS, and Android.</p>
<p>Built-in integrations give your application frontend access to your favorite third party services: Twilio, AWS S3, Slack, Mailgun, PubNub, Google, and more. For ultimate flexibility, you can add custom integrations using MongoDB Stitch&#8217;s HTTP service.</p>
<p>MongoDB Stitch allows you to compose multi-stage pipelines that orchestrate data across multiple services; where each stage acts on the data before passing its results on to the next.</p>
<p>Unlike other BaaS offerings, MongoDB Stitch works with your existing as well as new MongoDB clusters, giving you access to the full power and scalability of the database. By defining appropriate data access rules, you can selectively expose your existing MongoDB data to other applications through MongoDB Stitch&#8217;s API.</p>
<p>If you&#8217;d like to try it out, <a href="./../../../mongodb/mongodb-stitch-the-latest-and-best-way-to-build-your-app/index.html" title="MongoDB Stitch - the latest, and best way to build your app">step through building an application with MongoDB Stitch</a>.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/rest-mobile-app-amazon-alexa-cloud-services" data-via="wpbeginner" data-text="The Modern Application Stack &#8211; Part 6: Browsers Aren&#8217;t the Only UI ‚Äì Mobile Apps, Amazon Alexa, Cloud Services" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/rest-mobile-app-amazon-alexa-cloud-services"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/rest-mobile-app-amazon-alexa-cloud-services" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Frest-mobile-app-amazon-alexa-cloud-services&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../../../category/mongodb/index.html" rel="category tag">MongoDB</a> | 
Tags: <a href="./../../alexa/index.html" rel="tag">alexa</a>, <a href="./../../amazon-alexa/index.html" rel="tag">amazon alexa</a>, <a href="./../../mean/index.html" rel="tag">MEAN</a>, <a href="./../../mern/index.html" rel="tag">mern</a>, <a href="./../../mongodb/index.html" rel="tag">mongodb</a>, <a href="./../../node-js/index.html" rel="tag">node.js</a>, <a href="./../../reactjs/index.html" rel="tag">reactjs</a>, <a href="./../../rest-api/index.html" rel="tag">rest api</a>
</div>

			</div>			<div id="post-4393" class="post-4393 post type-post status-publish format-standard hentry category-mongodb tag-es6 tag-javascript tag-mern tag-mern-stack tag-mongodb tag-react tag-reactjs">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../../../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../../../mongodb/the-modern-application-stack-part-5-using-reactjs-es6-jsx-to-build-a-ui-the-rise-of-mern/index.html">February 24, 2017</a>
			</div>
	<div class="postcomments">
		<a href="./../../../mongodb/the-modern-application-stack-part-5-using-reactjs-es6-jsx-to-build-a-ui-the-rise-of-mern/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../../../mongodb/the-modern-application-stack-part-5-using-reactjs-es6-jsx-to-build-a-ui-the-rise-of-mern/index.html" rel="bookmark">The Modern Application Stack &#8211; Part 5: Using ReactJS, ES6 &#038; JSX to Build a UI (the rise of MERN)</a></h2>
				
				<div class="entry">
										<p>This is the fifth in a series of blog posts examining technologies such as <strong>ReactJS</strong> that are driving the development of modern web and mobile applications.</p>
<p><a href="./../../../mongodb/modern-application-stack-part-1-introducing-the-mean-stack/index.html"><strong>Modern Application Stack ‚Äì Part 1: Introducing The MEAN Stack</strong></a> introduced the technologies making up the MEAN (MongoDB, Express, Angular, Node.js) and MERN (MongoDB, Express, React, Node.js) Stacks, why you might want to use them, and how to combine them to build your web application (or your native mobile or desktop app).</p>
<p>The remainder of the series is focussed on working through the end to end steps of building a real (albeit simple) application ‚Äì <em>MongoPop</em>. <a href="./../../../mongodb/mean_stack_2_mongodb_node_js/index.html" title="MongoDB with Node.js"><strong>Part 2: Using MongoDB With Node.js</strong></a> created an environment where we could work with a MongoDB database from Node.js; it also created a simplified interface to the MongoDB Node.js Driver. <a href="htt.//mongodb/the-modern-application-stack-part-3-building-a-rest-api-using-express-js" title="Building REST API for MongoDB using Express JS"><strong>Part 3: Building a REST API with Express.js</strong></a> built on Part 2 by using Express.js to add a REST API which will be used by the clients that we implement in the final posts. <a href="./../../../mongodb/the-modern-application-stack-part-4-building-a-client-ui-using-angular-2-formerly-angularjs-typescript/index.html" title="Building a Client UI Using Angular 2 &amp; TypeScript"><strong>Part 4: Building a Client UI Using Angular 2 (formerly AngularJS) &amp; TypeScript</strong></a> completed the MEAN stack by adding an Angular 2 client.</p>
<p>This post is similar to <a href="./../../../mongodb/the-modern-application-stack-part-4-building-a-client-ui-using-angular-2-formerly-angularjs-typescript/index.html" title="Building an Angular 2 client application">Part 4</a> except that it uses ReactJS rather than Angular to implement a remote web-app client for the <strong>Mongopop</strong> application ‚Äì completing the full MERN application stack.</p>
<h2>ReactJS (recap)</h2>
<div id="attachment_4395" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/02/MERN_Stack.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4395" src="./../../../wp-content/uploads/2017/02/MERN_Stack-1024x450.png" alt="MERN Stack architecture with React" width="480" height="211" class="size-large wp-image-4395" srcset="./../../../wp-content/uploads/2017/02/MERN_Stack-1024x450.png 1024w, ./../../../wp-content/uploads/2017/02/MERN_Stack-300x132.png 300w, ./../../../wp-content/uploads/2017/02/MERN_Stack-768x338.png 768w, ./../../../wp-content/uploads/2017/02/MERN_Stack.png 1819w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4395" class="wp-caption-text">MERN Stack architecture with React</p>
</div>
<p><a href="https://facebook.github.io/react/" title="React, ReactJS">React</a> (alternatively referred to as ReactJS), is an up and coming alternative to Angular. It is a JavaScript library, developed by Facebook and Instagram, to build interactive, reactive user interfaces. Like Angular, React breaks the front-end application down into components. Each component can hold its own <em>state_and a parent can pass its state down to its child components (as _properties</em>) and those components can pass changes back to the parent through the use of callback functions. Components can also include regular data members (which are not state or properties) for data which isn&#8217;t rendered.</p>
<p>State variables should be updated using the <code>setState</code> function ‚Äì this allows ReactJS to calculate which elements of the page need to be refreshed in order to reflect the change. As refreshing the whole page can be an expensive operation, this can represent a significant efficiency and is a big part of what makes React live up to its name as ‚Äúreactive‚Äù.</p>
<p>React components are typically implemented using <a href="https://facebook.github.io/jsx/">JSX</a> ‚Äì an extension of JavaScript that allows HTML syntax to be embedded within the code.</p>
<p>React is most commonly executed within the browser but it can also be run on the back-end server within Node.js, or as a mobile app using <em>React Native</em>.</p>
<h2>JSX &amp; ReactJS</h2>
<p>It&#8217;s possible to implement ReactJS components using &#8216;pure&#8217; JavaScript (though, we&#8217;ve already seen in this series that it&#8217;s more complicated than that) but it&#8217;s more typical to use <a href="https://facebook.github.io/react/docs/introducing-jsx.html" title="Introducing JSX">JSX</a>. JSX extends the JavaScript syntax to allow HTML and JavaScript expressions to be used in the same code ‚Äì making the code concise and easy to understand.</p>
<p>Components can be implemented as a single function but in this post a class is used as it offers more options. The following code implements a very simple component:</p>
<pre><code class="js">class HelloMessage extends React.Component {
  render() {
    return &lt;div&gt;Hello {this.props.name}&lt;/div&gt;;
  }
}
</code></pre>
<p>By extending <code>React.Component</code>, we indicate that the class implements a component and that the <code>render()</code> method returns the contents of that component</p>
<p>The enclosing component can pass data down to this component as <em>properties</em> (accessed within the component as <code>this.props</code>); in this case, there is just one ‚Äì <code>name</code>. JavaScript can be included at any point in the returned HTML by surrounding it with braces <code>{this.props.name}</code>. The enclosing component would include this code within its own <code>render()</code> method, where <code>userName</code> is part of that component&#8217;s state.:</p>
<pre><code class="js">&lt;HelloMessage
name={this.state.userName}
/&gt;
</code></pre>
<p>The <em>state</em> data member for a component should include all of the variable values that are to be rendered (apart from those that have been passed down as properties). State values can be initialized directly in the class&#8217;s constructor function but after that, the <code>setState({userName: "Andrew"})</code> method should be used so that ReactJS knows that any elements containing <code>userName</code> should be rerendered.</p>
<p>JSX gets compiled into JavaScript before it&#8217;s used (this post uses the <a href="https://babeljs.io/" title="Babel JavaScript compiler">Babel compiler</a>) and so there are no special dependencies on the browser.</p>
<h2>Downloading, running, and using the Mongopop ReactJS application</h2>
<p>The compiled ReactJS client code is included as part if the Mongopop package installed in <a href="./../../../mongodb/mean_stack_2_mongodb_node_js/index.html" title="Using MongoDB With Node.js">Part 2: Using MongoDB With Node.js</a>.</p>
<p>The back-end application should be installed &amp; run in the same way as in parts 2 &amp; 3:</p>
<pre><code>git clone git@github.com:am-MongoDB/MongoDB-Mongopop.git
cd MongoDB-Mongopop
npm install
npm run express
</code></pre>
<p>Run the ReactJS client by browsing to <code>http://&lt;back-end-server&gt;:3000/react</code>.</p>
<p>Unlike the Angular client, the ReactJS application is developed and built as a separate project, and then compiled results are copied to <code>public/react</code> in the back-end server (this is covered in the next section).</p>
<h2>Build and deploy</h2>
<p>To access the source and build an updated version of the client, a new GitHub repository must be downloaded ‚Äì <a href="https://github.com/am-MongoDB/MongoDB-Mongopop-ReactJS" title="Mongopop ReactJS client for MongoDB">MongoDB-Mongopop-ReactJS</a>:</p>
<pre><code class="bash">git clone git@github.com:am-MongoDB/MongoDB-Mongopop-ReactJS.git
cd MongoDB-Mongopop-ReactJS
</code></pre>
<p>As with the back-end and the Angular client, <code>package.json</code> includes a list of dependencies as well as scripts:</p>
<pre><code class="js">{
  "name": "mongopop-react-client",
  "version": "0.1.0",
  "private": false,
  "homepage": "http://localhost:3000/react",
  "devDependencies": {
    "react-scripts": "0.8.5"
  },
  "dependencies": {
    "mongodb": "^2.2.20",
    "react": "^15.4.2",
    "react-dom": "^15.4.2"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "eject": "react-scripts eject"
  }
}
</code></pre>
<p>Before running any of the software, the Node.js dependencies (as defined in <code>package.json</code> must be installed into the <code>node_modules</code> directory):</p>
<pre><code>npm install
</code></pre>
<p>To compile the JSX code, start the development server, and run the ReactJS client, run:</p>
<pre><code>export PORT=3030 # As Express is already using 3000 on this machine
npm start
</code></pre>
<p>This should automatically open the application within your browser. Note that the ReactJS code was loaded from a local development server but it will use the real REST API running in the back-end.</p>
<p>Note that when running in this mode, you may get errors when your browser tries accessing the REST API ‚Äì this is because browsers typically block cross-site scripting. To work around this, install <a href="https://chrome.google.com/webstore/detail/allow-control-allow-origi/nlfbmbojpeacfghkpbjhddihlkkiljbi/related?hl=en-US">this extension from the Google Chrome store</a>.</p>
<p>If you make changes to the ReactJS client and want to include them in the real back-end then build a new, optimized version:</p>
<pre><code>npm run build
</code></pre>
<p>The contents of the <code>MongoDB-Mongopop-ReactJS/build</code> folder should then be copied to <code>MongoDB-Mongopop/public/react</code>.</p>
<p>To see exactly what <code>react-scripts</code> is doing for these operations, review the scripts in <code>node_modules/react-scripts/scripts</code>.</p>
<h2>Component architecture of the Mongopop ReactJS UI</h2>
<p>Most ReactJS applications are built from one or more, nested components ‚Äì Mongopop is no exception:</p>
<div id="attachment_4396" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/02/ReactJS_Components.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4396" src="./../../../wp-content/uploads/2017/02/ReactJS_Components-744x1024.png" alt="ReactJS components making up the Mongopop client app" width="480" height="661" class="size-large wp-image-4396" srcset="./../../../wp-content/uploads/2017/02/ReactJS_Components-744x1024.png 744w, ./../../../wp-content/uploads/2017/02/ReactJS_Components-218x300.png 218w, ./../../../wp-content/uploads/2017/02/ReactJS_Components-768x1057.png 768w, ./../../../wp-content/uploads/2017/02/ReactJS_Components.png 872w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4396" class="wp-caption-text">ReactJS components making up the Mongopop client app</p>
</div>
<p>The top-level component (<code>MongoPopContainer</code>) renders the &#8220;Welcome to MongoPop&#8221; heading before delegating the the rest of the page to seven sub-components.</p>
<p><code>MongoPopContainer</code> is implemented by a <a href="https://github.com/am-MongoDB/MongoDB-Mongopop-ReactJS/blob/master/src/App.js" title="Mongopop App.js main React component">JSX class of the same name</a>. The class contains the state variables for any information which must be used by more than one sub-component (e.g. the collection name). It also includes handler functions that will be used by sub-components when they make changes to any state variable passed down. The class implements the <code>render()</code> function which returns the expression that ReactJS must convert to HTML for rendering; in addition to the opening <code>&lt;h1&gt;Welcome to MongoPop&lt;/h1&gt;</code>, it includes an element for each of the sub-components. As part of those element definitions, it passes down state variables (which the sub-component receives as properties):</p>
<pre><code class="js">&lt;CountDocuments
  dataService={this.dataService}
  collection={this.state.MongoDBCollectionName}
/&gt;
</code></pre>
<p>Changes to a data value by a parent component will automatically be propagated to a child ‚Äì it&#8217;s best practice to have data flow in this direction as much as possible. If a data value is changed by a child <em>and</em> the parent (either directly or as a proxy for one of its other child components) needs to know of the change, then the child triggers an event. That event is processed by a handler registered by the parent ‚Äì the parent may then explicitly act on the change, but even if it does nothing explicit, the change flows to the other child components.</p>
<p>Each of the sub-components is implemented by its own JSX class ‚Äì e.g. <a href="https://github.com/am-MongoDB/MongoDB-Mongopop-ReactJS/blob/master/src/count.component.js" title="MongoDB Mongopop React count component">CountDocuments</a>.</p>
<p>Mongopop is a reasonably flat application with only one layer of sub-components below <code>MongoPopContainer</code>, but more complex applications may nest deeper and reuse components.</p>
<p>This table details what data is passed from <code>MongoPopContainer</code> down to each of its children and what data change events are sent back up to <code>MongoPopContainer</code> (and from there, back down to the other children):</p>
<table class="table table-bordered" summary="ReactJS components for Mongopop ReactJS client application">
<caption><strong>Flow of data between ReactJS components</strong></caption>
<thead>
<tr>
<th>Child component</th>
<th>Data passed down</th>
<th>Data changes passed back up</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<pre style="border:0px; background-color:#fff">ServerDetails</pre>
</td>
<td>Data service</td>
<td></td>
</tr>
<tr>
<td>
<pre style="border:0px; background-color:#fff">ConnectionInfo</pre>
</td>
<td>Data service</td>
<td></td>
</tr>
<tr>
<td>
<pre style="border:0px; background-color:#fff">CollectionName</pre>
</td>
<td>Data service</td>
<td>Collection Name</td>
</tr>
<tr>
<td rowspan="2">
<pre style="border:0px; background-color:#fff">AddDocuments</pre>
</td>
<td>Collection Name</td>
<td rowspan="2"></td>
</tr>
<tr>
<td>Data service</td>
</tr>
<tr>
<td rowspan="2">
<pre style="border:0px; background-color:#fff">CountDocuments</pre>
</td>
<td>Collection Name</td>
<td rowspan="2"></td>
</tr>
<tr>
<td>Data service</td>
</tr>
<tr>
<td rowspan="3">
<pre style="border:0px; background-color:#fff">UpdateDocuments</pre>
</td>
<td>Collection Name</td>
<td rowspan="3"></td>
</tr>
<tr>
<td>Data service</td>
</tr>
<tr>
<td>Sample data to play with</td>
</tr>
<tr>
<td rowspan="2">
<pre style="border:0px; background-color:#fff">SampleDocuments</pre>
</td>
<td>Collection Name</td>
<td rowspan="2">Sample data to play with</td>
</tr>
<tr>
<td>Data service</td>
</tr>
</tbody>
</table>
<h2>What are all of these files?</h2>
<p>To recap, the files and folders covered earlier in this series (for the back-end, under <code>MongoDB-Mongopop</code> folder):</p>
<ul>
<li>
<strong><code>package.json</code></strong>: Instructs the Node.js package manager (<code>npm</code>) what it needs to do; including which dependency packages should be installed</li>
<li>
<strong><code>node_modues</code></strong>: Directory where <code>npm</code> will install packages</li>
<li>
<strong><code>node_modues/mongodb</code></strong>: The <a href="https://mongodb.github.io/node-mongodb-native/" title="MongoDB driver for Node.js">MongoDB driver for Node.js</a>
</li>
<li>
<strong><code>node_modues/mongodb-core</code></strong>: Low-level MongoDB driver library; available for framework developers (application developers should avoid using it directly)</li>
<li>
<strong><code>javascripts/db.js</code></strong>: A JavaScript module we&#8217;ve created for use by our Node.js apps (in this series, it will be Express) to access MongoDB; this module in turn uses the MongoDB Node.js driver.</li>
<li>
<strong><code>config.js</code></strong>: Contains the application‚Äìspecific configuration options</li>
<li>
<strong><code>bin/www</code></strong>: The script that starts an Express application; this is invoked by the <code>npm start</code> script within the <code>package.json</code> file. Starts the HTTP server, pointing it to the <code>app</code> module in <code>app.js</code>
</li>
<li>
<strong><code>app.js</code></strong>: Defines the main back-end application module (<code>app</code>). Configures:
<ul>
<li>That the application will be run by Express</li>
<li>Which routes there will be &amp; where they are located in the file system (<code>routes</code> directory)</li>
<li>What view engine to use (Jade in this case)</li>
<li>Where to find the <em>views</em> to be used by the view engine (<code>views</code> directory)</li>
<li>What middleware to use (e.g. to parse the JSON received in requests)</li>
<li>Where the static files (which can be read by the remote client) are located (<code>public</code> directory)</li>
<li>Error handler for queries sent to an undefined route</li>
</ul>
</li>
<li>
<strong><code>views</code></strong>: Directory containing the templates that will be used by the Jade view engine to create the HTML for any pages generated by the Express application (for this application, this is just the error page that&#8217;s used in cases such as mistyped routes (&#8220;404 Page not found&#8221;))</li>
<li>
<strong><code>routes</code></strong>: Directory containing one JavaScript file for each Express route
<ul>
<li>
<strong><code>routes/pop.js</code></strong>: Contains the Express application for the <code>/pop</code> route; this is the implementation of the Mongopop REST API. This defines methods for all of the supported route paths.</li>
</ul>
</li>
<li>
<strong><code>public</code></strong>: Contains all of the static files that must be accessible by a remote client (e.g., our Angular to React apps).</li>
</ul>
<p>In addition, for the ReactJS client application:</p>
<ul>
<li>
<strong><code>public/react</code></strong> The deployed ReactJS client code; e.g. the JSX code that has been compiled down into vanilla JavaScript</li>
</ul>
<p>More significant for this post are the new files introduced under the <code>MongoDB-Mongopop-ReactJS</code> folder:</p>
<ul>
<li>
<strong><code>build</code></strong>: Directory containing the compiled and optmized JavaScript (to be copied to the back-end)</li>
<li>
<strong><code>node-modules</code></strong>: Node.js modules used by the ReactJS client application (as opposed to the Express, server-side Node.js modules)</li>
<li>
<strong><code>public/index.html</code></strong>: Outer template for the application (includes the <code>root</code>div element)</li>
<li>
<strong><code>src</code></strong>: Directory JSX source code files we write for the application
<ul>
<li>
<strong><code>index.js</code></strong>: Top-level JSX for the client; creates the <code>&lt;App /&gt;</code> element as a placeholder to be expanded by App.js </li>
<li>
<strong><code>App.js</code></strong>: Replaces the <code>&lt;App /&gt;</code> element from <code>index.js</code> with the output from the <code>MongoPopContainer</code> component/class. Includes the rest of the client components</li>
<li>
<strong><code>X.component.js</code></strong>: Class implementing sub-component X</li>
<li>
<strong><code>data.service.js</code></strong>: Service used to interact with the back-end REST API (mostly used to access the database)</li>
</ul>
</li>
<li>
<strong><code>package.json</code></strong>: Instructs the Node.js package manager (<code>npm</code>) what it needs to do; including which dependency packages should be installed</li>
</ul>
<h2>&#8220;Boilerplate&#8221; files and how they get invoked</h2>
<p>If you&#8217;ve already read <a href="./../../../mongodb/the-modern-application-stack-part-4-building-a-client-ui-using-angular-2-formerly-angularjs-typescript/index.html" title="Completing the MEAN stack ‚Äì Mongopop Angular2 client">Part 4: Building a Client UI Using Angular 2 (formerly AngularJS) &amp; TypeScript</a>, you should be relieved to see that far fewer source files are involved before reaching the actual application code:</p>
<div id="attachment_4397" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/02/ReactJS_file_relationships.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4397" src="./../../../wp-content/uploads/2017/02/ReactJS_file_relationships-962x1024.png" alt="Relationships between ReactJS files" width="480" height="511" class="size-large wp-image-4397" srcset="./../../../wp-content/uploads/2017/02/ReactJS_file_relationships-962x1024.png 962w, ./../../../wp-content/uploads/2017/02/ReactJS_file_relationships-282x300.png 282w, ./../../../wp-content/uploads/2017/02/ReactJS_file_relationships-768x817.png 768w, ./../../../wp-content/uploads/2017/02/ReactJS_file_relationships.png 1340w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4397" class="wp-caption-text">Relationships between ReactJS files</p>
</div>
<p><code>public/index.html</code> defines a <code>div</code> element with its <code>id</code> set to <code>root</code>:</p>
<p><script src="https://gist.github.com/am-MongoDB/9f298b6283e3a8d2d7d956291ec9439e.js"></script></p>
<p><code>src/index.js</code> accesses the <code>root</code> element from <code>public/index.html</code> so that it can be populated with the output from the application. It imports <code>src/App.js</code> and creates the <code>&lt;App /&gt;</code> element.</p>
<p><script src="https://gist.github.com/am-MongoDB/945a4aa73a75af90a25572b0de56b77e.js"></script></p>
<p><code>src/App.js</code> defines the <code>App</code> class to satisfy the <code>App</code> element in <code>src/index.js</code>; that class renders the <code>&lt;MongoPopContainer /&gt;</code> element, which is made up of all of the sub-components. <code>App.js</code> imports each of the sub-component source files (<code>X.component.js</code>) so that they can implement those components. It also imports <code>src/data.service.js</code> to give access to the back-end Mongopop REST API:</p>
<p><script src="https://gist.github.com/am-MongoDB/04bae5f85acfff596f7f1b4e29b7540e.js"></script></p>
<h2>Calling the REST API</h2>
<p>The <a href="https://github.com/am-MongoDB/MongoDB-Mongopop-ReactJS/blob/master/src/data.service.js" title="Acess to the Mongopop REST API from ReactJS">Data Service class</a> hides the communication with the back-end REST API; serving two purposes:</p>
<ul>
<li>Simplifying all of the components&#8217; code</li>
<li>Shielding the components&#8217; code from any changes in the REST API signature or behavior ‚Äì that can all be handled within the DataService</li>
</ul>
<p>The functions of the data service return promises to make working with their asynchronous behaviour simpler. Refer back to <a href="./../../../mongodb/mean_stack_2_mongodb_node_js/index.html" title="Using MongoDB With Node.js">Part 2: Using MongoDB With Node.js</a> if you need a recap on using <strong>promises</strong>.</p>
<p>As a reminder from <a href="h.//mongodb/the-modern-application-stack-part-3-building-a-rest-api-using-express-js" title="Building a REST API with Express.js">Part 3: Building a REST API with Express.js</a>, this is the REST API we have to interact with:</p>
<table class="table table-bordered" summary="Express route paths implemented for the Mongopop REST API">
<caption><strong>Express routes implemented for the Mongopop REST API</strong></caption>
<thead>
<tr>
<th>Route Path</th>
<th>HTTP Method</th>
<th>Parameters</th>
<th>Response</th>
<th>Purpose
<pre style="border:0px; background-color:#fff; height:0px">                      </pre>
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<pre style="border:0px; background-color:#fff">/pop/</pre>
</td>
<td>GET</td>
<td></td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
"AppName": "MongoPop",
"Version": 1.0
}
        </pre>
</td>
<td>Returns the version of the API.</td>
</tr>
<tr>
<td>
<pre style="border:0px; background-color:#fff">/pop/ip</pre>
</td>
<td>GET</td>
<td></td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">{"ip": string}</pre>
</td>
<td>Fetches the IP Address of the server running the Mongopop backend.</td>
</tr>
<tr>
<td>
<pre style="border:0px; background-color:#fff">/pop/config</pre>
</td>
<td>GET</td>
<td></td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
mongodb: {
    defaultDatabase: string,
    defaultCollection: string,
    defaultUri: string
},
mockarooUrl: string
}
        </pre>
</td>
<td>Fetches client-side defaults from the back-end config file.</td>
</tr>
<tr>
<td>
<pre style="border:0px; background-color:#fff">/pop/addDocs</pre>
</td>
<td>POST</td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
MongoDBURI: string;
collectionName: string;
dataSource: string;
numberDocs: number;
unique: boolean;
}
        </pre>
</td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
success: boolean;
count: number;
error: string;
}
        </pre>
</td>
<td>Add `numberDocs` batches of documents, using documents fetched from `dataSource`</td>
</tr>
<tr>
<td>
<pre style="border:0px; background-color:#fff">/pop/sampleDocs</pre>
</td>
<td>POST</td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
MongoDBURI: string;
collectionName: string;
numberDocs: number;
}
        </pre>
</td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
success: boolean;   
documents: string;
error: string;
}
        </pre>
</td>
<td>Read a sample of the documents from a collection.</td>
</tr>
<tr>
<td>
<pre style="border:0px; background-color:#fff">/pop/countDocs</pre>
</td>
<td>POST</td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
MongoDBURI: string; 
collectionName: string;
}
        </pre>
</td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
success: boolean;   
count: number;
error: string;
}
        </pre>
</td>
<td>Counts the number of documents in the collection.</td>
</tr>
<tr>
<td>
<pre style="border:0px; background-color:#fff">/pop/updateDocs</pre>
</td>
<td>POST</td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
MongoDBURI: string;
collectionName: string;
matchPattern: Object;
dataChange: Object;
threads: number;
}
        </pre>
</td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
success: boolean;
count: number;
error: string;
}
        </pre>
</td>
<td>Apply an update to all documents in a collection<br>
    which match a given pattern</td>
</tr>
</tbody>
</table>
<p>This data access class uses the <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest" title="Asynchronous-htttp-api">XMLHttpRequest API</a> to make asynchronous HTTP requests to the REST API running in the back-end (mostly to access MongoDB).</p>
<p>One of the simplest functions that <a href="https://github.com/am-MongoDB/MongoDB-Mongopop-ReactJS/blob/master/src/data.service.js" title="MongoDB MongoPope React daat service"><code>data.service.js</code></a> provides is <code>fetchConfig</code> which sends an HTTP <code>GET</code> request to the back-end to retrieve default the client configuration parameters:</p>
<p><script src="https://gist.github.com/am-MongoDB/b3e1a63771eda54d638c3bc632790fb1.js"></script></p>
<p>When using this API, the application registers handler functions against a number of possible events; in this case:</p>
<ul>
<li>
<code>onreadystatechange</code>: triggered if/when a successful HTTP response is received</li>
<li>
<code>onerror</code> &amp; <code>onabort</code>: triggered when there has been a problem</li>
</ul>
<p>The method returns a promise which subsequently ‚Äì via the bound-in function (<code>processRequest</code> &amp; <code>processError</code>) ‚Äì either:</p>
<ul>
<li>Provides an object representing the received response</li>
<li>Raises an error with an appropriate message</li>
</ul>
<p>The <code>baseURL</code> data member is set to <code>http://localhost:3000/pop</code> but that can be changed by editing the data service creation line in <a href="https://github.com/am-MongoDB/MongoDB-Mongopop-ReactJS/blob/master/src/App.js" title="MongoDB Mongopop React component"><code>App.js</code></a>:</p>
<pre><code class="js">this.dataService = new DataService("http://localhost:3000/pop");
</code></pre>
<p>Another of the methods sends a <code>POST</code> message to the REST API&#8217;s <code>pop/addDocs</code> route path to request the bulk addition of documents to a MongoDB collection:</p>
<p><script src="https://gist.github.com/am-MongoDB/adfb0970e14dcedc105965ba9a26f778.js"></script></p>
<p>The program flow is very similar to that of the previous function and, in the success case, it eventually resolves the returned promise with a count of the number of documents added.</p>
<p>A final method from the <code>DataService</code> class worth looking at is <code>calculateMongoDBURI()</code> which takes the MongoDB URI provided by <a href="https://cloud.mongodb.com/" title="Hosted MongoDB as a cloud service">MongoDB Atlas</a> and converts it into one that can actually be used to access the database ‚Äì replacing the <code>&lt;DATABASE&gt;</code> and <code>&lt;PASSWORD&gt;</code> placeholders with the actual values:</p>
<p><script src="https://gist.github.com/am-MongoDB/94448e69217467113e6bd03ec0828fef.js"></script></p>
<p>The function stores the final URI in the data service class&#8217;s <code>MongoDBURI</code> data member ‚Äì to sent to the back-end when accessing the database (see <code>sendAddDocs</code> above). It also returns a second value (<code>MongoDBURIRedacted</code>) with the password masked out ‚Äì to be used when displaying the URI.</p>
<h2>A simple component that accepts data from its parent</h2>
<p>Recall that the application consists of eight components: the top-level application which contains each of the <code>ServerDetails</code>, <code>ConnectionInfo</code>, <code>CollectionName</code>, <code>AddDocuments</code>, <code>CountDocuments</code>, <code>UpdateDocuments</code>, and <code>SampleDocuments</code> components.</p>
<p>When building a new application, you would typically start by designing the the top-level component and then working downwards. As the top-level container is, perhaps, the most complex one to understand, we&#8217;ll start at the bottom and then work up.</p>
<p>A simple sub-component to start with is the <a href="https://github.com/am-MongoDB/MongoDB-Mongopop-ReactJS/blob/master/src/add.component.js" title="MongoDB Mongopo Add React component"><code>AddDocuments</code></a> component:</p>
<div id="attachment_4398" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/02/ReactJS_Components-1.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4398" src="./../../../wp-content/uploads/2017/02/ReactJS_Components-1-744x1024.png" alt="ReactJS component" width="480" height="661" class="size-large wp-image-4398" srcset="./../../../wp-content/uploads/2017/02/ReactJS_Components-1-744x1024.png 744w, ./../../../wp-content/uploads/2017/02/ReactJS_Components-1-218x300.png 218w, ./../../../wp-content/uploads/2017/02/ReactJS_Components-1-768x1057.png 768w, ./../../../wp-content/uploads/2017/02/ReactJS_Components-1.png 872w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4398" class="wp-caption-text">ReactJS component</p>
</div>
<p>A central design decision for any component is what <em>state</em> is required (any variable data that is to be rendered by the component should either be part of the component&#8217;s state or of the <code>properties</code> passed by its parent component). The state is initialised in the class&#8217;s constructor:</p>
<p><script src="https://gist.github.com/am-MongoDB/efb47e5a6295df1344212ff8fe3955bc.js"></script></p>
<p>Recall that any state variable X can be read using <code>this.state.X</code> but only the constructor should write to it that way ‚Äì anywhere else should use the <code>setState()</code> function so that ReactJS is made aware of the change ‚Äì enabling it to refresh any affected elements. In this class, there are six state variables:</p>
<ul>
<li>
<code>MockarooURL</code>: The URL from a service such as <a href="https://www.mockaroo.com/">Mockaroo</a> which will return an array containing a set of example JSON documents</li>
<li>
<code>numDocsToAdd</code>: How many batches of documents should be added (with the default value of <code>MockarooURL</code>, each batch contains 1,000 documents)</li>
<li>
<code>uniqueDocs</code>: Whether each batch should be distinct from the other batches (this significantly slows things down)</li>
<li>
<code>numDocsAdded</code>: Updated with the number of added documents in the event that the operation succeeds</li>
<li>
<code>errorText</code>: Updated with an error message in the event that the operation fails</li>
<li>
<code>addedCollection</code>: Name of the collection that documents were last added to (initialized with the <code>collection</code> property passed by the parent component)</li>
</ul>
<div id="attachment_4399" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/02/state_variables_in_ReactJS_component.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4399" src="./../../../wp-content/uploads/2017/02/state_variables_in_ReactJS_component-1024x806.png" alt="ReactJS state variables" width="480" height="378" class="size-large wp-image-4399" srcset="./../../../wp-content/uploads/2017/02/state_variables_in_ReactJS_component-1024x806.png 1024w, ./../../../wp-content/uploads/2017/02/state_variables_in_ReactJS_component-300x236.png 300w, ./../../../wp-content/uploads/2017/02/state_variables_in_ReactJS_component-768x605.png 768w, ./../../../wp-content/uploads/2017/02/state_variables_in_ReactJS_component.png 1318w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4399" class="wp-caption-text">ReactJS state variables</p>
</div>
<p>Note that the constructor receives the properties passed down from the parent component. The constructor from the <code>React.Component</code> class must always be invoked within the component&#8217;s constructor: <code>super(props)</code>.</p>
<p>The <code>bind</code>s at the end of the constructor make <code>this</code> available for use within the class&#8217;s methods.</p>
<p>Further down in the class is the <code>render()</code> method which returns the content that ReactJS converts to HTML and JavaScript for the browser to render:</p>
<p><script src="https://gist.github.com/am-MongoDB/8905927872d7e997af97e794cd0fc587.js"></script></p>
<p>Recall that when coding in JSX, JavaScript can be embedded in the HTML by surrounding it with braces. The function uses that almost immediately to include the collection name in the component&#8217;s header: <code>&lt;h2&gt;Add documents to {this.props.collection}&lt;/h2&gt;</code>.</p>
<p>The first <code>input</code> is initialized with <code>this.state.MockarooURL</code> and if the user changes the value then <code>this.handleURLChange</code> is invoked ‚Äì which in turn updates the state value:</p>
<p><script src="https://gist.github.com/am-MongoDB/9edda5acf297e57cd93fc8044ef54914.js"></script></p>
<p>The same pattern holds for the <code>input</code>s for <code>numDocsToAdd</code> &amp; <code>uniqueDocs</code>.</p>
<p>When this component&#8217;s button is pressed, the <code>onClick</code> event calls <code>this.handleAddSubmit()</code>:</p>
<p><script src="https://gist.github.com/am-MongoDB/df3968f8e0f1c0f636688e0031e3f3de.js"></script></p>
<p>This function invokes the <code>sendAddDocs()</code> method of the data service that was passed down from the parent component (and so is part of <code>this.props</code>). <code>sendAddDocs()</code> returns a promise and the first function in the <code>then</code> clause is called if/when that promise is successfully resolved ‚Äì setting the <code>numDocsAdded</code> state to the number of added documents; if the promise is instead rejected then the second function is called ‚Äì setting the error message. In either case, the state change will cause the associated element to be rerendered:</p>
<p><script src="https://gist.github.com/am-MongoDB/a9d5003f7d238f4f4a576fe14007c0a3.js"></script></p>
<h2>Passing data down to a sub-component (and receiving changes back)</h2>
<p>The <code>AddDocs</code> component is embedded within the <code>render()</code>method of <code>MongoPopContainer</code> component class; implemented in <a href="https://github.com/am-MongoDB/MongoDB-Mongopop-ReactJS/blob/master/src/App.js" title="MongoDB Mongopo ReactJS component"><code>App.js</code></a>:</p>
<p><script src="https://gist.github.com/am-MongoDB/3f54f24d2e8933f85a57e941a07de136.js"></script></p>
<p>It passes down two items:</p>
<ul>
<li>
<code>dataService</code> is an instance of the <code>DataService</code> class and is used to access the back-end (in particular, to interact with MongoDB). Appears as part of <code>AddDocument</code>&#8216;s properties and can be accessed as <code>this.props.dataService</code>.</li>
<li>
<code>collection</code> is a string representing the collection name. Appears as part of <code>AddDocument</code>&#8216;s properties and can be accessed as <code>this.props.collection</code>.</li>
</ul>
<p><code>MongoDBCollectionName</code> is initialized, and <code>dataService</code> is instantiated as part of the <code>MongoPopContainer</code> constructor:</p>
<p><script src="https://gist.github.com/am-MongoDB/b9685e888b689a63fb5780581b625da2.js"></script></p>
<p>Note that for a real, deployed application, <code>http://localhost:3000/pop</code> would be replaced with the public URL for REST API. Additionally, you should consider adding authentication to the API .</p>
<p>But where did the collection name get set ‚Äì the constructor initialized it to an empty string but that&#8217;s not we see when running the application? There&#8217;s a clue in the constructor:</p>
<pre><code class="js">this.handleCollectionChange=this.handleCollectionChange.bind(this);
</code></pre>
<p>Recall that a <code>bind</code> like this is to allow a function (<code>this.handleCollectionChange()</code>) to access the <code>this</code> object:</p>
<p><script src="https://gist.github.com/am-MongoDB/a6050d700e87b6a84667e6e39636aa54.js"></script></p>
<p>The <code>handleCollectionChange()</code> method is passed down to the <code>CollectionName</code> component:</p>
<p><script src="https://gist.github.com/am-MongoDB/b3dd9d388660f44f7fe0d0396463f29f.js"></script></p>
<p>This is the <a href="https://github.com/am-MongoDB/MongoDB-Mongopop-ReactJS/blob/master/src/collection.name.component.js" title="MongoDB Mongopop ReactJS collection component"><code>CollectionName</code> component class</a>:</p>
<p><script src="https://gist.github.com/am-MongoDB/2f5609c0a6c00cbcee0c3039af179117.js"></script></p>
<p><code>CollectionName</code> has a single state variable ‚Äì <code>collection</code> ‚Äì which is initially set in the <code>componentDidMount()</code> method by fetching the default client configuration information from the back-end by calling <code>this.props.dataService.fetchConfig()</code>. <a href="https://facebook.github.io/react/docs/react-component.html#componentdidmount"><code>componentDidMount</code></a> is one of the <a href="https://facebook.github.io/react/docs/react-component.html">component lifecycle methods</a> that are part of any <code>React.Component</code> class ‚Äì it is invoked after the component has been loaded into the browser, it is where you would typically fetch any data from the back-end that&#8217;s needed for the component&#8217;s starting state. After setting the collection state, the change notification function passed down by the parent component is invoked to pass up the new value:</p>
<pre><code class="js">_this.props.onChange(_this.state.collection);
</code></pre>
<p>Of course, the user needs to be able to change the collection name and so an <code>input</code> element is included. The value of the element is initialized with the collection state variable and when the user changes that value, <code>this.handleCollectionNameChange</code> is invoked. In turn, that method updates the component state and passes the new collection name up to the parent component by calling the change notification method provided by the parent.</p>
<h2>Optionally empty components</h2>
<p>It&#8217;s common that a component should only display its contents if a particular condition is met. Mongopop includes a feature to allow the user to apply a bulk change to a set of documents ‚Äì selected using a pattern specified by the user. If they don&#8217;t know the typical document structure for the collection then it&#8217;s unlikely that they&#8217;ll make a sensible change. Mongopop forces them to first retrieve a sample of the documents before they&#8217;re given the option to make any changes.</p>
<p>This optionality is implemented through the <code>SampleDocuments</code> &amp; <code>UpdateDocuments</code> components:</p>
<table class="table table-bordered" summary="ReactJS components for Mongopop ReactJS client application">
<caption><strong>Flow of data between ReactJS components</strong></caption>
<thead>
<tr>
<th>Child component</th>
<th>Data passed down</th>
<th>Data changes passed back up</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="3">
<pre style="border:0px; background-color:#fff">UpdateDocuments</pre>
</td>
<td>Collection Name</td>
<td rowspan="3"></td>
</tr>
<tr>
<td>Data service</td>
</tr>
<tr>
<td>Sample data to play with</td>
</tr>
<tr>
<td rowspan="2">
<pre style="border:0px; background-color:#fff">SampleDocuments</pre>
</td>
<td>Collection Name</td>
<td rowspan="2">Sample data to play with</td>
</tr>
<tr>
<td>Data service</td>
</tr>
</tbody>
</table>
<p>Recall that the <code>MongoPopContainer</code> component class includes a state variable named <code>DataToPlayWith</code> which is initialized to <code>FALSE</code>:</p>
<p><script src="https://gist.github.com/am-MongoDB/e805cc84f22425ca69a3be3e5471f5f9.js"></script></p>
<p>That state is updated using the <code>handleDataAvailabiltyChange</code> method:</p>
<p><script src="https://gist.github.com/am-MongoDB/2643ae015b34cdd007d64c37723cabae.js"></script></p>
<p>That method is passed down to the <code>SampleDocuments</code> component:</p>
<p><script src="https://gist.github.com/am-MongoDB/e3045afa1ba4ef16ffd26eee8501b9ac.js"></script></p>
<p>When the user fetches a sample of the documents from a collection, the <a href="https://github.com/am-MongoDB/MongoDB-Mongopop-ReactJS/blob/master/src/sample.component.js" title="MongoDB Mongopo React JS sample documents component"><code>SampleDocuments</code> component</a> invokes the change notification method (<code>_this.props.onDataToWorkWith()</code>), passing back <code>TRUE</code> if the request was a success, <code>FALSE</code> otherwise:</p>
<p><script src="https://gist.github.com/am-MongoDB/935a2525c7c19a5fe4faafc1340a448a.js"></script></p>
<p><code>MongoPopContainer</code> passes its state variable <code>DataToPlayWith</code> down to the <code>UpdateDocuments</code> component:</p>
<p><script src="https://gist.github.com/am-MongoDB/29798f6f9ced02711723385352f87414.js"></script></p>
<p>The <a href="https://github.com/am-MongoDB/MongoDB-Mongopop-ReactJS/blob/master/src/update.component.js" title="MongoDB Mongopop Updated documents ReactJS component"><code>UpdateDocuments</code> component class</a> is then able to check the value using:</p>
<p><script src="https://gist.github.com/am-MongoDB/a504ca807afe4ea76e710d8ae7e14bd7.js"></script></p>
<p>Otherwise, the rest of this component is similar to those already seen:</p>
<p><script src="https://gist.github.com/am-MongoDB/584938c293791e488c360554f335af92.js"></script></p>
<h2>Periodic operations</h2>
<p>The <a href="https://github.com/am-MongoDB/MongoDB-Mongopop-ReactJS/blob/master/src/count.component.js" title="MongoDB Mongopop React count component"><code>CountDocuments</code> component</a> has an extra feature ‚Äì if the repeat option is checked then it will fetch and display the document count every five seconds. The function that&#8217;s called when the count button is clicked, checks the value of the state variable associated with the checkbox and if it&#8217;s set, calls <code>setInterval()</code> to call the <code>countOnce()</code> method every five seconds:</p>
<p><script src="https://gist.github.com/am-MongoDB/c117558651ebca0c2806ecb92cf5ce71.js"></script></p>
<p>The timer is cleared (<code>clearInterval()</code>) if there is an error or just before the component is unmounted (in <code>componentWillUnmount</code>).</p>
<h2>Other components</h2>
<p>For completeness, this is the full top-level component, <a href="https://github.com/am-MongoDB/MongoDB-Mongopop-ReactJS/blob/master/src/App.js"><code>App.js</code></a>, which includes the rest of the sub-components:</p>
<p><script src="https://gist.github.com/am-MongoDB/c906c0585d164abd7e2b5228b5d1bd1c.js"></script></p>
<p>The <a href="https://github.com/am-MongoDB/MongoDB-Mongopop-ReactJS/blob/master/src/connection.info.component.js" title="MongoDB Mongopop ReactJS connection info component"><code>ConnectionInfo</code> component</a>:</p>
<p><script src="https://gist.github.com/am-MongoDB/2b3542d5e2999273851b766b99df0969.js"></script></p>
<p>The <a href="https://github.com/am-MongoDB/MongoDB-Mongopop-ReactJS/blob/master/src/server.details.component.js" title="MongoDB Mongopop server details React component"><code>ServerDetails</code> component</a>:</p>
<p><script src="https://gist.github.com/am-MongoDB/d663218f8610c98510c2d458316f8c41.js"></script></p>
<h2>Testing &amp; debugging the ReactJS application</h2>
<p>Now that the full MERN stack application has been implemented, you can test it from within your browser:</p>
<p><iframe loading="lazy" width="560" height="315" src="https://www.youtube.com/embed/eS8R7z_FaVo?rel=0" frameborder="0" allowfullscreen></iframe></p>
<p>Debugging the ReactJS client is straightforward using the <a href="https://developer.chrome.com/devtools">Google Chrome Developer Tools</a> which are built into the Chrome browser. Despite the browser executing the transpiled JavaScript the Dev Tools allows you to navigate and set breakpoints in your JSX code:</p>
<div id="attachment_4400" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/02/debug_JSX_in_Chrome.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4400" src="./../../../wp-content/uploads/2017/02/debug_JSX_in_Chrome-1024x869.png" alt="Debug React JSX with Google Chrome Developer tools" width="480" height="407" class="size-large wp-image-4400" srcset="./../../../wp-content/uploads/2017/02/debug_JSX_in_Chrome-1024x869.png 1024w, ./../../../wp-content/uploads/2017/02/debug_JSX_in_Chrome-300x255.png 300w, ./../../../wp-content/uploads/2017/02/debug_JSX_in_Chrome-768x652.png 768w, ./../../../wp-content/uploads/2017/02/debug_JSX_in_Chrome.png 1432w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4400" class="wp-caption-text">Debug React JSX with Google Chrome Developer tools</p>
</div>
<p>If there is a compilation error then the error is sent to the browser:</p>
<div id="attachment_4401" style="width: 693px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/02/Compile_error.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4401" src="./../../../wp-content/uploads/2017/02/Compile_error.png" alt="ReactJS Compile errors in Google Chrome Developer tools" width="683" height="429" class="size-full wp-image-4401" srcset="./../../../wp-content/uploads/2017/02/Compile_error.png 683w, ./../../../wp-content/uploads/2017/02/Compile_error-300x188.png 300w" sizes="auto, (max-width: 683px) 100vw, 683px"></a><p id="caption-attachment-4401" class="wp-caption-text">ReactJS Compile errors in Google Chrome Developer tools</p>
</div>
<p>By installing the <a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi?hl=en"><em>React Developer Tools</em> from the Google Chrome Store</a>, you get an extra &#8220;React&#8221; tab that can be used to view or modify the state or properties for any of the components:</p>
<div id="attachment_4402" style="width: 1033px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/02/Chrome_React_dev_tool.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4402" src="./../../../wp-content/uploads/2017/02/Chrome_React_dev_tool.png" alt="React in Google Chrome Developer tools" width="1023" height="576" class="size-full wp-image-4402" srcset="./../../../wp-content/uploads/2017/02/Chrome_React_dev_tool.png 1023w, ./../../../wp-content/uploads/2017/02/Chrome_React_dev_tool-300x169.png 300w, ./../../../wp-content/uploads/2017/02/Chrome_React_dev_tool-768x432.png 768w" sizes="auto, (max-width: 1023px) 100vw, 1023px"></a><p id="caption-attachment-4402" class="wp-caption-text">React in Google Chrome Developer tools</p>
</div>
<h2>ReactJS vs. Angular</h2>
<p>So should you use Angular 2 or React for your new web application? A quick Google search will find you some fairly deep comparisons of the two technologies but in summary, Angular 2 is a little more powerful while React is easier for developers to get up to speed with and use (note how many fewer files are needed). The <a href="./../../../mongodb/the-modern-application-stack-part-4-building-a-client-ui-using-angular-2-formerly-angularjs-typescript/index.html" title="Angular2 with MongoDB">previous blog</a> in this series built the Mongopop client application using Angular 2, while this one built a near-identical app using ReactJS ‚Äì hopefully these posts have helped you pick a favorite.</p>
<p>The following snapshot from Google Trends suggests that Angular has been much more common for a number of years but that React is gaining ground:</p>
<div id="attachment_4403" style="width: 837px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2017/02/ReactJS_vs_Angular.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4403" src="./../../../wp-content/uploads/2017/02/ReactJS_vs_Angular.png" alt="ReactJS popularity vs. Angular and Angular 2" width="827" height="374" class="size-full wp-image-4403" srcset="./../../../wp-content/uploads/2017/02/ReactJS_vs_Angular.png 827w, ./../../../wp-content/uploads/2017/02/ReactJS_vs_Angular-300x136.png 300w, ./../../../wp-content/uploads/2017/02/ReactJS_vs_Angular-768x347.png 768w" sizes="auto, (max-width: 827px) 100vw, 827px"></a><p id="caption-attachment-4403" class="wp-caption-text">ReactJS popularity vs. Angular and Angular 2</p>
</div>
<h2>Summary &amp; what&#8217;s next in the series</h2>
<p>Previous posts stepped through building the Mongopop application back-end and then the creation of an Angular 2 client application. This post described how to build a front-end client using ReactJS. At this point, we have a complete, working, MERN stack application.</p>
<p>The coupling between the front and back-end is loose; the client simply makes remote, HTTP requests to the back-end service ‚Äì using the interface created in <a href="h.//mongodb/the-modern-application-stack-part-3-building-a-rest-api-using-express-js" title="Building REST API for MongoDB using Express JS">Part 3: Building a REST API with Express.js</a>.</p>
<p>This series will finish by demonstrating alternate methods to implement front-end client applications that aren&#8217;t browser-based.</p>
<p>Continue to the final post this blog series to discover some more unconventional ways to use the Mongopop REST API:<br>
* <a href="./../../../mongodb/modern-application-stack-part-1-introducing-the-mean-stack/index.html" title="MEAN stack, MERN stack">Part 1: Introducing The MEAN Stack (and the young MERN upstart)</a><br>
* <a href="./../../../mongodb/mean_stack_2_mongodb_node_js/index.html" title="Using MongoDB With Node.js">Part 2: Using MongoDB With Node.js</a><br>
* <a href="./../../../mongodb/the-modern-application-stack-part-3-building-a-rest-api-using-express-js/index.html" title="Building REST API for MongoDB using Express JS">Part 3: Building a REST API with Express.js</a><br>
* <a href="./../../../mongodb/the-modern-application-stack-part-4-building-a-client-ui-using-angular-2-formerly-angularjs-typescript/index.html" title="Completing the MEAN stack ‚Äì Mongopop Angular2 client">Part 4: Building a Client UI Using Angular 2 (formerly AngularJS) &amp; TypeScript</a><br>
* <a href="./../../../mongodb/the-modern-application-stack-part-5-using-reactjs-es6-jsx-to-build-a-ui-the-rise-of-mern/index.html" title="Building an application front-end with ReactJS and ES6">Part 5: Using ReactJS, ES6 &amp; JSX to Build a UI (the rise of MERN)</a><br>
* <a href="./../../../mongodb/rest-mobile-app-amazon-alexa-cloud-services/index.html" title="Using REST APIs from mobile applications and Amazon Alexa">Part 6: Browsers Aren&#8217;t the Only UI ‚Äì Mobile Apps, Amazon Alexa, Cloud Services&#8230;</a></p>
<h2>A simpler way to build your app ‚Äì MongoDB Stitch, Backend as a Service</h2>
<p><a href="https://www.mongodb.com/cloud/stitch">MongoDB Stitch</a> is a backend as a service (BaaS), giving developers a REST-like API to MongoDB, and composability with other services, backed by a robust system for configuring fine-grained data access controls. Stitch provides native SDKs for JavaScript, iOS, and Android.</p>
<p>Built-in integrations give your application frontend access to your favorite third party services: Twilio, AWS S3, Slack, Mailgun, PubNub, Google, and more. For ultimate flexibility, you can add custom integrations using MongoDB Stitch&#8217;s HTTP service.</p>
<p>MongoDB Stitch allows you to compose multi-stage pipelines that orchestrate data across multiple services; where each stage acts on the data before passing its results on to the next.</p>
<p>Unlike other BaaS offerings, MongoDB Stitch works with your existing as well as new MongoDB clusters, giving you access to the full power and scalability of the database. By defining appropriate data access rules, you can selectively expose your existing MongoDB data to other applications through MongoDB Stitch&#8217;s API.</p>
<p>If you&#8217;d like to try it out, <a href="./../../../mongodb/mongodb-stitch-the-latest-and-best-way-to-build-your-app/index.html" title="MongoDB Stitch - the latest, and best way to build your app">step through building an application with MongoDB Stitch</a>.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/the-modern-application-stack-part-5-using-reactjs-es6-jsx-to-build-a-ui-the-rise-of-mern" data-via="wpbeginner" data-text="The Modern Application Stack &#8211; Part 5: Using ReactJS, ES6 &#038; JSX to Build a UI (the rise of MERN)" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/the-modern-application-stack-part-5-using-reactjs-es6-jsx-to-build-a-ui-the-rise-of-mern"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/the-modern-application-stack-part-5-using-reactjs-es6-jsx-to-build-a-ui-the-rise-of-mern" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Fthe-modern-application-stack-part-5-using-reactjs-es6-jsx-to-build-a-ui-the-rise-of-mern&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../../../category/mongodb/index.html" rel="category tag">MongoDB</a> | 
Tags: <a href="./../../es6/index.html" rel="tag">es6</a>, <a href="./../../javascript/index.html" rel="tag">javascript</a>, <a href="./../../mern/index.html" rel="tag">mern</a>, <a href="./../../mern-stack/index.html" rel="tag">mern stack</a>, <a href="./../../mongodb/index.html" rel="tag">mongodb</a>, <a href="./../../react/index.html" rel="tag">REACT</a>, <a href="./../../reactjs/index.html" rel="tag">reactjs</a>
</div>

			</div>			<div id="post-4387" class="post-4387 post type-post status-publish format-standard hentry category-mongodb tag-angular tag-angular-js tag-angular2 tag-mean tag-mean-stack tag-mongodb tag-mongopop tag-observables tag-typescript">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../../../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../../../mongodb/the-modern-application-stack-part-4-building-a-client-ui-using-angular-2-formerly-angularjs-typescript/index.html">February 17, 2017</a>
			</div>
	<div class="postcomments">
		<a href="./../../../mongodb/the-modern-application-stack-part-4-building-a-client-ui-using-angular-2-formerly-angularjs-typescript/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../../../mongodb/the-modern-application-stack-part-4-building-a-client-ui-using-angular-2-formerly-angularjs-typescript/index.html" rel="bookmark">The Modern Application Stack ‚Äì Part 4: Building a Client UI Using Angular 2 (formerly AngularJS) &#038; TypeScript</a></h2>
				
				<div class="entry">
										<h2>Introduction</h2>
<p>This is the fourth in a series of blog posts examining technologies such as Angular that are driving the development of modern web and mobile applications.</p>
<p><a href="./../../../mongodb/modern-application-stack-part-1-introducing-the-mean-stack/index.html" title="The MEAN Stack - with MongoDB">&#8220;Modern Application Stack ‚Äì Part 1: Introducing The MEAN Stack&#8221;</a> introduced the technologies making up the <strong>MEAN</strong> (<strong>M</strong>ongoDB, <strong>E</strong>xpress, <strong>A</strong>ngular, <strong>N</strong>ode.js) and <strong>MERN</strong> (<strong>M</strong>ongoDB, <strong>E</strong>xpress, <strong>R</strong>eact, <strong>N</strong>ode.js) Stacks, why you might want to use them, and how to combine them to build your web application (or your native mobile or desktop app).</p>
<p>The remainder of the series is focussed on working through the end to end steps of building a real (albeit simple) application. ‚Äì <em>MongoPop</em>. <a href="./../../../mongodb/mean_stack_2_mongodb_node_js/index.html" title="MEAN Stack MERN Stack - Node.js &amp; MongoDB"><em>Part 2: Using MongoDB With Node.js</em></a> created an environment where we could work with a MongoDB database from Node.js; it also created a simplified interface to the MongoDB Node.js Driver. <a href="./../../../mongodb/the-modern-application-stack-part-3-building-a-rest-api-using-express-js/index.html" title="Building REST API for MongoDB using Express JS">Part 3: Building a REST API with Express.js</a> built on Part 2 by using Express.js to add a REST API which will be used by the clients that we implement in the final posts.</p>
<p>This post demonstrates how to use Angular 2 (the evolution of Angular.js) to implement a remote web-app client for the <em>Mongopop</em> application.</p>
<h2>Angular 2 (recap)</h2>
<p><strong>Angular</strong>, originally created and maintained by Google, runs your JavaScript code within the user&#8217;s web browsers to implement a <em>reactive</em> user interface (UI). A reactive UI gives the user immediate feedback as they give their input (in contrast to static web forms where you enter all of your data, hit &#8220;Submit&#8221; and wait.</p>
<p></p>
<center><img decoding="async" src="./../../../wp-content/uploads/2017/02/Reactive_MongoDB_URI.gif" alt="Reactive Angular 2 application" title="Reactive Angular 2 application"></center>
<p>Version 1 of Angular was called AngularJS but it was shortened to Angular in Angular 2 after it was completely rewritten in <a href="https://www.typescriptlang.org/">Typescript</a> (a superset of JavaScript) ‚Äì Typescript is now also the recommended language for Angular apps to use.</p>
<p>You implement your application front-end as a set of <em>components</em> ‚Äì each of which consists of your JavaScript (Typescript) code and an HTML template that includes hooks to execute and use the results from your Typescript functions. Complex application front-ends can be crafted from many simple (optionally nested) components.</p>
<p>Angular application code can also be executed on the back-end server rather than in a browser, or as a native desktop or mobile application.</p>
<p><img decoding="async" src="./../../../wp-content/uploads/2017/02/MEAN_Stack.png" alt="MEAN Stack Architecture" title="MEAN Stack Architecture"></p>
<h2>Downloading, running, and using the Mongopop application</h2>
<p>The Angular client code is included as part if the Mongopop package installed in <a href="./../../../mongodb/mean_stack_2_mongodb_node_js/index.html" title="Using MongoDB With Node.js">Part 2: Using MongoDB With Node.js</a>.</p>
<p>The back-end application should be run in the same way as in parts 2 &amp; 3. The client software needs to be <em>transpiled</em> from Typescript to JavaScript ‚Äì the client software running in a remote browser can then download the JavaScript files and execute them.</p>
<p>The existing <code>package.json</code> file includes a script for transpiling the Angular 2 code:</p>
<pre><code class="js">  "scripts": {
        ...
    "tsc:w": "cd public &amp;&amp; npm run tsc:w",
        ...  
},
</code></pre>
<p>That <code>tsc:w</code> delegates the work to a script of the same name defined in <code>public/package.json</code>;</p>
<pre><code class="js">  "scripts": {
        ...
    "tsc:w": "tsc -w",
        ...  
},
</code></pre>
<p><code>tsc -w</code> continually monitors the client app&#8217;s Typescript files and reruns the transpilation every time they are edited.</p>
<p>To start the continual transpilation of the Angular 2 code:</p>
<pre><code class="js">npm run rsc:w
</code></pre>
<h2>Component architecture of the Mongopop Angular UI</h2>
<p>Angular applications (both AngularJS and Angular2) are built from one or more, nested components ‚Äì Mongopop is no exception:</p>
<p><img decoding="async" src="./../../../wp-content/uploads/2017/02/AngularComponents.png" alt="Mongopop Angular2 Components" title="MEAN Stack Angular Components"></p>
<p>The main component (<code>AppComponent)</code>contains the HTML and logic for connecting to the database and orchestrating its sub-components. Part of the definition of <code>AppComponent</code> is meta data/decoration to indicate that it should be loaded at the point that a <code>my-app</code> element (<code>&lt;my-app&gt;&lt;/my-app&gt;</code>) appears in the <code>index.html</code> file (once the component is running, its output replaces whatever holding content sits between <code>&lt;my-app&gt;</code> and <code>&lt;/my-app&gt;</code>). <code>AppComponent</code> is implemented by:</p>
<ul>
<li>A Typescript file containing the <code>AppComponent</code> class (including the data members, initialization code, and member functions</li>
<li>A HTML file containing
<ul>
<li>HTML layout</li>
<li>Rendering of data members</li>
<li>Elements to be populated by sub-components</li>
<li>Data members to be passed down for use by sub-components</li>
<li>Logic (e.g. what to do when the user changes the value in a form)</li>
</ul>
</li>
<li>(Optionally) a <em>CSS</em> file to customise the appearance of the rendered content</li>
</ul>
<p>Mongopop is a reasonably flat application with only one layer of sub-components below <code>AppComponent</code>, but more complex applications may nest deeper.</p>
<p>Changes to a data value by a parent component will automatically be propagated to a child ‚Äì it&#8217;s best practice to have data flow in this direction as much as possible. If a data value is changed by a child <em>and</em> the parent (either directly or as a proxy for one of its other child components) needs to know of the change, then the child triggers an event. That event is processed by a handler registered by the parent ‚Äì the parent may then explicitly act on the change, but even if it does nothing explicit, the change flows to the other child components.</p>
<p>This table details what data is passed from <code>AppComponent</code> down to each of its children and what data change events are sent back up to <code>AppComponent</code> (and from there, back down to the other children):</p>
<table class="table table-bordered" summary="Angular components for Mongopop Angular client application">
<caption><strong>Flow of data between Angular components</strong></caption>
<thead>
<tr>
<th>Child component</th>
<th>Data passed down</th>
<th>Data changes passed back up</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="3">
<pre style="border:0px; background-color:#fff">AddComponent</pre>
</td>
<td>Data service</td>
<td rowspan="3">Collection name</td>
</tr>
<tr>
<td>Collection name</td>
</tr>
<tr>
<td>Mockaroo URL</td>
</tr>
<tr>
<td rowspan="2">
<pre style="border:0px; background-color:#fff">CountComponent</pre>
</td>
<td>Data service</td>
<td rowspan="2">Collection name</td>
</tr>
<tr>
<td>Collection name</td>
</tr>
<tr>
<td rowspan="2">
<pre style="border:0px; background-color:#fff">UpdateComponent</pre>
</td>
<td>Data service</td>
<td rowspan="2">Collection name</td>
</tr>
<tr>
<td>Collection name</td>
</tr>
<tr>
<td rowspan="2">
<pre style="border:0px; background-color:#fff">SampleComponent</pre>
</td>
<td>Data service</td>
<td rowspan="2">Collection name</td>
</tr>
<tr>
<td>Collection name</td>
</tr>
</tbody>
</table>
<h2>What are all of these files?</h2>
<p>To recap, the files and folders covered earlier in this series:</p>
<ul>
<li>
<strong><code>package.json</code></strong>: Instructs the Node.js package manager (<code>npm</code>) what it needs to do; including which dependency packages should be installed</li>
<li>
<strong><code>node_modues</code></strong>: Directory where <code>npm</code> will install packages</li>
<li>
<strong><code>node_modues/mongodb</code></strong>: The <a href="https://mongodb.github.io/node-mongodb-native/">MongoDB driver for Node.js</a>
</li>
<li>
<strong><code>node_modues/mongodb-core</code></strong>: Low-level MongoDB driver library; available for framework developers (application developers should avoid using it directly)</li>
<li>
<strong><code>javascripts/db.js</code></strong>: A JavaScript module we&#8217;ve created for use by our Node.js apps (in this series, it will be Express) to access MongoDB; this module in turn uses the MongoDB Node.js driver.</li>
<li>
<strong><code>config.js</code></strong>: Contains the application‚Äìspecific configuration options</li>
<li>
<strong><code>bin/www</code></strong>: The script that starts an Express application; this is invoked by the <code>npm start</code> script within the <code>package.json</code> file. Starts the HTTP server, pointing it to the <code>app</code> module in <code>app.js</code>
</li>
<li>
<strong><code>app.js</code></strong>: Defines the main back-end application module (<code>app</code>). Configures:
<ul>
<li>That the application will be run by Express</li>
<li>Which routes there will be &amp; where they are located in the file system (<code>routes</code> directory)</li>
<li>What view engine to use (Jade in this case)</li>
<li>Where to find the <em>views</em> to be used by the view engine (<code>views</code> directory)</li>
<li>What middleware to use (e.g. to parse the JSON received in requests)</li>
<li>Where the static files (which can be read by the remote client) are located (<code>public</code> directory)</li>
<li>Error handler for queries sent to an undefined route</li>
</ul>
</li>
<li>
<strong><code>views</code></strong>: Directory containing the templates that will be used by the Jade view engine to create the HTML for any pages generated by the Express application (for this application, this is just the error page that&#8217;s used in cases such as mistyped routes (&#8220;404 Page not found&#8221;))</li>
<li>
<strong><code>routes</code></strong>: Directory containing one JavaScript file for each Express route
<ul>
<li>
<strong><code>routes/pop.js</code></strong>: Contains the Express application for the <code>/pop</code> route; this is the implementation of the Mongopop REST API. This defines methods for all of the supported route paths.</li>
</ul>
</li>
<li>
<strong><code>public</code></strong>: Contains all of the static files that must be accessible by a remote client (e.g., our Angular to React apps).</li>
</ul>
<p>Now for the <em>new files</em> that implement the Angular client (note that because it must be downloaded by a remote browser, it is stored under the <code>public</code> folder):</p>
<ul>
<li>
<strong><code>public/package.json</code></strong>: Instructs the Node.js package manager (<code>npm</code>) what it needs to do; including which dependency packages should be installed (i.e. the same as <code>/package.json</code> but this is for the Angular client app)</li>
<li>
<strong><code>public/index.html</code></strong>: Entry point for the application; served up when browsing to <code>http://&lt;backend-server&gt;/</code>. Imports <code>public/system.config.js</code>
</li>
<li>
<strong><code>public/system.config.js</code></strong>: Configuration information for the Angular client app; in particular defining the remainder of the directories and files:
<ul>
<li>
<strong><code>public/app</code></strong>: Source files for the client application ‚Äì including the Typescript files (and the transpiled JavaScript files) together the HTML and any custom CSS files. Combined, these define the Angular components.
<ul>
<li>
<strong><code>public/app/main.ts</code></strong>: Entry point for the Angular app. Bootstraps <code>public/app/app.module.ts</code>
</li>
<li>
<strong><code>public/app/app.module.ts</code></strong>: Imports required modules, declares the application components and any services. Declares which component to bootstrap (<code>AppComponent</code> which is implemented in <code>public/app/app.component.*</code>)</li>
<li>
<strong><code>public/app/app.component.html</code></strong>: HTML template for the top-level component. Includes elements that are replaced by sub-components</li>
<li>
<strong><code>public/app/app.component.ts</code></strong>: Implements the <code>AppComponent</code> class for the top-level component</li>
<li>
<strong><code>public/app/X.component.html</code></strong>: HTML template for sub-component <em>X</em>
</li>
<li>
<strong><code>public/app/X.component.ts</code></strong>: Implements the class for sub-component <em>X</em>
</li>
<li>
<strong><code>AddDocsRequest.ts</code></strong>, <strong><code>ClientConfig.ts</code></strong>, <strong><code>CountDocsRequest.ts</code></strong>, <strong><code>MongoResult.ts</code></strong>, <strong><code>MongoReadResult.ts</code></strong>, <strong><code>SampleDocsRequest.ts</code></strong>, &amp; <strong><code>UpdateDocsRequest.ts</code></strong>: Classes that match the request parameters and response formats of the REST API that&#8217;s used to access the back-end</li>
<li>
<strong><code>data.service.ts</code></strong>: Service used to access the back-end REST API (mostly used to access the database)</li>
<li>
<strong><code>X.js*</code> &amp; *<code>X.js.map</code></strong>: Files which are generated by the transpilation of the Typescript files.</li>
</ul>
</li>
<li>
<strong><code>public/node-modules</code></strong>: Node.js modules used by the Angular app (as opposed to the Express, server-side Node.js modules)</li>
<li>
<strong><code>public/styles.css</code></strong>: CSS style sheet (imported by <code>public/index.html)</code> ‚Äì applies to all content in the home page, not just content added by the components</li>
<li>
<strong><code>public/stylesheets/styles.css</code></strong>: CSS style sheet (imported by <code>public/app/app.component.ts</code> and the other components) ‚Äì note that each component could have their own, specialized style sheet instead</li>
</ul>
</li>
</ul>
<h2>&#8220;Boilerplate&#8221; files and how they get invoked</h2>
<p>This is an imposing number of new files and this is one of the reasons that Angular is often viewed as the more complex layer in the application stack. One of the frustrations for many developers, is the number of files that need to be created and edited on the client side before your first line of component/application code is executed. The good news is that there is a consistent pattern and so it&#8217;s reasonable to fork you app from an existing project ‚Äì the <a href="https://github.com/am-MongoDB/MongoDB-Mongopop">Mongopop app can be cloned from GitHub</a> or, the <a href="https://angular.io/docs/ts/latest/cli-quickstart.html">Angular QuickStart</a> can be used as your starting point.</p>
<p>As a reminder, here is the relationship between these common files (and our application-specific components):</p>
<p><img decoding="async" src="./../../../wp-content/uploads/2017/02/Angular-file-links.png" alt="Angular2 boilerplate files" title="Angular2 boilerplate files"></p>
<h2>Contents of the &#8220;boilerplate&#8221; files</h2>
<p>This section includes the contents for each of the non-component files and then remarks on some of the key points.</p>
<p><em><code>public/package.json</code></em></p>
<p><script src="https://gist.github.com/am-MongoDB/9f68574012cc11d1945426ea0d5b7f2b.js"></script></p>
<p>The <code>scripts</code> section defines what <code>npm</code> should do when you type <code>npm run &lt;command-name&gt;</code> from the command line. Of most interest is the <code>tsc:w</code> script ‚Äì this is how the transpiler is launched. After transpiling all of the <code>.ts</code> Typescript files, it watches them for changes ‚Äì retranspiling as needed.</p>
<p>Note that the <code>dependencies</code> are for this Angular client. They will be installed in <code>public/node_modules</code> when <code>npm install</code> is run (for Mongopop, this is done automatically when building the <a href="https://github.com/am-MongoDB/MongoDB-Mongopop" title="Mongopop ‚Äì MEAN application for populating MongoDB">full project</a> ).</p>
<p><em><code>public/index.html</code></em></p>
<p><script src="https://gist.github.com/am-MongoDB/55538a628996f34ccbf4949493e716a9.js"></script></p>
<p>Focussing on the key lines, the application is started using the <code>app</code> defined in <code>systemjs.config.js</code>:</p>
<p><script src="https://gist.github.com/am-MongoDB/0ad4193353ecfa6678980deed8c5bffc.js"></script></p>
<p><script src="./systemjs.config.js"></script></p>
<p><script>System.import('app').catch(function(err){ console.error(err); });</script></p>
<p>And the output from the application replaces the placeholder text in the <code>my-app</code> element:</p>
<pre><code class="html">&lt;my-app&gt;Loading MongoPop client app...&lt;/my-app&gt;
</code></pre>
<p><em><code>public/systemjs.config.js</code></em></p>
<p><script src="https://gist.github.com/am-MongoDB/ef2a2dd2627f0ca8c25c91f937658188.js"></script></p>
<p><code>packages.app.main</code> is mapped to <code>public/app/main.js</code> ‚Äì note that <code>main.js</code>  is referenced rather than <code>main.ts</code> as it is always the transpiled code that is executed. This is what causes <code>main.ts</code> to be run.</p>
<p><em><code>public/app/main.ts</code></em></p>
<p><script src="https://gist.github.com/am-MongoDB/c0051df45939be6b09166bde5021eebe.js"></script></p>
<p>This simply imports and bootstraps the <code>AppModule</code> class from <code>public/app/app.module.ts</code> (actually <code>app.module.js</code>)</p>
<p><em><code>public/app/app.module.ts</code></em></p>
<p><script src="https://gist.github.com/am-MongoDB/fbea98f7a6f983cd169eaaa8ec861bc3.js"></script></p>
<p>This is the first file to actually reference the components which make up the Mongopop application!</p>
<p>Note that <code>NgModule</code> is the core module for Angular and must always be imported; for this application <code>BrowserModule</code>, <code>HttpModule</code>, and <code>FormsModule</code> are also needed.</p>
<p>The <code>import</code> commands also bring in the (<code>.js</code>) files for each of the components as well as the data service.</p>
<p>Following the imports, the <code>@NgModule</code> <em>decorator function</em> takes a JSON object that tells Angular how to run the code for this module (<code>AppModule</code>) ‚Äì including the list of imported modules, components, and services as well as the module/component needed to bootstrap the actual application (<code>AppComponent</code>).</p>
<h2>Typescript &amp; Observables (before getting into component code)</h2>
<p>As a reminder from <a href="./../../../mongodb/modern-application-stack-part-1-introducing-the-mean-stack/index.html" title="MEAN stack, MERN stack">Part 1: Introducing The MEAN Stack (and the young MERN upstart)</a>; the most recent, widely supported version is ECMAScript 6 ‚Äì normally referred to as <a href="http://es6-features.org/#Constants">/ES6/</a>. ES6 is supported by recent versions of Chrome, Opera, Safari, and Node.js). Some platforms (e.g. Firefox and Microsoft Edge) do not yet support all features of ES6. These are some of the key features added in ES6:</p>
<ul>
<li>Classes &amp; modules</li>
<li>Promises ‚Äì a more convenient way to handle completion or failure of synchronous function calls (compared to callbacks)</li>
<li>Arrow functions ‚Äì a concise syntax for writing function expressions</li>
<li>Generators ‚Äì functions that can yield to allow others to execute</li>
<li>Iterators</li>
<li>Typed arrays</li>
</ul>
<p><a href="https://www.typescriptlang.org/">Typescript</a> is a superset of ES6 (JavaScript); adding static type checking. Angular 2 is written in Typescript and Typescript is the primary language to be used when writing code to run in Angular 2.</p>
<p>Because ES6 and Typescript are not supported in all environments, it is common to <em>transpile</em> the code into an earlier version of JavaScript to make it more portable. <code>tsc</code> is used to transpile Typescript into JavaScript.</p>
<p>And of course, JavaScript is augmented by numerous libraries. The Mongopop Angular 2 client uses <strong>Observables</strong> from the <a href="https://github.com/Reactive-Extensions/RxJS">RxJS reactive libraries</a> which greatly simplify making asynchronous calls to the back-end (a pattern historically referred to as AJAX).</p>
<p><a href="http://reactivex.io/documentation/observable.html">RxJS Observables</a> fulfil a similar role to ES6 promises in that they simplify the code involved with asynchronous function calls (removing the need to explicitly pass callback functions). Promises are more contained than Observables, they make a call and later receive a single signal that the asynchronous activity triggered by the call succeeded or failed. Observables can have a more complex lifecycle, including the caller receiving multiple sets of results and the caller being able to cancel the Observable.</p>
<p>The Mongopop application uses two simple patterns when calling functions that return an Observable; the first is used within the components to digest the results from our own data service:</p>
<p><script src="https://gist.github.com/am-MongoDB/f718ae55373d3901b2caebd523d26b12.js"></script></p>
<p>In Mongopop&#8217;s use of Observables, we don&#8217;t have anything to do in the final arrow function and so don&#8217;t use it (and so it could have used the second pattern instead ‚Äì but it&#8217;s interesting to see both).</p>
<p>The second pattern is used within the data service when making calls to the Angular 2 <code>http</code> module (this example also shows how we return an Observable back to the components):</p>
<p><script src="https://gist.github.com/am-MongoDB/4cd344f9d827e301b9d4e7512e5ff4ce.js"></script></p>
<h2>Calling the REST API</h2>
<p>The <a href="https://github.com/am-MongoDB/MongoDB-Mongopop/blob/master/public/app/data.service.ts" title="MongoPop DataService class from GitHub"><code>DataService</code> class</a> hides the communication with the back-end REST API; serving two purposes:</p>
<ul>
<li>Simplifying all of the components&#8217; code</li>
<li>Shielding the components&#8217; code from any changes in the REST API signature or behavior ‚Äì that can all be handled within the DataService</li>
</ul>
<p>By adding the <code>@Injectable</code> decorator to the class definition, any member variables defined in the arguments to the class constructor function will be automatically instantiated (i.e. there is no need to explicitly request a <code>new Http</code> object):</p>
<p><script src="https://gist.github.com/am-MongoDB/bdd1585280e0334ab7f7b08655600c31.js"></script></p>
<p>After the constructor has been called, methods within the class can safely make use of the <code>http</code> data member.</p>
<p>As a reminder from <a href="./../../../mongodb/the-modern-application-stack-part-3-building-a-rest-api-using-express-js/index.html" title="Building REST API for MongoDB using Express JS">Part 3: Building a REST API with Express.js</a>, this is the REST API we have to interact with:</p>
<table class="table table-bordered" summary="Express route paths implemented for the Mongopop REST API">
<caption><strong>Express routes implemented for the Mongopop REST API</strong></caption>
<thead>
<tr>
<th>Route Path</th>
<th>HTTP Method</th>
<th>Parameters</th>
<th>Response</th>
<th>Purpose
<pre style="border:0px; background-color:#fff; height:0px">                      </pre>
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<pre style="border:0px; background-color:#fff">/pop/</pre>
</td>
<td>GET</td>
<td></td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
"AppName": "MongoPop",
"Version": 1.0
}
        </pre>
</td>
<td>Returns the version of the API.</td>
</tr>
<tr>
<td>
<pre style="border:0px; background-color:#fff">/pop/ip</pre>
</td>
<td>GET</td>
<td></td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">{"ip": string}</pre>
</td>
<td>Fetches the IP Address of the server running the Mongopop backend.</td>
</tr>
<tr>
<td>
<pre style="border:0px; background-color:#fff">/pop/config</pre>
</td>
<td>GET</td>
<td></td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
mongodb: {
    defaultDatabase: string,
    defaultCollection: string,
    defaultUri: string
},
mockarooUrl: string
}
        </pre>
</td>
<td>Fetches client-side defaults from the back-end config file.</td>
</tr>
<tr>
<td>
<pre style="border:0px; background-color:#fff">/pop/addDocs</pre>
</td>
<td>POST</td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
MongoDBURI: string;
collectionName: string;
dataSource: string;
numberDocs: number;
unique: boolean;
}
        </pre>
</td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
success: boolean;
count: number;
error: string;
}
        </pre>
</td>
<td>Add `numberDocs` batches of documents, using documents fetched from `dataSource`</td>
</tr>
<tr>
<td>
<pre style="border:0px; background-color:#fff">/pop/sampleDocs</pre>
</td>
<td>POST</td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
MongoDBURI: string;
collectionName: string;
numberDocs: number;
}
        </pre>
</td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
success: boolean;   
documents: string;
error: string;
}
        </pre>
</td>
<td>Read a sample of the documents from a collection.</td>
</tr>
<tr>
<td>
<pre style="border:0px; background-color:#fff">/pop/countDocs</pre>
</td>
<td>POST</td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
MongoDBURI: string; 
collectionName: string;
}
        </pre>
</td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
success: boolean;   
count: number;
error: string;
}
        </pre>
</td>
<td>Counts the number of documents in the collection.</td>
</tr>
<tr>
<td>
<pre style="border:0px; background-color:#fff">/pop/updateDocs</pre>
</td>
<td>POST</td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
MongoDBURI: string;
collectionName: string;
matchPattern: Object;
dataChange: Object;
threads: number;
}
        </pre>
</td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
success: boolean;
count: number;
error: string;
}
        </pre>
</td>
<td>Apply an update to all documents in a collection<br>
    which match a given pattern</td>
</tr>
</tbody>
</table>
<p>Most of the methods follow a very similar pattern and so only a few are explained here; refer to the <a href="https://github.com/am-MongoDB/MongoDB-Mongopop/blob/master/public/app/data.service.ts" title="MongoPop DataService class from GitHub"><code>DataService</code> class</a> to review the remainder.</p>
<p>The simplest method retrieves a count of the documents for a given collection:</p>
<p><script src="https://gist.github.com/am-MongoDB/45a69032a8c9c168e3cc3554ff0b652f.js"></script></p>
<p>This method returns an Observable, which in turn delivers an object of type <code>MongoResult</code>. <code>MongoResult</code> is defined in <a href="https://github.com/am-MongoDB/MongoDB-Mongopop/blob/master/public/app/MongoResult.ts"><code>MongoResult.ts</code></a>:</p>
<p><script src="https://gist.github.com/am-MongoDB/2e67ad27f5f94552ff7a4e187a941a89.js"></script></p>
<p>The <code>pop/count</code> PUT method expects the request parameters to be in a specific format (see earlier table); to avoid coding errors, another Typescript class is used to ensure that the correct parameters are always included ‚Äì <code>CountDocsRequest</code>:</p>
<p><script src="https://gist.github.com/am-MongoDB/9e323989feec41af2b01eb412acf1b0f.js"></script></p>
<p><code>http.post</code> returns an Observable. If the Observable achieves a positive outcome then the <code>map</code> method is invoked to convert the resulting data (in this case, simply parsing the result from a JSON string into a Typescript/JavaScript object) before automatically passing that updated result through this method&#8217;s own returned Observable.</p>
<p>The <code>timeout</code> method causes an error if the HTTP request doesn&#8217;t succeed or fail within 6 minutes.</p>
<p>The <code>catch</code> method passes on any error from the HTTP request (or a generic error if <code>error.toString()</code> is <code>null</code>) if none exists.</p>
<p>The <code>updateDBDocs</code> method is a little more complex ‚Äì before sending the request, it must first parse the user-provided strings representing:</p>
<ul>
<li>The pattern identifying which documents should be updated</li>
<li>The change that should be applied to each of the matching documents</li>
</ul>
<p>This helper function is used to parse the (hopefully) JSON string:</p>
<p><script src="https://gist.github.com/am-MongoDB/7ca639fdf99af6977b9ec769b5f7c75d.js"></script></p>
<p>If the string is a valid JSON document then <code>tryParseJSON</code> returns an object representation of it; if not then it returns an error.</p>
<p>A new class (<code>UpdateDocsRequest</code>) is used for the update request:</p>
<p><script src="https://gist.github.com/am-MongoDB/935678471b89d091d920545550de9f15.js"></script></p>
<p><code>updateDBDocs</code> is the method that is invoked from the component code:</p>
<p><script src="https://gist.github.com/am-MongoDB/0352559fd042355184a9481b63d849b9.js"></script></p>
<p>After converting the received string into objects, it delegates the actual sending of the HTTP request to <code>sendUpdateDocs</code>:</p>
<p><script src="https://gist.github.com/am-MongoDB/df01ad0ecf30cc5e7b5c86ea4dcb594d.js"></script></p>
<h2>A simple component that accepts data from its parent</h2>
<p>Recall that the application consists of five components: the top-level application which contains each of the add, count, update, and sample components.</p>
<p>When building a new application, you would typically start by designing the the top-level container and then work downwards. As the top-level container is the most complex one to understand, we&#8217;ll start at the bottom and then work up.</p>
<p>A simple sub-component to start with is the count component:</p>
<p><img decoding="async" src="./../../../wp-content/uploads/2017/02/Count_Component.png" alt="Mongopop Angular2 component" title="Mongopop Angular2 component"><br>
<code>public/app/count.component.html</code> defines the elements that define what&#8217;s rendered for this component:</p>
<p><script src="https://gist.github.com/am-MongoDB/ed99c1a5d8e96d0882e0d023b325589d.js"></script></p>
<p>You&#8217;ll recognise most of this as standard HTML code.</p>
<p>The first Angular extension is for the single <code>input</code> element, where the initial <code>value</code> (what&#8217;s displayed in the input box) is set to <code>{{MongoDBCollectionName}}</code>. Any name contained within a double pair of braces refers to a data member of the component&#8217;s class (<code>public/app/count.component.ts</code>).</p>
<p>When the button is clicked, <code>countDocs</code> (a method of the component&#8217;s class) is invoked with <code>CountCollName.value</code> (the current contents of the input field) passed as a parameter.</p>
<p>Below the button, the class data members of <code>DocumentCount</code> and <code>CountDocError</code> are displayed ‚Äì nothing is actually rendered unless one of these has been given a non-empty value. Note that these are placed below the button in the code, but they would still display the resulting values if they were moved higher up ‚Äì position within the HTML file doesn&#8217;t impact logic flow. Each of those messages is given a class so that they can be styled differently within the component&#8217;s CSS file:</p>
<p><script src="https://gist.github.com/am-MongoDB/d22b7725f9dc764b1445771f3d32d116.js"></script></p>
<p><img decoding="async" src="./../../../wp-content/uploads/2017/02/Count_Success.png" alt="Angular 2 success message" title="Angular 2 success message"></p>
<p><img decoding="async" src="./../../../wp-content/uploads/2017/02/Count_Error.png" alt="Angular 2 error message" title="Angular 2 error message"></p>
<p>The data and processing behind the component is defined in <code>public/app/count.component.ts</code>:</p>
<p><script src="https://gist.github.com/am-MongoDB/0f679598352ae900d193d14d7d2ea38e.js"></script></p>
<p>Starting with the <code>@component</code> decoration for the class:</p>
<p><script src="https://gist.github.com/am-MongoDB/230cc3627b2b60257e2ed52751848e87.js"></script></p>
<p>This provides meta data for the component:</p>
<ul>
<li>
<code>selector</code>: The position of the component within the parent&#8217;s HTML should be defined by a <code>&lt;my-count&gt;&lt;/my-count&gt;</code> element.</li>
<li>
<code>templateUrl</code>: The HMTL source file for the template (<code>public/app/count.component.ts</code> in this case ‚Äì <code>public</code> is dropped as the path is relative)</li>
<li>
<code>styleUrls</code>: The CSS file for this component ‚Äì all components in this application reference the same file: <code>public/stylesheets/style.css</code>
</li>
</ul>
<p>The class definition declares that it implements the <code>OnInit</code> interface; this means that its <code>ngOnInit()</code> method will be called after the browser has loaded the component; it&#8217;s a good place to perform any initialization steps. In this component, it&#8217;s empty and could be removed.</p>
<p>The two data members used for displaying success/failure messages are initialized to empty strings:</p>
<pre><code class="js">this.DocumentCount = "";
this.CountDocError = "";
</code></pre>
<p>Recall that data is passed back and forth between the count component and its parent:</p>
<table class="table table-bordered" summary="Angular components for Mongopop Angular client application">
<caption><strong>Flow of data between Angular components</strong></caption>
<thead>
<tr>
<th>Child component</th>
<th>Data passed down</th>
<th>Data changes pased back up</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="2">
<pre style="border:0px; background-color:#fff">CountComponent</pre>
</td>
<td>Data service</td>
<td rowspan="2">Collection name</td>
</tr>
<tr>
<td>Collection name</td>
</tr>
</tbody>
</table>
<p>To that end, two class members are inherited from the parent component ‚Äì indicated by the <code>@Input()</code> decoration:</p>
<pre><code class="js">// Parameters sent down from the parent component (AppComponent)
@Input() dataService: DataService;
@Input() MongoDBCollectionName: string;
</code></pre>
<p>The first is an instance of the data service (which will be used to request the document count); the second is the collection name that we used in the component&#8217;s HTML code. Note that if either of these are changed in the parent component then the instance within this component will automatically be updated.</p>
<p>When the name of the collection is changed within this component, the change needs to be pushed back up to the parent component. This is achieved by declaring an event emitter (<code>onCollection</code>):</p>
<p><script src="https://gist.github.com/am-MongoDB/50195e2d042d4635105a22875db1f748.js"></script></p>
<p>Recall that the HTML for this component invokes a member function: <code>countDocs(CountCollName.value)</code> when the button is clicked; that function is implemented in the component class:</p>
<p><script src="https://gist.github.com/am-MongoDB/15dd5c3e97f7be099495934bf9ffb3e7.js"></script></p>
<p>After using the data service to request the document count, either the success or error messages are sent ‚Äì depending on the success/failure of the requested operation. Note that there are two layers to the error checking:</p>
<ol>
<li>Was the network request successful? Errors such as a bad URL, out of service back-end, or loss of a network connection would cause this check to fail.</li>
<li>Was the back-end application able to execute the request successfully? Errors such as a non-existent collection would cause this check to fail.</li>
</ol>
<p>Note that when <code>this.CountDocError</code> or <code>this.DocumentCount</code> are written to, Angular will automatically render the new values in the browser.</p>
<h2>Passing data down to a sub-component (and receiving changes back)</h2>
<p>We&#8217;ve seen how <code>CountComponent</code> can accept data from its parent and so the next step is to look at that parent ‚Äì <code>AppComponent</code>.</p>
<p>The HTML template <a href="https://github.com/am-MongoDB/MongoDB-Mongopop/blob/master/public/app/app.component.html"><code>app.component.html</code></a> includes some of its own content, such as collecting database connection information, but most of it is delegation to other components. For example, this is the section that adds in <code>CountComponent</code>:</p>
<p><script src="https://gist.github.com/am-MongoDB/541245e2817d80975db6ec5dbe8ae821.js"></script></p>
<p>Angular will replace the <code>&lt;my-count&gt;&lt;/my-count&gt;</code> element with <code>CountComponent</code>; the extra code within that element passes data down to that sub-component. For passing data members down, the syntax is:</p>
<pre><code class="js">[name-of-data-member-in-child-component]="name-of-data-member-in-this-component"
</code></pre>
<p>As well as the two data members, a reference to the <code>onCollection</code> event handler is passed down (to allow <code>CountComponent</code> to propagate changes to the collection name back up to this component). The syntax for this is:</p>
<pre><code class="js">(name-of-event-emitter-in-child-component)="name-of-event-handler-in-this-component($event)"
</code></pre>
<p>As with the count component, the main app component has a Typescript class ‚Äì defined in <a href="https://github.com/am-MongoDB/MongoDB-Mongopop/blob/master/public/app/add.component.ts"><code>app.component.ts</code></a> ‚Äì in addition to the HTML file. The two items that must be passed down are the data service (so that the count component can make requests of the back-end) and the collection name ‚Äì these are both members of the <code>AppComponent</code> class.</p>
<p>The <code>dataService</code> object is implicitly created and initialized because it is a parameter of the class&#8217;s constructor, and because the class is decorated with <code>@Injectable</code>:</p>
<p><script src="https://gist.github.com/am-MongoDB/ca892e28cc3a292372df8c4b11ecef2e.js"></script></p>
<p><code>MongoDBCollectionName</code> is set during component initialization within the <code>ngOnInit()</code> method by using the data service to fetch the default client configuration information from the back-end:</p>
<p><script src="https://gist.github.com/am-MongoDB/eae1bf9663f079171ee11b77f382af5c.js"></script></p>
<p>Finally, when the collection name is changed in the count component, the event that it emits gets handled by the event handler called, <code>onCollection</code>, which uses the new value to update its own data member:</p>
<p><script src="https://gist.github.com/am-MongoDB/31bb2702952987a0d42ddd9eb03ee16e.js"></script></p>
<h2>Conditionally including a component</h2>
<p>It&#8217;s common that a certain component should only be included if a particular condition is met. Mongopop includes a feature to allow the user to apply a bulk change to a set of documents &#8211; selected using a pattern specified by the user. If they don&#8217;t know the typical document structure for the collection then it&#8217;s unlikely that they&#8217;ll make a sensible change. Mongopop forces them to first retrieve a sample of the documents before they&#8217;re given the option to make any changes.</p>
<p>The <a href="https://angular.io/docs/ts/latest/api/common/index/NgIf-directive.html"><code>ngIf</code></a> directive can be placed within the opening part of an element (in this case a <code>&lt;div&gt;</code>) to make that element conditional. This approach is used within <code>app.component.html</code> to only include the update component if the <code>DataToPlayWith</code> data member is TRUE:</p>
<p><script src="https://gist.github.com/am-MongoDB/15b2bc542799332308b8a6aa86a2ebea.js"></script></p>
<p>Note that, as with the count component, if the update component is included then it&#8217;s passed the data service and collection name and that it also passes back changes to the collection name.</p>
<p>Angular includes other <a href="https://angular.io/docs/ts/latest/api/#!?type=directive">directives</a> that can be used to control content; <a href="https://angular.io/docs/ts/latest/api/common/index/NgFor-directive.html"><code>ngFor</code></a> being a common one as it allows you to iterate through items such as arrays:</p>
<p><script src="https://gist.github.com/am-MongoDB/216098b193c5f40f9b48a094c4d7eea0.js"></script></p>
<p>Returning to <a href="https://github.com/am-MongoDB/MongoDB-Mongopop/blob/master/public/app/app.component.html"><code>app.component.html</code></a>, an extra handler (<code>onSample</code>) is passed down to the sample component:</p>
<p><script src="https://gist.github.com/am-MongoDB/0a3e27b4d058e0f2e8b9e30e73c479a4.js"></script></p>
<p><a href="https://github.com/am-MongoDB/MongoDB-Mongopop/blob/master/public/app/sample.component.html"><code>sample.component.html</code></a> is similar to the HTML code for the count component but there is an extra input for how many documents should be sampled from the collection:</p>
<p><script src="https://gist.github.com/am-MongoDB/181d3bdd10116d6f1fa014ba3ea19799.js"></script></p>
<p>On clicking the button, the collection name and sample size are passed to the <code>sampleDocs</code> method in <a href="https://github.com/am-MongoDB/MongoDB-Mongopop/blob/master/public/app/sample.component.ts"><code>sample.component.ts</code></a> which (among other things) emits an event back to the <code>AppComponent</code>&#8216;s event handler using the <code>onSample</code> event emitter:</p>
<p><script src="https://gist.github.com/am-MongoDB/2306f3cb61734d2bc4f26fc117438741.js"></script></p>
<h2>Other code highlights</h2>
<p>Returning to <a href="https://github.com/am-MongoDB/MongoDB-Mongopop/blob/master/public/app/app.component.html"><code>app.component.html</code></a>; there is some content there in addition to the sub-components:</p>
<p><script src="https://gist.github.com/am-MongoDB/3b54145980126d6b62680c344bfce3aa.js"></script></p>
<p>Most of this code is there to allow a full MongoDB URI/connection string to be built based on some user-provided attributes. Within the input elements, two event types (<code>keyup</code> &amp; <code>change</code>) make immediate changes to other values (without the need for a page refresh or pressing a button):</p>
<p><img decoding="async" src="./../../../wp-content/uploads/2017/02/Reactive_MongoDB_URI.gif" alt="Reactive Angular 2 Component" title="Reactive Angular 2 Component"></p>
<p>The actions attached to each of these events call methods from the AppComponent class to set the data members ‚Äì for example the <code>setDBName</code> method (from <a href="https://github.com/am-MongoDB/MongoDB-Mongopop/blob/master/public/app/add.component.ts"><code>app.component.ts</code></a>):</p>
<p><script src="https://gist.github.com/am-MongoDB/e8c47296fb7bc7497d56e604ddcf375b.js"></script></p>
<p>In addition to setting the <code>dBInputs.MongoDBDatabaseName</code> value, it also invokes the data service method <code>calculateMongoDBURI</code> (taken from <a href="https://github.com/am-MongoDB/MongoDB-Mongopop/blob/master/public/app/app.component.ts"><code>data.service.ts</code></a> ):</p>
<p><script src="https://gist.github.com/am-MongoDB/54af5d9b8189ea94731544a5304bd428.js"></script></p>
<p>This method is run by the handler associated with any data member that affects the MongoDB URI (base URI, database name, socket timeout, connection pool size, or password). Its purpose is to build a full URI which will then be used for accessing MongoDB; if the URI contains a password then a second form of the URI, <code>MongoDBURIRedacted</code> has the password replaced with <code>**********</code>.</p>
<p>It starts with a test as to whether the URI has been left to the default <code>localhost:27017</code> ‚Äì in which case it&#8217;s assumed that there&#8217;s no need for a username or password (obviously, this shouldn&#8217;t be used in production). If not, it assumes that the URI has been provided by the <a href="https://cloud.mongodb.com/" title="MongoDB Atlas ‚Äì MongoDB as a service in the cloud">MongoDB Atlas GUI</a> and applies these changes:</p>
<ul>
<li>Change the database name from <code>&lt;DATATBASE&gt;</code> to the one chosen by the user.</li>
<li>Replace <code>&lt;PASSWORD&gt;</code> with the real password (and with <code>**********</code> for the redacted URI).</li>
<li>Add the socket timeout parameter.</li>
<li>Add the connection pool size parameter.</li>
</ul>
<h2>Testing &amp; debugging the Angular application</h2>
<p>Now that the full MEAN stack application has been implemented, you can test it from within your browser:</p>
<p><iframe loading="lazy" width="560" height="315" src="https://www.youtube.com/embed/z7IE1NHh6FE?rel=0" frameborder="0" allowfullscreen></iframe></p>
<p>Debugging the Angular 2 client is straightforward using the <a href="https://developer.chrome.com/devtools">Google Chrome Developer Tools</a> which are built into the Chrome browser. Despite the browser executing the transpiled JavaScript the Dev Tools allows you to browse and set breakpoints in your Typescript code:</p>
<p><img decoding="async" src="./../../../wp-content/uploads/2017/02/Debugging_Angular2_Typescript_withGoogle_Chrom_DevTools.png" alt="" title="Debugging Angular2 and Typescript with Chrome Developer Tools"></p>
<h2>Summary &amp; what&#8217;s next in the series</h2>
<p>Previous posts stepped through building the Mongopop application back-end. This post describes how to build a front-end client using Angular 2. At this point, we have a complete, working, MEAN stack application.</p>
<p>The coupling between the front and back-end is loose; the client simply makes remote, HTTP requests to the back-end service ‚Äì using the interface created in <a href="./../../../mongodb/the-modern-application-stack-part-3-building-a-rest-api-using-express-js/index.html" title="Building REST API for MongoDB using Express JS">Part 3: Building a REST API with Express.js</a>.</p>
<p>This series will finish out by demonstrating alternate methods to implement front-ends; using ReactJS for another browser-based UI (completing the <strong>MERN stack</strong>) and then more alternative methods.</p>
<p>Continue following this blog series to step through building the remaining stages of the <a href="https://github.com/am-MongoDB/MongoDB-Mongopop">Mongopop</a> application:</p>
<ul>
<li><a href="./../../../mongodb/modern-application-stack-part-1-introducing-the-mean-stack/index.html" title="MEAN stack, MERN stack">Part 1: Introducing The MEAN Stack (and the young MERN upstart)</a></li>
<li><a href="./../../../mongodb/mean_stack_2_mongodb_node_js/index.html" title="Using MongoDB With Node.js">Part 2: Using MongoDB With Node.js</a></li>
<li><a href="./../../../mongodb/the-modern-application-stack-part-3-building-a-rest-api-using-express-js/index.html" title="Building REST API for MongoDB using Express JS">Part 3: Building a REST API with Express.js</a></li>
<li><a href="./../../../mongodb/the-modern-application-stack-part-4-building-a-client-ui-using-angular-2-formerly-angularjs-typescript/index.html" title="Completing the MEAN stack ‚Äì Mongopop Angular2 client">Part 4: Building a Client UI Using Angular 2 (formerly AngularJS) &amp; TypeScript</a></li>
<li><a href="./../../../mongodb/the-modern-application-stack-part-5-using-reactjs-es6-jsx-to-build-a-ui-the-rise-of-mern/index.html" title="Building an application front-end with ReactJS and ES6">Part 5: Using ReactJS, ES6 &amp; JSX to Build a UI (the rise of MERN)</a></li>
<li><a href="./../../../mongodb/rest-mobile-app-amazon-alexa-cloud-services/index.html" title="Using REST APIs from mobile applications and Amazon Alexa">Part 6: Browsers Aren&#8217;t the Only UI ‚Äì Mobile Apps, Amazon Alexa, Cloud Services&#8230;</a></li>
</ul>
<h2>A simpler way to build your app ‚Äì MongoDB Stitch, Backend as a Service</h2>
<p><a href="https://www.mongodb.com/cloud/stitch">MongoDB Stitch</a> is a backend as a service (BaaS), giving developers a REST-like API to MongoDB, and composability with other services, backed by a robust system for configuring fine-grained data access controls. Stitch provides native SDKs for JavaScript, iOS, and Android.</p>
<p>Built-in integrations give your application frontend access to your favorite third party services: Twilio, AWS S3, Slack, Mailgun, PubNub, Google, and more. For ultimate flexibility, you can add custom integrations using MongoDB Stitch&#8217;s HTTP service.</p>
<p>MongoDB Stitch allows you to compose multi-stage pipelines that orchestrate data across multiple services; where each stage acts on the data before passing its results on to the next.</p>
<p>Unlike other BaaS offerings, MongoDB Stitch works with your existing as well as new MongoDB clusters, giving you access to the full power and scalability of the database. By defining appropriate data access rules, you can selectively expose your existing MongoDB data to other applications through MongoDB Stitch&#8217;s API.</p>
<p>If you&#8217;d like to try it out, <a href="./../../../mongodb/mongodb-stitch-the-latest-and-best-way-to-build-your-app/index.html" title="MongoDB Stitch - the latest, and best way to build your app">step through building an application with MongoDB Stitch</a>.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/the-modern-application-stack-part-4-building-a-client-ui-using-angular-2-formerly-angularjs-typescript" data-via="wpbeginner" data-text="The Modern Application Stack ‚Äì Part 4: Building a Client UI Using Angular 2 (formerly AngularJS) &#038; TypeScript" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/the-modern-application-stack-part-4-building-a-client-ui-using-angular-2-formerly-angularjs-typescript"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/the-modern-application-stack-part-4-building-a-client-ui-using-angular-2-formerly-angularjs-typescript" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Fthe-modern-application-stack-part-4-building-a-client-ui-using-angular-2-formerly-angularjs-typescript&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../../../category/mongodb/index.html" rel="category tag">MongoDB</a> | 
Tags: <a href="./../../angular/index.html" rel="tag">angular</a>, <a href="./../../angular-js/index.html" rel="tag">angular.js</a>, <a href="./../../angular2/index.html" rel="tag">angular2</a>, <a href="./../../mean/index.html" rel="tag">MEAN</a>, <a href="./../../mean-stack/index.html" rel="tag">mean stack</a>, <a href="./../../mongodb/index.html" rel="tag">mongodb</a>, <a href="./../../mongopop/index.html" rel="tag">mongopop</a>, <a href="./../../observables/index.html" rel="tag">observables</a>, <a href="./../../typescript/index.html" rel="tag">typescript</a>
</div>

			</div>			<div id="post-4371" class="post-4371 post type-post status-publish format-standard hentry category-mongodb tag-express tag-mean tag-mean-stack tag-mongodb tag-promises">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../../../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../../../mongodb/the-modern-application-stack-part-3-building-a-rest-api-using-express-js/index.html">February 8, 2017</a>
			</div>
	<div class="postcomments">
		<a href="./../../../mongodb/the-modern-application-stack-part-3-building-a-rest-api-using-express-js/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../../../mongodb/the-modern-application-stack-part-3-building-a-rest-api-using-express-js/index.html" rel="bookmark">The Modern Application Stack ‚Äì Part 3: Building a REST API Using Express.js</a></h2>
				
				<div class="entry">
										<h4>Introduction</h4>
<p>This is the third in a series of blog posts examining the technologies that are driving the development of modern web and mobile applications.</p>
<p><a href="./../../../mongodb/modern-application-stack-part-1-introducing-the-mean-stack/index.html" title="MEAN Stack and MERN Stack"><em>Part 1: Introducing The MEAN Stack (and the young MERN upstart</em>)</a> introduced the technologies making up the MEAN (<em>M</em>ongoDB, <em>E</em>xpress, <em>A</em>ngular, <em>N</em>ode.js) and MERN (<em>M</em>ongoDB, <em>E</em>xpress, <em>R</em>eact, <em>N</em>ode.js) Stacks, why you might want to use them, and how to combine them to build your web application (or your native mobile or desktop app).</p>
<p>The remainder of the series is focused on working through the end to end steps of building a real (albeit simple) application. ‚Äì <em>MongoPop</em>. <a href="./../../../mongodb/mean_stack_2_mongodb_node_js/index.html" title="Using MongoDB With Node.js"><em>Part 2: Using MongoDB With Node.js</em></a> created an environment where we could work with a MongoDB database from Node.js; it also created a simplified interface to the MongoDB Node.js Driver.</p>
<p>This post builds on from those first posts by using Express to build a REST API so that a remote client can work with MongoDB. You will be missing a lot of context if you have skipped those posts ‚Äì it&#8217;s recommended to follow through those first.</p>
<h4>The REST API</h4>
<p>A Representational State Transfer (REST) interface provides a set of operations that can be invoked by a remote client (which could be another service) over a network, using the HTTP protocol. The client will typically provide parameters such as a string to search for or the name of a resource to be deleted.</p>
<p>Many services provide a REST API so that clients (their own and those of 3rd parties) and other services can use the service in a well defined, loosely coupled manner. As an example, the <a href="https://developers.google.com/places/" title="Google's API for working with Google Places">Google Places API</a> can be used to search for information about a specific location:</p>
<p><script src="https://gist.github.com/am-MongoDB/6671d3e23e3596e876c0328965b274c2.js"></script></p>
<p>Breaking down the URI used in that <code>curl</code> request:</p>
<ul>
<li>No <em>method</em> is specified and so the <code>curl</code> command defaults to a HTTP <code>GET</code>.</li>
<li>
<code>maps.googleapis.com</code> is the address of the Google APIs service.</li>
<li>
<code>/maps/api/place/details/json</code> is the <em>route path</em> to the specific operation that&#8217;s being requested.</li>
<li>
<code>placeid=ChIJKxSwWSZgAUgR0tWM0zAkZBc</code> is a <em>parameter</em> (passed to the function bound to this route path), identifying which place we want to read the data for.</li>
<li>
<code>key=AIzaSyC53qhhXAmPOsxc34WManoorp7SVN_Qezo</code> is a parameter indicating the Google API key, verifying that it&#8217;s a registered application making the request (Google will also cap, or bill for, the number of requests made using this key).</li>
</ul>
<p>There&#8217;s a convention as to which HTTP method should be used for which types of operation:</p>
<ul>
<li>
<strong>GET</strong>: Fetches data</li>
<li>
<strong>POST</strong>: Adds new data</li>
<li>
<strong>PUT</strong>: Updates data</li>
<li>
<strong>DELETE</strong>: Removes data</li>
</ul>
<p>Mongopop&#8217;s REST API breaks this convention and uses <code>POST</code> for some read requests (as it&#8217;s simpler passing arguments than with <code>GET</code>).</p>
<p>These are the REST operations that will be implemented in Express for Mongopop:</p>
<table class="table table-bordered" summary="Express route paths implemented for the Mongopop REST API">
<caption><strong>Express routes implemented for the Mongopop REST API</strong></caption>
<thead>
<tr>
<th>Route Path</th>
<th>HTTP Method</th>
<th>Parameters</th>
<th>Response</th>
<th>Purpose
<pre style="border:0px; background-color:#fff; height:0px">                      </pre>
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<pre style="border:0px; background-color:#fff">/pop/</pre>
</td>
<td>GET</td>
<td></td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
"AppName": "MongoPop",
"Version": 1.0
}
        </pre>
</td>
<td>Returns the version of the API.</td>
</tr>
<tr>
<td>
<pre style="border:0px; background-color:#fff">/pop/ip</pre>
</td>
<td>GET</td>
<td></td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">{"ip": string}</pre>
</td>
<td>Fetches the IP Address of the server running the Mongopop backend.</td>
</tr>
<tr>
<td>
<pre style="border:0px; background-color:#fff">/pop/config</pre>
</td>
<td>GET</td>
<td></td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
mongodb: {
    defaultDatabase: string,
    defaultCollection: string,
    defaultUri: string
},
mockarooUrl: string
}
        </pre>
</td>
<td>Fetches client-side defaults from the back-end config file.</td>
</tr>
<tr>
<td>
<pre style="border:0px; background-color:#fff">/pop/addDocs</pre>
</td>
<td>POST</td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
MongoDBURI: string;
collectionName: string;
dataSource: string;
numberDocs: number;
unique: boolean;
}
        </pre>
</td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
success: boolean;
count: number;
error: string;
}
        </pre>
</td>
<td>Add `numberDocs` batches of documents, using documents fetched from `dataSource`</td>
</tr>
<tr>
<td>
<pre style="border:0px; background-color:#fff">/pop/sampleDocs</pre>
</td>
<td>POST</td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
MongoDBURI: string;
collectionName: string;
numberDocs: number;
}
        </pre>
</td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
success: boolean;   
documents: string;
error: string;
}
        </pre>
</td>
<td>Read a sample of the documents from a collection.</td>
</tr>
<tr>
<td>
<pre style="border:0px; background-color:#fff">/pop/countDocs</pre>
</td>
<td>POST</td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
MongoDBURI: string; 
collectionName: string;
}
        </pre>
</td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
success: boolean;   
count: number;
error: string;
}
        </pre>
</td>
<td>Counts the number of documents in the collection.</td>
</tr>
<tr>
<td>
<pre style="border:0px; background-color:#fff">/pop/updateDocs</pre>
</td>
<td>POST</td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
MongoDBURI: string;
collectionName: string;
matchPattern: Object;
dataChange: Object;
threads: number;
}
        </pre>
</td>
<td>
<pre style="border:0px; font-size:11px; background-color:#fff">
{
success: boolean;
count: number;
error: string;
}
        </pre>
</td>
<td>Apply an update to all documents in a collection<br>
    which match a given pattern</td>
</tr>
</tbody>
</table>
<h4>Express</h4>
<p><a href="http://expressjs.com/" title="Express.js web application framework for Node.js">Express</a> is the web application framework that runs your back-end application (JavaScript) code. Express runs as a module within the Node.js environment.</p>
<p>Express can handle the routing of requests to the right functions within your application (or to different apps running in the same environment).</p>
<p>You can run the app&#8217;s full business logic within Express and even use an optional <em>view engine</em> to generate the final HTML to be rendered by the user&#8217;s browser. At the other extreme, Express can be used to simply provide a <a href="https://en.wikipedia.org/wiki/Representational_state_transfer">REST API</a> ‚Äì giving the front-end app access to the resources it needs e.g., the database.</p>
<p>The Mongopop application uses Express to perform two functions:</p>
<ul>
<li>Send the front-end application code to the remote client when the user browses to our app</li>
<li>Provide a REST API that the front-end can access using HTTP network calls, in order to access the database</li>
</ul>
<h4>Downloading, running, and using the application</h4>
<p>The application&#8217;s Express code is included as part of the Mongopop package installed in <a href="./../../../mongodb/mean_stack_2_mongodb_node_js/index.html" title="Using MongoDB With Node.js">Part 2: Using MongoDB With Node.js</a>.</p>
<h4>What are all of these files?</h4>
<p>A reminder of the files described in <a href="./../../../mongodb/mean_stack_2_mongodb_node_js/index.html" title="Using MongoDB With Node.js">Part 2</a>:</p>
<ul>
<li>
<strong><code>package.json</code></strong>: Instructs the Node.js package manager (<code>npm</code>) on what it needs to do; including which dependency packages should be installed</li>
<li>
<strong><code>node_modues</code></strong>: Directory where <code>npm</code> will install packages</li>
<li>
<strong><code>node_modues/mongodb</code></strong>: The <a href="https://mongodb.github.io/node-mongodb-native/" title="MongoDB JavaScript driver for Node.js">MongoDB driver for Node.js</a>
</li>
<li>
<strong><code>node_modues/mongodb-core</code></strong>: Low-level MongoDB driver library; available for framework developers (application developers should avoid using it directly)</li>
<li>
<strong><code>javascripts/db.js</code></strong>: A JavaScript module we&#8217;ve created for use by our Node.js apps (in this series, it will be Express) to access MongoDB; this module in turn uses the MongoDB Node.js driver.</li>
</ul>
<p>Other files and directories that are relevant to our Express application:</p>
<ul>
<li>
<strong><code>config.js</code></strong>: Contains the application‚Äìspecific configuration options</li>
<li>
<strong><code>bin/www</code></strong>: The script that starts an Express application; this is invoked by the <code>npm start</code> script within the <code>package.json</code> file. Starts the HTTP server, pointing it to the <code>app</code> module in <code>app.js</code>
</li>
<li>
<strong><code>app.js</code></strong>: Defines the main application module (<code>app</code>). Configures:
<ul>
<li>That the application will be run by Express</li>
<li>Which routes there will be &amp; where they are located in the file system (<code>routes</code> directory)</li>
<li>What view engine to use (Jade in this case)</li>
<li>Where to find the /views/ to be used by the view engine (<code>views</code> directory)</li>
<li>What middleware to use (e.g. to parse the JSON received in requests)</li>
<li>Where the static files (which can be read by the remote client) are located (<code>public</code> directory)</li>
<li>Error handler for queries sent to an undefined route</li>
</ul>
</li>
<li>
<strong><code>views</code></strong>: Directory containing the templates that will be used by the Jade view engine to create the HTML for any pages generated by the Express application (for this application, this is just the error page that&#8217;s used in cases such as mistyped routes (&#8220;404 Page not found&#8221;))</li>
<li>
<strong><code>routes</code></strong>: Directory containing one JavaScript file for each Express route
<ul>
<li>
<strong><code>routes/pop.js</code></strong>: Contains the Express application for the <code>/pop</code> route; this is the implementation of the Mongopop REST API. This defines methods for all of the supported route paths.</li>
</ul>
</li>
<li>
<strong><code>public</code></strong>: Contains all of the static files that must be accessible by a remote client (e.g., our Angular to React apps). This is not used for the REST API and so can be ignored until Parts 4 and 5.</li>
</ul>
<p>The rest of the files and directories can be ignored for now ‚Äì they will be covered in later posts in this series.</p>
<h4>Architecture</h4>
<p><img decoding="async" src="./../../../wp-content/uploads/2017/02/REST_API.png" alt="REST AIP implemented in Express.js" title="Rest API implemented in Express.js"></p>
<p>The new REST API (implemented in <code>routes/pop.js</code>) uses the <code>javascripts/db.js</code> database layer implemented in <a href="./../../../mongodb/mean_stack_2_mongodb_node_js/index.html" title="Node.js and MongoDB as part of the MEAN stack">Part 2</a> to access the MongoDB database via the <a href="https://mongodb.github.io/node-mongodb-native/" title="MongoDB JavaScript Node.js driver API">MongoDB Node.js Driver</a>. As we don&#8217;t yet have either the Angular or React clients, we will user the <code>curl</code> command-line tool to manually test the REST API.</p>
<h4>Code highlights</h4>
<h4><code>config.js</code></h4>
<p><script src="https://gist.github.com/am-MongoDB/d6f71c9342f0b04fd077a6101368faf4.js"></script></p>
<p>The <code>config</code> module can be imported by other parts of the application so that your preferences can be taken into account.</p>
<p><code>expressPort</code> is used by <code>bin/www</code> to decide what port the web server should listen on; change this if that port is already in use.</p>
<p><code>client</code> contains defaults to be used by the client (Angular or React). It&#8217;s important to create your own schema at <a href="https://www.mockaroo.com/" title="Generate JSON data sets using Mockaroo">Mockaroo.com</a> and replace <code>client.mockarooUrl</code> with your custom URL (the one included here will fail if used too often).</p>
<h4><code>bin/www</code></h4>
<p>This is mostly boiler-plate code to start Express with your application. This code ensures that it is our application, <code>app.js</code>, that is run by the Express server:</p>
<p><script src="https://gist.github.com/am-MongoDB/895e18af7cf757e379787e238535dba6.js"></script></p>
<p>This code uses the <code>expressPort</code> from <code>config.js</code> as the port for the server to listen on; it will be overruled if the user sets the <code>PORT</code> environment variable:</p>
<p><script src="https://gist.github.com/am-MongoDB/cdd015a34e639798c92fa5391591c972.js"></script></p>
<h4><code>app.js</code></h4>
<p>This <a href="https://github.com/am-MongoDB/MongoDB-Mongopop/blob/master/app.js" title="app.js file for the Mockaroo MongoDB MEAN/MERN stack app">file</a> defines the <code>app</code> module ; much of the contents are boilerplate (and covered by comments in the code) but we look here at a few of the lines that are particular to this application.</p>
<p>Make this an Express application:</p>
<p><script src="https://gist.github.com/am-MongoDB/b7c0afd975e8d9a00d7f3504f950f5d7.js"></script></p>
<p>Define where the views (templates used by the Jade view engine to generate the HTML code) and static files (files that must be accessible by a remote client) are located:</p>
<p><script src="https://gist.github.com/am-MongoDB/00b713272a703500507d07d501e608f7.js"></script></p>
<p>Create the <code>/pop</code> route and associate it with the file containing its code (<code>routes/pop.js</code>):</p>
<p><script src="https://gist.github.com/am-MongoDB/f869436734576d82ebbb2bbefb4dd9e3.js"></script></p>
<h4><code>routes/pop.js</code></h4>
<p>This <a href="https://github.com/am-MongoDB/MongoDB-Mongopop/blob/master/routes/pop.js" title="Implementation of REST API for Mockaroo MongoDB population app">file</a> implements each of the operations provided by the Mongopop REST API. Because of the the <code>/pop</code> route defined in <code>app.js</code> Express will direct any URL of the form <code>http://&lt;mongopop-server&gt;:3000/pop/X</code> here. Within this file a route handler is created in order direct incoming requests to <code>http://&lt;mongopop-server&gt;:3000/pop/X</code> to the appropriate function:</p>
<p><script src="https://gist.github.com/am-MongoDB/8f755926a46dc716b189b2508b499279.js"></script></p>
<p>As the <code>/pop</code> route is only intended for the REST API, end users shouldn&#8217;t be browsing here but we create a top level handler for the <code>GET</code> method in case they do:</p>
<p><script src="https://gist.github.com/am-MongoDB/ddcfff4375d14e156e6c8fe8910e54f8.js"></script></p>
<p><img decoding="async" src="./../../../wp-content/uploads/2017/02/top_of_pop_route.png" alt="Results of browsing to the top-route for the Mongopop MongoDB application" title="Results of browsing to the top-route for the Mongopop MongoDB Application"></p>
<p>This is the first time that we see how to send a response to a request; <code>res.json(testObject);</code> converts <code>testObject</code> into a JSON document and sends it back to the requesting client as part of the response message.</p>
<p>The simplest useful route path is for the <code>GET</code> method on <code>/pop/ip</code> which sends a response containing the IP address of the back-end server. This is useful to the Mongopop client as it means the user can see it and add it to the <a href="https://www.mongodb.com/cloud" title="MongoDB Atlas - MongoDB as a cloud service">MongoDB Atlas</a> whitelist. The code to determine and store <code>publicIP</code> is left out here but can be found in the <a href="https://github.com/am-MongoDB/MongoDB-Mongopop/blob/master/routes/pop.js" title="Implementation of MongoDB MongoPop REST API">full source file for <code>pop.js</code></a>.</p>
<p><script src="https://gist.github.com/am-MongoDB/cd3ce3a68574562330010bf3f9a5b93f.js"></script></p>
<p><img decoding="async" src="./../../../wp-content/uploads/2017/02/ip_route.png" alt="Fetching the IP address for the MongoDB Mongopop back-end using REST API" title="Fetching the IP address for the MongoDB Mongopop back-end using REST API"></p>
<p>We&#8217;ve seen that it&#8217;s possible to test <code>GET</code> methods from a browser&#8217;s address bar; that isn&#8217;t possible for <code>POST</code> methods and so it&#8217;s useful to be able to test using the <code>curl</code> command-line command:</p>
<p><script src="https://gist.github.com/am-MongoDB/480520ac8dba6989fc0f0b43c2106257.js"></script></p>
<p>The <code>GET</code> method for <code>/pop/config</code> is just as simple ‚Äì responding with the client-specific configuration data:</p>
<p><script src="https://gist.github.com/am-MongoDB/c48e0d2c94667303d6ba7e4da82aa14a.js"></script></p>
<p><script src="https://gist.github.com/am-MongoDB/b5348fea74155be8289feedb8bdb2555.js"></script></p>
<p>The results of the request are still very simple but the output from <code>curl</code> is already starting to get messy; piping it through <code>python -mjson.tool</code> makes it easier to read:</p>
<p><script src="https://gist.github.com/am-MongoDB/d690566ecedccc7e1d24087d97b3a607.js"></script></p>
<p>The simplest operation that actually accesses the database is the <code>POST</code> method for the <code>/pop/countDocs</code> route path:</p>
<p><script src="https://gist.github.com/am-MongoDB/db488a9f9866f5a91adddba3fe1f694f.js"></script></p>
<p><code>database</code> is an instance of the object prototype defined in <code>javascripts/db</code> (see <a href="./../../../mongodb/mean_stack_2_mongodb_node_js/index.html" title="The Modern Application Stack ‚Äì Part 2: Using MongoDB With Node.js">The Modern Application Stack ‚Äì Part 2: Using MongoDB With Node.js</a>) and so all this method needs to do is use that object to:</p>
<ul>
<li>Connect to the database (using the address of the MongoDB server provided in the request body). The results from the promise returned by <code>database.connect</code> is passed to the function(s) in the first <code>.then</code> clause. Refer back to <a href="./../../../mongodb/mean_stack_2_mongodb_node_js/index.html" title="Using MongoDB With Node.js">Part 2: Using MongoDB With Node.js</a> if you need a recap on using <em>promises</em>.</li>
<li>The function in the <code>.then</code> clause handles the case where the <code>database.connect</code> promise is resolved (success). This function requests a count of the documents ‚Äì the database connection information is now stored within the <code>database</code> object and so only the collection name needs to be passed. The promise returned by <code>database.countDocuments</code> is passed to the next <code>.then</code> clause. Note that there is no second (error) function provided, and so if the promise from <code>database.connect</code> is rejected, then that failure passes through to the next <code>.then</code> clause in the chain.</li>
<li>The second <code>.then</code> clause has two functions:
<ul>
<li>The first is invoked if and when the promise is resolved (success) and it returns a success response (which is automatically converted into a resolved promise that it passed to the final <code>.then</code> clause in the chain). <code>count</code> is the value returned when the promise from the call to <code>database.countDocuments</code> was resolved.</li>
<li>The second function handles the failure case (could be from either <code>database.connect</code> or <code>database.countDocuments</code>) by returning an error response object (which is converted to a resolved promise).</li>
</ul>
</li>
<li>The final <code>.then</code> clause closes the database connection and then sends the HTTP response back to the client; the response is built by converting the <code>resultObject</code> (which could represent success or failure) to a JSON string.</li>
</ul>
<p>Once more, <code>curl</code> can be used from the command-line to test this operation; as this is a <code>POST</code> request, the <code>--data</code> option is used to pass the JSON document to be included in the request:</p>
<p><script src="https://gist.github.com/am-MongoDB/bcfe2d25cc5cca3f541f33d6e10395f7.js"></script></p>
<p><code>curl</code> can also be used to test the error paths. Cause the database connection to fail by using the wrong port number in the MongoDB URI:</p>
<p><script src="https://gist.github.com/am-MongoDB/c1870ed519d3c984233ec0cb58f06586.js"></script></p>
<p>Cause the count to fail by using the name of a non-existent collection:</p>
<p><script src="https://gist.github.com/am-MongoDB/2eb854b3ee2aa967acb1a66f8d00640f.js"></script></p>
<p>The <code>POST</code> method for the <code>pop/sampleDocs</code> route path works in a very similar way:</p>
<p><script src="https://gist.github.com/am-MongoDB/48ff297002eceb8201f67fe58e7d1d71.js"></script></p>
<p>Testing this new operation:</p>
<p><script src="https://gist.github.com/am-MongoDB/8a27a81809e2cd98baf9c29ccadd2381.js"></script></p>
<p>The <code>POST</code> method for <code>pop/updateDocs</code> is a little more complex as the caller can request multiple update operations be performed. The simplest way to process multiple asynchronous, promise-returning function calls in parallel is to build an array of the tasks and pass it to the <code>Promise.all</code> method which returns a promise that either resolves after all of the tasks have succeeded or is rejected if any of the tasks fail:</p>
<p><script src="https://gist.github.com/am-MongoDB/523c077b067da17bcca7919a35961a8a.js"></script></p>
<p>Testing with <code>curl</code>:</p>
<p><script src="https://gist.github.com/am-MongoDB/0efee82247ea652b5ecf367b465b139d.js"></script></p>
<p>The final method uses example data from a service such as <a href="https://www.mockaroo.com/">Mockaroo</a> to populate a MongoDB collection. A helper function is created that makes the call to that external service:</p>
<p><script src="https://gist.github.com/am-MongoDB/d988ff3dba646151ea4118473b3dc4c4.js"></script></p>
<p>That function is then used in the <code>POST</code> method for <code>/pop/addDocs</code>:</p>
<p><script src="https://gist.github.com/am-MongoDB/76dd46d05f9472bdbe19104a5fc19c42.js"></script></p>
<p>This method is longer than the previous ones ‚Äì mostly because there are two paths:</p>
<ul>
<li>In the first path, the client has requested that a fresh set of 1,000 example documents be used for each pass at adding a batch of documents. This path is much slower and will eat through your Mockaroo quota much faster.</li>
<li>In the second path, just one batch of 1,000 example documents is fetched from Mockaroo and then those same documents are repeatedly added. This path is faster but it results in duplicate documents (apart from a MongoDB-created <code>_id</code> field). This path cannot be used if the <code>_id</code> is part of the example documents generated by Mockaroo.</li>
</ul>
<p>So far, we&#8217;ve used the Chrome browser and the <code>curl</code> command-line tool to test the REST API. A third approach is to use the <a href="https://chrome.google.com/webstore/detail/postman/fhbjgbiflinjbdggehcddcbncdddomop">Postman Chrome app</a>:</p>
<p><img decoding="async" src="./../../../wp-content/uploads/2017/02/Test_REST_API_with_Postman.png" alt="Testing MongoDB Mongopop REST API with Postman Chrome app" title="Testing MongoDB Mongopop REST API with Postman Chrome app"></p>
<h4>Debugging Tips</h4>
<p>One way to debug a Node.js application is to liberally sprinkle <code>console.log</code> messages throughout your code but that takes extra effort and bloats your code base. Every time you want to understand something new, you must add extra logging to your code and then restart your application.</p>
<p>Developers working with browser-side JavaScript benefit from the excellent tools built into modern browsers ‚Äì for example, Google&#8217;s <a href="https://developer.chrome.com/devtools" title="Chrome Developer Tools">Chrome Developer Tools</a> which let you:</p>
<ul>
<li>Browse code (e.g. HTML and JavaScript)</li>
<li>Add breakpoints</li>
<li>View &amp; alter contents of variables</li>
<li>View and modify css styles</li>
<li>View network messages</li>
<li>Access the console (view output and issue commands)</li>
<li>Check security details</li>
<li>Audit memory use, CPU, etc.</li>
</ul>
<p>You open the Chrome DevTools within the Chrome browser using &#8220;View/Developer/Developer Tools&#8221;.</p>
<p>Fortunately, you can use the <code>node-debug</code> command of <a href="https://github.com/node-inspector/node-inspector"><code>node-inspector</code></a> to get a very similar experience for Node.js back-end applications. To install <code>node-inspector</code>:</p>
<p><script src="https://gist.github.com/am-MongoDB/a4e8beffc4944a1661a41a1142e8aa27.js"></script></p>
<p><code>node-inspector</code> can be used to debug the Mongopop Express application by starting it with <code>node-debug</code> via the <code>express-debug</code> script in <code>package.json</code>:</p>
<p><script src="https://gist.github.com/am-MongoDB/e2e9bb6c5817bbbc3244ec1bf668e001.js"></script></p>
<p>To run the Mongopop REST API with <code>node-debug</code>, kill the Express app if it&#8217;s already running and then execute:</p>
<p><script src="https://gist.github.com/am-MongoDB/ac8ea737900ca517545786b558a01cfa.js"></script></p>
<p>Note that this automatically adds a breakpoint at the start of the app and so you will need to skip over that to run the application.</p>
<p><img decoding="async" src="./../../../wp-content/uploads/2017/02/Node_Inspector.png" alt="Using Chrome Developer Tools with MongoDB Express Node.js application" title="Using Chrome Developer Tools with MongoDB Express Node.js application"></p>
<p>Depending on your version of Node.js, you may see this error:</p>
<p><script src="https://gist.github.com/am-MongoDB/813df5e59e4f68224fcc2e3853df7e83.js"></script></p>
<p>If you do, apply <a href="https://github.com/node-inspector/node-inspector/pull/938/files">this patch</a> to <code>/usr/local/lib/node_modules/node-inspector/lib/InjectorClient.js</code>.</p>
<h4>Summary &amp; what&#8217;s next in the series</h4>
<p><a href="./../../../mongodb/modern-application-stack-part-1-introducing-the-mean-stack/index.html" title="Introducing the MEAN stack and MERN stack">Part 1: Introducing The MEAN Stack</a> provided an overview of the technologies that are used by modern application developers ‚Äì in particular, the MERN and MEAN stacks. <a href="./../../../mongodb/mean_stack_2_mongodb_node_js/index.html" title="Using MongoDB with Node.js">Part 2: Using MongoDB With Node.js</a> set up Node.js and the MongoDB Driver and then used them to build a new Node.js module to provide a simplified interface to the database.</p>
<p>This post built upon the first two of the series by stepping through how to implement a REST API using Express. We also looked at three different ways to test this API and how to debug Node.js applications. This REST API is required by both the Angular (Part 4) and React (Part 5) web app clients, as well as by the alternative UIs explored in Part 6.</p>
<p>The next part of this series implements the Angular client that makes use of the REST API ‚Äì at the end of that post, you will understand the end-to-end steps required to implement an application using the MEAN stack.</p>
<p>Continue to follow this blog series to step through building the remaining stages of the <a href="https://github.com/am-MongoDB/MongoDB-Mongopop" title="Mongopop ‚Äì MongoDB data population app">MongoPop</a> application:</p>
<ul>
<li><a href="./../../../mongodb/modern-application-stack-part-1-introducing-the-mean-stack/index.html" title="MEAN stack, MERN stack">Part 1: Introducing The MEAN Stack (and the young MERN upstart)</a></li>
<li><a href="./../../../mongodb/mean_stack_2_mongodb_node_js/index.html" title="Using MongoDB With Node.js">Part 2: Using MongoDB With Node.js</a></li>
<li><a href="./../../../mongodb/the-modern-application-stack-part-3-building-a-rest-api-using-express-js/index.html" title="Building REST API for MongoDB using Express JS">Part 3: Building a REST API with Express.js</a></li>
<li><a href="./../../../mongodb/the-modern-application-stack-part-4-building-a-client-ui-using-angular-2-formerly-angularjs-typescript/index.html" title="Completing the MEAN stack ‚Äì Mongopop Angular2 client">Part 4: Building a Client UI Using Angular 2 (formerly AngularJS) &amp; TypeScript</a></li>
<li><a href="./../../../mongodb/the-modern-application-stack-part-5-using-reactjs-es6-jsx-to-build-a-ui-the-rise-of-mern/index.html" title="Building an application front-end with ReactJS and ES6">Part 5: Using ReactJS, ES6 &amp; JSX to Build a UI (the rise of MERN)</a></li>
<li><a href="./../../../mongodb/rest-mobile-app-amazon-alexa-cloud-services/index.html" title="Using REST APIs from mobile applications and Amazon Alexa">Part 6: Browsers Aren&#8217;t the Only UI ‚Äì Mobile Apps, Amazon Alexa, Cloud Services&#8230;</a></li>
</ul>
<h4>A simpler way to build your app ‚Äì MongoDB Stitch, Backend as a Service</h4>
<p><a href="https://www.mongodb.com/cloud/stitch">MongoDB Stitch</a> is a backend as a service (BaaS), giving developers a REST-like API to MongoDB, and composability with other services, backed by a robust system for configuring fine-grained data access controls. Stitch provides native SDKs for JavaScript, iOS, and Android.</p>
<p>Built-in integrations give your application frontend access to your favorite third party services: Twilio, AWS S3, Slack, Mailgun, PubNub, Google, and more. For ultimate flexibility, you can add custom integrations using MongoDB Stitch&#8217;s HTTP service.</p>
<p>MongoDB Stitch allows you to compose multi-stage pipelines that orchestrate data across multiple services; where each stage acts on the data before passing its results on to the next.</p>
<p>Unlike other BaaS offerings, MongoDB Stitch works with your existing as well as new MongoDB clusters, giving you access to the full power and scalability of the database. By defining appropriate data access rules, you can selectively expose your existing MongoDB data to other applications through MongoDB Stitch&#8217;s API.</p>
<p>If you&#8217;d like to try it out, <a href="./../../../mongodb/mongodb-stitch-the-latest-and-best-way-to-build-your-app/index.html" title="MongoDB Stitch - the latest, and best way to build your app">step through building an application with MongoDB Stitch</a>.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/the-modern-application-stack-part-3-building-a-rest-api-using-express-js" data-via="wpbeginner" data-text="The Modern Application Stack ‚Äì Part 3: Building a REST API Using Express.js" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/the-modern-application-stack-part-3-building-a-rest-api-using-express-js"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/the-modern-application-stack-part-3-building-a-rest-api-using-express-js" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Fthe-modern-application-stack-part-3-building-a-rest-api-using-express-js&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../../../category/mongodb/index.html" rel="category tag">MongoDB</a> | 
Tags: <a href="./../../express/index.html" rel="tag">Express</a>, <a href="./../../mean/index.html" rel="tag">MEAN</a>, <a href="./../../mean-stack/index.html" rel="tag">mean stack</a>, <a href="./../../mongodb/index.html" rel="tag">mongodb</a>, <a href="./../../promises/index.html" rel="tag">promises</a>
</div>

			</div>			<div id="post-4355" class="post-4355 post type-post status-publish format-standard hentry category-mongodb tag-angular tag-angular-js tag-javascript tag-mean-stack tag-mongodb tag-typescript">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../../../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../../../mongodb/mean_stack_2_mongodb_node_js/index.html">February 2, 2017</a>
			</div>
	<div class="postcomments">
		<a href="./../../../mongodb/mean_stack_2_mongodb_node_js/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../../../mongodb/mean_stack_2_mongodb_node_js/index.html" rel="bookmark">The Modern Application Stack ‚Äì Part 2: Using MongoDB With Node.js</a></h2>
				
				<div class="entry">
										<h2>Introduction</h2>
<p>This is the second in a series of blog posts examining the technologies that are driving the development of modern web and mobile applications.</p>
<p><a href="./../../../mongodb/modern-application-stack-part-1-introducing-the-mean-stack/index.html" title="The Modern Application Stack ‚Äì Introducing The MEAN Stack">&#8220;Modern Application Stack ‚Äì Part 1: Introducing The MEAN Stack&#8221;</a> introduced the technologies making up the <strong>MEAN</strong> (<strong>M</strong>ongoDB, <strong>E</strong>xpress, <strong>A</strong>ngular, <strong>N</strong>ode.js) and <strong>MERN</strong> (<strong>M</strong>ongoDB, <strong>E</strong>xpress, <strong>R</strong>eact, <strong>N</strong>ode.js) Stacks, why you might want to use them, and how to combine them to build your web application (or your native mobile or desktop app).</p>
<p>The remainder of the series is focussed on working through the end to end steps of building a real (albeit simple) application ‚Äì <em>MongoPop</em>.</p>
<p>This post demonstrates how to use MongoDB from Node.js.</p>
<h2>MongoDB (recap)</h2>
<p>MongoDB provides the persistence for your application data.</p>
<p>MongoDB is an open-source, document database designed with both scalability and developer agility in mind. MongoDB bridges the gap between key-value stores, which are fast and scalable, and relational databases, which have rich functionality. Instead of storing data in rows and columns as one would with a relational database, MongoDB stores JSON documents in collections with dynamic schemas.</p>
<p>MongoDB&#8217;s document data model makes it easy for you to store and combine data of any structure, without giving up sophisticated validation rules, flexible data access, and rich indexing functionality. You can dynamically modify the schema without downtime ‚Äì vital for rapidly evolving applications.</p>
<p>It can be scaled within and across geographically distributed data centers, providing high levels of availability and scalability. As your deployments grow, the database scales easily with no downtime, and without changing your application.</p>
<p><a href="https://www.mongodb.com/cloud/atlas" title="MongoDB Atlas Cloud Database Service">MongoDB Atlas</a> is a database as a service for MongoDB, letting you focus on apps instead of ops. With MongoDB Atlas, you only pay for what you use with a convenient hourly billing model. With the click of a button, you can scale up and down when you need to, with no downtime, full security, and high performance.</p>
<p>Our application will access MongoDB via the <a href="https://mongodb.github.io/node-mongodb-native/" title="JavaScript Node.js driver for MongoDB">JavaScript/Node.js driver</a> which we install as a Node.js module.</p>
<h2>Node.js (recap)</h2>
<p><a href="https://nodejs.org/">Node.js</a> is a JavaScript runtime environment that runs your back-end application (via Express).</p>
<p>Node.js is based on Google&#8217;s V8 JavaScript engine which is used in the Chrome browser. It also includes a number of modules that provides features essential for implementing web applications ‚Äì including networking protocols such as HTTP. Third party modules, including the MongoDB driver, can be installed, using the <code>npm</code> tool.</p>
<p>Node.js is an asynchronous, event-driven engine where the application makes a request and then continues working on other useful tasks rather than stalling while it waits for a response. On completion of the requested task, the application is informed of the results via a callback (or a <em>promise</em> or <em>Observable</em>. This enables large numbers of operations to be performed in parallel ‚Äì essential when scaling applications. MongoDB was also designed to be used asynchronously and so it works well with Node.js applications.</p>
<h2>The application ‚Äì Mongopop</h2>
<p>MongoPop is a web application that can be used to help you test out and exercise MongoDB. After supplying it with the database connection information (e.g., as displayed in the MongoDB Atlas GUI), MongoPop provides these features:</p>
<ul>
<li>Accept your username and password and create the full MongoDB connect string ‚Äì using it to connect to your database</li>
<li>Populate your chosen MongoDB collection with bulk data (created with the help of the <a href="https://www.mockaroo.com/">Mockeroo service</a>)</li>
<li>Count the number of documents</li>
<li>Read sample documents</li>
<li>Apply bulk changes to selected documents</li>
</ul>
<p></p>
<center>
<img decoding="async" src="./../../../wp-content/uploads/2017/02/Mongopop_demo.gif" alt="Mongopop Demo" title="Mongopop Demo"> </center>
<h2>Downloading, running, and using the Mongopop application</h2>
<p>Rather than installing and running MongoDB ourselves, it&#8217;s simpler to spin one up in <a href="https://cloud.mongodb.com/" title="MongoDB Atlas Cloud Database Service">MongoDB Atlas</a>:</p>
<p><img decoding="async" src="./../../../wp-content/uploads/2017/02/Create_MongoDB_Atlas_Cluster.gif" alt="Create MongoDB Atlas Cluster" title="Create MongoDB Atlas Cluster"></p>
<p>To get the application code, either <a href="https://github.com/am-MongoDB/Mongopop/archive/master.zip" title="Mongopop - populating MongoDB databases">download and extract the zip file</a> or use <code>git</code> to clone the Mongopop repo:</p>
<pre><code>git clone git@github.com:am-MongoDB/MongoDB-Mongopop.git
cd MongoDB-Mongopop
</code></pre>
<p>If you don&#8217;t have Node.js installed then that needs to be done before building the application; it can be downloaded from <a href="https://nodejs.org/en/">nodejs.org</a> .</p>
<p>A file called <code>package.json</code> is used to control <a href="https://www.npmjs.com/"><code>npm</code></a> (the package manager for Node.js); here is the final version for the application:</p>
<p><script src="https://gist.github.com/am-MongoDB/aead8db6513beeb9c39e50cdb5efa95a.js"></script></p>
<p>The <code>scripts</code> section defines a set of shortcuts that can be executed using <code>npm run &lt;script-name&gt;</code>. For example <code>npm run debug</code> runs the Typescript transpiler (<code>tsc</code>) and then the Express framework in debug mode. <code>start</code> is a special case and can be executed with <code>npm start</code>.</p>
<p>Before running any of the software, the Node.js dependencies must be installed (into the <code>node_modules</code> directory):</p>
<pre><code>npm install
</code></pre>
<p>Note the list of dependencies in <code>package.json</code> ‚Äì these are the Node.js packages that will be installed by <code>npm install</code>. After those modules have been installed, <code>npm</code> will invoke the <code>postinstall</code> script (that will be covered in Part 4 of this series). If you later realise that an extra package is needed then you can install it and add it to the dependency list with a single command. For example, if the MongoDB Node.js driver hadn&#8217;t already been included then it could be added with <code>npm install --save mongodb</code> ‚Äì this would install the package as well as saving the dependency in <code>package.json</code>.</p>
<p>The application can then be run:</p>
<pre><code>npm start
</code></pre>
<p>Once running, browse to <code>http://localhost:3000/</code> to try out the application. When browsing to that location, you should be rewarded with the IP address of the server where Node.js is running (useful when running the client application remotely) ‚Äì this IP address must be added to the <em>IP Whitelist</em> in the Security tab of the <a href="https://cloud.mongodb.com/">MongoDB Atlas GUI</a>. Fill in the password for the MongoDB user you created in MongoDB Atlas and you&#8217;re ready to go. Note that you should get your own URL, for your own data set using the <a href="https://www.mockaroo.com/">Mockaroo service</a> ‚Äì allowing you to customise the format and contents of the sample data (and avoid exceeding the Mockaroo quota limit for the example URL).</p>
<h4>What are all of these files?</h4>
<ul>
<li>
<strong><code>package.json</code></strong>: Instructs the Node.js package manager (<code>npm</code>) what it needs to do; including which dependency packages should be installed</li>
<li>
<strong><code>node_modues</code></strong>: Directory where <code>npm</code> will install packages</li>
<li>
<strong><code>node_modues/mongodb</code></strong>: The MongoDB driver for Node.js</li>
<li>
<strong><code>node_modues/mongodb-core</code></strong>: Low-level MongoDB driver library; available for framework developers (application developers should avoid using it directly)</li>
<li>
<strong><code>javascripts/db.js</code></strong>: A JavaScript module we&#8217;ve created for use by our Node.js apps (in this series, it will be Express) to access MongoDB; this module in turn uses the MongoDB Node.js driver.</li>
</ul>
<p>The rest of the files and directories can be ignored for now ‚Äì they will be covered in later posts in this series.</p>
<h2>Architecture</h2>
<p><img decoding="async" src="./../../../wp-content/uploads/2017/02/MongoDB_NodeJS_Driver.png" alt="Using the JavaScript MongoDB Node.js Driver" title="Using the JavaScript MongoDB Node.js Driver"></p>
<p>The MongoDB Node.js Driver provides a JavaScript API which implements the network protocol required to read and write from a local or remote MongoDB database. If using a <a href="https://docs.mongodb.com/manual/replication/" title="MongoDB Replica Sets">replica set</a> (and you should for production) then the driver also decides which MongoDB instance to send each request to. If using a sharded MongoDB cluster then the driver connects to the <a href="https://docs.mongodb.com/manual/reference/program/mongos/" title="mongos ‚Äì the MongoDB query router"><code>mongos</code> query router</a>, which in turn picks the correct shard(s) to direct each request to.</p>
<p>We implement a shallow wrapper for the driver (<code>javascripts/db.js</code>) which simplifies the database interface that the application code (coming in the next post) is exposed to.</p>
<h4>Code highlights</h4>
<p><code>javascripts/db.js</code> defines an /object prototype/ (think <em>class</em> from other languages) named <code>DB</code> to provide access to MongoDB.</p>
<p>Its only dependency is the MongoDB Node.js driver:</p>
<pre><code class="js">var MongoClient = require('mongodb').MongoClient;
</code></pre>
<p>The prototype has a single property ‚Äì <code>db</code> which stores the database connection; it&#8217;s initialised to <code>null</code> in the constructor:</p>
<pre><code class="js">function DB() {
    this.db = null;         // The MongoDB database connection
}
</code></pre>
<p>The MongoDB driver is asynchronous (the function returns without waiting for the requested operation to complete); there are two different patterns for handling this:</p>
<ol>
<li>The application passes a <em>callback</em> function as a parameter; the driver will invoke this callback function when the operation has run to completion (either on success or failure)</li>
<li>If the application does not pass a callback function then the driver function will return a <em>promise</em>
</li>
</ol>
<p>This application uses the promise-based approach. This is the general pattern when using promises:</p>
<p><script src="https://gist.github.com/am-MongoDB/c58ad7e6c409439dc4b4bab6a676d754.js"></script></p>
<p>The methods of the <code>DB</code> object prototype we create are also asynchronous and also return promises (rather than accepting callback functions). This is the general pattern for returning and then subsequently satisfying promises:</p>
<p><script src="https://gist.github.com/am-MongoDB/ca7d242150185a1cbdef6347ac01133c.js"></script></p>
<p><code>db.js</code> represents a thin wrapper on top of the MongoDB driver library and so (with the background on promises under our belt) the code should be intuitive. The basic interaction model from the application should be:</p>
<ol>
<li>Connect to the database</li>
<li>Perform all of the required database actions for the current request</li>
<li>Disconnect from the database</li>
</ol>
<p>Here is the method from <code>db.js</code> to open the database connection:</p>
<p><script src="https://gist.github.com/am-MongoDB/5d287c55f317dbd5bd1957541697be4a.js"></script></p>
<p>One of the simplest methods that can be called to use this new connection is to count the number of documents in a collection:</p>
<p><script src="https://gist.github.com/am-MongoDB/432f4c516bc6c69d73721969266e7c0f.js"></script></p>
<p>Note that the <code>collection</code> method on the database connection doesn&#8217;t support promises and so a callback function is provided instead.</p>
<p>And after counting the documents; the application should close the connection with this method:</p>
<p><script src="https://gist.github.com/am-MongoDB/f9a30f7ef9caa9c3227af637d78a8c89.js"></script></p>
<p>Note that <code>then</code> also returns a promise (which is, in turn, resolved or rejected). The returned promise could be created in one of 4 ways:</p>
<ol>
<li>The function explicitly creates and returns a new promise (which will eventually be resolved or rejected).</li>
<li>The function returns another function call which, in turn, returns a promise (which will eventually be resolved or rejected).</li>
<li>The function returns a value ‚Äì which is automatically turned into a resolved promise.</li>
<li>The function throws an error ‚Äì which is automatically turned into a rejected promise.</li>
</ol>
<p>In this way, promises can be chained to perform a sequence of events (where each step waits on the resolution of the promise from the previous one). Using those 3 methods from <code>db.js</code>, it&#8217;s now possible to implement a very simple application function:</p>
<p><script src="https://gist.github.com/am-MongoDB/ef0583ff78aaefa889ed4f664828dd80.js"></script></p>
<p>That function isn&#8217;t part of the final application ‚Äì the actual code will be covered in the next post ‚Äì but jump ahead and look at <a href="https://github.com/am-MongoDB/MongoDB-Mongopop/blob/master/routes/pop.js"><code>routes/pop.js</code></a> if your curious).</p>
<p>It&#8217;s worth looking at the <code>sampleCollection</code> prototype method as it uses a database <a href="http://mongodb.github.io/node-mongodb-native/2.0/api/Cursor.html" title="MongoDB Database cursor">/cursor/</a> . This method fetches a &#8220;random&#8221; selection of documents ‚Äì useful when you want to understand the typical format of the collection&#8217;s documents:</p>
<p><script src="https://gist.github.com/am-MongoDB/00ec204efad24d558476f6e90887ceb3.js"></script></p>
<p>Note that [<code>collection.aggregate</code>](http://mongodb.github.io/ node-mongodb-native/2.0/api/Collection.html#aggregate &#8220;MongoDB aggregation from JavaScript Node.js driver&#8221;) doesn&#8217;t actually access the database ‚Äì that&#8217;s why it&#8217;s a synchronous call (no need for a promise or a callback) ‚Äì instead, it returns a <code>cursor</code>. The cursor is then used to read the data from MongoDB by invoking its <a href="http://mongodb.github.io/node-mongodb-native/2.0/api/Cursor.html#toArray" title="Get array from cursor using MongoDB JavaScript Node.js driver"><code>toArray</code></a> method. As <code>toArray</code> reads from the database, it can take some time and so it is an asynchronous call, and a callback function must be provided (<code>toArray</code> doesn&#8217;t support promises).</p>
<p>The rest of these database methods can be viewed in <a href="https://github.com/am-MongoDB/MongoDB-Mongopop/blob/master/javascripts/db.js"><code>db.js</code></a> but they follow a similar pattern. The <a href="http://mongodb.github.io/node-mongodb-native/2.0/api/index.html" title="JavaScript MongoDB Driver for Node.js ‚Äì API">Node.js MongoDB Driver API documentation</a> explains each of the methods and their parameters.</p>
<h4>Summary &amp; what&#8217;s next in the series</h4>
<p>This post built upon the first, introductory, post by stepping through how to install and use Node.js and the MongoDB Node.js driver. This is our first step in building a modern, reactive application using the MEAN and MERN stacks.</p>
<p>The blog went on to describe the implementation of a thin layer that&#8217;s been created to sit between the application code and the MongoDB driver. The layer is there to provide a simpler, more limited API to make application development easier. In other applications, the layer could add extra value such as making semantic data checks.</p>
<p>The next part of this series adds the Express framework and uses it to implement a REST API to allow clients to make requests of the MongoDB database. That REST API will subsequently be used by the client application (using Angular in Part 4 or React in Part 5).</p>
<p>Continue following this blog series to step through building the remaining stages of the <a href="https://github.com/am-MongoDB/MongoDB-Mongopop">MongoPop</a> application:</p>
<ul>
<li><a href="./../../../mongodb/modern-application-stack-part-1-introducing-the-mean-stack/index.html" title="MEAN stack, MERN stack">Part 1: Introducing The MEAN Stack (and the young MERN upstart)</a></li>
<li><a href="./../../../mongodb/mean_stack_2_mongodb_node_js/index.html" title="Using MongoDB With Node.js">Part 2: Using MongoDB With Node.js</a></li>
<li><a href="./../../../mongodb/the-modern-application-stack-part-3-building-a-rest-api-using-express-js/index.html" title="Building REST API for MongoDB using Express JS">Part 3: Building a REST API with Express.js</a></li>
<li><a href="./../../../mongodb/the-modern-application-stack-part-4-building-a-client-ui-using-angular-2-formerly-angularjs-typescript/index.html" title="Completing the MEAN stack ‚Äì Mongopop Angular2 client">Part 4: Building a Client UI Using Angular 2 (formerly AngularJS) &amp; TypeScript</a></li>
<li><a href="./../../../mongodb/the-modern-application-stack-part-5-using-reactjs-es6-jsx-to-build-a-ui-the-rise-of-mern/index.html" title="Building an application front-end with ReactJS and ES6">Part 5: Using ReactJS, ES6 &amp; JSX to Build a UI (the rise of MERN)</a></li>
<li><a href="./../../../mongodb/rest-mobile-app-amazon-alexa-cloud-services/index.html" title="Using REST APIs from mobile applications and Amazon Alexa">Part 6: Browsers Aren&#8217;t the Only UI ‚Äì Mobile Apps, Amazon Alexa, Cloud Services&#8230;</a></li>
</ul>
<h4>A simpler way to build your app ‚Äì MongoDB Stitch, Backend as a Service</h4>
<p><a href="https://www.mongodb.com/cloud/stitch">MongoDB Stitch</a> is a backend as a service (BaaS), giving developers a REST-like API to MongoDB, and composability with other services, backed by a robust system for configuring fine-grained data access controls. Stitch provides native SDKs for JavaScript, iOS, and Android.</p>
<p>Built-in integrations give your application frontend access to your favorite third party services: Twilio, AWS S3, Slack, Mailgun, PubNub, Google, and more. For ultimate flexibility, you can add custom integrations using MongoDB Stitch&#8217;s HTTP service.</p>
<p>MongoDB Stitch allows you to compose multi-stage pipelines that orchestrate data across multiple services; where each stage acts on the data before passing its results on to the next.</p>
<p>Unlike other BaaS offerings, MongoDB Stitch works with your existing as well as new MongoDB clusters, giving you access to the full power and scalability of the database. By defining appropriate data access rules, you can selectively expose your existing MongoDB data to other applications through MongoDB Stitch&#8217;s API.</p>
<p>If you&#8217;d like to try it out, <a href="./../../../mongodb/mongodb-stitch-the-latest-and-best-way-to-build-your-app/index.html" title="MongoDB Stitch - the latest, and best way to build your app">step through building an application with MongoDB Stitch</a>.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/mean_stack_2_mongodb_node_js" data-via="wpbeginner" data-text="The Modern Application Stack ‚Äì Part 2: Using MongoDB With Node.js" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/mean_stack_2_mongodb_node_js"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/mean_stack_2_mongodb_node_js" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Fmean_stack_2_mongodb_node_js&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../../../category/mongodb/index.html" rel="category tag">MongoDB</a> | 
Tags: <a href="./../../angular/index.html" rel="tag">angular</a>, <a href="./../../angular-js/index.html" rel="tag">angular.js</a>, <a href="./../../javascript/index.html" rel="tag">javascript</a>, <a href="./../../mean-stack/index.html" rel="tag">mean stack</a>, <a href="./../../mongodb/index.html" rel="tag">mongodb</a>, <a href="./../../typescript/index.html" rel="tag">typescript</a>
</div>

			</div>      
							<div class="more_posts">
					<span class="post_links"><a href="./4/index.html">&laquo; Older Entries</a> &nbsp; <a href="./2/index.html">Recent Entries &raquo;</a></span>
				</div>
						

					
	</div>
		
		
<div id="sidebar">
	<ul>

<li id="search-2" class="widget widget_search"><form role="search" method="get" id="searchform" class="searchform" action=".//">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s">
					<input type="submit" id="searchsubmit" value="Search">
				</div>
			</form></li>

		<li id="recent-posts-2" class="widget widget_recent_entries">
		<h2 class="widgettitle">Recent Posts</h2>

		<ul>
											<li>
					<a href="./../../../mongodb/building-a-collaborative-ios-minesweeper-game-with-realm/index.html">Building a collaborative iOS Minesweeper game with Realm</a>
									</li>
											<li>
					<a href="./../../../mongodb/using-realm-flexible-sync-in-your-app-an-ios-tutorial/index.html">Using Realm Flexible Sync in Your App‚Äîan iOS Tutorial</a>
									</li>
											<li>
					<a href="./../../../mongodb/realm-swift-type-projections/index.html">Realm-Swift Type Projections</a>
									</li>
											<li>
					<a href="./../../../mongodb/introducing-flexible-sync-preview-the-next-iteration-of-realm-sync/index.html">Introducing Flexible Sync (Preview) ‚Äì The Next Iteration of Realm Sync</a>
									</li>
											<li>
					<a href="./../../../mongodb/goodbye-nspredicate-hello-realm-swift-query-api/index.html">Goodbye NSPredicate, hello Realm Swift Query API</a>
									</li>
					</ul>

		</li>
<li id="text-2" class="widget widget_text">			<div class="textwidget">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-5257306915232759";
/* Clusterdb-home */
google_ad_slot = "1624229680";
google_ad_width = 200;
google_ad_height =600;
//--></script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
</div>
		</li>
<li id="recent-comments-2" class="widget widget_recent_comments">
<h2 class="widgettitle">Recent Comments</h2>
<ul id="recentcomments">
<li class="recentcomments">
<span class="comment-author-link"><a href="http://mikael.ronstrom@blogspot.com/" class="url" rel="ugc external nofollow">Mikael Ronstr√∂m</a></span> on <a href="./../../../mysql-cluster/mysql-cluster-running-on-raspberry-pi/index.html#comment-787242">MySQL Cluster running on Raspberry Pi</a>
</li>
<li class="recentcomments">
<span class="comment-author-link">andrew</span> on <a href="./../../../mysql-cluster/setting-up-mysql-asynchronous-replication-for-high-availability/index.html#comment-668717">Setting up MySQL Asynchronous Replication for High Availability</a>
</li>
<li class="recentcomments">
<span class="comment-author-link"><a href="http://www.suksesonline.com/" class="url" rel="ugc external nofollow">Betty</a></span> on <a href="./../../../mysql-cluster/setting-up-mysql-asynchronous-replication-for-high-availability/index.html#comment-668713">Setting up MySQL Asynchronous Replication for High Availability</a>
</li>
<li class="recentcomments">
<span class="comment-author-link">Sai Krishnan</span> on <a href="./../../../mysql-cluster/get-mysql-replication-up-and-running-in-5-minutes/index.html#comment-661143">Get MySQL Replication up and running in 5 minutes</a>
</li>
<li class="recentcomments">
<span class="comment-author-link">Nayan</span> on <a href="./../../../mysql-cluster/get-mysql-replication-up-and-running-in-5-minutes/index.html#comment-660628">Get MySQL Replication up and running in 5 minutes</a>
</li>
</ul>
</li>
<li id="categories-2" class="widget widget_categories">
<h2 class="widgettitle">Categories</h2>

			<ul>
					<li class="cat-item cat-item-2">
<a href="./../../../category/me/index.html">Me</a>
</li>
	<li class="cat-item cat-item-146">
<a href="./../../../category/mongodb/index.html">MongoDB</a>
</li>
	<li class="cat-item cat-item-3">
<a href="./../../../category/mysql/index.html">MySQL</a>
</li>
	<li class="cat-item cat-item-4">
<a href="./../../../category/mysql-cluster/index.html">MySQL Cluster</a>
</li>
	<li class="cat-item cat-item-131">
<a href="./../../../category/mysql-fabric/index.html">MySQL Fabric</a>
</li>
	<li class="cat-item cat-item-5">
<a href="./../../../category/mysql-replication/index.html">MySQL Replication</a>
</li>
	<li class="cat-item cat-item-214">
<a href="./../../../category/mongodb/realm/index.html">Realm</a>
</li>
	<li class="cat-item cat-item-1">
<a href="./../../../category/uncategorized/index.html">Uncategorized</a>
</li>
			</ul>

			</li>
<li id="tag_cloud-2" class="widget widget_tag_cloud">
<h2 class="widgettitle">Tags</h2>
<div class="tagcloud">
<a href="./../../7-4/index.html" class="tag-cloud-link tag-link-137 tag-link-position-1" style="font-size: 9.0632911392405pt;" aria-label="7.4 (7 items)">7.4</a>
<a href="./../../apache-kafka/index.html" class="tag-cloud-link tag-link-169 tag-link-position-2" style="font-size: 8.620253164557pt;" aria-label="Apache Kafka (6 items)">Apache Kafka</a>
<a href="./../../cluster/index.html" class="tag-cloud-link tag-link-18 tag-link-position-3" style="font-size: 8.620253164557pt;" aria-label="Cluster (6 items)">Cluster</a>
<a href="./../../ha/index.html" class="tag-cloud-link tag-link-41 tag-link-position-4" style="font-size: 15.354430379747pt;" aria-label="HA (40 items)">HA</a>
<a href="./../../high-availability/index.html" class="tag-cloud-link tag-link-43 tag-link-position-5" style="font-size: 15.26582278481pt;" aria-label="High Availability (39 items)">High Availability</a>
<a href="./../../ios/index.html" class="tag-cloud-link tag-link-215 tag-link-position-6" style="font-size: 10.658227848101pt;" aria-label="ios (11 items)">ios</a>
<a href="./../../java/index.html" class="tag-cloud-link tag-link-47 tag-link-position-7" style="font-size: 8.620253164557pt;" aria-label="Java (6 items)">Java</a>
<a href="./../../javascript/index.html" class="tag-cloud-link tag-link-48 tag-link-position-8" style="font-size: 10.303797468354pt;" aria-label="javascript (10 items)">javascript</a>
<a href="./../../mcm/index.html" class="tag-cloud-link tag-link-56 tag-link-position-9" style="font-size: 8pt;" aria-label="MCM (5 items)">MCM</a>
<a href="./../../mean/index.html" class="tag-cloud-link tag-link-186 tag-link-position-10" style="font-size: 8pt;" aria-label="MEAN (5 items)">MEAN</a>
<a href="./../../memcached/index.html" class="tag-cloud-link tag-link-57 tag-link-position-11" style="font-size: 8pt;" aria-label="Memcached (5 items)">Memcached</a>
<a href="./../../mobile/index.html" class="tag-cloud-link tag-link-211 tag-link-position-12" style="font-size: 8pt;" aria-label="mobile (5 items)">mobile</a>
<a href="./../../mongodb/index.html" class="tag-cloud-link tag-link-150 tag-link-position-13" style="font-size: 16.417721518987pt;" aria-label="mongodb (53 items)">mongodb</a>
<a href="./../../mongodb-3-2/index.html" class="tag-cloud-link tag-link-153 tag-link-position-14" style="font-size: 8pt;" aria-label="MongoDB 3.2 (5 items)">MongoDB 3.2</a>
<a href="./../../mongodb-atlas/index.html" class="tag-cloud-link tag-link-163 tag-link-position-15" style="font-size: 9.0632911392405pt;" aria-label="MongoDB Atlas (7 items)">MongoDB Atlas</a>
<a href="./../../mongodb-mobile/index.html" class="tag-cloud-link tag-link-212 tag-link-position-16" style="font-size: 8pt;" aria-label="MongoDB Mobile (5 items)">MongoDB Mobile</a>
<a href="./../../mongodb-stitch/index.html" class="tag-cloud-link tag-link-204 tag-link-position-17" style="font-size: 12.253164556962pt;" aria-label="MongoDB Stitch (17 items)">MongoDB Stitch</a>
<a href="./../../mysql/index.html" class="tag-cloud-link tag-link-147 tag-link-position-18" style="font-size: 22pt;" aria-label="MySQL (229 items)">MySQL</a>
<a href="./../../mysql-5-6/index.html" class="tag-cloud-link tag-link-64 tag-link-position-19" style="font-size: 10.924050632911pt;" aria-label="MySQL 5.6 (12 items)">MySQL 5.6</a>
<a href="./../../mysql-cluster/index.html" class="tag-cloud-link tag-link-148 tag-link-position-20" style="font-size: 21.46835443038pt;" aria-label="MySQL Cluster (198 items)">MySQL Cluster</a>
<a href="./../../mysql-cluster-70/index.html" class="tag-cloud-link tag-link-69 tag-link-position-21" style="font-size: 13.936708860759pt;" aria-label="MySQL Cluster 7.0 (27 items)">MySQL Cluster 7.0</a>
<a href="./../../mysql-cluster-7-1/index.html" class="tag-cloud-link tag-link-70 tag-link-position-22" style="font-size: 15.177215189873pt;" aria-label="MySQL Cluster 7.1 (38 items)">MySQL Cluster 7.1</a>
<a href="./../../mysql-cluster-7-2/index.html" class="tag-cloud-link tag-link-71 tag-link-position-23" style="font-size: 14.556962025316pt;" aria-label="MySQL Cluster 7.2 (32 items)">MySQL Cluster 7.2</a>
<a href="./../../mysql-cluster-7-3/index.html" class="tag-cloud-link tag-link-72 tag-link-position-24" style="font-size: 12.253164556962pt;" aria-label="MySQL Cluster 7.3 (17 items)">MySQL Cluster 7.3</a>
<a href="./../../mysql-cluster-7-4/index.html" class="tag-cloud-link tag-link-134 tag-link-position-25" style="font-size: 11.278481012658pt;" aria-label="MySQL Cluster 7.4 (13 items)">MySQL Cluster 7.4</a>
<a href="./../../mysql-cluster-cge/index.html" class="tag-cloud-link tag-link-73 tag-link-position-26" style="font-size: 17.569620253165pt;" aria-label="MySQL Cluster CGE (72 items)">MySQL Cluster CGE</a>
<a href="./../../mysql-cluster-manager/index.html" class="tag-cloud-link tag-link-74 tag-link-position-27" style="font-size: 12.607594936709pt;" aria-label="MySQL Cluster Manager (19 items)">MySQL Cluster Manager</a>
<a href="./../../mysql-enterprise-monitor/index.html" class="tag-cloud-link tag-link-76 tag-link-position-28" style="font-size: 9.0632911392405pt;" aria-label="MySQL Enterprise Monitor (7 items)">MySQL Enterprise Monitor</a>
<a href="./../../mysql-fabric-2/index.html" class="tag-cloud-link tag-link-132 tag-link-position-29" style="font-size: 9.0632911392405pt;" aria-label="mysql fabric (7 items)">mysql fabric</a>
<a href="./../../mysql-replication/index.html" class="tag-cloud-link tag-link-149 tag-link-position-30" style="font-size: 15.354430379747pt;" aria-label="MySQL Replication (40 items)">MySQL Replication</a>
<a href="./../../mysql-utilities/index.html" class="tag-cloud-link tag-link-78 tag-link-position-31" style="font-size: 8pt;" aria-label="MySQL Utilities (5 items)">MySQL Utilities</a>
<a href="./../../ndb-api/index.html" class="tag-cloud-link tag-link-80 tag-link-position-32" style="font-size: 10.303797468354pt;" aria-label="NDB API (10 items)">NDB API</a>
<a href="./../../node-js/index.html" class="tag-cloud-link tag-link-83 tag-link-position-33" style="font-size: 10.303797468354pt;" aria-label="node.js (10 items)">node.js</a>
<a href="./../../nosql/index.html" class="tag-cloud-link tag-link-84 tag-link-position-34" style="font-size: 12.784810126582pt;" aria-label="NoSQL (20 items)">NoSQL</a>
<a href="./../../performance/index.html" class="tag-cloud-link tag-link-97 tag-link-position-35" style="font-size: 9.9493670886076pt;" aria-label="Performance (9 items)">Performance</a>
<a href="./../../realm/index.html" class="tag-cloud-link tag-link-213 tag-link-position-36" style="font-size: 11.721518987342pt;" aria-label="Realm (15 items)">Realm</a>
<a href="./../../replication/index.html" class="tag-cloud-link tag-link-104 tag-link-position-37" style="font-size: 10.924050632911pt;" aria-label="Replication (12 items)">Replication</a>
<a href="./../../secondary/index.html" class="tag-cloud-link tag-link-138 tag-link-position-38" style="font-size: 11.278481012658pt;" aria-label="secondary (13 items)">secondary</a>
<a href="./../../serverless/index.html" class="tag-cloud-link tag-link-208 tag-link-position-39" style="font-size: 8.620253164557pt;" aria-label="serverless (6 items)">serverless</a>
<a href="./../../sharding/index.html" class="tag-cloud-link tag-link-129 tag-link-position-40" style="font-size: 8pt;" aria-label="sharding (5 items)">sharding</a>
<a href="./../../swift/index.html" class="tag-cloud-link tag-link-216 tag-link-position-41" style="font-size: 10.303797468354pt;" aria-label="Swift (10 items)">Swift</a>
<a href="./../../swiftui/index.html" class="tag-cloud-link tag-link-217 tag-link-position-42" style="font-size: 10.303797468354pt;" aria-label="SwiftUI (10 items)">SwiftUI</a>
<a href="./../../webcast/index.html" class="tag-cloud-link tag-link-124 tag-link-position-43" style="font-size: 8pt;" aria-label="Webcast (5 items)">Webcast</a>
<a href="./../../webinar/index.html" class="tag-cloud-link tag-link-125 tag-link-position-44" style="font-size: 12.430379746835pt;" aria-label="webinar (18 items)">webinar</a>
<a href="./../../windows/index.html" class="tag-cloud-link tag-link-127 tag-link-position-45" style="font-size: 9.0632911392405pt;" aria-label="Windows (7 items)">Windows</a>
</div>
</li>
<li id="theme_socialmedia-2" class="widget theme_socialmedia">			<div class="widget-social-icons">
				
			<a href="http://twitter.com/andrewmorgan"><img src="./../../../wp-content/themes/zeesynergie/images/icons/twitter.png" alt="twitter"></a><a href="http://www.facebook.com/andrewjamesmorgan"><img src="./../../../wp-content/themes/zeesynergie/images/icons/facebook.png" alt="facebook"></a><a href="https://plus.google.com/u/0/100605473697871424413/posts"><img src="./../../../wp-content/themes/zeesynergie/images/icons/googleplus.png" alt="googleplus"></a><a href="http://www.linkedin.com/profile/view?id=16709956"><img src="./../../../wp-content/themes/zeesynergie/images/icons/linkedin.png" alt="linkedin"></a><a href="http://www.flickr.com/photos/andrewjamesmorgan/"><img src="./../../../wp-content/themes/zeesynergie/images/icons/flickr.png" alt="flickr"></a><a href="http://www.youtube.com/channel/UCodtDakJ4VdeSCzS3P3rIsw"><img src="./../../../wp-content/themes/zeesynergie/images/icons/youtube.png" alt="youtube"></a>			</div>
		</li>
<li id="archives-2" class="widget widget_archive">
<h2 class="widgettitle">Archives</h2>

			<ul>
					<li><a href="./../../../2022/03/index.html">March 2022</a></li>
	<li><a href="./../../../2022/02/index.html">February 2022</a></li>
	<li><a href="./../../../2022/01/index.html">January 2022</a></li>
	<li><a href="./../../../2021/12/index.html">December 2021</a></li>
	<li><a href="./../../../2021/11/index.html">November 2021</a></li>
	<li><a href="./../../../2021/09/index.html">September 2021</a></li>
	<li><a href="./../../../2021/08/index.html">August 2021</a></li>
	<li><a href="./../../../2021/07/index.html">July 2021</a></li>
	<li><a href="./../../../2021/06/index.html">June 2021</a></li>
	<li><a href="./../../../2021/05/index.html">May 2021</a></li>
	<li><a href="./../../../2021/04/index.html">April 2021</a></li>
	<li><a href="./../../../2021/02/index.html">February 2021</a></li>
	<li><a href="./../../../2021/01/index.html">January 2021</a></li>
	<li><a href="./../../../2020/12/index.html">December 2020</a></li>
	<li><a href="./../../../2019/03/index.html">March 2019</a></li>
	<li><a href="./../../../2019/01/index.html">January 2019</a></li>
	<li><a href="./../../../2018/12/index.html">December 2018</a></li>
	<li><a href="./../../../2018/11/index.html">November 2018</a></li>
	<li><a href="./../../../2018/10/index.html">October 2018</a></li>
	<li><a href="./../../../2018/09/index.html">September 2018</a></li>
	<li><a href="./../../../2017/09/index.html">September 2017</a></li>
	<li><a href="./../../../2017/03/index.html">March 2017</a></li>
	<li><a href="./../../../2017/02/index.html">February 2017</a></li>
	<li><a href="./../../../2017/01/index.html">January 2017</a></li>
	<li><a href="./../../../2016/12/index.html">December 2016</a></li>
	<li><a href="./../../../2016/11/index.html">November 2016</a></li>
	<li><a href="./../../../2016/09/index.html">September 2016</a></li>
	<li><a href="./../../../2016/01/index.html">January 2016</a></li>
	<li><a href="./../../../2015/11/index.html">November 2015</a></li>
	<li><a href="./../../../2015/10/index.html">October 2015</a></li>
	<li><a href="./../../../2015/09/index.html">September 2015</a></li>
	<li><a href="./../../../2015/06/index.html">June 2015</a></li>
	<li><a href="./../../../2015/04/index.html">April 2015</a></li>
	<li><a href="./../../../2015/03/index.html">March 2015</a></li>
	<li><a href="./../../../2015/02/index.html">February 2015</a></li>
	<li><a href="./../../../2015/01/index.html">January 2015</a></li>
	<li><a href="./../../../2014/12/index.html">December 2014</a></li>
	<li><a href="./../../../2014/11/index.html">November 2014</a></li>
	<li><a href="./../../../2014/10/index.html">October 2014</a></li>
	<li><a href="./../../../2014/09/index.html">September 2014</a></li>
	<li><a href="./../../../2014/08/index.html">August 2014</a></li>
	<li><a href="./../../../2014/07/index.html">July 2014</a></li>
	<li><a href="./../../../2014/06/index.html">June 2014</a></li>
	<li><a href="./../../../2014/05/index.html">May 2014</a></li>
	<li><a href="./../../../2014/04/index.html">April 2014</a></li>
	<li><a href="./../../../2014/03/index.html">March 2014</a></li>
	<li><a href="./../../../2014/02/index.html">February 2014</a></li>
	<li><a href="./../../../2014/01/index.html">January 2014</a></li>
	<li><a href="./../../../2013/12/index.html">December 2013</a></li>
	<li><a href="./../../../2013/11/index.html">November 2013</a></li>
	<li><a href="./../../../2013/09/index.html">September 2013</a></li>
	<li><a href="./../../../2013/08/index.html">August 2013</a></li>
	<li><a href="./../../../2013/07/index.html">July 2013</a></li>
	<li><a href="./../../../2013/06/index.html">June 2013</a></li>
	<li><a href="./../../../2013/05/index.html">May 2013</a></li>
	<li><a href="./../../../2013/03/index.html">March 2013</a></li>
	<li><a href="./../../../2013/02/index.html">February 2013</a></li>
	<li><a href="./../../../2013/01/index.html">January 2013</a></li>
	<li><a href="./../../../2012/12/index.html">December 2012</a></li>
	<li><a href="./../../../2012/11/index.html">November 2012</a></li>
	<li><a href="./../../../2012/09/index.html">September 2012</a></li>
	<li><a href="./../../../2012/07/index.html">July 2012</a></li>
	<li><a href="./../../../2012/06/index.html">June 2012</a></li>
	<li><a href="./../../../2012/05/index.html">May 2012</a></li>
	<li><a href="./../../../2012/04/index.html">April 2012</a></li>
	<li><a href="./../../../2012/03/index.html">March 2012</a></li>
	<li><a href="./../../../2012/02/index.html">February 2012</a></li>
	<li><a href="./../../../2012/01/index.html">January 2012</a></li>
	<li><a href="./../../../2011/12/index.html">December 2011</a></li>
	<li><a href="./../../../2011/11/index.html">November 2011</a></li>
	<li><a href="./../../../2011/10/index.html">October 2011</a></li>
	<li><a href="./../../../2011/09/index.html">September 2011</a></li>
	<li><a href="./../../../2011/07/index.html">July 2011</a></li>
	<li><a href="./../../../2011/06/index.html">June 2011</a></li>
	<li><a href="./../../../2011/05/index.html">May 2011</a></li>
	<li><a href="./../../../2011/04/index.html">April 2011</a></li>
	<li><a href="./../../../2011/03/index.html">March 2011</a></li>
	<li><a href="./../../../2011/02/index.html">February 2011</a></li>
	<li><a href="./../../../2011/01/index.html">January 2011</a></li>
	<li><a href="./../../../2010/12/index.html">December 2010</a></li>
	<li><a href="./../../../2010/11/index.html">November 2010</a></li>
	<li><a href="./../../../2010/10/index.html">October 2010</a></li>
	<li><a href="./../../../2010/09/index.html">September 2010</a></li>
	<li><a href="./../../../2010/08/index.html">August 2010</a></li>
	<li><a href="./../../../2010/07/index.html">July 2010</a></li>
	<li><a href="./../../../2010/06/index.html">June 2010</a></li>
	<li><a href="./../../../2010/05/index.html">May 2010</a></li>
	<li><a href="./../../../2010/04/index.html">April 2010</a></li>
	<li><a href="./../../../2010/03/index.html">March 2010</a></li>
	<li><a href="./../../../2010/02/index.html">February 2010</a></li>
	<li><a href="./../../../2010/01/index.html">January 2010</a></li>
	<li><a href="./../../../2009/12/index.html">December 2009</a></li>
	<li><a href="./../../../2009/11/index.html">November 2009</a></li>
	<li><a href="./../../../2009/10/index.html">October 2009</a></li>
	<li><a href="./../../../2009/09/index.html">September 2009</a></li>
	<li><a href="./../../../2009/08/index.html">August 2009</a></li>
	<li><a href="./../../../2009/07/index.html">July 2009</a></li>
	<li><a href="./../../../2009/06/index.html">June 2009</a></li>
	<li><a href="./../../../2009/05/index.html">May 2009</a></li>
	<li><a href="./../../../2009/04/index.html">April 2009</a></li>
			</ul>

			</li>
	
	</ul>
</div>	</div>
	
	</div>
	<div id="footer">
		<div id="foot">
			Supported by <a href="http://www.thievesgarden.co.uk/" title="Maidenhead Accommodation - self catering apartment to rent" target="Thieves Garden">Thieves Garden - Maidenhead self catering apartment</a> and <a href="http://www.oleronvilla.com/" title="Ile d'Oleron Holiday Home to rent" target="Oleron Villa">Oleron Villa holiday home on Ile d'Oleron</a>.			<div class="credit_link">	<a href="http://themezee.com/">Theme by ThemeZee</a>
</div>
			<div class="clear"></div>
		</div>
	</div>
</div>
	<!-- Powered by WPtouch: 4.3.39 -->
</body>
</html>