<!DOCTYPE html>
<!-- HTML 5 --><html lang="en-US">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<link rel="pingback" href="./../../../xmlrpc.php">
	
	<title>mongodb | Andrew Morgan on Databases | Page 5</title>

<meta name="robots" content="max-image-preview:large">
	<style>img:is([sizes="auto" i], [sizes^="auto," i]) { contain-intrinsic-size: 3000px 1500px }</style>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="alternate" type="application/rss+xml" title="Andrew Morgan on Databases &raquo; Feed" href="./../../../feed/index.html">
<link rel="alternate" type="application/rss+xml" title="Andrew Morgan on Databases &raquo; Comments Feed" href="./../../../comments/feed/index.html">
<link rel="alternate" type="application/rss+xml" title="Andrew Morgan on Databases &raquo; mongodb Tag Feed" href="./../feed/index.html">
		<!-- This site uses the Google Analytics by MonsterInsights plugin v9.2.2 - Using Analytics tracking - https://www.monsterinsights.com/ -->
		<!-- Note: MonsterInsights is not currently configured on this site. The site owner needs to authenticate with Google Analytics in the MonsterInsights settings panel. -->
					<!-- No tracking code set -->
				<!-- / Google Analytics by MonsterInsights -->
		<script type="text/javascript">
/* <![CDATA[ */
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/www.clusterdb.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=81fb77f64976ac32efe42aab69fdb5e4"}};
/*! This file is auto-generated */
!function(i,n){var o,s,e;function c(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function p(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data),r=(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0),new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data));return t.every(function(e,t){return e===r[t]})}function u(e,t,n){switch(t){case"flag":return n(e,"🏳️‍⚧️","🏳️​⚧️")?!1:!n(e,"🇺🇳","🇺​🇳")&&!n(e,"🏴󠁧󠁢󠁥󠁮󠁧󠁿","🏴​󠁧​󠁢​󠁥​󠁮​󠁧​󠁿");case"emoji":return!n(e,"🐦‍⬛","🐦​⬛")}return!1}function f(e,t,n){var r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):i.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0}),o=(a.textBaseline="top",a.font="600 32px Arial",{});return e.forEach(function(e){o[e]=t(a,e,n)}),o}function t(e){var t=i.createElement("script");t.src=e,t.defer=!0,i.head.appendChild(t)}"undefined"!=typeof Promise&&(o="wpEmojiSettingsSupports",s=["flag","emoji"],n.supports={everything:!0,everythingExceptFlag:!0},e=new Promise(function(e){i.addEventListener("DOMContentLoaded",e,{once:!0})}),new Promise(function(t){var n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),p.toString()].join(",")+"));",r=new Blob([e],{type:"text/javascript"}),a=new Worker(URL.createObjectURL(r),{name:"wpTestEmojiSupports"});return void(a.onmessage=function(e){c(n=e.data),a.terminate(),t(n)})}catch(e){}c(n=f(s,u,p))}t(n)}).then(function(e){for(var t in e)n.supports[t]=e[t],n.supports.everything=n.supports.everything&&n.supports[t],"flag"!==t&&(n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&n.supports[t]);n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&!n.supports.flag,n.DOMReady=!1,n.readyCallback=function(){n.DOMReady=!0}}).then(function(){return e}).then(function(){var e;n.supports.everything||(n.readyCallback(),(e=n.source||{}).concatemoji?t(e.concatemoji):e.wpemoji&&e.twemoji&&(t(e.twemoji),t(e.wpemoji)))}))}((window,document),window._wpemojiSettings);
/* ]]> */
</script>
<style id="wp-emoji-styles-inline-css" type="text/css">img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}</style>
<link rel="stylesheet" id="wp-block-library-css" href="./../../../wp-includes/css/dist/block-library/style.min.css?ver=81fb77f64976ac32efe42aab69fdb5e4" type="text/css" media="all">
<style id="classic-theme-styles-inline-css" type="text/css">/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}</style>
<style id="global-styles-inline-css" type="text/css">:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
:root :where(.wp-block-pullquote){font-size: 1.5em;line-height: 1.6;}</style>
<link rel="stylesheet" id="plyr-css-css" href="./../../../wp-content/plugins/easy-video-player/lib/plyr.css?ver=81fb77f64976ac32efe42aab69fdb5e4" type="text/css" media="all">
<link rel="stylesheet" id="zeeSynergie_stylesheet-css" href="./../../../wp-content/themes/zeesynergie/style.css?ver=81fb77f64976ac32efe42aab69fdb5e4" type="text/css" media="all">
<link rel="stylesheet" id="zeeSynergie_colorscheme-css" href="./../../../wp-content/themes/zeesynergie/includes/css/colorschemes/blue.css?ver=81fb77f64976ac32efe42aab69fdb5e4" type="text/css" media="all">
<link rel="stylesheet" id="themezee_default_font-css" href="http://fonts.googleapis.com/css?family=Paytone+One&#038;ver=81fb77f64976ac32efe42aab69fdb5e4" type="text/css" media="all">
<script type="text/javascript" src="./../../../wp-content/plugins/easy-video-player/lib/plyr.min.js?ver=81fb77f64976ac32efe42aab69fdb5e4" id="plyr-js-js"></script>
<script type="text/javascript" src="./../../../wp-includes/js/jquery/jquery.min.js?ver=3.7.1" id="jquery-core-js"></script>
<script type="text/javascript" src="./../../../wp-includes/js/jquery/jquery-migrate.min.js?ver=3.4.1" id="jquery-migrate-js"></script>
<script type="text/javascript" src="./../../../wp-content/themes/zeesynergie/includes/js/jquery.cycle.all.min.js?ver=81fb77f64976ac32efe42aab69fdb5e4" id="zee_jquery-cycle-js"></script>
<link rel="https://api.w.org/" href="./../../../wp-json/index.html">
<link rel="alternate" title="JSON" type="application/json" href="./../../../wp-json/wp/v2/tags/150/index.html">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="./../../../xmlrpc.php?rsd">

<style data-context="foundation-flickity-css">/*! Flickity v2.0.2
http://flickity.metafizzy.co
---------------------------------------------- */.flickity-enabled{position:relative}.flickity-enabled:focus{outline:0}.flickity-viewport{overflow:hidden;position:relative;height:100%}.flickity-slider{position:absolute;width:100%;height:100%}.flickity-enabled.is-draggable{-webkit-tap-highlight-color:transparent;tap-highlight-color:transparent;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.flickity-enabled.is-draggable .flickity-viewport{cursor:move;cursor:-webkit-grab;cursor:grab}.flickity-enabled.is-draggable .flickity-viewport.is-pointer-down{cursor:-webkit-grabbing;cursor:grabbing}.flickity-prev-next-button{position:absolute;top:50%;width:44px;height:44px;border:none;border-radius:50%;background:#fff;background:hsla(0,0%,100%,.75);cursor:pointer;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.flickity-prev-next-button:hover{background:#fff}.flickity-prev-next-button:focus{outline:0;box-shadow:0 0 0 5px #09f}.flickity-prev-next-button:active{opacity:.6}.flickity-prev-next-button.previous{left:10px}.flickity-prev-next-button.next{right:10px}.flickity-rtl .flickity-prev-next-button.previous{left:auto;right:10px}.flickity-rtl .flickity-prev-next-button.next{right:auto;left:10px}.flickity-prev-next-button:disabled{opacity:.3;cursor:auto}.flickity-prev-next-button svg{position:absolute;left:20%;top:20%;width:60%;height:60%}.flickity-prev-next-button .arrow{fill:#333}.flickity-page-dots{position:absolute;width:100%;bottom:-25px;padding:0;margin:0;list-style:none;text-align:center;line-height:1}.flickity-rtl .flickity-page-dots{direction:rtl}.flickity-page-dots .dot{display:inline-block;width:10px;height:10px;margin:0 8px;background:#333;border-radius:50%;opacity:.25;cursor:pointer}.flickity-page-dots .dot.is-selected{opacity:1}</style>
<style data-context="foundation-slideout-css">.slideout-menu{position:fixed;left:0;top:0;bottom:0;right:auto;z-index:0;width:256px;overflow-y:auto;-webkit-overflow-scrolling:touch;display:none}.slideout-menu.pushit-right{left:auto;right:0}.slideout-panel{position:relative;z-index:1;will-change:transform}.slideout-open,.slideout-open .slideout-panel,.slideout-open body{overflow:hidden}.slideout-open .slideout-menu{display:block}.pushit{display:none}</style>
<script type="text/javascript">
				//<![CDATA[
					jQuery(document).ready(function($) {
						$('#nav ul').css({display: 'none'}); // Opera Fix
						$('#nav li').hover(function(){
							$(this).find('ul:first').css({visibility: 'visible',display: 'none'}).show().css({opacity:0}).animate({opacity:1},400);
						},function(){
							$(this).find('ul:first').css({visibility: 'hidden'});
						});
					});
				//]]>
				</script><style type="text/css"></style>
<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
<style type="text/css" id="custom-background-css">body.custom-background { background-color: #89a5bf; }</style>
	<style>.ios7.web-app-mode.has-fixed header{ background-color: rgba(3,122,221,.88);}</style>
</head>

<body class="archive paged tag tag-mongodb tag-150 custom-background paged-5 tag-paged-5">
<div id="wrapper">

	<div id="header">

		<div id="head">
			<div id="logo">
									<a href="./../../../index.html"><h1>Andrew Morgan on Databases</h1></a>
                                        <!-- <a href=".//"><h1>MySQL Cluster, Replication, Fabric...</h1></a>  ZXZX -->					
							</div>
			<div id="socialmedia_icons">
				<a href="http://twitter.com/andrewmorgan"><img src="./../../../wp-content/themes/zeesynergie/images/icons/twitter.png" alt="twitter"></a><a href="http://www.facebook.com/andrewjamesmorgan"><img src="./../../../wp-content/themes/zeesynergie/images/icons/facebook.png" alt="facebook"></a><a href="https://plus.google.com/u/0/100605473697871424413/posts"><img src="./../../../wp-content/themes/zeesynergie/images/icons/googleplus.png" alt="googleplus"></a><a href="http://www.linkedin.com/profile/view?id=16709956"><img src="./../../../wp-content/themes/zeesynergie/images/icons/linkedin.png" alt="linkedin"></a><a href="http://www.flickr.com/photos/andrewjamesmorgan/"><img src="./../../../wp-content/themes/zeesynergie/images/icons/flickr.png" alt="flickr"></a><a href="http://www.youtube.com/channel/UCodtDakJ4VdeSCzS3P3rIsw"><img src="./../../../wp-content/themes/zeesynergie/images/icons/youtube.png" alt="youtube"></a>				<div class="clear"></div>
			</div>
			<div class="clear"></div>
		</div>
		
		<div id="navi_container">
			<div id="navi">
				<ul id="nav" class="menu">
<li class="page_item page-item-1011"><a href="./../../../about/index.html">About</a></li>
</ul>			</div>
		</div>
		<div class="clear"></div>
	</div>
	
	<div id="container">
	
			<div id="custom_header">
			<img src="./../../../wp-content/uploads/2015/06/cropped-ClusterDB-logo-header.png">
		</div>
	
	<div id="wrap">
		<div id="content">
		
		<h2 class="arh">Tag Archive for mongodb</h2>
				
					<div id="post-4248" class="post-4248 post type-post status-publish format-standard hentry category-mongodb tag-frameworks tag-mongodb tag-mongodb-atlas">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../../../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../../../mongodb/using-mongodb-atlas-from-your-favorite-language-or-framework/index.html">September 16, 2016</a>
			</div>
	<div class="postcomments">
		<a href="./../../../mongodb/using-mongodb-atlas-from-your-favorite-language-or-framework/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../../../mongodb/using-mongodb-atlas-from-your-favorite-language-or-framework/index.html" rel="bookmark">Using MongoDB Atlas From Your Favorite Language or Framework</a></h2>
				
				<div class="entry">
										<p>Developers love working with MongoDB. One reason is the flexible data model, another is that there&#8217;s an idiomatic driver for just about every programming language and someone&#8217;s probably already built a framework on top of MongoDB that takes care of a lot of the grunt work. With high availability and scaling built in, they can also be confident that MongoDB will continue to meet their needs as their business grows.</p>
<p><a href="https://www.mongodb.com/cloud">MongoDB Atlas</a> provides all of the features of MongoDB, without the operational heavy lifting required for any new application. MongoDB Atlas is available on demand through a pay-as-you-go model and billed on an hourly basis, letting you focus on what you do best.</p>
<p>It’s easy to get started – use a simple GUI to select the instance size, region, and features you need (Figure 1).</p>
<div id="attachment_4249" style="width: 970px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Create_MongoDB_Atlas_Cluster.gif"><img fetchpriority="high" decoding="async" aria-describedby="caption-attachment-4249" src="./../../../wp-content/uploads/2016/09/Create_MongoDB_Atlas_Cluster.gif" alt="Create MongoDB Atlas Cluster" width="960" height="540" class="size-full wp-image-4249"></a><p id="caption-attachment-4249" class="wp-caption-text">Figure 1: Create MongoDB Atlas Cluster</p>
</div>
<p>MongoDB Atlas provides:</p>
<ul>
<li>Security features to protect access to your data</li>
<li>Built in replication for always-on availability, tolerating complete data center failure</li>
<li>Backups and point in time recovery to protect against data corruption</li>
<li>Fine-grained monitoring to let you know when to scale. Additional instances can be provisioned with the push of a button</li>
<li>Automated patching and one-click upgrades for new major versions of the database, enabling you to take advantage of the latest and greatest MongoDB features</li>
<li>A choice of cloud providers, regions, and billing options</li>
</ul>
<p>This post provides instructions on how to use MongoDB Atlas directly from your application or how to configure your favorite framework to use it. It goes on to provide links to some worked examples for specific frameworks.</p>
<h1>Worked Examples for Specific Frameworks</h1>
<p>Detailed walkthroughs are available for specific programming languages and frameworks:</p>
<ul>
<li>
<a href="https://www.mongodb.com/blog/post/using-pencilblue-with-mongodb-atlas">Using PencilBlue with MongoDB Atlas</a> (JavaScript, Node.js)</li>
<li>
<a href="https://www.mongodb.com/blog/post/develop-and-deploy-a-nodejs-app-to-aws-elastic-beanstalk-and-mongodb-atlas">Develop &amp; Deploy a Node.js App to AWS Elastic Beanstalk &amp; MongoDB Atlas</a> (JavaScript, Node.js, Express, AWS Elastic Beanstalk)</li>
<li>
<a href="https://www.mongodb.com/blog/post/processing-data-streams-with-amazon-kinesis-and-mongodb-atlas">Processing Data Streams with Amazon Kinesis and MongoDB Atlas</a> (Amazon Kinesis, JavaScript, Node.js)</li>
<li>
<a href="https://www.mongodb.com/blog/post/mongodb-atlas-as-the-data-store-for-apostrophe">MongoDB Atlas as The Data Store for Apostrophe</a> (JavaScript, Node.js)</li>
<li>
<a href="https://www.mongodb.com/blog/post/configuring-keystonejs-to-use-mongodb-atlas">Configuring KeystoneJS to Use MongoDB Atlas</a> (JavaSript, Express, Node.js)</li>
<li>
<a href="https://www.mongodb.com/blog/post/getting-started-with-python-pymodm-and-mongodb-atlas">Getting Started with Python, PyMODM, and MongoDB Atlas</a> (Python, PyMODM)</li>
<li>
<a href="https://www.okgrow.com/posts/mongodb-atlas-setup">MongoDB Atlas with Meteor: A Step-By-Step Guide</a> <strong>External site</strong> (Meteor, JavaScript, Angular, React</li>
</ul>
<p>This list will be extended as new blog posts are produced. If your preferred language or framework isn&#8217;t listed above then read on as the following, generic instructions cover most other cases.</p>
<h1>Preparing MongoDB Atlas For Your Application</h1>
<p>Launch your MongoDB cluster using <a href="https://www.mongodb.com/cloud">MongoDB Atlas</a> and then (optionally) create a user with read and write privileges for just the database that will be used for your application, as shown in Figure 2.</p>
<div id="attachment_4250" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Create_Application_User_in_MongoDB_Atlas.png"><img decoding="async" aria-describedby="caption-attachment-4250" src="./../../../wp-content/uploads/2016/09/Create_Application_User_in_MongoDB_Atlas-1024x979.png" alt="Creating an Application user in MongoDB Atlas" width="480" height="459" class="size-large wp-image-4250" srcset="./../../../wp-content/uploads/2016/09/Create_Application_User_in_MongoDB_Atlas-1024x979.png 1024w, ./../../../wp-content/uploads/2016/09/Create_Application_User_in_MongoDB_Atlas-300x287.png 300w, ./../../../wp-content/uploads/2016/09/Create_Application_User_in_MongoDB_Atlas-768x734.png 768w" sizes="(max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4250" class="wp-caption-text">Figure 2: Creating an Application user in MongoDB Atlas</p>
</div>
<p>You must also add the IP address of your application server to the IP Whitelist in the MongoDB Atlas security tab (Figure 3). Note that if multiple application servers will be accessing MongoDB Atlas then an IP address range can be specified in CIDR format (IP Address/number of significant bits).</p>
<div id="attachment_4252" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Add_IP_Address_Range_to_MongoDB_Atlas.png"><img decoding="async" aria-describedby="caption-attachment-4252" src="./../../../wp-content/uploads/2016/09/Add_IP_Address_Range_to_MongoDB_Atlas-1024x510.png" alt="Add App Server IP Address(es) to MongoDB Atlas" width="480" height="239" class="size-large wp-image-4252" srcset="./../../../wp-content/uploads/2016/09/Add_IP_Address_Range_to_MongoDB_Atlas-1024x510.png 1024w, ./../../../wp-content/uploads/2016/09/Add_IP_Address_Range_to_MongoDB_Atlas-300x149.png 300w, ./../../../wp-content/uploads/2016/09/Add_IP_Address_Range_to_MongoDB_Atlas-768x382.png 768w, ./../../../wp-content/uploads/2016/09/Add_IP_Address_Range_to_MongoDB_Atlas.png 1760w" sizes="(max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4252" class="wp-caption-text">Figure 3: Add App Server IP Address(es) to MongoDB Atlas</p>
</div>
<h1>Connecting Your Application (Framework) to MongoDB Atlas</h1>
<p>The exact way that you specify how to connect to MongoDB Atlas will vary depending on your programming language and (optionally) the framework you&#8217;re using. However it&#8217;s pretty universal that you&#8217;ll need to provide a connection string/URI. The core of this URI can be retrieved by clicking on the <em>CONNECT</em> button for your cluster in the MongoDB Atlas GUI, selecting the <em>MongoDB Drivers</em> tab and then copying the string (Figure 4).</p>
<div id="attachment_4253" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/MongoDB_Atlas_URI.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4253" src="./../../../wp-content/uploads/2016/09/MongoDB_Atlas_URI-1024x399.png" alt="Copy MongoDB Atlas Connection String/URI" width="480" height="187" class="size-large wp-image-4253" srcset="./../../../wp-content/uploads/2016/09/MongoDB_Atlas_URI-1024x399.png 1024w, ./../../../wp-content/uploads/2016/09/MongoDB_Atlas_URI-300x117.png 300w, ./../../../wp-content/uploads/2016/09/MongoDB_Atlas_URI-768x299.png 768w, ./../../../wp-content/uploads/2016/09/MongoDB_Atlas_URI.png 1380w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4253" class="wp-caption-text">Figure 4: Copy MongoDB Atlas Connection String/URI</p>
</div>
<p>Note that this URI contains the administrator username for your MongoDB Atlas group and will connect to the <em>admin</em> database – you&#8217;ll probably want to change that.</p>
<p>Your final URI should look something like this:</p>
<pre><code>mongodb://appuser:my_password@cluster0-shard-00-00-qfovx.mongodb.net:27017,cluster0-shard-00-01-qfovx.mongodb.net:27017,cluster0-shard-00-02-qfovx.mongodb.net:27017/appdatabase?ssl=true&amp;authSource=admin'
</code></pre>
<p>The URI contains these components:</p>
<ul>
<li>
<strong>appuser</strong> is the name of the user you created in the MongoDB Atlas UI.</li>
<li>
<strong>my_password</strong> is the password you chose when creating the user in MongoDB Atlas.</li>
<li>
<strong>cluster0-shard-00-00-qfovx.mongodb.net</strong>, <strong>cluster0-shard-00-01-qfovx.mongodb.net</strong>, &amp; <strong>cluster0-shard-00-02-qfovx.mongodb.net</strong> are the hostnames of the instances in your MongoDB Atlas replica set (click on the &#8220;CONNECT&#8221; button in the MongoDB Atlas UI if you don&#8217;t have these).</li>
<li>
<strong>27017</strong> is the standard MongoDB port number.</li>
<li>
<strong>appdatabase</strong> is the name of the database (schema) that your application or framework will use. Note that for some frameworks, this should be omitted and the database name configured separately – check the default configuration file or documentation for your framework to see if it&#8217;s possible to provide the database name outside of the URI.</li>
<li>To enforce security, MongoDB Atlas mandates that the <strong>ssl</strong> option is used.</li>
<li>
<strong>admin</strong> is the database that&#8217;s being used to store the credentials for <strong>appuser</strong>.</li>
</ul>
<h1>Check Your Application Data</h1>
<p>At this point, you should add some test data through your application and then confirm that it&#8217;s being correctly stored in MongoDB Atlas.</p>
<p><a href="https://www.mongodb.com/products/compass">MongoDB Compass</a> is the GUI for MongoDB, allowing you to visually explore your data and interact with your data with full CRUD functionality. The same credentials can be used to connect Compass to your MongoDB database (Figure 5).</p>
<div id="attachment_4254" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Connect_MongoDB_Compass_to_MongoDB_Atlas-2.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4254" src="./../../../wp-content/uploads/2016/09/Connect_MongoDB_Compass_to_MongoDB_Atlas-2-1024x794.png" alt="Connect MongoDB Compass to MongoDB Atlas" width="480" height="372" class="size-large wp-image-4254" srcset="./../../../wp-content/uploads/2016/09/Connect_MongoDB_Compass_to_MongoDB_Atlas-2-1024x794.png 1024w, ./../../../wp-content/uploads/2016/09/Connect_MongoDB_Compass_to_MongoDB_Atlas-2-300x233.png 300w, ./../../../wp-content/uploads/2016/09/Connect_MongoDB_Compass_to_MongoDB_Atlas-2-768x595.png 768w, ./../../../wp-content/uploads/2016/09/Connect_MongoDB_Compass_to_MongoDB_Atlas-2.png 1798w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4254" class="wp-caption-text">Figure 5: Connect MongoDB Compass to MongoDB Atlas</p>
</div>
<p>Once connected, explore the data added to your collections (Figure 6).</p>
<div id="attachment_4255" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Explore_MongoDB_Atlas_data_with_MongoDB_Compass-1.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4255" src="./../../../wp-content/uploads/2016/09/Explore_MongoDB_Atlas_data_with_MongoDB_Compass-1-1024x734.png" alt="Explore MongoDB Atlas Data Using MongoDB Compass" width="480" height="344" class="size-large wp-image-4255" srcset="./../../../wp-content/uploads/2016/09/Explore_MongoDB_Atlas_data_with_MongoDB_Compass-1-1024x734.png 1024w, ./../../../wp-content/uploads/2016/09/Explore_MongoDB_Atlas_data_with_MongoDB_Compass-1-300x215.png 300w, ./../../../wp-content/uploads/2016/09/Explore_MongoDB_Atlas_data_with_MongoDB_Compass-1-768x550.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4255" class="wp-caption-text">Figure 6: Explore MongoDB Atlas Data Using MongoDB Compass</p>
</div>
<p>It is also possible to add, delete, and modify documents (Figure 7).</p>
<div id="attachment_4256" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Modify_MongoDB_Atlas_document_in_MongoDB_Compass-1.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4256" src="./../../../wp-content/uploads/2016/09/Modify_MongoDB_Atlas_document_in_MongoDB_Compass-1-1024x340.png" alt="Modify a Document in MongoDB Compass" width="480" height="159" class="size-large wp-image-4256" srcset="./../../../wp-content/uploads/2016/09/Modify_MongoDB_Atlas_document_in_MongoDB_Compass-1-1024x340.png 1024w, ./../../../wp-content/uploads/2016/09/Modify_MongoDB_Atlas_document_in_MongoDB_Compass-1-300x100.png 300w, ./../../../wp-content/uploads/2016/09/Modify_MongoDB_Atlas_document_in_MongoDB_Compass-1-768x255.png 768w, ./../../../wp-content/uploads/2016/09/Modify_MongoDB_Atlas_document_in_MongoDB_Compass-1.png 2002w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4256" class="wp-caption-text">Figure 7: Modify a Document in MongoDB Compass</p>
</div>
<p>You can verify that the document has really been updated from the MongoDB shell:</p>
<pre><code class="js">Cluster0-shard-0:PRIMARY&gt; use appdatabase
Cluster0-shard-0:PRIMARY&gt; db.simples.find({
    first_name: "Stephanie", 
    last_name: "Green"}).pretty()
{
    "_id" : ObjectId("57a206be0e8ecb0d5b5549f9"),
    "first_name" : "Stephanie",
    "last_name" : "Green",
    "email" : "sgreen1b@tiny.cc",
    "gender" : "Female",
    "ip_address" : "129.173.45.61",
    "children" : [
        {
            "first_name" : "Eugene",
            "birthday" : "8/25/1985"
        },
        {
            "first_name" : "Nicole",
            "birthday" : "12/29/1963",
            "favoriteColor" : "Yellow"
        }
    ]
}
</code></pre>
<h1>Migrating Your Data to MongoDB Atlas</h1>
<p>This post has assumed that you&#8217;re building a new application but what if you already have one, with data stored in a MongoDB cluster that you&#8217;re managing yourself? Fortunately, the process to migrate your data to MongoDB Atlas (and back out again if desired) is straightforward and is described in <a href="https://www.mongodb.com/blog/post/migrating-data-to-mongodb-atlas">Migrating Data to MongoDB Atlas</a>.</p>
<p>We offer a <a href="https://www.mongodb.com/products/consulting#mongodb_atlas_migration">MongoDB Atlas Migration service</a> to help you properly configure MongoDB Atlas and develop a migration plan. This is especially helpful if you need to minimize downtime for your application, if you have a complex sharded deployment, or if you want to revise your deployment architecture as part of the migration. <a href="https://www.mongodb.com/contact/consulting/mongodb-atlas-migration">Contact us</a> to learn more about the MongoDB Atlas Migration service.</p>
<h1>Next Steps</h1>
<p>While MongoDB Atlas radically simplifies the operation of MongoDB there are still some decisions to take to ensure the best performance and reliability for your application. The <a href="https://www.mongodb.com/collateral/mongodb-atlas-best-practices">MongoDB Atlas Best Practices white paper</a> provides guidance on best practices for deploying, managing, and optimizing the performance of your database with MongoDB Atlas.</p>
<p>The guide outlines considerations for achieving performance at scale with MongoDB Atlas across a number of key dimensions, including instance size selection, application patterns, schema design and indexing, and disk I/O. While this guide is broad in scope, it is not exhaustive. Following the recommendations in the guide will provide a solid foundation for ensuring optimal application performance.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/using-mongodb-atlas-from-your-favorite-language-or-framework" data-via="wpbeginner" data-text="Using MongoDB Atlas From Your Favorite Language or Framework" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/using-mongodb-atlas-from-your-favorite-language-or-framework"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/using-mongodb-atlas-from-your-favorite-language-or-framework" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Fusing-mongodb-atlas-from-your-favorite-language-or-framework&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../../../category/mongodb/index.html" rel="category tag">MongoDB</a> | 
Tags: <a href="./../../frameworks/index.html" rel="tag">Frameworks</a>, <a href="./../../mongodb/index.html" rel="tag">mongodb</a>, <a href="./../../mongodb-atlas/index.html" rel="tag">MongoDB Atlas</a>
</div>

			</div>			<div id="post-4239" class="post-4239 post type-post status-publish format-standard hentry category-mongodb tag-cms tag-javascript tag-keystonejs tag-mongodb tag-mongodb-atlas tag-node-js">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../../../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../../../mongodb/configuring-keystonejs-to-use-mongodb-atlas/index.html">September 16, 2016</a>
			</div>
	<div class="postcomments">
		<a href="./../../../mongodb/configuring-keystonejs-to-use-mongodb-atlas/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../../../mongodb/configuring-keystonejs-to-use-mongodb-atlas/index.html" rel="bookmark">Configuring KeystoneJS to Use MongoDB Atlas</a></h2>
				
				<div class="entry">
										<p>KeystoneJS is an open source framework for building web applications and Content Management Systems. It&#8217;s built on top of MongoDB, Express, and Node.js &#8211; key components of the ubiquitous MEAN stack.</p>
<p>This post explains why MongoDB Atlas is an ideal choice for KeystoneJS and then goes on to show how to configure KeystoneJS to use it.</p>
<h1>Why are KeystoneJS and MongoDB Atlas a Good Match</h1>
<p>The MEAN stack is extremely popular and well supported and it&#8217;s the go to platform when developing modern applications. For its part, MongoDB brings flexible schemas, rich queries, an idiomatic Node.js driver, and simple to use high availability and scaling.</p>
<p><a href="https://www.mongodb.com/cloud">MongoDB Atlas</a> provides all of the features of MongoDB, without the operational heavy lifting required for any new application. MongoDB Atlas is available on demand through a pay-as-you-go model and billed on an hourly basis, letting you focus on what you do best.</p>
<p>It’s easy to get started – use a simple GUI to select the instance size, region, and features you need. MongoDB Atlas provides:</p>
<ul>
<li>Security features to protect access to your data</li>
<li>Built in replication for always-on availability, tolerating complete data center failure</li>
<li>Backups and point in time recovery to protect against data corruption</li>
<li>Fine-grained monitoring to let you know when to scale. Additional instances can be provisioned with the push of a button</li>
<li>Automated patching and one-click upgrades for new major versions of the database, enabling you to take advantage of the latest and greatest MongoDB features</li>
<li>A choice of cloud providers, regions, and billing options</li>
</ul>
<p>Like KeystoneJS, MongoDB Atlas is a natural fit for users looking to simplify their development and operations work, letting them focus on what makes their application unique rather than commodity (albeit essential) plumbing.</p>
<h1>Installing KeystoneJS and Configuring it to Use MongoDB Atlas</h1>
<p>Before starting with KeystoneJS, you should launch your MongoDB cluster using <a href="https://www.mongodb.com/cloud">MongoDB Atlas</a> and then (optionally) create a user with read and write privileges for just the database that will be used for this project, as shown in Figure 1. You must also add the IP address of your application server to the IP Whitelist in the MongoDB Atlas security tab.</p>
<div id="attachment_4240" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Add_KeystoneJS_user.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4240" src="./../../../wp-content/uploads/2016/09/Add_KeystoneJS_user-1024x891.png" alt="Creating KeystoneJS user in MongoDB Atlas" width="480" height="418" class="size-large wp-image-4240" srcset="./../../../wp-content/uploads/2016/09/Add_KeystoneJS_user-1024x891.png 1024w, ./../../../wp-content/uploads/2016/09/Add_KeystoneJS_user-300x261.png 300w, ./../../../wp-content/uploads/2016/09/Add_KeystoneJS_user-768x668.png 768w, ./../../../wp-content/uploads/2016/09/Add_KeystoneJS_user.png 2010w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4240" class="wp-caption-text">Figure 1: Creating KeystoneJS user in MongoDB Atlas</p>
</div>
<p>If it isn&#8217;t already installed on your system, download and install Node.js:</p>
<p><script src="https://gist.github.com/am-MongoDB/3bbb946bb35fd8054e95adf92b96f103.js"></script><br>
You should then add the <code>bin</code> sub-folder to your <code>.bash_profile</code> file and then install KeystoneJS:</p>
<p><script src="https://gist.github.com/am-MongoDB/ada983d4879a3439751da83044644790.js"></script></p>
<p>Before starting KeystoneJS you need to configure it with details on how to connect to your specific MongoDB Atlas cluster. This is done by updating the <code>MONGO_URI</code> value within the <code>.env</code> file:</p>
<p><script src="https://gist.github.com/am-MongoDB/2b40abeec5e34a9443a26012507417d6.js"></script></p>
<p>The URI contains these components:</p>
<ul>
<li>
<code>keystonejs_user</code> is the name of the user you created in the MongoDB Atlas UI</li>
<li>
<code>my_password</code> is the password you chose when creating the user in MongoDB Atlas</li>
<li>
<code>cluster0-shard-00-00-qfovx.mongodb.net</code>, <code>cluster0-shard-00-01-qfovx.mongodb.net</code>, &amp; <code>cluster0-shard-00-02-qfovx.mongodb.net</code> are the hostnames of the instances in your MongoDB Atlas replica set (click on the &#8220;CONNECT&#8221; button in the MongoDB Atlas UI if you don&#8217;t have these)</li>
<li>
<code>27017</code> is the standard MongoDB port number</li>
<li>
<code>clusterdb</code> is the name of the database (schema) that KeystoneJS will use (note that this must match the project name used when installing KeystoneJS as well as the database you granted the user access to)</li>
<li>To enforce security, MongoDB Atlas mandates that the <code>ssl</code> option is used</li>
<li>
<code>admin</code> is the database that&#8217;s being used to store the credentials for <code>keystonejs_user</code>
</li>
</ul>
<p>Clients connect to KeystoneJS through port 3000 and so you must open that port in your firewall.</p>
<p>You can then start KeystoneJS:</p>
<pre><code>$ node keystone
</code></pre>
<p><script src="https://gist.github.com/am-MongoDB/7e0305ec2a8acf6a9891a44da048987a.js"></script></p>
<h1>Testing the Configuration</h1>
<p>Browse to the application at <code>http://address-of-app-server:3000</code> as shown in Figure 2.</p>
<div id="attachment_4241" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/KeystoneJS.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4241" src="./../../../wp-content/uploads/2016/09/KeystoneJS-1024x648.png" alt="KeystoneJS Running on MongoDB Atlas" width="480" height="304" class="size-large wp-image-4241" srcset="./../../../wp-content/uploads/2016/09/KeystoneJS-1024x648.png 1024w, ./../../../wp-content/uploads/2016/09/KeystoneJS-300x190.png 300w, ./../../../wp-content/uploads/2016/09/KeystoneJS-768x486.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4241" class="wp-caption-text">Figure 2: KeystoneJS Running on MongoDB Atlas</p>
</div>
<p>Sign in using the credentials shown and then confirm that you can upload some images to a gallery and create a new page as shown in Figure 3.</p>
<div id="attachment_4242" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/create_KeystoneJS_post_on_MongoDB_Atlas.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4242" src="./../../../wp-content/uploads/2016/09/create_KeystoneJS_post_on_MongoDB_Atlas-1024x943.png" alt="Create a Page in KeystoneJS with Data Stored in MongoDB Atlas" width="480" height="442" class="size-large wp-image-4242" srcset="./../../../wp-content/uploads/2016/09/create_KeystoneJS_post_on_MongoDB_Atlas-1024x943.png 1024w, ./../../../wp-content/uploads/2016/09/create_KeystoneJS_post_on_MongoDB_Atlas-300x276.png 300w, ./../../../wp-content/uploads/2016/09/create_KeystoneJS_post_on_MongoDB_Atlas-768x707.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4242" class="wp-caption-text">Figure 3: Create a Page in KeystoneJS with Data Stored in MongoDB Atlas</p>
</div>
<p>After saving the page, confirm that you can browse to the newly created post (Figure 4).</p>
<div id="attachment_4243" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/view_KeystoneJS_post_on_MongoDB_Atlas.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4243" src="./../../../wp-content/uploads/2016/09/view_KeystoneJS_post_on_MongoDB_Atlas-1024x905.png" alt="View KeystoneJS Post with Data Read from MongoDB Atlas" width="480" height="424" class="size-large wp-image-4243" srcset="./../../../wp-content/uploads/2016/09/view_KeystoneJS_post_on_MongoDB_Atlas-1024x905.png 1024w, ./../../../wp-content/uploads/2016/09/view_KeystoneJS_post_on_MongoDB_Atlas-300x265.png 300w, ./../../../wp-content/uploads/2016/09/view_KeystoneJS_post_on_MongoDB_Atlas-768x679.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4243" class="wp-caption-text">Figure 4: View KeystoneJS Post with Data Read from MongoDB Atlas</p>
</div>
<p>Optionally, confirm that, MongoDB Atlas really is being used by KeystoneJS, you can connect using the MongoDB shell:</p>
<p><script src="https://gist.github.com/am-MongoDB/ec422d08c7a5560f776b5638f06185d6.js"></script></p>
<p>To visually navigate through the schema and data created by KeystoneJS, <a href="https://www.mongodb.com/download-center?jmp=nav#compass">download and install MongoDB Compass</a>. The same credentials can be used to connect Compass to your MongoDB database – Figure 5.</p>
<div id="attachment_4244" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Connect_MongoDB_Compass_to_MongoDB_Atlas-1.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4244" src="./../../../wp-content/uploads/2016/09/Connect_MongoDB_Compass_to_MongoDB_Atlas-1-1024x794.png" alt="Connect MongoDB Compass to MongoDB Atlas Database" width="480" height="372" class="size-large wp-image-4244" srcset="./../../../wp-content/uploads/2016/09/Connect_MongoDB_Compass_to_MongoDB_Atlas-1-1024x794.png 1024w, ./../../../wp-content/uploads/2016/09/Connect_MongoDB_Compass_to_MongoDB_Atlas-1-300x233.png 300w, ./../../../wp-content/uploads/2016/09/Connect_MongoDB_Compass_to_MongoDB_Atlas-1-768x595.png 768w, ./../../../wp-content/uploads/2016/09/Connect_MongoDB_Compass_to_MongoDB_Atlas-1.png 1798w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4244" class="wp-caption-text">Figure 5: Connect MongoDB Compass to MongoDB Atlas Database</p>
</div>
<p>Navigate through the structure of the data in the <code>clusterdb</code> database (Figure 6) and view the JSON documents (Figure 7).</p>
<div id="attachment_4245" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Compass_KeystoneJS_Schema.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4245" src="./../../../wp-content/uploads/2016/09/Compass_KeystoneJS_Schema-1024x712.png" alt="Explore KeystoneJS Schema Using MongoDB Compass" width="480" height="334" class="size-large wp-image-4245" srcset="./../../../wp-content/uploads/2016/09/Compass_KeystoneJS_Schema-1024x712.png 1024w, ./../../../wp-content/uploads/2016/09/Compass_KeystoneJS_Schema-300x209.png 300w, ./../../../wp-content/uploads/2016/09/Compass_KeystoneJS_Schema-768x534.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4245" class="wp-caption-text">Figure 6: Explore KeystoneJS Schema Using MongoDB Compass</p>
</div>
<div id="attachment_4246" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Compass_KeystoneJS_Data.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4246" src="./../../../wp-content/uploads/2016/09/Compass_KeystoneJS_Data-1024x435.png" alt="View Documents Stored by KeystoneJS Using MongoDB Atlas" width="480" height="204" class="size-large wp-image-4246" srcset="./../../../wp-content/uploads/2016/09/Compass_KeystoneJS_Data-1024x435.png 1024w, ./../../../wp-content/uploads/2016/09/Compass_KeystoneJS_Data-300x128.png 300w, ./../../../wp-content/uploads/2016/09/Compass_KeystoneJS_Data-768x327.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4246" class="wp-caption-text">Figure 7: View Documents Stored by KeystoneJS Using MongoDB Atlas</p>
</div>
<h1>Next Steps</h1>
<p>While MongoDB Atlas radically simplifies the operation of MongoDB there are still some decisions to take to ensure the best performance and reliability for your application. The <a href="https://www.mongodb.com/collateral/mongodb-atlas-best-practices">MongoDB Atlas Best Practices white paper</a> provides guidance on best practices for deploying, managing, and optimizing the performance of your database with MongoDB Atlas.</p>
<p>The guide outlines considerations for achieving performance at scale with MongoDB Atlas across a number of key dimensions, including instance size selection, application patterns, schema design and indexing, and disk I/O. While this guide is broad in scope, it is not exhaustive. Following the recommendations in the guide will provide a solid foundation for ensuring optimal application performance.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/configuring-keystonejs-to-use-mongodb-atlas" data-via="wpbeginner" data-text="Configuring KeystoneJS to Use MongoDB Atlas" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/configuring-keystonejs-to-use-mongodb-atlas"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/configuring-keystonejs-to-use-mongodb-atlas" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Fconfiguring-keystonejs-to-use-mongodb-atlas&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../../../category/mongodb/index.html" rel="category tag">MongoDB</a> | 
Tags: <a href="./../../cms/index.html" rel="tag">CMS</a>, <a href="./../../javascript/index.html" rel="tag">javascript</a>, <a href="./../../keystonejs/index.html" rel="tag">KeystoneJS</a>, <a href="./../../mongodb/index.html" rel="tag">mongodb</a>, <a href="./../../mongodb-atlas/index.html" rel="tag">MongoDB Atlas</a>, <a href="./../../node-js/index.html" rel="tag">node.js</a>
</div>

			</div>			<div id="post-4235" class="post-4235 post type-post status-publish format-standard hentry category-mongodb tag-dbaas tag-migration tag-mongodb tag-mongodb-atlas">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../../../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../../../mongodb/migrating-data-to-mongodb-atlas/index.html">September 16, 2016</a>
			</div>
	<div class="postcomments">
		<a href="./../../../mongodb/migrating-data-to-mongodb-atlas/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../../../mongodb/migrating-data-to-mongodb-atlas/index.html" rel="bookmark">Migrating Data to MongoDB Atlas</a></h2>
				
				<div class="entry">
										<p><a href="https://www.mongodb.com/atlas">MongoDB Atlas</a> was announced at this year&#8217;s MongoDB World. It&#8217;s great not just for new applications, but also your existing MongoDB databases running on other platforms. This post will focus on how you migrate your data and applications over to MongoDB Atlas.</p>
<h1>What is MongoDB Atlas?</h1>
<p>MongoDB Atlas provides all of the features of MongoDB, without the operational heavy lifting required for any new application. MongoDB Atlas is available on demand through a pay-as-you-go model and billed on an hourly basis, letting you focus on what you do best.</p>
<p>It’s easy to get started – use a simple GUI to select the instance size, region, and features you need. MongoDB Atlas provides:</p>
<ul>
<li>Security features to protect access to your data</li>
<li>Built in replication for always-on availability, tolerating complete data center failure</li>
<li>Backups and point in time recovery to protect against data corruption</li>
<li>Fine-grained monitoring to let you know when to scale. Additional instances can be provisioned with the push of a button</li>
<li>Automated patching and one-click upgrades for new major versions of the database, enabling you to take advantage of the latest and greatest MongoDB features</li>
<li>A choice of cloud providers, regions, and billing options</li>
</ul>
<p>But what if you already have application data held in your own on-prem or cloud-based MongoDB database – is it possible to safely migrate that data to MongoDB Atlas? What if your data is held in a 3rd party hosted MongoDB service such as Compose or mLab? Conversely, is it possible to build your application against MongoDB Atlas and then move the data to a MongoDB database running on another platform in the future?</p>
<p>The answer to all of those questions is &#8220;yes&#8221;. In the future you should expect this to be a highly automated process but right now it involves some manual steps – the purpose of this blog post is to describe the process.</p>
<h1>Moving Your Application Data to MongoDB Atlas</h1>
<p>The procedure is very straightforward, but if you can&#8217;t tolerate losing any of your updates then it does involve stopping application writes for a period. That means it&#8217;s vital that you prepare in advance in order to minimize the impact.</p>
<h2>Pre-Migration Checklist</h2>
<ul>
<li>How long will writes need to be stopped? Perform a dry-run of the <code>mongodump</code> &amp; <code>mongorestore</code> steps but without stopping application writes to answer this.</li>
<li>When will the stopping of writes have the smallest impact?</li>
<li>What can you change in the application to minimize the impact, e.g. provide a read-only version of the service when it isn&#8217;t possible to write to the database?</li>
<li>Will you warn users of planned maintenance ahead of time?</li>
<li>Do you have sufficient storage space to store the dumped data on the machine where you plan to run <code>mongodump</code>?</li>
<li>Once the data has been migrated to MongoDB Atlas, the application will need to switch its database connections to the new address; identify how this will be done.</li>
<li>List the IP Addresses of all the machines that will need to connect to MongoDB Atlas – this includes your application nodes as well as the machine where <code>mongorestore</code> will be run. These will need to be added to your MongoDB Atlas group&#8217;s whitelist.</li>
<li>Decide on what MongoDB Atlas instance size to use and, if necessary how many shards will be needed.</li>
<li>Decide on which region to use, e.g. co locating the MongoDB Atlas instances with your cloud-based application servers.</li>
</ul>
<h2>Execute the Migration</h2>
<ul>
<li>Create the <a href="https://www.mongodb.com/cloud">MongoDB Atlas cluster</a>.</li>
<li>Add the required IP Addresses to the whitelist in your group&#8217;s security tab.</li>
<li>Stop database writes to your existing database; either in your application logic or by blocking them for each of your databases (schemas) in the original MongoDB deployment:</li>
</ul>
<pre><code>laptop&gt; mongo --host=ec2-52-208-185-213.eu-west-1.compute.amazonaws.com \
    --eval "db.fsyncLock()"
</code></pre>
<ul>
<li>Back up the data from the existing database (writes the data to a directory named <code>dump</code>):</li>
</ul>
<pre><code>laptop&gt; mongodump --host=ec2-52-208-185-213.eu-west-1.compute.amazonaws.com \
    --port=27017
</code></pre>
<ul>
<li>Write the data to MongoDB Atlas (using the connection information provided in the Web UI):</li>
</ul>
<pre><code>mongorestore --ssl --host cluster0-shard-00-00-qfovx.mongodb.net \
    --port 27017 -u billy -p XXX dump
</code></pre>
<ul>
<li>Switch the application&#8217;s database connections over to your MongoDB Atlas instance.</li>
</ul>
<p>Want more help?  We offer a <a href="https://www.mongodb.com/products/consulting#mongodb_atlas_migration">MongoDB Atlas Migration service</a> to help you properly configure MongoDB Atlas and develop a migration plan. This is especially helpful if you need to minimize downtime for your application, if you have a complex sharded deployment, or if you want to revise your deployment architecture as part of the migration. <a href="https://www.mongodb.com/contact/consulting/mongodb-atlas-migration">Contact us</a> to learn more about the MongoDB Atlas Migration service.</p>
<h1>Moving Your Application Data Out of MongoDB Atlas</h1>
<p>To migrate data out, you can download a MongoDB Atlas backup and then copy the contents to the receiving MongoDB cluster; the <a href="https://docs.cloudmanager.mongodb.com/tutorial/restore-replica-set/#restore-the-primary">documentation describes how to load the data into the receiving replica set</a>. The backup can be either a periodic snapshot or a point-in-time view of the MongoDB Atlas database. If you can&#8217;t tolerate lost writes, they must be stopped by the application (<code>fsyncLock</code> is not available in MongoDB Atlas).</p>
<h1>Getting the Best Out of MongoDB Atlas</h1>
<p>While MongoDB Atlas radically simplifies the operation of MongoDB there are still some decisions to take to ensure the best performance and reliability for your application. The <a href="https://www.mongodb.com/collateral/mongodb-atlas-best-practices">MongoDB Atlas Best Practices white paper</a> provides guidance on best practices for deploying, managing, and optimizing the performance of your database with MongoDB Atlas.</p>
<p>The guide outlines considerations for achieving performance at scale with MongoDB Atlas across a number of key dimensions, including instance size selection, application patterns, schema design and indexing, and disk I/O. While this guide is broad in scope, it is not exhaustive. Following the recommendations in the guide will provide a solid foundation for ensuring optimal application performance.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/migrating-data-to-mongodb-atlas" data-via="wpbeginner" data-text="Migrating Data to MongoDB Atlas" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/migrating-data-to-mongodb-atlas"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/migrating-data-to-mongodb-atlas" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Fmigrating-data-to-mongodb-atlas&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../../../category/mongodb/index.html" rel="category tag">MongoDB</a> | 
Tags: <a href="./../../dbaas/index.html" rel="tag">DBaaS</a>, <a href="./../../migration/index.html" rel="tag">Migration</a>, <a href="./../../mongodb/index.html" rel="tag">mongodb</a>, <a href="./../../mongodb-atlas/index.html" rel="tag">MongoDB Atlas</a>
</div>

			</div>			<div id="post-4230" class="post-4230 post type-post status-publish format-standard hentry category-mongodb tag-apache-kafka tag-data-streaming tag-kafka tag-mongodb">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../../../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../../../mongodb/mongodb-data-streaming-implementing-a-mongodb-kafka-consumer/index.html">September 16, 2016</a>
			</div>
	<div class="postcomments">
		<a href="./../../../mongodb/mongodb-data-streaming-implementing-a-mongodb-kafka-consumer/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../../../mongodb/mongodb-data-streaming-implementing-a-mongodb-kafka-consumer/index.html" rel="bookmark">MongoDB &#038; Data Streaming – Implementing a MongoDB Kafka Consumer</a></h2>
				
				<div class="entry">
										<h1>Data Streaming</h1>
<p>In today&#8217;s data landscape, no single system can provide all of the required perspectives to deliver real insight. Deriving the full meaning from data requires mixing huge volumes of information from many sources.</p>
<p>At the same time, we&#8217;re impatient to get answers instantly; if the time to insight exceeds 10s of milliseconds then the value is lost – applications such as high frequency trading, fraud detection, and recommendation engines can&#8217;t afford to wait. This often means analyzing the inflow of data before it even makes it to the database of record. Add in zero tolerance for data loss and the challenge gets even more daunting.</p>
<p>Kafka and data streams are focused on ingesting the massive flow of data from multiple fire-hoses and then routing it to the systems that need it – filtering, aggregating, and analyzing en-route.</p>
<p>This blog introduces Apache Kafka and then illustrates how to use MongoDB as a source (producer) and destination (consumer) for the streamed data. A more complete study of this topic can be found in the <a href="https://www.mongodb.com/collateral/data-streaming-with-apache-kafka-and-mongodb" title="Data Streaming with Kafka &amp; MongoDB">Data Streaming with Kafka &amp; MongoDB</a> white paper.</p>
<h1>Apache Kafka</h1>
<p>Kafka provides a flexible, scalable, and reliable method to communicate streams of event data from one or more <strong>producers</strong> to one or more <strong>consumers</strong>. Examples of <strong>events</strong> include:</p>
<ul>
<li>A periodic sensor reading such as the current temperature</li>
<li>A user adding an item to the shopping cart in an online store</li>
<li>A Tweet being sent with a specific hashtag</li>
</ul>
<p>Streams of Kafka events are organized into <strong>topics</strong>. A producer chooses a topic to send a given event to, and consumers select which topics they pull events from. For example, a financial application could pull NYSE stock trades from one topic, and company financial announcements from another in order to look for trading opportunities.</p>
<p>In Kafka, topics are further divided into <strong>partitions</strong> to support scale out. Each Kafka node (<strong>broker</strong>) is responsible for receiving, storing, and passing on all of the events from one or more partitions for a given topic. In this way, the processing and storage for a topic can be linearly scaled across many brokers. Similarly, an application may scale out by using many consumers for a given topic, with each pulling events from a discrete set of partitions.</p>
<div id="attachment_4231" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Kafka_topic.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4231" src="./../../../wp-content/uploads/2016/09/Kafka_topic-1024x720.png" alt="Kafka Producers, Consumers, Topics, and Partitions" width="480" height="338" class="size-large wp-image-4231" srcset="./../../../wp-content/uploads/2016/09/Kafka_topic-1024x720.png 1024w, ./../../../wp-content/uploads/2016/09/Kafka_topic-300x211.png 300w, ./../../../wp-content/uploads/2016/09/Kafka_topic-768x540.png 768w, ./../../../wp-content/uploads/2016/09/Kafka_topic.png 1464w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4231" class="wp-caption-text">Figure 1: Kafka Producers, Consumers, Topics, and Partitions</p>
</div>
<h1>MongoDB As A Kafka Consumer – A Java Example</h1>
<p>In order to use MongoDB as a Kafka consumer, the received events must be converted into BSON documents before they are stored in the database. In this example, the events are strings representing JSON documents. The strings are converted to Java objects so that they are easy for Java developers to work with; those objects are then transformed into BSON documents.</p>
<p>Complete source code, Maven configuration, and test data can be found further down, but here are some of the highlights; starting with the main loop for receiving and processing event messages from the Kafka topic:</p>
<p><script src="https://gist.github.com/am-MongoDB/c802bcd43fec731d219ee8ace58dd880.js"></script></p>
<p>The <code>Fish</code> class includes helper methods to hide how the objects are converted into BSON documents:</p>
<p><script src="https://gist.github.com/am-MongoDB/432ffc15d4f95209da70123c9d752826.js"></script></p>
<p>In a real application more would be done with the received messages – they could be combined with reference data read from MongoDB, acted on and then passed along the pipeline by publishing to additional topics. In this example, the final step is to confirm from the <code>mongo</code> shell that the data has been added to the database:</p>
<p><script src="https://gist.github.com/2fd1f4a7ecaf5dd6a426fc8b53e9b4c0.js"></script></p>
<h2>Full Java Code for MongoDB Kafka Consumer</h2>
<h3>Business Object – <code>Fish.java</code>
</h3>
<p><script src="https://gist.github.com/217f007071922dc2d7d37eed9fe7a789.js"></script></p>
<h3>Kafka Consumer for MongoDB – <code>MongoDBSimpleConsumer.java</code>
</h3>
<p>Note that this example consumer is written using the Kafka <em>Simple Consumer API</em> – there is also a Kafka <em>High Level Consumer API</em> which hides much of the complexity – including managing the offsets. The Simple API provides more control to the application but at the cost of writing extra code.<br>
<script src="https://gist.github.com/77eb68a6af50f93453a7c316dbe1c6b5.js"></script></p>
<h3>Maven Dependencies – <code>pom.xml</code>
</h3>
<p><script src="https://gist.github.com/03f9bfbbedfe4fa015854c9a39ba4bbc.js"></script></p>
<h3>Test Data – <code>Fish.json</code>
</h3>
<p>A sample of the test data injected into Kafka is shown below:</p>
<p><script src="https://gist.github.com/5e74c8913119107936f9a5594b7dd149.js"></script></p>
<p>For simple testing, this data can be injected into the <code>clusterdb-topic1</code> topic using the <code>kafka-console-producer.sh</code> command.</p>
<h1>Next Steps</h1>
<p>To learn much more about data streaming and how MongoDB fits in (including Apache Kafka and competing and complementary technologies) read the <a href="https://www.mongodb.com/collateral/data-streaming-with-apache-kafka-and-mongodb" title="Data Streaming with Kafka &amp; MongoDB">Data Streaming with Kafka &amp; MongoDB</a> white paper and watch the <a href="https://www.mongodb.com/presentations/webinar-data-streaming-with-apache-kafka-and-mongodb">webinar replay</a>.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/mongodb-data-streaming-implementing-a-mongodb-kafka-consumer" data-via="wpbeginner" data-text="MongoDB &#038; Data Streaming – Implementing a MongoDB Kafka Consumer" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/mongodb-data-streaming-implementing-a-mongodb-kafka-consumer"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/mongodb-data-streaming-implementing-a-mongodb-kafka-consumer" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Fmongodb-data-streaming-implementing-a-mongodb-kafka-consumer&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../../../category/mongodb/index.html" rel="category tag">MongoDB</a> | 
Tags: <a href="./../../apache-kafka/index.html" rel="tag">Apache Kafka</a>, <a href="./../../data-streaming/index.html" rel="tag">data streaming</a>, <a href="./../../kafka/index.html" rel="tag">Kafka</a>, <a href="./../../mongodb/index.html" rel="tag">mongodb</a>
</div>

			</div>			<div id="post-4215" class="post-4215 post type-post status-publish format-standard hentry category-mongodb tag-javascript tag-mongodb tag-mongodb-atlas tag-mongodb-compass tag-node-js tag-pencilblue">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../../../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../../../mongodb/using-pencilblue-with-mongodb-atlas/index.html">September 15, 2016</a>
			</div>
	<div class="postcomments">
		<a href="./../../../mongodb/using-pencilblue-with-mongodb-atlas/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../../../mongodb/using-pencilblue-with-mongodb-atlas/index.html" rel="bookmark">Using PencilBlue with MongoDB Atlas</a></h2>
				
				<div class="entry">
										<p>PencilBlue is a Node.js based, open source blogging and Content Management System, targeted at enterprise grade websites.</p>
<p>This post explains why MongoDB Atlas is an ideal choice for PencilBlue and then goes on to show how to configure PencilBlue to use it.</p>
<h1>Why MongoDB Atlas is the Ideal Database for PencilBlue</h1>
<p>MongoDB delivers flexible schemas, rich queries, an idiomatic Node.js driver, and simple to use high availability and scaling. This makes it the go-to database for anyone looking to build applications on Node.js.</p>
<p><a href="https://www.mongodb.com/cloud">MongoDB Atlas</a> provides all of the features of MongoDB, without the operational heavy lifting required for any new application. MongoDB Atlas is available on demand through a pay-as-you-go model and billed on an hourly basis, letting you focus on what you do best.</p>
<p>It’s easy to get started – use a simple GUI to select the instance size, region, and features you need. MongoDB Atlas provides:</p>
<ul>
<li>Security features to protect access to your data</li>
<li>Built in replication for always-on availability, tolerating complete data center failure</li>
<li>Backups and point in time recovery to protect against data corruption</li>
<li>Fine-grained monitoring to let you know when to scale. Additional instances can be provisioned with the push of a button</li>
<li>Automated patching and one-click upgrades for new major versions of the database, enabling you to take advantage of the latest and greatest MongoDB features</li>
<li>A choice of cloud providers, regions, and billing options</li>
</ul>
<p>Like PencilBlue, MongoDB Atlas is a natural fit for users looking to simplify their development and operations work, letting them focus on what makes their application unique rather than commodity (albeit essential) plumbing.</p>
<h1>Installing PencilBlue and Connecting it to MongoDB Atlas</h1>
<p>Before starting with PencilBlue, you should launch your MongoDB cluster using <a href="https://www.mongodb.com/cloud">MongoDB Atlas</a> and then (optionally) create a user with read and write privileges for just the database that will be used for this project, as shown in Figure 1.</p>
<div id="attachment_4216" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/PencilBlue_user.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4216" src="./../../../wp-content/uploads/2016/09/PencilBlue_user-910x1024.png" alt="Adding a PencilBlue User to MongoDB Atlas" width="480" height="540" class="size-large wp-image-4216" srcset="./../../../wp-content/uploads/2016/09/PencilBlue_user-910x1024.png 910w, ./../../../wp-content/uploads/2016/09/PencilBlue_user-267x300.png 267w, ./../../../wp-content/uploads/2016/09/PencilBlue_user-768x864.png 768w, ./../../../wp-content/uploads/2016/09/PencilBlue_user.png 1596w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4216" class="wp-caption-text">Figure 1: Adding a PencilBlue User to MongoDB Atlas</p>
</div>
<p>You must also add your IP address to the IP Whitelist in the MongoDB Atlas security tab (Figure 2).</p>
<div id="attachment_4217" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/PencilBlue_whitelist_IP.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4217" src="./../../../wp-content/uploads/2016/09/PencilBlue_whitelist_IP-1024x701.png" alt="Add IP Address to MongoDB Atlas Whitelist" width="480" height="329" class="size-large wp-image-4217" srcset="./../../../wp-content/uploads/2016/09/PencilBlue_whitelist_IP-1024x701.png 1024w, ./../../../wp-content/uploads/2016/09/PencilBlue_whitelist_IP-300x205.png 300w, ./../../../wp-content/uploads/2016/09/PencilBlue_whitelist_IP-768x526.png 768w, ./../../../wp-content/uploads/2016/09/PencilBlue_whitelist_IP.png 1502w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4217" class="wp-caption-text">Figure 2: Add IP Address to MongoDB Atlas Whitelist</p>
</div>
<p>If it isn&#8217;t already installed on your system, download and install Node.js:</p>
<pre><code>$ curl https://nodejs.org/dist/v4.4.7/node-v4.4.7-linux-x64.tar.xz -o node.tar.xz
$ tar xf node.tar.xz
</code></pre>
<p>You should then add the <code>bin</code> sub-folder to your <code>.bash_profile</code> before installing the PencilBlue command line interface (CLI):</p>
<pre><code>$ sudo npm install -g pencilblue-cli
Password:
npm WARN engine pencilblue-cli@0.3.1: wanted: {"node":"&gt;= 4.4.7"} (current: {"node":"0.12.5","npm":"2.11.2"})
/usr/local/bin/pencilblue -&gt; /usr/local/lib/node_modules/pencilblue-cli/lib/pencilblue-cli.js
/usr/local/bin/pbctrl -&gt; /usr/local/lib/node_modules/pencilblue-cli/lib/pencilblue-cli.js
pencilblue-cli@0.3.1 /usr/local/lib/node_modules/pencilblue-cli
├── process@0.11.8
├── colors@1.1.2
├── q@1.4.1
├── shelljs@0.7.3 (interpret@1.0.1, rechoir@0.6.2, glob@7.0.5)
└── prompt@1.0.0 (revalidator@0.1.8, pkginfo@0.4.0, read@1.0.7, winston@2.1.1, utile@0.3.0)
</code></pre>
<p>The CLI can then be used to install and configure PencilBlue itself:</p>
<pre><code>$ pbctrl install PencilBlue
Site Name:  (My PencilBlue Site) PokeSite
Site Root:  (http://localhost:8080) 
Address to bind to:  (0.0.0.0) 
Site Port:  (8080) 
MongoDB URL:  (mongodb://127.0.0.1:27017/) mongodb://pencilblue_user:my_password@cluster0-shard-00-00-qfovx.mongodb.net:27017,cluster0-shard-00-01-qfovx.mongodb.net:27017,cluster0-shard-00-02-qfovx.mongodb.net:27017/?ssl=true&amp;authSource=admin
Database Name:  (pencilblue) clusterdb
Do you want to install Bower components?:  (y/N) 
Cloning PencilBlue from github...
Cloning into 'PencilBlue'...
Installing npm modules...
...
Creating config.js...
Installation completed.
</code></pre>
<p>Note that if you need to change the configuration (e.g., to specify a new URL to connect to MongoDB) then edit the <code>config.js</code> file that was created during this step.</p>
<p>The MongoDB URL you provided contains these components:</p>
<ul>
<li>
<code>pencilblue_user</code> is the name of the user you created in the MongoDB Atlas UI</li>
<li>
<code>my_password</code> is the password you chose when creating the user in MongoDB Atlas</li>
<li>
<code>cluster0-shard-00-00-qfovx.mongodb.net</code>, <code>cluster0-shard-00-01-qfovx.mongodb.net</code>, &amp; <code>cluster0-shard-00-02-qfovx.mongodb.net</code> are the hostnames of the instances in your MongoDB Atlas replica set (click on the &#8220;CONNECT&#8221; button in the MongoDB Atlas UI if you don&#8217;t have these – Figure 3)</li>
<li>
<code>27017</code> is the standard MongoDB port number</li>
<li>To enforce security, MongoDB Atlas mandates that the <code>ssl</code> option is used</li>
<li>
<code>admin</code> is the database that&#8217;s being used to store the credentials for <code>pencilblue_user</code>
</li>
</ul>
<div id="attachment_4218" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/PencilBlue_Find_Connect_String.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4218" src="./../../../wp-content/uploads/2016/09/PencilBlue_Find_Connect_String-1024x414.png" alt="Find the Hostnames From the MongoDB Atlas UI" width="480" height="194" class="size-large wp-image-4218" srcset="./../../../wp-content/uploads/2016/09/PencilBlue_Find_Connect_String-1024x414.png 1024w, ./../../../wp-content/uploads/2016/09/PencilBlue_Find_Connect_String-300x121.png 300w, ./../../../wp-content/uploads/2016/09/PencilBlue_Find_Connect_String-768x310.png 768w, ./../../../wp-content/uploads/2016/09/PencilBlue_Find_Connect_String.png 1520w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4218" class="wp-caption-text">Figure 3: Find the Hostnames From the MongoDB Atlas UI</p>
</div>
<p><code>clusterdb</code> is the name of the database (schema) that PencilBlue will use (note that unlike some frameworks, the database name is specified separately rather than being embedded in the MongoDB URL).</p>
<p>The PencilBlue process can now be started:</p>
<pre><code>$ cd PencilBlue/
$ pbctrl start
</code></pre>
<h1>Confirm that MongoDB Atlas is Being Used</h1>
<p>At this point, it is possible to connect to MongoDB Atlas using the MongoDB shell (we&#8217;ll look at an easier way to navigate the data later) to confirm that the schema has been created:</p>
<pre><code>$ mongo mongodb://cluster0-shard-00-00-qfovx.mongodb.net:27017,cluster0-shard-00-01-qfovx.mongodb.net:27017,cluster0-shard-00-02-qfovx.mongodb.net:27017/admin?replicaSet=Cluster0-shard-0 --ssl --username billy --password my_password

Cluster0-shard-0:PRIMARY&gt; show dbs
admin      0.000GB
clusterdb  0.008GB
local      0.007GB

Cluster0-shard-0:PRIMARY&gt; use clusterdb
switched to db clusterdb

Cluster0-shard-0:PRIMARY&gt; show collections
article
auth_token
comment
custom_object
custom_object_type
fs.chunks
fs.files
job_log
lock
media
page
password_reset
plugin
plugin_settings
section
server_registry
session
setting
theme_settings
topic
unverified_user
user
</code></pre>
<h1>Create Your First Page in PencilBlue</h1>
<p>Browse to the application at <a href="http://localhost:8080/">http://localhost:8080</a> as shown in Figure 4 and create a user account.</p>
<div id="attachment_4219" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/PencilBlue_Browser.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4219" src="./../../../wp-content/uploads/2016/09/PencilBlue_Browser-1016x1024.png" alt="Register User in PencilBlue" width="480" height="484" class="size-large wp-image-4219" srcset="./../../../wp-content/uploads/2016/09/PencilBlue_Browser-1016x1024.png 1016w, ./../../../wp-content/uploads/2016/09/PencilBlue_Browser-150x150.png 150w, ./../../../wp-content/uploads/2016/09/PencilBlue_Browser-298x300.png 298w, ./../../../wp-content/uploads/2016/09/PencilBlue_Browser-768x774.png 768w, ./../../../wp-content/uploads/2016/09/PencilBlue_Browser-144x144.png 144w, ./../../../wp-content/uploads/2016/09/PencilBlue_Browser.png 1750w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4219" class="wp-caption-text">Figure 4: Register User in PencilBlue</p>
</div>
<p>You&#8217;re then able to login and create your first page (Figure 5).</p>
<div id="attachment_4220" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/PencilBlue_Create_content.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4220" src="./../../../wp-content/uploads/2016/09/PencilBlue_Create_content-1024x973.png" alt="Create a New Page Using PencilBlue" width="480" height="456" class="size-large wp-image-4220" srcset="./../../../wp-content/uploads/2016/09/PencilBlue_Create_content-1024x973.png 1024w, ./../../../wp-content/uploads/2016/09/PencilBlue_Create_content-300x285.png 300w, ./../../../wp-content/uploads/2016/09/PencilBlue_Create_content-768x730.png 768w, ./../../../wp-content/uploads/2016/09/PencilBlue_Create_content.png 1902w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4220" class="wp-caption-text">Figure 5: Create a New Page Using PencilBlue</p>
</div>
<p>After saving, the new page can be viewed (Figure 6).</p>
<div id="attachment_4221" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/PencilBlue_Page.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4221" src="./../../../wp-content/uploads/2016/09/PencilBlue_Page-776x1024.png" alt="View Pokémon Page in PencilBlue" width="480" height="633" class="size-large wp-image-4221" srcset="./../../../wp-content/uploads/2016/09/PencilBlue_Page-776x1024.png 776w, ./../../../wp-content/uploads/2016/09/PencilBlue_Page-227x300.png 227w, ./../../../wp-content/uploads/2016/09/PencilBlue_Page-768x1014.png 768w, ./../../../wp-content/uploads/2016/09/PencilBlue_Page.png 1620w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4221" class="wp-caption-text">Figure 6: View Pokémon Page in PencilBlue</p>
</div>
<p>To visually navigate through the PencilBlue schema and data, <a href="https://www.mongodb.com/download-center?jmp=nav#compass">download and install MongoDB Compass</a>. Use your MongoDB Atlas credentials to connect Compass to your MongoDB database – Figure 7.</p>
<div id="attachment_4222" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/PencilBlue_Connect_Compass_to_MongoDB_Atlas.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4222" src="./../../../wp-content/uploads/2016/09/PencilBlue_Connect_Compass_to_MongoDB_Atlas-1024x839.png" alt="Connect MongoDB Compass to MongoDB Atlas" width="480" height="393" class="size-large wp-image-4222" srcset="./../../../wp-content/uploads/2016/09/PencilBlue_Connect_Compass_to_MongoDB_Atlas-1024x839.png 1024w, ./../../../wp-content/uploads/2016/09/PencilBlue_Connect_Compass_to_MongoDB_Atlas-300x246.png 300w, ./../../../wp-content/uploads/2016/09/PencilBlue_Connect_Compass_to_MongoDB_Atlas-768x629.png 768w, ./../../../wp-content/uploads/2016/09/PencilBlue_Connect_Compass_to_MongoDB_Atlas.png 1802w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4222" class="wp-caption-text">Figure 7: Connect MongoDB Compass to MongoDB Atlas</p>
</div>
<p>Navigate through the structure of the data in the <code>clusterdb</code> database (Figure 8); view the JSON documents (Figure 9) and check the indexes (Figure 10).</p>
<div id="attachment_4223" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/PencilBlue_Compass_Schema.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4223" src="./../../../wp-content/uploads/2016/09/PencilBlue_Compass_Schema-1024x594.png" alt="Explore PencilBlue Schema Using MongoDB Compass" width="480" height="278" class="size-large wp-image-4223" srcset="./../../../wp-content/uploads/2016/09/PencilBlue_Compass_Schema-1024x594.png 1024w, ./../../../wp-content/uploads/2016/09/PencilBlue_Compass_Schema-300x174.png 300w, ./../../../wp-content/uploads/2016/09/PencilBlue_Compass_Schema-768x445.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4223" class="wp-caption-text">Figure 8: Explore PencilBlue Schema Using MongoDB Compass</p>
</div>
<div id="attachment_4224" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/PencilBlue_Compass_Document.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4224" src="./../../../wp-content/uploads/2016/09/PencilBlue_Compass_Document-1024x595.png" alt="View PencilBlue Documents in MongoDB Compass" width="480" height="279" class="size-large wp-image-4224" srcset="./../../../wp-content/uploads/2016/09/PencilBlue_Compass_Document-1024x595.png 1024w, ./../../../wp-content/uploads/2016/09/PencilBlue_Compass_Document-300x174.png 300w, ./../../../wp-content/uploads/2016/09/PencilBlue_Compass_Document-768x446.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4224" class="wp-caption-text">Figure 9: View PencilBlue Documents in MongoDB Compass</p>
</div>
<div id="attachment_4225" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/PencilBlue_Compass_Indexes.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4225" src="./../../../wp-content/uploads/2016/09/PencilBlue_Compass_Indexes-1024x594.png" alt="View PencilBlue Indexes Using MongoDB Compass" width="480" height="278" class="size-large wp-image-4225" srcset="./../../../wp-content/uploads/2016/09/PencilBlue_Compass_Indexes-1024x594.png 1024w, ./../../../wp-content/uploads/2016/09/PencilBlue_Compass_Indexes-300x174.png 300w, ./../../../wp-content/uploads/2016/09/PencilBlue_Compass_Indexes-768x446.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4225" class="wp-caption-text">Figure 10: View PencilBlue Indexes Using MongoDB Compass</p>
</div>
<h1>Next Steps</h1>
<p>While MongoDB Atlas radically simplifies the operation of MongoDB there are still some decisions to take to ensure the best performance and reliability for your application. The <a href="https://www.mongodb.com/collateral/mongodb-atlas-best-practices">MongoDB Atlas Best Practices white paper</a> provides guidance on best practices for deploying, managing, and optimizing the performance of your database with MongoDB Atlas.</p>
<p>The guide outlines considerations for achieving performance at scale with MongoDB Atlas across a number of key dimensions, including instance size selection, application patterns, schema design and indexing, and disk I/O. While this guide is broad in scope, it is not exhaustive. Following the recommendations in the guide will provide a solid foundation for ensuring optimal application performance.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/using-pencilblue-with-mongodb-atlas" data-via="wpbeginner" data-text="Using PencilBlue with MongoDB Atlas" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/using-pencilblue-with-mongodb-atlas"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/using-pencilblue-with-mongodb-atlas" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Fusing-pencilblue-with-mongodb-atlas&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../../../category/mongodb/index.html" rel="category tag">MongoDB</a> | 
Tags: <a href="./../../javascript/index.html" rel="tag">javascript</a>, <a href="./../../mongodb/index.html" rel="tag">mongodb</a>, <a href="./../../mongodb-atlas/index.html" rel="tag">MongoDB Atlas</a>, <a href="./../../mongodb-compass/index.html" rel="tag">MongoDB Compass</a>, <a href="./../../node-js/index.html" rel="tag">node.js</a>, <a href="./../../pencilblue/index.html" rel="tag">PencilBlue</a>
</div>

			</div>			<div id="post-4201" class="post-4201 post type-post status-publish format-standard hentry category-mongodb tag-aws tag-elastic-beanstalk tag-mongodb tag-mongodb-atlas tag-node-js">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../../../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../../../mongodb/develop-deploy-a-node-js-app-to-aws-elastic-beanstalk-mongodb-atlas/index.html">September 15, 2016</a>
			</div>
	<div class="postcomments">
		<a href="./../../../mongodb/develop-deploy-a-node-js-app-to-aws-elastic-beanstalk-mongodb-atlas/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../../../mongodb/develop-deploy-a-node-js-app-to-aws-elastic-beanstalk-mongodb-atlas/index.html" rel="bookmark">Develop &#038; Deploy a Node.js App to AWS Elastic Beanstalk &#038; MongoDB Atlas</a></h2>
				
				<div class="entry">
										<h1>Introduction</h1>
<p>This blog post demonstrates how to build and deploy an application on AWS Elastic Beanstalk, and have that application connect to <a href="https://www.mongodb.com/cloud">MongoDB Atlas</a> as its back-end database service:</p>
<ul>
<li>Introducing the example <em>MongoPop</em> application</li>
<li>Connecting applications to your MongoDB Atlas cluster; including IP address whitelisting</li>
<li>Downloading and testing MongoPop locally and on AWS Elastic Beanstalk</li>
<li>Populating your database with thousands of realistic documents</li>
<li>Explaining key parts of the application code</li>
<li>Adapting and redeploying applications</li>
<li>Graphically exploring your schema and data with MongoDB Compass</li>
</ul>
<p>AWS Elastic Beanstalk is a service offered by Amazon to make it simple for developers to deploy and manage their cloud-based applications. After you&#8217;ve uploaded your application, Elastic Beanstalk automatically takes care of:</p>
<ul>
<li>Capacity provisioning, adding more instances as needed</li>
<li>Load balancing</li>
<li>Health monitoring</li>
</ul>
<p>MongoDB Atlas provides all of the features of the MongoDB database, without the operational heavy lifting. MongoDB Atlas is available on demand through a pay-as-you-go model and billed on an hourly basis, letting you focus on your application code.</p>
<p>It’s easy to get started – use a simple GUI to select the instance size, region, and features you need. MongoDB Atlas provides:</p>
<ul>
<li>Security features to protect access to your data</li>
<li>Built in replication for always-on availability, tolerating complete data center failure</li>
<li>Backups and point in time recovery to protect against data corruption</li>
<li>Fine-grained monitoring to let you know when to scale. Additional instances can be provisioned with the push of a button</li>
<li>Automated patching and one-click upgrades for new major versions of the database, enabling you to take advantage of the latest and greatest MongoDB features</li>
<li>A choice of cloud providers, regions, and billing options</li>
</ul>
<p>There is clearly a lot of synergy between these technologies – both of them handling the enabling infrastructure, letting the developer spend their precious time on writing great applications. To continue in the spirit of developer productivity, the application used in this post is developed using Node.js, the Express web application framework, and the Pug (formerly Jade) template engine.</p>
<h1>The Application &#8211; MongoPop</h1>
<p>Let&#8217;s start by taking a look at what the new Mongopop application provides.</p>
<p>Getting your MongoDB Atlas cluster up and running is a breeze but what do you do with it next? Wouldn&#8217;t it be great to populate it with some realistic data so that you can start experimenting? This is what MongoPop does – even letting you tailor the format and contents of the data using the <a href="http://www.mockaroo.com/">Mockaroo</a> service.</p>
<p>Mockaroo is a flexible service, allowing you to define a rich schema and then generate realistic sample data sets. Supported types include:</p>
<ul>
<li>Email address</li>
<li>City</li>
<li>European first name</li>
<li>JSON array</li>
<li>Branded drug names</li>
<li>Custom types defined by you, based on regular expressions</li>
</ul>
<p>Data files can be downloaded from Mockaroo in multiple formats, including: JSON, CSV, and SQL.</p>
<p>MongoPop pulls data from Mockaroo and then automatically writes the data to your database. It defaults to our example Mockaroo schema but you can replace that with a URL for any schema that you&#8217;ve defined in Mockaroo (or any other service providing arrays of JSON documents). Mockaroo takes care of connecting to MongoDB Atlas and runs multithreaded, speeding up the process of loading large datasets into MongoDB.</p>
<h2>Using MongoPop</h2>
<div id="attachment_4203" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Identify_IP_Address_for_MongoDB_Atlas_whitelisting.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4203" src="./../../../wp-content/uploads/2016/09/Identify_IP_Address_for_MongoDB_Atlas_whitelisting-1024x524.png" alt="Identify IP Address of MongoPop Server for MongoDB Atlas IP Whitelisting" width="480" height="246" class="size-large wp-image-4203" srcset="./../../../wp-content/uploads/2016/09/Identify_IP_Address_for_MongoDB_Atlas_whitelisting-1024x524.png 1024w, ./../../../wp-content/uploads/2016/09/Identify_IP_Address_for_MongoDB_Atlas_whitelisting-300x153.png 300w, ./../../../wp-content/uploads/2016/09/Identify_IP_Address_for_MongoDB_Atlas_whitelisting-768x393.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4203" class="wp-caption-text">Figure 1: Identify IP Address of MongoPop Server for MongoDB Atlas IP Whitelisting</p>
</div>
<p>When you first access MongoPop (Figure 1), you&#8217;re presented with a form to provide details on how to connect to your MongoDB Atlas instance, and what you&#8217;d like the data to look like. Before completing the form, take a note of the IP address that&#8217;s displayed. This IP address needs to be added to the whitelist for your group, which is done through the security tab of the <a href="https://www.mongodb.com/cloud">MongoDB Atlas UI</a> (Figure 2).</p>
<div id="attachment_4204" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Add_IP_Address_to_MongoDB_Atlas_whitelist.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4204" src="./../../../wp-content/uploads/2016/09/Add_IP_Address_to_MongoDB_Atlas_whitelist-1024x428.png" alt="Add MongoPop IP Address to MongoDB Atlas Group Whitelist" width="480" height="201" class="size-large wp-image-4204" srcset="./../../../wp-content/uploads/2016/09/Add_IP_Address_to_MongoDB_Atlas_whitelist-1024x428.png 1024w, ./../../../wp-content/uploads/2016/09/Add_IP_Address_to_MongoDB_Atlas_whitelist-300x126.png 300w, ./../../../wp-content/uploads/2016/09/Add_IP_Address_to_MongoDB_Atlas_whitelist-768x321.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4204" class="wp-caption-text">Figure 2: Add MongoPop IP Address to MongoDB Atlas Group Whitelist</p>
</div>
<p>In a production Elastic Beanstalk environment, the IP whitelisting can be a little more involved – that will be covered later in this post.</p>
<div id="attachment_4205" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Find_Node_Driver_Connect_String_MongoDB_Atlas.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4205" src="./../../../wp-content/uploads/2016/09/Find_Node_Driver_Connect_String_MongoDB_Atlas-1024x416.png" alt="Find the Node.js Driver Connect String in MongoDB Atlas" width="480" height="195" class="size-large wp-image-4205" srcset="./../../../wp-content/uploads/2016/09/Find_Node_Driver_Connect_String_MongoDB_Atlas-1024x416.png 1024w, ./../../../wp-content/uploads/2016/09/Find_Node_Driver_Connect_String_MongoDB_Atlas-300x122.png 300w, ./../../../wp-content/uploads/2016/09/Find_Node_Driver_Connect_String_MongoDB_Atlas-768x312.png 768w, ./../../../wp-content/uploads/2016/09/Find_Node_Driver_Connect_String_MongoDB_Atlas.png 1380w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4205" class="wp-caption-text">Figure 3: Find the Node.js Driver Connect String in MongoDB Atlas</p>
</div>
<p>While in the MongoDB Atlas UI, click the &#8220;CONNECT&#8221; button, select the &#8220;MongoDB Drivers&#8221; tab and then the &#8220;COPY&#8221; button (Figure 3). Paste the copied URI directly into MongoPop. You should also enter the password and the database you want to use.</p>
<p>Note that the URI needs editing before it&#8217;s actually used but MongoPop handles that using the password and database name you provide; the final URI will take this form: <code>mongodb://mongodb_user:my_password@cluster0-shard-00-00-qfovx.mongodb.net:27017,cluster0-shard-00-01-qfovx.mongodb.net:27017,cluster0-shard-00-02-qfovx.mongodb.net:27017/mongopop?ssl=true&amp;authSource=admin</code>.</p>
<p>This URI contains these components:</p>
<ul>
<li>
<code>mongodb_user</code> is the name of the user you gave when creating the group in the MongoDB Atlas UI. Alternatively, create a new user in the MongoDB Atlas UI with more restricted privileges.</li>
<li>
<code>my_password</code> is the password you chose when creating the user in MongoDB Atlas.</li>
<li>
<code>cluster0-shard-00-00-qfovx.mongodb.net</code>, <code>cluster0-shard-00-01-qfovx.mongodb.net</code>, &amp; <code>cluster0-shard-00-02-qfovx.mongodb.net</code> are the hostnames of the instances in your MongoDB Atlas replica set.</li>
<li>
<code>27017</code> is the default MongoDB port number.</li>
<li>
<code>mongopop</code> is the name of the database (schema) that MongoPop will use.</li>
<li>To enforce over-the-wire encryption, MongoDB Atlas mandates that the <code>ssl</code> option is used.</li>
<li>
<code>admin</code> is the database that&#8217;s being used to store the credentials for <code>mongodb_user</code>.</li>
</ul>
<p>The remaining fields define the collection to store the documents, the source of the document schema, and the number of documents (in thousands) to be added. The source URL defaults to a document format already defined but you can create your own by registering at the <a href="http://www.mockaroo.com/">Mockaroo</a> site, defining the document structure and then using the URL provided.</p>
<p>After clicking the &#8220;populate&#8221; button, MongoPop fetches the data set(s) from Mockaroo and then adds the documents to your MongoDB Atlas collection. Once the data has been added, the page refreshes and you&#8217;re shown a sample of the documents now stored in your collection (Figure 4).</p>
<div id="attachment_4206" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/MongoDB_Atlas_sample_document.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4206" src="./../../../wp-content/uploads/2016/09/MongoDB_Atlas_sample_document-1024x771.png" alt="Sample of Data Added to MongoDB Atlas Collection" width="480" height="361" class="size-large wp-image-4206" srcset="./../../../wp-content/uploads/2016/09/MongoDB_Atlas_sample_document-1024x771.png 1024w, ./../../../wp-content/uploads/2016/09/MongoDB_Atlas_sample_document-300x226.png 300w, ./../../../wp-content/uploads/2016/09/MongoDB_Atlas_sample_document-768x578.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4206" class="wp-caption-text">Figure 4: Sample of Data Added to MongoDB Atlas Collection</p>
</div>
<h3>MongoDB Compass</h3>
<p>Congratulations, you now have some data in your database! An optional step is to start exploring that data using <a href="https://www.mongodb.com/products/compass">MongoDB Compass</a>. The same credentials can be used to connect Compass to your MongoDB database (Figure 5).</p>
<div id="attachment_4207" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Connect_MongoDB_Compass_to_MongoDB_Atlas.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4207" src="./../../../wp-content/uploads/2016/09/Connect_MongoDB_Compass_to_MongoDB_Atlas-1024x839.png" alt="Connect MongoDB Compass to MongoDB Atlas" width="480" height="393" class="size-large wp-image-4207" srcset="./../../../wp-content/uploads/2016/09/Connect_MongoDB_Compass_to_MongoDB_Atlas-1024x839.png 1024w, ./../../../wp-content/uploads/2016/09/Connect_MongoDB_Compass_to_MongoDB_Atlas-300x246.png 300w, ./../../../wp-content/uploads/2016/09/Connect_MongoDB_Compass_to_MongoDB_Atlas-768x629.png 768w, ./../../../wp-content/uploads/2016/09/Connect_MongoDB_Compass_to_MongoDB_Atlas.png 1796w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4207" class="wp-caption-text">Figure 5: Connect MongoDB Compass to MongoDB Atlas</p>
</div>
<p>Once connected, explore the data added to the collection (Figure 6).</p>
<div id="attachment_4208" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Explore_MongoDB_Atlas_data_with_MongoDB_Compass.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4208" src="./../../../wp-content/uploads/2016/09/Explore_MongoDB_Atlas_data_with_MongoDB_Compass-1024x734.png" alt="Explore MongoDB Atlas Data Using MongoDB Compass" width="480" height="344" class="size-large wp-image-4208" srcset="./../../../wp-content/uploads/2016/09/Explore_MongoDB_Atlas_data_with_MongoDB_Compass-1024x734.png 1024w, ./../../../wp-content/uploads/2016/09/Explore_MongoDB_Atlas_data_with_MongoDB_Compass-300x215.png 300w, ./../../../wp-content/uploads/2016/09/Explore_MongoDB_Atlas_data_with_MongoDB_Compass-768x550.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4208" class="wp-caption-text">Figure 6: Explore MongoDB Atlas Data Using MongoDB Compass</p>
</div>
<p>In this version (1.3) of MongoDB Compass (currently in <a href="https://www.mongodb.com/download-center?jmp=nav#compass">beta</a>), it is also possible to add, delete, and modify documents (Figure 7).</p>
<div id="attachment_4209" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Modify_MongoDB_Atlas_document_in_MongoDB_Compass.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4209" src="./../../../wp-content/uploads/2016/09/Modify_MongoDB_Atlas_document_in_MongoDB_Compass-1024x340.png" alt="Modify a Document in MongoDB Compass" width="480" height="159" class="size-large wp-image-4209" srcset="./../../../wp-content/uploads/2016/09/Modify_MongoDB_Atlas_document_in_MongoDB_Compass-1024x340.png 1024w, ./../../../wp-content/uploads/2016/09/Modify_MongoDB_Atlas_document_in_MongoDB_Compass-300x100.png 300w, ./../../../wp-content/uploads/2016/09/Modify_MongoDB_Atlas_document_in_MongoDB_Compass-768x255.png 768w, ./../../../wp-content/uploads/2016/09/Modify_MongoDB_Atlas_document_in_MongoDB_Compass.png 2002w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4209" class="wp-caption-text">Figure 7: Modify a Document in MongoDB Compass</p>
</div>
<p>You can verify that the document has really been updated from the MongoDB shell:</p>
<p><script src="https://gist.github.com/am-MongoDB/fd52e83e27d4db27e84be40c5c6c719d.js"></script></p>
<h2>Downloading the Application</h2>
<p>The tools for deploying your application to AWS Elastic Beanstalk integrate with <code>git</code>, which makes it the best way to get the code. Assuming that <code>git</code> is already installed, downloading the code is simple:</p>
<p><script src="https://gist.github.com/am-MongoDB/f20c38dc8fdbb058eec5c828da33b845.js"></script></p>
<p>If you then want to refresh your local repository with the latest version:</p>
<p><script src="https://gist.github.com/am-MongoDB/79171206054c25534005da997a001ebb.js"></script></p>
<p>Alternatively, simply <a href="https://github.com/andrewjamesmorgan/mongopop/archive/master.zip">download the zip file</a>.</p>
<h2>Testing The Application Locally</h2>
<p>Deploying to Elastic Beanstalk is straightforward but there is a delay each time you update and redeploy your application. For that reason, it&#8217;s still useful to be able to test and debug locally.</p>
<p>After downloading the application, installing its dependencies and then running it is trivial (this assumes that you already have Node.js installed):</p>
<p><script src="https://gist.github.com/am-MongoDB/3aa672bbdc0f0db3ce6655a295251e28.js"></script></p>
<p><code>npm_install</code> installs all of the required dependencies (which are described in <code>package.json</code>). <code>npm start</code> starts the application – once it it running browse to <a href="http://localhost:3000/pop"><code>http://localhost:3000/pop</code></a> to try it out.</p>
<h3>Deploying to AWS Elastic Beanstalk</h3>
<p>You can create your Elastic Beanstalk environment and deploy and monitor your application from the <a href="https://console.aws.amazon.com/elasticbeanstalk">AWS console</a>. If you don&#8217;t already have an account then that&#8217;s where you would create it. If you already have an account, and a copy of your Access Key ID and Secret Access Key, then using the <a href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb-cli3.html">EB CLI</a> provides a more efficient workflow.</p>
<p>The method for installing the EB CLI <a href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb-cli3-install.html">varies by platform</a> but if you already have Homebrew installed on OS X then it&#8217;s as simple as:</p>
<p><script src="https://gist.github.com/am-MongoDB/dad9ee324bd60683dc24d1c0b909c565.js"></script></p>
<p><code>eb init</code> sets default values for Elastic Beanstalk applications created with the EB CLI by prompting you with a series of questions:</p>
<p><script src="https://gist.github.com/am-MongoDB/bb7a6f5986844ee3a4d65eb3db534b66.js"></script></p>
<p><code>eb create</code> creates a new environment and deploys the current application to that environment:</p>
<p><script src="https://gist.github.com/am-MongoDB/700457d947aba7a81751bd4c62c6172d.js"></script></p>
<p>Finally, <code>eb open</code> connects to the MongoPop app from your browser.</p>
<p>If you want to make changes to the application then the EB CLI makes it simple to redeploy the new version. As an example, edit the <code>views/pop.jade</code> file to add an extra paragraph after the title:</p>
<p><script src="https://gist.github.com/am-MongoDB/48ddde4054dde848b02924ba2d7ecb0b.js"></script></p>
<p>The EB CLI integrates with <code>git</code> and so update <code>git</code> with the change and then redeploy:</p>
<p><script src="https://gist.github.com/am-MongoDB/48c861d261f4d91a354485b06fc68776.js"></script></p>
<div id="attachment_4210" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Personalised_AWS_Elasticbeanstalk_App.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4210" src="./../../../wp-content/uploads/2016/09/Personalised_AWS_Elasticbeanstalk_App-1024x241.png" alt="Personalized Version of MongoPop Deployed to AWS EBS" width="480" height="113" class="size-large wp-image-4210" srcset="./../../../wp-content/uploads/2016/09/Personalised_AWS_Elasticbeanstalk_App-1024x241.png 1024w, ./../../../wp-content/uploads/2016/09/Personalised_AWS_Elasticbeanstalk_App-300x71.png 300w, ./../../../wp-content/uploads/2016/09/Personalised_AWS_Elasticbeanstalk_App-768x181.png 768w, ./../../../wp-content/uploads/2016/09/Personalised_AWS_Elasticbeanstalk_App.png 1952w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4210" class="wp-caption-text">Figure 8: Personalized Version of MongoPop Deployed to AWS EBS</p>
</div>
<p>When you&#8217;re finished with the application, the environment can be deleted with a single command:</p>
<p><script src="https://gist.github.com/am-MongoDB/7771e7c498d3b085b5784d32ecd07ea3.js"></script></p>
<p>Note that this doesn&#8217;t remove the application deployment files that Elastic Beanstalk keeps in AWS S3 storage. To avoid continuing charges, delete those files through the <a href="https://console.aws.amazon.com/s3">AWS console</a> (Figure 9).</p>
<div id="attachment_4211" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Remove_Files_from_AWS_S3_Storage.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4211" src="./../../../wp-content/uploads/2016/09/Remove_Files_from_AWS_S3_Storage-1024x734.png" alt="Remove Deployment Files From AWS S3 Storage" width="480" height="344" class="size-large wp-image-4211" srcset="./../../../wp-content/uploads/2016/09/Remove_Files_from_AWS_S3_Storage-1024x734.png 1024w, ./../../../wp-content/uploads/2016/09/Remove_Files_from_AWS_S3_Storage-300x215.png 300w, ./../../../wp-content/uploads/2016/09/Remove_Files_from_AWS_S3_Storage-768x551.png 768w, ./../../../wp-content/uploads/2016/09/Remove_Files_from_AWS_S3_Storage.png 1436w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4211" class="wp-caption-text">Figure 9: Remove Deployment Files From AWS S3 Storage</p>
</div>
<h1>Code Highlights</h1>
<p>The full code for MongoPop can be found in <a href="https://github.com/andrewjamesmorgan/mongopop">GitHub</a> but this section presents some snippets that are specific to MongoDB and MongoDB Atlas.</p>
<p>Firstly, constructing the final URI to access the database (from <code>views/pop.js</code>):</p>
<p><script src="https://gist.github.com/am-MongoDB/7fbd00a28851dd32f97b644f0460319c.js"></script></p>
<p>Connecting to the database and working with the collection (<code>javascripts/db.js</code>):</p>
<p><script src="https://gist.github.com/am-MongoDB/3bbc2e113c31bb9802a3b073712efec8.js"></script></p>
<p>All of the dependencies (including the MongoDB Node.js driver) are defined in <code>package.json</code>:</p>
<p><script src="https://gist.github.com/am-MongoDB/38887db8319434ec1928288a4cf39146.js"></script></p>
<h1>The IP Address Whitelisting Challenge</h1>
<p>IP address whitelisting is a key MongoDB Atlas security feature, adding an extra layer to prevent 3rd parties from accessing your data. Clients are prevented from accessing the database unless their IP address has been added to the <a href="https://docs.atlas.mongodb.com/setup-cluster-security/#add-ip-addresses-to-the-whitelist">IP whitelist</a> for your MongoDB Atlas group.</p>
<p>VPC Peering for MongoDB Atlas is under development and will be available soon, offering a simple, robust solution. It will allow the whitelisting of an entire AWS Security Group within the VPC containing your application servers.</p>
<p>If you need to deploy a robust, scalable application before VPC peering becomes available, some extra steps may be required.</p>
<p>In our example application, the public IP address of the AWS EC2 instance running MongoPop was added to the MongoDB Atlas whitelist for the group.</p>
<p>That works fine but what happens if that EC2 instance fails and is rescheduled – its IP Address changes and so it would not be able to connect to MongoDB Atlas until it was whitelisted. That scenario can be remedied by assigning an Elastic IP address (which survives rescheduling) to the EC2 instance using the <a href="https://console.aws.amazon.com/ec2">AWS Console</a>.</p>
<p>What if demand for your application grows and Elastic Beanstalk determines that it needs to add an extra EC2 instance? Again, that instance will have an IP Address that hasn&#8217;t yet been added to the MongoDB Atlas whitelist. To cover that scenario (as well as rescheduling), the AWS NAT Gateway service can be used. Figure 10 illustrates a configuration using a NAT Gateway.<br>
</p>
<div id="attachment_4212" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/NAT_Gateway_with_AWS_Elastic_Beanstalk.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4212" src="./../../../wp-content/uploads/2016/09/NAT_Gateway_with_AWS_Elastic_Beanstalk-1024x618.png" alt="Presenting a Single IP Address Using an AWS NAT Gateway" width="480" height="290" class="size-large wp-image-4212" srcset="./../../../wp-content/uploads/2016/09/NAT_Gateway_with_AWS_Elastic_Beanstalk-1024x618.png 1024w, ./../../../wp-content/uploads/2016/09/NAT_Gateway_with_AWS_Elastic_Beanstalk-300x181.png 300w, ./../../../wp-content/uploads/2016/09/NAT_Gateway_with_AWS_Elastic_Beanstalk-768x463.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4212" class="wp-caption-text">Figure 10: Presenting a Single IP Address Using an AWS NAT Gateway</p>
</div>
<p>Two subnets are created within the AWS Virtual Private Cloud (VPC):</p>
<ul>
<li>The <strong>public subnet</strong> contains the front-end servers which external clients access via an Elastic IP Address attached to the Internet Gateway (IGW). It also contains the NAT Gateway service.</li>
<li>The <strong>private subnet</strong> contains the back-end servers which will access MongoDB Atlas.</li>
</ul>
<p>Routing tables must be created to route all messages from the private subnet destined for public IP addresses through the NAT Gateway. The NAT Gateway has its own Elastic IP Address which all of the outgoing messages that pass through it appear to originate from – this IP Address must be added to the MongoDB Atlas whitelist.</p>
<p>Messages between the front-end and back-end servers use local IP Addresses and so are routed directly, without passing through the NAT Gateway. Messages from external clients are routed from the IGW to the front-end servers.</p>
<p>Clearly this configuration adds cost and complexity (e.g., the application needs breaking into front and back-end components).</p>
<p>An alternative is to add extra logic to your application so that it automatically adds its IP address to the whitelist using the <a href="https://docs.atlas.mongodb.com/api/">MongoDB Atlas Public API</a>. If taking that approach, then also consider how to remove redundant IP addresses as the whitelist is limited to 20 entries.</p>
<h1>What Next?</h1>
<p>While MongoDB Atlas radically simplifies the operation of MongoDB there are still some decisions to take to ensure the best performance and reliability for your application. The <a href="https://www.mongodb.com/collateral/mongodb-atlas-best-practices">MongoDB Atlas Best Practices white paper</a> provides guidance on best practices for deploying, managing, and optimizing the performance of your database with MongoDB Atlas.</p>
<p>The guide outlines considerations for achieving performance at scale with MongoDB Atlas across a number of key dimensions, including instance size selection, application patterns, schema design and indexing, and disk I/O. While this guide is broad in scope, it is not exhaustive. Following the recommendations in the guide will provide a solid foundation for ensuring optimal application performance.</p>
<p>Learn more about the capabilities of MongoDB Atlas and try it out for yourself <a href="https://www.mongodb.com/cloud">here</a>.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/develop-deploy-a-node-js-app-to-aws-elastic-beanstalk-mongodb-atlas" data-via="wpbeginner" data-text="Develop &#038; Deploy a Node.js App to AWS Elastic Beanstalk &#038; MongoDB Atlas" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/develop-deploy-a-node-js-app-to-aws-elastic-beanstalk-mongodb-atlas"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/develop-deploy-a-node-js-app-to-aws-elastic-beanstalk-mongodb-atlas" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Fdevelop-deploy-a-node-js-app-to-aws-elastic-beanstalk-mongodb-atlas&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../../../category/mongodb/index.html" rel="category tag">MongoDB</a> | 
Tags: <a href="./../../aws/index.html" rel="tag">AWS</a>, <a href="./../../elastic-beanstalk/index.html" rel="tag">Elastic Beanstalk</a>, <a href="./../../mongodb/index.html" rel="tag">mongodb</a>, <a href="./../../mongodb-atlas/index.html" rel="tag">MongoDB Atlas</a>, <a href="./../../node-js/index.html" rel="tag">node.js</a>
</div>

			</div>			<div id="post-4190" class="post-4190 post type-post status-publish format-standard hentry category-mongodb tag-apostrophe tag-express tag-javascript tag-mongodb tag-mongodb-atlas tag-node-js">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../../../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../../../mongodb/atlas_apostrophe/index.html">September 15, 2016</a>
			</div>
	<div class="postcomments">
		<a href="./../../../mongodb/atlas_apostrophe/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../../../mongodb/atlas_apostrophe/index.html" rel="bookmark">MongoDB Atlas as The Data Store for Apostrophe</a></h2>
				
				<div class="entry">
										<p>Apostrophe is a Content Management Systems that&#8217;s designed to build content-driven web sites. Because of their ease of use, Apostrophe is built upon MongoDB and Node.js.</p>
<p>This post explains why MongoDB Atlas is an ideal choice for Apostrophe and then goes on to show how to configure Apostrophe to use it.</p>
<h4>Why MongoDB Atlas is the Ideal Database for Apostrophe</h4>
<p>MongoDB delivers flexible schemas, rich queries, an idiomatic Node.js driver, and simple to use high availability and scaling. This makes it the go-to database for anyone looking to build applications on Node.js.</p>
<p><a href="https://www.mongodb.com/cloud">MongoDB Atlas</a> provides all of the features of MongoDB, without the operational heavy lifting required for any new application. MongoDB Atlas is available on demand through a pay-as-you-go model and billed on an hourly basis, letting you focus on what you do best.</p>
<p>It’s easy to get started – use a simple GUI to select the instance size, region, and features you need. MongoDB Atlas provides:</p>
<ul>
<li>Security features to protect access to your data</li>
<li>Built in replication for always-on availability, tolerating complete data center failure</li>
<li>Backups and point in time recovery to protect against data corruption</li>
<li>Fine-grained monitoring to let you know when to scale. Additional instances can be provisioned with the push of a button</li>
<li>Automated patching and one-click upgrades for new major versions of the database, enabling you to take advantage of the latest and greatest MongoDB features</li>
<li>A choice of cloud providers, regions, and billing options</li>
</ul>
<p>Like Apostrophe, MongoDB Atlas is a natural fit for users looking to simplify their development and operations work, letting them focus on what makes their application unique rather than commodity (albeit essential) plumbing.</p>
<h4>Installing Apostrophe and Setting it up to Use MongoDB Atlas</h4>
<p>Before starting with Apostrophe, you should launch your MongoDB cluster using <a href="https://www.mongodb.com/cloud">MongoDB Atlas</a> and then (optionally) create a user with read and write privileges for just the database that will be used for this project, as shown in Figure 1. You must also add the IP address of your application server to the IP Whitelist in the MongoDB Atlas security tab.</p>
<div id="attachment_4192" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Apostrophe_Create_DB_user.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4192" class="size-large wp-image-4192" src="./../../../wp-content/uploads/2016/09/Apostrophe_Create_DB_user-983x1024.png" alt="Creating an Apostrophe user in MongoDB Atlas" width="480" height="500" srcset="./../../../wp-content/uploads/2016/09/Apostrophe_Create_DB_user-983x1024.png 983w, ./../../../wp-content/uploads/2016/09/Apostrophe_Create_DB_user-288x300.png 288w, ./../../../wp-content/uploads/2016/09/Apostrophe_Create_DB_user-768x800.png 768w, ./../../../wp-content/uploads/2016/09/Apostrophe_Create_DB_user.png 1672w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4192" class="wp-caption-text">Figure 1:Creating an Apostrophe user in MongoDB Atlas</p>
</div>
<p>If it isn&#8217;t already installed on your system, download and install Node.js:</p>
<p><script src="https://gist.github.com/am-MongoDB/3bbb946bb35fd8054e95adf92b96f103.js"></script></p>
<p>You should then add the <code>bin</code> sub-folder to your <code>.bash_profile</code> file and then install ImageMagick (used by Apostrophe to handle image files); clone the Apostrophe Sandbox project; and then install its dependencies:</p>
<p><script src="https://gist.github.com/am-MongoDB/676b16c5fdeaa650a448378c1a0bbdac.js"></script></p>
<p>Before starting Apostrophe you need to configure it with details on how to connect to your specific MongoDB Atlas cluster. This is done by cloning the configuration file to <code>data/local.js</code>:</p>
<p><script src="https://gist.github.com/am-MongoDB/14d6019b0333b351685f3b077a93864d.js"></script></p>
<p>You should then edit the <code>data/local.js</code> file and set the <code>uri</code> parameter using the specific connection information provided for your MongoDB Atlas group:</p>
<p><script src="https://gist.github.com/am-MongoDB/2fdcb8c954ac831e8970543afbf5a1e4.js"></script></p>
<p>The URI contains these components:</p>
<ul>
<li>
<code>apostrophe_user</code> is the name of the user you created in the MongoDB Atlas UI</li>
<li>
<code>my_password</code> is the password you chose when creating the user in MongoDB Atlas</li>
<li>
<code>cluster0-shard-00-00-qfovx.mongodb.net</code>, <code>cluster0-shard-00-01-qfovx.mongodb.net</code>, &amp; <code>cluster0-shard-00-02-qfovx.mongodb.net</code> are the hostnames of the instances in your MongoDB Atlas replica set (click on the &#8220;CONNECT&#8221; button in the MongoDB Atlas UI if you don&#8217;t have these)</li>
<li>
<code>27017</code> is the standard MongoDB port number</li>
<li>
<code>clusterdb</code> is the name of the database (schema) that Apostrophe will use (note that this must match the project name used when installing Apostrophe as well as the database you granted the user access to</li>
<li>To enforce security, MongoDB Atlas mandates that the <code>ssl</code> option is used</li>
<li>
<code>admin</code> is the database that&#8217;s being used to store the credentials for <code>apostrophe_user</code>
</li>
</ul>
<p>Clients connect to Apostrophe through port 3000 and so you must open that port in your firewall.</p>
<p>You can then create the database and start Apostrophe:</p>
<p><script src="https://gist.github.com/am-MongoDB/000e19868892d5865a90a0e339286609.js"></script></p>
<h2>Testing the Application</h2>
<p>Browse to the application at <code>http://address-of-app-server:3000</code> as shown in Figure 2 and then login using the username <code>admin</code> and the password <code>demo</code>.</p>
<div id="attachment_4194" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Apostrophe.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4194" src="./../../../wp-content/uploads/2016/09/Apostrophe-1024x498.png" alt="Apostrophe Running on MongoDB Atlas" width="480" height="233" class="size-large wp-image-4194" srcset="./../../../wp-content/uploads/2016/09/Apostrophe-1024x498.png 1024w, ./../../../wp-content/uploads/2016/09/Apostrophe-300x146.png 300w, ./../../../wp-content/uploads/2016/09/Apostrophe-768x373.png 768w, ./../../../wp-content/uploads/2016/09/Apostrophe.png 1138w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4194" class="wp-caption-text">Figure 2: Apostrophe Running on MongoDB Atlas</p>
</div>
<p>Now, go ahead and add some content (Figure 3).</p>
<div id="attachment_4195" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/create_Apostrophe_post_on_MongoDB_Atlas.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4195" src="./../../../wp-content/uploads/2016/09/create_Apostrophe_post_on_MongoDB_Atlas-1024x668.png" alt="Edit Apostrophe Home Page with Data Stored in MongoDB Atlas" width="480" height="313" class="size-large wp-image-4195" srcset="./../../../wp-content/uploads/2016/09/create_Apostrophe_post_on_MongoDB_Atlas-1024x668.png 1024w, ./../../../wp-content/uploads/2016/09/create_Apostrophe_post_on_MongoDB_Atlas-300x196.png 300w, ./../../../wp-content/uploads/2016/09/create_Apostrophe_post_on_MongoDB_Atlas-768x501.png 768w, ./../../../wp-content/uploads/2016/09/create_Apostrophe_post_on_MongoDB_Atlas.png 1136w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4195" class="wp-caption-text">Figure 3: Edit Apostrophe Home Page with Data Stored in MongoDB Atlas</p>
</div>
<p>Upload some images as shown in Figure 4.</p>
<div id="attachment_4196" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Apostrophe_add_images.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4196" src="./../../../wp-content/uploads/2016/09/Apostrophe_add_images-1024x673.png" alt="Upload Images to Apostrophe on MongoDB Atlas" width="480" height="315" class="size-large wp-image-4196" srcset="./../../../wp-content/uploads/2016/09/Apostrophe_add_images-1024x673.png 1024w, ./../../../wp-content/uploads/2016/09/Apostrophe_add_images-300x197.png 300w, ./../../../wp-content/uploads/2016/09/Apostrophe_add_images-768x505.png 768w, ./../../../wp-content/uploads/2016/09/Apostrophe_add_images.png 1142w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4196" class="wp-caption-text">Figure 4: Upload Images to Apostrophe on MongoDB Atlas</p>
</div>
<p>Optionally, to confirm that, MongoDB Atlas really is being used by Apostrophe, you can connect using the MongoDB shell:</p>
<p><script src="https://gist.github.com/am-MongoDB/6c3f3ff8df99ee12e1b963f6851f9441.js"></script></p>
<p>To visually navigate through the schema and data created by Apostrophe, <a href="https://www.mongodb.com/download-center?jmp=nav#compass">download and install MongoDB Compass</a>. Use your MongoDB Atlas credentials to connect Compass to your MongoDB database – Figure 5.</p>
<div id="attachment_4197" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Connect_Compass_to_MongoDB_Atlas.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4197" src="./../../../wp-content/uploads/2016/09/Connect_Compass_to_MongoDB_Atlas-1024x839.png" alt="Connect MongoDB Compass to MongoDB Atlas" width="480" height="393" class="size-large wp-image-4197" srcset="./../../../wp-content/uploads/2016/09/Connect_Compass_to_MongoDB_Atlas-1024x839.png 1024w, ./../../../wp-content/uploads/2016/09/Connect_Compass_to_MongoDB_Atlas-300x246.png 300w, ./../../../wp-content/uploads/2016/09/Connect_Compass_to_MongoDB_Atlas-768x629.png 768w, ./../../../wp-content/uploads/2016/09/Connect_Compass_to_MongoDB_Atlas.png 1802w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4197" class="wp-caption-text">Figure 5: Connect MongoDB Compass to MongoDB Atlas</p>
</div>
<p>Navigate through the structure of the data in the <code>clusterdb</code> database (Figure 6) and view the JSON documents (Figure 7).</p>
<div id="attachment_4198" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Compass_Apostrophe_Schema.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4198" src="./../../../wp-content/uploads/2016/09/Compass_Apostrophe_Schema-1024x631.png" alt="Explore Apostrophe Schema Using MongoDB Compass" width="480" height="296" class="size-large wp-image-4198" srcset="./../../../wp-content/uploads/2016/09/Compass_Apostrophe_Schema-1024x631.png 1024w, ./../../../wp-content/uploads/2016/09/Compass_Apostrophe_Schema-300x185.png 300w, ./../../../wp-content/uploads/2016/09/Compass_Apostrophe_Schema-768x473.png 768w, ./../../../wp-content/uploads/2016/09/Compass_Apostrophe_Schema.png 1282w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4198" class="wp-caption-text">Figure 6: Explore Apostrophe Schema Using MongoDB Compass</p>
</div>
<div id="attachment_4199" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Compass_Apostrophe_Data.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4199" src="./../../../wp-content/uploads/2016/09/Compass_Apostrophe_Data-1024x630.png" alt="View Apostrophe Documents in MongoDB Compass" width="480" height="295" class="size-large wp-image-4199" srcset="./../../../wp-content/uploads/2016/09/Compass_Apostrophe_Data-1024x630.png 1024w, ./../../../wp-content/uploads/2016/09/Compass_Apostrophe_Data-300x185.png 300w, ./../../../wp-content/uploads/2016/09/Compass_Apostrophe_Data-768x473.png 768w, ./../../../wp-content/uploads/2016/09/Compass_Apostrophe_Data.png 1279w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4199" class="wp-caption-text">Figure 7: View Apostrophe Documents in MongoDB Compass</p>
</div>
<h4>What Next?</h4>
<p>While MongoDB Atlas radically simplifies the operation of MongoDB there are still some decisions to take to ensure the best performance and reliability for your application. The <a href="https://www.mongodb.com/collateral/mongodb-atlas-best-practices">MongoDB Atlas Best Practices white paper</a> provides guidance on best practices for deploying, managing, and optimizing the performance of your database with MongoDB Atlas.</p>
<p>The guide outlines considerations for achieving performance at scale with MongoDB Atlas across a number of key dimensions, including instance size selection, application patterns, schema design and indexing, and disk I/O. While this guide is broad in scope, it is not exhaustive. Following the recommendations in the guide will provide a solid foundation for ensuring optimal application performance.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/atlas_apostrophe" data-via="wpbeginner" data-text="MongoDB Atlas as The Data Store for Apostrophe" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/atlas_apostrophe"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/atlas_apostrophe" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Fatlas_apostrophe&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../../../category/mongodb/index.html" rel="category tag">MongoDB</a> | 
Tags: <a href="./../../apostrophe/index.html" rel="tag">apostrophe</a>, <a href="./../../express/index.html" rel="tag">Express</a>, <a href="./../../javascript/index.html" rel="tag">javascript</a>, <a href="./../../mongodb/index.html" rel="tag">mongodb</a>, <a href="./../../mongodb-atlas/index.html" rel="tag">MongoDB Atlas</a>, <a href="./../../node-js/index.html" rel="tag">node.js</a>
</div>

			</div>			<div id="post-4171" class="post-4171 post type-post status-publish format-standard hentry category-mongodb tag-containers tag-docker tag-kubernetes tag-microservices tag-mongodb">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../../../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../../../mongodb/running-mongodb-as-a-microservice-with-docker-and-kubernetes/index.html">September 15, 2016</a>
			</div>
	<div class="postcomments">
		<a href="./../../../mongodb/running-mongodb-as-a-microservice-with-docker-and-kubernetes/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../../../mongodb/running-mongodb-as-a-microservice-with-docker-and-kubernetes/index.html" rel="bookmark">Running MongoDB as a Microservice with Docker and Kubernetes</a></h2>
				
				<div class="entry">
										<h2>
<a id="user-content-introduction" class="anchor" href="#introduction"></a>Introduction</h2>
<p>Want to try out MongoDB on your laptop? Execute a single command and you have a lightweight, self-contained sandbox; another command removes all traces when you&#8217;re done.</p>
<p>Need an identical copy of your application stack in multiple environments? Build your own container image and let your development, test, operations, and support teams launch an identical clone of your environment.</p>
<p>Containers are revolutionizing the entire software lifecycle: from the earliest technical experiments and proofs of concept through development, test, deployment, and support.</p>
<p>Orchestration tools manage how multiple containers are created, upgraded and made highly available. Orchestration also controls how containers are connected to build sophisticated applications from multiple, microservice containers.</p>
<p>The rich functionality, simple tools, and powerful APIs make container and orchestration functionality a favorite for DevOps teams who integrate them into Continuous Integration (CI) and Continuous Delivery (CD) workflows.</p>
<p>This post delves into the extra challenges you face when attempting to run and orchestrate MongoDB in containers and illustrates how these challenges can be overcome.</p>
<h2>
<a id="user-content-considerations-for-mongodb" class="anchor" href="#considerations-for-mongodb"></a>Considerations for MongoDB</h2>
<p>Running MongoDB with containers and orchestration introduces some additional considerations:</p>
<ul>
<li>MongoDB database nodes are stateful. In the event that a container fails, and is rescheduled, it&#8217;s undesirable for the data to be lost (it could be recovered from other nodes in the replica set, but that takes time). To solve this, features such as the <em>Volume</em> abstraction in Kubernetes can be used to map what would otherwise be an ephemeral MongoDB data directory in the container to a persistent location where the data survives container failure and rescheduling.</li>
<li>MongoDB database nodes within a replica set must communicate with each other – including after rescheduling. All of the nodes within a replica set must know the addresses of all of their peers, but when a container is rescheduled, it is likely to be restarted with a different IP Address. For example, all containers within a Kubernetes Pod share a single IP address, which changes when the pod is rescheduled. With Kubernetes, this can be handled by associating a Kubernetes Service with each MongoDB node, which uses the Kubernetes DNS service to provide a <code>hostname</code> for the service that remains constant through rescheduling.</li>
<li>Once each of the individual MongoDB nodes is running (each within its own container), the replica set must be initialized and each node added. This is likely to require some additional logic beyond that offered by off the shelf orchestration tools. Specifically, one MongoDB node within the intended replica set must be used to execute the <code>rs.initiate</code> and <code>rs.add</code> commands.</li>
<li>If the orchestration framework provides automated rescheduling of containers (as Kubernetes does) then this can increase MongoDB&#8217;s resiliency since a failed replica set member can be automatically recreated, thus restoring full redundancy levels without human intervention.</li>
<li>It should be noted that while the orchestration framework might monitor the state of the containers, it is unlikely to monitor the applications running within the containers, or backup their data. That means it&#8217;s important to use a strong monitoring and backup solution such as <a href="https://www.mongodb.com/cloud/">MongoDB Cloud Manager</a>, included with <a href="https://www.mongodb.com/products/mongodb-enterprise-advanced">MongoDB Enterprise Advanced</a> and <a href="https://www.mongodb.com/products/mongodb-professional">MongoDB Professional</a>. Consider creating your own image that contains both your preferred version of MongoDB and the <a href="https://docs.cloud.mongodb.com/tutorial/nav/install-automation-agent/">MongoDB Automation Agent</a>.</li>
</ul>
<h2>
<a id="user-content-implementing-a-mongodb-replica-set-using-docker-and-kubernetes" class="anchor" href="#implementing-a-mongodb-replica-set-using-docker-and-kubernetes"></a>Implementing a MongoDB Replica Set using Docker and Kubernetes</h2>
<p>As described in the previous section, distributed databases such as MongoDB require a little extra attention when being deployed with orchestration frameworks such as Kubernetes. This section goes to the next level of detail, showing how this can actually be implemented.</p>
<p>This section starts by creating the entire MongoDB replica set in a single Kubernetes cluster (which would normally be within a single data center – that clearly doesn&#8217;t provide geographic redundancy. In reality, little has to be changed to run across multiple clusters and those steps are described later.</p>
<p>Each member of the replica set will be run as its own pod with a service exposing an external IP address and port. This &#8216;fixed&#8217; IP address is important as both external applications and other replica set members can rely on it remaining constant in the event that a pod is rescheduled.</p>
<p>The following diagram illustrates one of these pods and the associated Replication Controller and service.</p>
<div id="attachment_4173" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/MongoDB_pod.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4173" class="size-large wp-image-4173" src="./../../../wp-content/uploads/2016/09/MongoDB_pod-1024x521.png" alt="MongoDB Replica Set member configured as a Kubernetes Pod and exposed as a service" width="480" height="244" srcset="./../../../wp-content/uploads/2016/09/MongoDB_pod-1024x521.png 1024w, ./../../../wp-content/uploads/2016/09/MongoDB_pod-300x153.png 300w, ./../../../wp-content/uploads/2016/09/MongoDB_pod-768x391.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4173" class="wp-caption-text">Figure 1: MongoDB Replica Set member as a Kubernetes Pod</p>
</div>
<p>Stepping through the resources described in that configuration we have:</p>
<ul>
<li>Starting at the core there is a single container named <code>mongo-node1</code>. <code>mongo-node1</code> includes an image called <code>mongo</code> which is a publicly available MongoDB container image hosted on <a href="https://hub.docker.com/_/mongo/">Docker Hub</a>. The container exposes port <code>27107</code> within the cluster.</li>
<li>The Kubernetes <em>volumes</em> feature is used to map the <code>/data/db</code> directory within the connector to the persistent storage element named <code>mongo-persistent-storage1</code>; which in turn is mapped to a disk named <code>mongodb-disk1</code> created in the Google Cloud. This is where MongoDB would store its data so that it is persisted over container rescheduling.</li>
<li>The container is held within a pod which has the labels to name the pod <code>mongo-node</code> and provide an (arbitrary) instance name of <code>rod</code>.</li>
<li>A Replication Controller named <code>mongo-rc1</code> is configured to ensure that a single instance of the <code>mongo-node1</code> pod is always running.</li>
<li>The <code>LoadBalancer</code> service named <code>mongo-svc-a</code> exposes an IP Address to the outside world together with the port of <code>27017</code> which is mapped to the same port number in the container. The service identifies the correct pod using a selector that matches the pod&#8217;s labels. That external IP Address and port will be used by both an application and for communication between the replica set members. There are also local IP addresses for each container, but those change when containers are moved or restarted, and so aren&#8217;t of use for the replica set.</li>
</ul>
<p>The next diagram shows the configuration for a second member of the replica set.</p>
<div id="attachment_4174" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Second_replica_set_member.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4174" class="size-large wp-image-4174" src="./../../../wp-content/uploads/2016/09/Second_replica_set_member-1024x518.png" alt="Second MongoDB Replica Set member configured as a Kubernetes Pod" width="480" height="243" srcset="./../../../wp-content/uploads/2016/09/Second_replica_set_member-1024x518.png 1024w, ./../../../wp-content/uploads/2016/09/Second_replica_set_member-300x152.png 300w, ./../../../wp-content/uploads/2016/09/Second_replica_set_member-768x389.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4174" class="wp-caption-text">Figure 2: Second MongoDB Replica Set member configured as a Kubernetes Pod</p>
</div>
<p>90% of the configuration is the same, with just these changes:</p>
<ul>
<li>The disk and volume names must be unique and so <code>mongodb-disk2</code> and <code>mongo-persistent-storage2</code> are used</li>
<li>The Pod is assigned a label of <code>instance: jane</code> and <code>name: mongo-node2</code> so that the new service can distinguish it (using a selector) from the <code>rod</code> Pod used in Figure 1.</li>
<li>The Replication Controller is named <code>mongo-rc2</code>
</li>
<li>The Service is named <code>mongo-svc-b</code> and gets a unique, external IP Address (in this instance, Kubernetes has assigned <code>104.1.4.5</code>)</li>
</ul>
<p>The configuration of the third replica set member follows the same pattern and the following figure shows the complete replica set:</p>
<div id="attachment_4175" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/full_replica_set.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4175" class="size-large wp-image-4175" src="./../../../wp-content/uploads/2016/09/full_replica_set-673x1024.png" alt="Full Replica Set member configured as a Kubernetes Service" width="480" height="730" srcset="./../../../wp-content/uploads/2016/09/full_replica_set-673x1024.png 673w, ./../../../wp-content/uploads/2016/09/full_replica_set-197x300.png 197w, ./../../../wp-content/uploads/2016/09/full_replica_set-768x1168.png 768w, ./../../../wp-content/uploads/2016/09/full_replica_set.png 1416w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4175" class="wp-caption-text">Figure3: Full Replica Set member configured as a Kubernetes Service</p>
</div>
<p>Note that even if running the configuration shown in Figure 3 on a Kubernetes cluster of three or more nodes, Kubernetes may (and often will) schedule two or more MongoDB replica set members on the same host. This is because Kubernetes views the three pods as belonging to three independent services.</p>
<p>To increase redundancy (within the zone), an additional <em>headless</em> service can be created. The new service provides no capabilities to the outside world (and will not even have an IP address) but it serves to inform Kubernetes that the three MongoDB pods form a service and so Kubernetes will attempt to schedule them on different nodes.</p>
<div id="attachment_4176" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/Antiafinity_for_MongoDB_replica_set_nodes.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4176" class="size-large wp-image-4176" src="./../../../wp-content/uploads/2016/09/Antiafinity_for_MongoDB_replica_set_nodes-1024x411.png" alt="Figure 4: Headless service to avoid co-locating of MongoDB replica set members" width="480" height="193" srcset="./../../../wp-content/uploads/2016/09/Antiafinity_for_MongoDB_replica_set_nodes-1024x411.png 1024w, ./../../../wp-content/uploads/2016/09/Antiafinity_for_MongoDB_replica_set_nodes-300x120.png 300w, ./../../../wp-content/uploads/2016/09/Antiafinity_for_MongoDB_replica_set_nodes-768x308.png 768w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4176" class="wp-caption-text">Figure 4: Headless service to avoid co-locating of MongoDB replica set members</p>
</div>
<p>The actual configuration files and the commands needed to orchestrate and start the MongoDB replica set can be found in the <a title="Enabling Microservices: Containers &amp; Orchestration Explained" href="https://www.mongodb.com/collateral/microservices-containers-and-orchestration-explained">Enabling Microservices: Containers &amp; Orchestration Explained white paper</a>. In particular, there are some special steps required to combine the three MongoDB instances into a functioning, robust replica set which are described in the paper.</p>
<h3>
<a id="user-content-multiple-availability-zone-mongodb-replica-set" class="anchor" href="#multiple-availability-zone-mongodb-replica-set"></a>Multiple Availability Zone MongoDB Replica Set</h3>
<p>There is risk associated with the replica set created above in that everything is running in the same GCE cluster, and hence in the same availability zone. If there were a major incident that took the availability zone offline, then the MongoDB replica set would be unavailable. If geographic redundancy is required, then the three pods should be run in three different availability zones or regions.</p>
<p>Surprisingly little needs to change in order to create a similar replica set that is split between three zones – which requires three clusters. Each cluster requires its own Kubernetes YAML file that defines just the pod, Replication Controller and service for one member of the replica set. It is then a simple matter to create a cluster, persistent storage, and MongoDB node for each zone.</p>
<div id="attachment_4177" style="width: 490px" class="wp-caption aligncenter">
<a href="./../../../wp-content/uploads/2016/09/geo_replica_set.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4177" class="size-large wp-image-4177" src="./../../../wp-content/uploads/2016/09/geo_replica_set-1024x413.png" alt="Replica set running over multiple availability zones/regions" width="480" height="194" srcset="./../../../wp-content/uploads/2016/09/geo_replica_set-1024x413.png 1024w, ./../../../wp-content/uploads/2016/09/geo_replica_set-300x121.png 300w, ./../../../wp-content/uploads/2016/09/geo_replica_set-768x310.png 768w, ./../../../wp-content/uploads/2016/09/geo_replica_set.png 1912w" sizes="auto, (max-width: 480px) 100vw, 480px"></a><p id="caption-attachment-4177" class="wp-caption-text">Figure 5: Replica set running over multiple availability zones/regions</p>
</div>
<h2>
<a id="user-content-next-steps" class="anchor" href="#next-steps"></a>Next Steps</h2>
<p>To learn more about containers and orchestration – both the technologies involved and the business benefits they deliver – read the <a title="Enabling Microservices: Containers &amp; Orchestration Explained" href="https://www.mongodb.com/collateral/microservices-containers-and-orchestration-explained">Enabling Microservices: Containers &amp; Orchestration Explained white paper</a>. The same paper provides the complete instructions to get the replica set described in this post up and running on Docker and Kubernetes in the Google Container Engine.</p>
<p>Watch this <a href="https://www.mongodb.com/webinar/enabling-microservices-with-containers-orchestration-and-mongodb">webinar recording</a> to learn more on this topic and see a live demo putting it all together.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/running-mongodb-as-a-microservice-with-docker-and-kubernetes" data-via="wpbeginner" data-text="Running MongoDB as a Microservice with Docker and Kubernetes" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/running-mongodb-as-a-microservice-with-docker-and-kubernetes"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/running-mongodb-as-a-microservice-with-docker-and-kubernetes" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Frunning-mongodb-as-a-microservice-with-docker-and-kubernetes&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../../../category/mongodb/index.html" rel="category tag">MongoDB</a> | 
Tags: <a href="./../../containers/index.html" rel="tag">containers</a>, <a href="./../../docker/index.html" rel="tag">docker</a>, <a href="./../../kubernetes/index.html" rel="tag">Kubernetes</a>, <a href="./../../microservices/index.html" rel="tag">microservices</a>, <a href="./../../mongodb/index.html" rel="tag">mongodb</a>
</div>

			</div>			<div id="post-4155" class="post-4155 post type-post status-publish format-standard hentry category-mongodb tag-3-2 tag-excel tag-mongodb tag-mongodb-3-2 tag-odbc tag-sql tag-windows">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../../../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../../../mongodb/analyzing-data-in-microsoft-excel-with-the-mongodb-connector-for-bi/index.html">January 22, 2016</a>
			</div>
	<div class="postcomments">
		<a href="./../../../mongodb/analyzing-data-in-microsoft-excel-with-the-mongodb-connector-for-bi/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../../../mongodb/analyzing-data-in-microsoft-excel-with-the-mongodb-connector-for-bi/index.html" rel="bookmark">Analyzing Data in Microsoft Excel with the MongoDB Connector for BI</a></h2>
				
				<div class="entry">
										<p>There are many great BI tools out there that enable powerful analytics and data visualization but sometimes the right tool for the job is the one you already have sitting on your laptop.</p>
<p>MongoDB 3.2 introduced the <a href="https://www.mongodb.com/products/bi-connector">MongoDB Connector for BI</a> which presents an SQL API to allow BI tools to read data from your database in real-time. Typically, this functionality will be showcased with specialized tools such as <a href="https://www.mongodb.com/webinar/live-data-visualisation-with-tableau-and-mongodb">Tableau</a> but it’s equally applicable to Microsoft’s ubiquitous Excel.</p>
<p>This video demonstrates how to connect Excel running on Microsoft Windows to the BI connector and then fetch data from MongoDB.</p>
<div style="width: 480px;" class="wp-video">
<!--[if lt IE 9]><script>document.createElement('video');</script><![endif]-->
<video class="wp-video-shortcode" id="video-4155-1" width="480" height="270" preload="metadata" controls="controls"><source type="video/mp4" src="http://clusterdb.com/upload/BI_Connector_with_Excel.mp4?_=1"><a href="http://clusterdb.com/upload/BI_Connector_with_Excel.mp4">http://clusterdb.com/upload/BI_Connector_with_Excel.mp4</a></video>
</div>
<p>&nbsp;</p>
<p>The instructions in the demo assume that you already have a MongoDB database running together with a configured instance of the MongoDB Connector for BI – the <a href="https://docs.mongodb.org/manual/products/bi-connector/">documentation</a> explains how to set that up.</p>
<p>Note that Excel is not able to handle the &#8220;.&#8221; character or capital letters in table of column names. To overcome this, it was necessary to edit the DRDL file produced by the mongodrdl tool to map names to lowercase equivalents and to replace each &#8220;.&#8221; (used to flatten embedded documents) with a &#8220;_&#8221;; this requires v1.1 or later of the BI connector.</p>
<p>The MongoDB Connector for BI is part of <a href="https://www.mongodb.com/products/mongodb-enterprise-advanced">MongoDB Enterprise Advanced</a>; it can be freely downloaded for evaluation – why not <a href="https://www.mongodb.com/download-center#bi-connector">try it out for yourself</a>.</p>
<p>More information on the BI connector as well as other MongoDB 3.2 features can be found in <a href="https://www.mongodb.com/collateral/mongodb-3-2-whats-new">MongoDB 3.2: What’s New</a>.</p>
					<div class="clear"></div>
									</div>
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/analyzing-data-in-microsoft-excel-with-the-mongodb-connector-for-bi" data-via="wpbeginner" data-text="Analyzing Data in Microsoft Excel with the MongoDB Connector for BI" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/analyzing-data-in-microsoft-excel-with-the-mongodb-connector-for-bi"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/analyzing-data-in-microsoft-excel-with-the-mongodb-connector-for-bi" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Fanalyzing-data-in-microsoft-excel-with-the-mongodb-connector-for-bi&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../../../category/mongodb/index.html" rel="category tag">MongoDB</a> | 
Tags: <a href="./../../3-2/index.html" rel="tag">3.2</a>, <a href="./../../excel/index.html" rel="tag">Excel</a>, <a href="./../../mongodb/index.html" rel="tag">mongodb</a>, <a href="./../../mongodb-3-2/index.html" rel="tag">MongoDB 3.2</a>, <a href="./../../odbc/index.html" rel="tag">ODBC</a>, <a href="./../../sql/index.html" rel="tag">sql</a>, <a href="./../../windows/index.html" rel="tag">Windows</a>
</div>

			</div>			<div id="post-4140" class="post-4140 post type-post status-publish format-standard hentry category-mongodb tag-aggregation tag-join tag-mongodb tag-mongodb-3-2">
				
				<div class="postmeta">	<div class="postmeta_links">
		<a href="./../../../author/andrew/index.html" title="Posts by andrew" rel="author">andrew</a> |
		<a href="./../../../mongodb/joins-and-other-aggregation-enhancements-in-mongodb-3-2/index.html">November 6, 2015</a>
			</div>
	<div class="postcomments">
		<a href="./../../../mongodb/joins-and-other-aggregation-enhancements-in-mongodb-3-2/index.html#respond">No comments</a>	</div>
	<div class="clear"></div>
</div>

				<h2 class="post-title"><a href="./../../../mongodb/joins-and-other-aggregation-enhancements-in-mongodb-3-2/index.html" rel="bookmark">Joins and Other Aggregation Enhancements in MongoDB 3.2</a></h2>
				
				<div class="entry">
										<p>This post looks at the aggregation enhancements being introduced in MongoDB 3.2 – most notably <code>$lookup</code> which implements left-outer equi-joins in the MongoDB Aggregation Framework. The material was originally published in a <a href="https://www.mongodb.com/blog/post/joins-and-other-aggregation-enhancements-coming-in-mongodb-3-2-part-1-of-3-introduction" title="Joins and Other Aggregation Enhancements Coming in MongoDB 3.2">MongoDB blog series</a>.</p>
<p>It starts with an introduction to analyzing data with MongoDB. We then explain why joins are sometimes useful for MongoDB – in spite of the strengths of the document model – and how developers have been working without them. It then works through examples of building aggregation pipelines – including using the operators added in MongoDB 3.2. After that, we look at how geolocation data can be included as well as what to do when you reach the limit of what can be done using a single pipeline – including adding wrapper code. Finally, there&#8217;s a summary of some of the limitations of the Aggregation Framework and reasons why you might supplement it with a full visualization solution such as <a href="http://www.tableau.com/">Tableau</a> together with MongoDB&#8217;s Connector for BI (Business Intelligence) – also new in MongoDB 3.2.</p>
<h2>
<a id="user-content-disclaimer" class="anchor" href="#disclaimer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Disclaimer</h2>
<p>MongoDB&#8217;s product plans are for informational purposes only. MongoDB&#8217;s plans may change and you should not rely on them for delivery of a specific feature at a specific time.</p>
<h2>
<a id="user-content-real-time-analytics-and-search" class="anchor" href="#real-time-analytics-and-search" aria-hidden="true"><span class="octicon octicon-link"></span></a>Real-Time Analytics and Search</h2>
<p>With the emergence of new data sources such as social media, mobile applications and sensor-equipped “Internet of Things” networks, organizations can extend analytics to deliver real-time insight and discovery into such areas as operational performance, customer satisfaction, and competitor behavior.</p>
<p>Time to value is everything. For example, having access to real-time customer sentiment or fleet tracking is of little benefit unless the data can be analyzed and reported in real-time.</p>
<p>MongoDB 3.2 aims to extend the options for performing analytics on the live, operational database – ensuring that answers are delivered quickly, and reflect current data. Work that would previously have needed to be done on the client side can now be performed by the database – freeing the developer to focus on new features. </p>
<h2>
<a id="user-content-the-case-for-joins" class="anchor" href="#the-case-for-joins" aria-hidden="true"><span class="octicon octicon-link"></span></a>The Case for Joins</h2>
<p>MongoDB’s document data model is flexible and provides developers many options in terms of modeling their data. Most of the time all the data for a record tends to be located in a single document. For the operational application, accessing data is simple, high performance, and easy to scale with this approach. </p>
<p>When it comes to analytics and reporting, however, it is possible that the data you need to access spans multiple collections. This is illustrated in Figure 1, where the <code>_id</code> field of multiple documents from the <code>products</code> collection is included in a document from the <code>orders</code> collection. For a query to analyze orders and details about their associated products, it must fetch the order document from the <code>orders</code> collection and then use the embedded references to read multiple documents from the <code>products</code> collection. Prior to MongoDB 3.2, this work is implemented in application code. However, this adds complexity to the application and requires multiple round trips to the database, which can impact performance.</p>
<p><a href="https://camo.githubusercontent.com/381f8bf25b13cc8ed82c317cf62a273a5a555a10/687474703a2f2f636c757374657264622e636f6d2f75706c6f61642f53696d756c617465644c6566744f757465724a6f696e732e706e67" target="_blank"><img decoding="async" src="https://camo.githubusercontent.com/381f8bf25b13cc8ed82c317cf62a273a5a555a10/687474703a2f2f636c757374657264622e636f6d2f75706c6f61642f53696d756c617465644c6566744f757465724a6f696e732e706e67" alt="Application-Layer simulation of joins between documents" title="Application-Layer simulation of joins between documents" data-canonical-src="http://clusterdb.com/upload/SimulatedLeftOuterJoins.png" style="max-width:100%;"></a><br>
<em>Figure 1: Application-Layer simulation of joins between documents</em></p>
<p>MongoDB 3.2 introduces the <code>$lookup</code> operator that can now be included as a stage in an aggregation pipeline. With this approach, the work of combining data from the orders and products collections is implemented within the database, and as part of a broader aggregation pipeline that performs other processing in a single query. As a result, there is less work to code in the application, and fewer round trips to the database. You can think about $lookup as equivalent to a left outer equi-join.</p>
<h3>
<a id="user-content-aside---what-is-a-left-outer-equi-join" class="anchor" href="#aside---what-is-a-left-outer-equi-join" aria-hidden="true"><span class="octicon octicon-link"></span></a>Aside &#8211; What is a Left Outer Equi-Join?</h3>
<p>A left outer equi-join produces a result set that contains data for all documents from the left table (collection) together with data from the right table (collection) for documents where there is a match with documents from the left table (collection). This is illustrated in Figure 2.</p>
<p><a href="https://camo.githubusercontent.com/3fd23b37ace2ba08cfb3744f7744ab11de630aa1/687474703a2f2f636c757374657264622e636f6d2f75706c6f61642f4c6566745f4f757465725f4a6f696e2e706e67" target="_blank"><img decoding="async" src="https://camo.githubusercontent.com/3fd23b37ace2ba08cfb3744f7744ab11de630aa1/687474703a2f2f636c757374657264622e636f6d2f75706c6f61642f4c6566745f4f757465725f4a6f696e2e706e67" alt="Left-Outer join between tables/collections" title="Left-Outer join between tables/collections" data-canonical-src="http://clusterdb.com/upload/Left_Outer_Join.png" style="max-width:100%;"></a><br>
<em>Figure 2: Left-Outer join between collections</em></p>
<h2>
<a id="user-content-mongodbs-aggregation-framework" class="anchor" href="#mongodbs-aggregation-framework" aria-hidden="true"><span class="octicon octicon-link"></span></a>MongoDB&#8217;s Aggregation Framework</h2>
<p>The Aggregation Framework is a pipeline for data aggregation modeled on the concept of data processing pipelines. Documents enter a multi-stage pipeline that transforms the documents into aggregated results. The pipeline consists of stages; each stage transforms the documents as they pass through.</p>
<p>In general, each successive stage reduces the volume of data; removing information that isn&#8217;t needed and combining other data to produce summarized results.</p>
<p>Figure 3 shows a conceptual model for the Aggregation Framework pipeline. This is what&#8217;s happening at each stage:</p>
<ul>
<li>On the left-hand side/start of the pipeline is the original collection contents – each record (document) containing a number of shapes (keys), each with a particular color (value)</li>
<li>The <code>$match</code> stage filters out any documents that don&#8217;t contain a red diamond</li>
<li>The <code>$project</code> stage adds a new “square” attribute with a value computed from the value (color) of the snowflake and triangle attributes</li>
<li>The <code>$lookup</code> stage (new in 3.2 &#8211; more details later) performs a left-outer join with another collection, with the star being the comparison key. This creates new documents which contain everything from the previous stage but augmented with data from any document from the second collection containing a matching colored star (i.e., the blue and yellow stars had matching “lookup” values, whereas the red star had none).</li>
<li>Finally, the <code>$group</code> stage groups the data by the color of the square and produces statistics (sum, average and standard deviation) for each group.</li>
</ul>
<p><a href="https://camo.githubusercontent.com/4861c2c6c2d2e68978a8e8c7e97c3e8b3dd0114c/687474703a2f2f7777772e636c757374657264622e636f6d2f75706c6f61642f4d6f6e676f44425f4167677265676174696f6e5f506970656c696e652e706e67" target="_blank"><img decoding="async" src="https://camo.githubusercontent.com/4861c2c6c2d2e68978a8e8c7e97c3e8b3dd0114c/687474703a2f2f7777772e636c757374657264622e636f6d2f75706c6f61642f4d6f6e676f44425f4167677265676174696f6e5f506970656c696e652e706e67" alt="MongoDB Aggregation Framework Pipeline" title="MongoDB Aggregation Framework Pipeline" data-canonical-src=".//upload/MongoDB_Aggregation_Pipeline.png" style="max-width:100%;"></a><br>
<em>Figure 3: MongoDB Aggregation Framework pipeline</em></p>
<p>This is the full set of aggregation stages:</p>
<ul>
<li>
<code>$match</code> – Filter documents</li>
<li>
<code>$geoNear</code> – Sort documents based on geographic proximity</li>
<li>
<code>$project</code> – Reshape documents (remove or rename keys or add new data based on calculations on the existing data)</li>
<li>
<code>$lookup</code> – <strong>Coming in 3.2</strong> – Left-outer joins</li>
<li>
<code>$unwind</code> – Expand documents (for example create multiple documents where each contains one element from an array from the original document)</li>
<li>
<code>$group</code> – Summarize documents</li>
<li>
<code>$sample</code> – Randomly selects a subset of documents</li>
<li>
<code>$sort</code> – Order documents</li>
<li>
<code>$skip</code> – Jump over a number of documents</li>
<li>
<code>$limit</code> – Limit number of documents</li>
<li>
<code>$redact</code> – Restrict sensitive content from documents</li>
<li>
<code>$out</code> – <em>Coming in 3.2</em>* – store the results in a new collection</li>
</ul>
<p>The details can be found in the <a href="http://docs.mongodb.org/manual/reference/operator/aggregation-pipeline/" title="Pipeline Aggregation Stages">documentation</a>.</p>
<h3>
<a id="user-content-new-aggregation-operators-in-mongodb-32" class="anchor" href="#new-aggregation-operators-in-mongodb-32" aria-hidden="true"><span class="octicon octicon-link"></span></a>New Aggregation Operators in MongoDB 3.2</h3>
<p>There are operators used within each stage and this set is being extended in MongoDB 3.2 to include:</p>
<ul>
<li>Array operations
<ul>
<li>
<code>$slice</code>, <code>$arrayElemAt</code>, <code>$concatArrays</code>, <code>$isArray</code>, <code>$filter</code>, <code>$min</code>, <code>$max</code>, <code>$avg</code> and <code>$sum</code> (some of these were previously available in a <code>$group</code> stage but not in <code>$project</code>
</li>
</ul>
</li>
<li>Standard Deviations
<ul>
<li>
<code>$stdDevSamp</code> (based on a sample) and <code>$stdDevPop</code> (based on the complete population)</li>
</ul>
</li>
<li>Square Root
<ul>
<li><code>$sqrt</code></li>
</ul>
</li>
<li>Absolute (make +ve) value
<ul>
<li><code>$abs</code></li>
</ul>
</li>
<li>Rounding numbers
<ul>
<li>
<code>$trunc</code>, <code>$ceil</code>, <code>$floor</code>
</li>
</ul>
</li>
<li>Logarithms
<ul>
<li>
<code>$log</code>, <code>$log10</code>, <code>$ln</code>
</li>
</ul>
</li>
<li>Raise to power
<ul>
<li><code>$pow</code></li>
</ul>
</li>
<li>Natural Exponent
<ul>
<li><code>$exp</code></li>
</ul>
</li>
</ul>
<p>Further details on these new operators can be found in the MongoDB 3.2 Release Notes.</p>
<h2>
<a id="user-content-lookup--left-outer-equi-joins" class="anchor" href="#lookup--left-outer-equi-joins" aria-hidden="true"><span class="octicon octicon-link"></span></a>$lookup – Left Outer Equi-Joins</h2>
<p>Figure 4 illustrates the syntax for performing the join:</p>
<ul>
<li>
<code>leftCollection</code> is the collection that the aggregation is being performed on and is the <em>left</em> collection in the join</li>
<li>
<code>from</code> identifies the collection that it will be joined with – the <em>right</em> collection (<code>rightCollection</code> in this case)</li>
<li>
<code>localField</code> specifies the key from the original/left collection – <code>leftVal</code>
</li>
<li>
<code>foreignField</code> specifies the key from the right collection – <code>rightVal</code>
</li>
<li>
<code>as</code> indicates that the data from the right collection should be embedded within the resulting documents as an array called <code>embeddedData</code>
</li>
</ul>
<p><a href="https://camo.githubusercontent.com/fdd7e396bb467e8d541289fa983c8cd334e64e77/687474703a2f2f7777772e636c757374657264622e636f6d2f75706c6f61642f246c6f6f6b75705f4d6f6e676f44425f4a6f696e732e706e67" target="_blank"><img decoding="async" src="https://camo.githubusercontent.com/fdd7e396bb467e8d541289fa983c8cd334e64e77/687474703a2f2f7777772e636c757374657264622e636f6d2f75706c6f61642f246c6f6f6b75705f4d6f6e676f44425f4a6f696e732e706e67" alt="$lookup – Left-Outer Joins for MongoDB" title="$lookup – Left-Outer Joins for MongoDB" data-canonical-src=".//upload/$lookup_MongoDB_Joins.png" style="max-width:100%;"></a><br>
<em>Figure 4: $lookup – Left-Outer Joins for MongoDB</em></p>
<p>In the follow-on blogs in this series, you’ll see how the data from a home sales collection (containing details of each home sale, including the property’s postal code) is joined with data from a postal code collection (containing postal codes and their geographical location). This produces documents that contain the original home sale information augmented with the coordinates of the property. In this case, the “homesales” collection is the left-collection and “postcodes” the right-collection; the “postcode” field from each collection is the <code>localField</code> which is matched with the <code>foreignField</code>.</p>
<h2>
<a id="user-content-worked-examples" class="anchor" href="#worked-examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Worked Examples</h2>
<h3>
<a id="user-content-the-data-set" class="anchor" href="#the-data-set" aria-hidden="true"><span class="octicon octicon-link"></span></a>The Data Set</h3>
<p>The examples use two data sets, the first being a comprehensive set of home sale data for a town and the second being a mapping from postal codes to geospatial locations for that same town.</p>
<p><em>For those interested, the imported data sets needed some cleaning up to make this walkthrough more useful &#8211; <a href="http://clusterdb.com/upload/DataSet_CleanUp.html" title="Cleaning up the data sets">the steps are described here</a>.</em></p>
<p>The two data sets can be checked using the <code>mongo</code> shell:</p>
<div class="highlight highlight-source-js">
<pre>db.homeSales.findOne()
{
  <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span><span class="pl-k">:</span> ObjectId(<span class="pl-s"><span class="pl-pds">"</span>56005dd980c3678b19792b7f<span class="pl-pds">"</span></span>),
  <span class="pl-s"><span class="pl-pds">"</span>amount<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">9000</span>,
  <span class="pl-s"><span class="pl-pds">"</span>date<span class="pl-pds">"</span></span><span class="pl-k">:</span> ISODate(<span class="pl-s"><span class="pl-pds">"</span>1996-09-19T00:00:00Z<span class="pl-pds">"</span></span>),
  <span class="pl-s"><span class="pl-pds">"</span>address<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
    <span class="pl-s"><span class="pl-pds">"</span>nameOrNumber<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">25</span>,
    <span class="pl-s"><span class="pl-pds">"</span>street<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>NORFOLK PARK COTTAGES<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>town<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>MAIDENHEAD<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>county<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>WINDSOR AND MAIDENHEAD<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>postcode<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>SL6 7DR<span class="pl-pds">"</span></span>
  }
}

db.postcodes.findOne()
{
  <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span><span class="pl-k">:</span> ObjectId(<span class="pl-s"><span class="pl-pds">"</span>5600521e50fa77da54dfc0d2<span class="pl-pds">"</span></span>),
  <span class="pl-s"><span class="pl-pds">"</span>postcode<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>SL6 0AA<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>location<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
    <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Point<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>coordinates<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
      <span class="pl-c1">51.525605</span>,
      <span class="pl-k">-</span><span class="pl-c1">0.700974</span>
    ]
  }
}</pre>
</div>
<p>An even better option to understand the contents of these collections is to use <a href="https://youtu.be/3w9HVFh1hRs">MongoDB Compass</a> (to be released with MongoDB 3.2). Figure 1 shows an overview of the <code>homeSales</code> collection and Figure 2 delves into its <code>address</code> sub-document.</p>
<p>
These datasets (the <code>homeSales</code> and <code>postcodes</code> collections) can be <a href="./../../../upload/SalesData.tar.gz" name="datasets for $lookup" alt="Download datasets used in this post">downloaded here</a>.
</p>
<p><a href="https://camo.githubusercontent.com/76e2d4bcdb1802474cc548b8b58891d3ed02d04b/687474703a2f2f636c757374657264622e636f6d2f75706c6f61642f436f6d706173735f566965775f6f665f686f6d6553616c65732e706e67" target="_blank"><img decoding="async" src="https://camo.githubusercontent.com/76e2d4bcdb1802474cc548b8b58891d3ed02d04b/687474703a2f2f636c757374657264622e636f6d2f75706c6f61642f436f6d706173735f566965775f6f665f686f6d6553616c65732e706e67" alt="MongoDB Compass View of homeSales Collection" title="MongoDB Compass View of homeSales Collection" data-canonical-src="http://clusterdb.com/upload/Compass_View_of_homeSales.png" style="max-width:100%;"></a><br>
<em>Figure 1: MongoDB Compass View of the homeSales Collection</em></p>
<p><a href="https://camo.githubusercontent.com/e0738db602146dee4a570b4e578274cc5746f97c/687474703a2f2f636c757374657264622e636f6d2f75706c6f61642f436f6d706173735f686f6d6553616c65735f416464726573732e706e67" target="_blank"><img decoding="async" src="https://camo.githubusercontent.com/e0738db602146dee4a570b4e578274cc5746f97c/687474703a2f2f636c757374657264622e636f6d2f75706c6f61642f436f6d706173735f686f6d6553616c65735f416464726573732e706e67" alt="Viewing Sub-Documents With MongoDB Compass" title="Viewing Sub-Documents With MongoDB Compass" data-canonical-src="http://clusterdb.com/upload/Compass_homeSales_Address.png" style="max-width:100%;"></a><br>
<em>Figure 2: Viewing Sub-Documents With MongoDB Compass</em></p>
<h3>
<a id="user-content-building-the-first-pipeline" class="anchor" href="#building-the-first-pipeline" aria-hidden="true"><span class="octicon octicon-link"></span></a>Building the First Pipeline</h3>
<p>As the error messages from complex pipelines aren&#8217;t always very specific, it makes sense to start with a simple pipeline and then check the results before moving onto the next.</p>
<p>As a collection&#8217;s indexes are only used for the beginning stages in the pipeline (before any transformations are performed), it is often sensible to reduce the result set as much as possible with a <code>$match</code> stage to filter out any unnecessary documents. Ideally, the match would be against the sharding key so that fewer shards need to be included. For the first pipeline stage the cheaper property sales are going to excluded and so it would help to have a secondary index on the <code>amount</code> key:</p>
<div class="highlight highlight-source-js">
<pre>db.homeSales.createIndex({amount<span class="pl-k">:</span> <span class="pl-c1">1</span>})</pre>
</div>
<p>The first stage in the pipeline then filters out any sales of less than £3,000,000:</p>
<div class="highlight highlight-source-js">
<pre>db.homeSales.aggregate([
  {$match<span class="pl-k">:</span> {
    amount<span class="pl-k">:</span> {$gte<span class="pl-k">:</span><span class="pl-c1">3000000</span>}}
  }
  ])</pre>
</div>
<p>The results can then be inspected to understand what will flow into the next stage in the pipeline:</p>
<div class="highlight highlight-source-js">
<pre>{
    {
      <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span><span class="pl-k">:</span> ObjectId(<span class="pl-s"><span class="pl-pds">"</span>56005dda80c3678b19799e52<span class="pl-pds">"</span></span>),
      <span class="pl-s"><span class="pl-pds">"</span>amount<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">3000000</span>,
      <span class="pl-s"><span class="pl-pds">"</span>date<span class="pl-pds">"</span></span><span class="pl-k">:</span> ISODate(<span class="pl-s"><span class="pl-pds">"</span>2012-04-19T00:00:00Z<span class="pl-pds">"</span></span>),
      <span class="pl-s"><span class="pl-pds">"</span>address<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
        <span class="pl-s"><span class="pl-pds">"</span>nameOrNumber<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>TEMPLE FERRY PLACE<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>street<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>MILL LANE<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>town<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>MAIDENHEAD<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>county<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>WINDSOR AND MAIDENHEAD<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>postcode<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>SL6 5ND<span class="pl-pds">"</span></span>
      }
    },

...

    {
      <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span><span class="pl-k">:</span> ObjectId(<span class="pl-s"><span class="pl-pds">"</span>56005dda80c3678b19799e5c<span class="pl-pds">"</span></span>),
      <span class="pl-s"><span class="pl-pds">"</span>amount<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">5425000</span>,
      <span class="pl-s"><span class="pl-pds">"</span>date<span class="pl-pds">"</span></span><span class="pl-k">:</span> ISODate(<span class="pl-s"><span class="pl-pds">"</span>1999-03-15T00:00:00Z<span class="pl-pds">"</span></span>),
      <span class="pl-s"><span class="pl-pds">"</span>address<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
        <span class="pl-s"><span class="pl-pds">"</span>nameOrNumber<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>2 - 3<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>street<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>THE SWITCHBACK<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>town<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>MAIDENHEAD<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>county<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>WINDSOR AND MAIDENHEAD<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>postcode<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>SL6 7RJ<span class="pl-pds">"</span></span>
      }
    }</pre>
</div>
<p>In the next stage, a left-outer join is performed – using <code>$lookup</code> – to find documents from the <code>postcodes</code> collection with a matching postcode so that the geographic location can be determined:</p>
<div class="highlight highlight-source-js">
<pre>db.homeSales.aggregate([
  {$match<span class="pl-k">:</span> {
    amount<span class="pl-k">:</span> {$gte<span class="pl-k">:</span><span class="pl-c1">3000000</span>}}
  }, 
  {$lookup<span class="pl-k">:</span> {
    from<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>postcodes<span class="pl-pds">"</span></span>, 
    localField<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>address.postcode<span class="pl-pds">"</span></span>,
    foreignField<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>postcode<span class="pl-pds">"</span></span>,
    as<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>postcode_docs<span class="pl-pds">"</span></span>}
  }
])</pre>
</div>
<p>Which yields these results:</p>
<div class="highlight highlight-source-js">
<pre>{
    {
      <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span><span class="pl-k">:</span> ObjectId(<span class="pl-s"><span class="pl-pds">"</span>56005dda80c3678b19799e52<span class="pl-pds">"</span></span>),
      <span class="pl-s"><span class="pl-pds">"</span>amount<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">3000000</span>,
      <span class="pl-s"><span class="pl-pds">"</span>date<span class="pl-pds">"</span></span><span class="pl-k">:</span> ISODate(<span class="pl-s"><span class="pl-pds">"</span>2012-04-19T00:00:00Z<span class="pl-pds">"</span></span>),
      <span class="pl-s"><span class="pl-pds">"</span>address<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
        <span class="pl-s"><span class="pl-pds">"</span>nameOrNumber<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>TEMPLE FERRY PLACE<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>street<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>MILL LANE<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>town<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>MAIDENHEAD<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>county<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>WINDSOR AND MAIDENHEAD<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>postcode<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>SL6 5ND<span class="pl-pds">"</span></span>
      },
      <span class="pl-s"><span class="pl-pds">"</span>postcode_docs<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
        {
          <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span><span class="pl-k">:</span> ObjectId(<span class="pl-s"><span class="pl-pds">"</span>560053e280c3678b1978b293<span class="pl-pds">"</span></span>),
          <span class="pl-s"><span class="pl-pds">"</span>postcode<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>SL6 5ND<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>location<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
            <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Point<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>coordinates<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
              <span class="pl-c1">51.549516</span>,
              <span class="pl-k">-</span><span class="pl-c1">0.80702</span>
            ]
          }
        }
      ]
    },

...

      <span class="pl-s"><span class="pl-pds">"</span>postcode_docs<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
        {
          <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span><span class="pl-k">:</span> ObjectId(<span class="pl-s"><span class="pl-pds">"</span>560053e280c3678b1978b524<span class="pl-pds">"</span></span>),
          <span class="pl-s"><span class="pl-pds">"</span>postcode<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>SL6 7RJ<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>location<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
            <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Point<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>coordinates<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
              <span class="pl-c1">51.536848</span>,
              <span class="pl-k">-</span><span class="pl-c1">0.735835</span>
            ]
          }
        }
      ]
    }</pre>
</div>
<p>The pipeline can then be extended with a <code>$project</code> stage to refactor the documents, removing any information that isn&#8217;t needed. The documents are then sorted in reverse-price order:</p>
<div class="highlight highlight-source-js">
<pre>db.homeSales.aggregate([
  {$match<span class="pl-k">:</span> {
    amount<span class="pl-k">:</span> {$gte<span class="pl-k">:</span><span class="pl-c1">3000000</span>}}
  }, 
  {$lookup<span class="pl-k">:</span> {
    from<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>postcodes<span class="pl-pds">"</span></span>, 
    localField<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>address.postcode<span class="pl-pds">"</span></span>,
    foreignField<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>postcode<span class="pl-pds">"</span></span>,
    as<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>postcode_docs<span class="pl-pds">"</span></span>}
  },
  {$project<span class="pl-k">:</span> {
    _id<span class="pl-k">:</span> <span class="pl-c1">0</span>,
    saleDate<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$date<span class="pl-pds">"</span></span>,
    price<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$amount<span class="pl-pds">"</span></span>,
    address<span class="pl-k">:</span> <span class="pl-c1">1</span>,
    location<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$postcode_docs.location<span class="pl-pds">"</span></span>}},
  {$sort<span class="pl-k">:</span>
    {
      price<span class="pl-k">:</span> <span class="pl-k">-</span><span class="pl-c1">1</span>
    }}
])</pre>
</div>
<p>The address and physical location of every home sale, starting with the most expensive is then shown:</p>
<div class="highlight highlight-source-js">
<pre>    {
      <span class="pl-s"><span class="pl-pds">"</span>address<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
        <span class="pl-s"><span class="pl-pds">"</span>nameOrNumber<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>2 - 3<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>street<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>THE SWITCHBACK<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>town<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>MAIDENHEAD<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>county<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>WINDSOR AND MAIDENHEAD<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>postcode<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>SL6 7RJ<span class="pl-pds">"</span></span>
      },
      <span class="pl-s"><span class="pl-pds">"</span>saleDate<span class="pl-pds">"</span></span><span class="pl-k">:</span> ISODate(<span class="pl-s"><span class="pl-pds">"</span>1999-03-15T00:00:00Z<span class="pl-pds">"</span></span>),
      <span class="pl-s"><span class="pl-pds">"</span>price<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">5425000</span>,
      <span class="pl-s"><span class="pl-pds">"</span>location<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
        {
          <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Point<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>coordinates<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
            <span class="pl-c1">51.536848</span>,
            <span class="pl-k">-</span><span class="pl-c1">0.735835</span>
          ]
        }
      ]
    },

...

    {
      <span class="pl-s"><span class="pl-pds">"</span>address<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
        <span class="pl-s"><span class="pl-pds">"</span>nameOrNumber<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>TEMPLE FERRY PLACE<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>street<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>MILL LANE<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>town<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>MAIDENHEAD<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>county<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>WINDSOR AND MAIDENHEAD<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>postcode<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>SL6 5ND<span class="pl-pds">"</span></span>
      },
      <span class="pl-s"><span class="pl-pds">"</span>saleDate<span class="pl-pds">"</span></span><span class="pl-k">:</span> ISODate(<span class="pl-s"><span class="pl-pds">"</span>2012-04-19T00:00:00Z<span class="pl-pds">"</span></span>),
      <span class="pl-s"><span class="pl-pds">"</span>price<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">3000000</span>,
      <span class="pl-s"><span class="pl-pds">"</span>location<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
        {
          <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Point<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>coordinates<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
            <span class="pl-c1">51.549516</span>,
            <span class="pl-k">-</span><span class="pl-c1">0.80702</span>
          ]
        }
      ]
    }</pre>
</div>
<h3>
<a id="user-content-building-further-pipelines" class="anchor" href="#building-further-pipelines" aria-hidden="true"><span class="octicon octicon-link"></span></a>Building Further Pipelines</h3>
<p>If all of the sales need to be analyzed (rather than just the most expensive few) then there would be too many results from the previous pipeline to be easily understood. For this reason, the pipeline is modified so that extra analysis and aggregation is performed within the database. This can be done using a <code>$group</code> stage – in this case to produce sales statistics by year:</p>
<div class="highlight highlight-source-js">
<pre>db.homeSales.aggregate([
  {
    $group<span class="pl-k">:</span> 
    {
      _id<span class="pl-k">:</span> {$year<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$date<span class="pl-pds">"</span></span>},
      higestPrice<span class="pl-k">:</span> {$max<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$amount<span class="pl-pds">"</span></span>},
      lowestPrice<span class="pl-k">:</span> {$min<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$amount<span class="pl-pds">"</span></span>},
      averagePrice<span class="pl-k">:</span> {$avg<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$amount<span class="pl-pds">"</span></span>},
      priceStdDev<span class="pl-k">:</span> {$stdDevPop<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$amount<span class="pl-pds">"</span></span>}
    }
  },
  {
    $sort<span class="pl-k">:</span> {_id<span class="pl-k">:</span> <span class="pl-c1">1</span>}
  }
])</pre>
</div>
<div class="highlight highlight-source-js">
<pre>    {
      <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1995</span>,
      <span class="pl-s"><span class="pl-pds">"</span>higestPrice<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1000000</span>,
      <span class="pl-s"><span class="pl-pds">"</span>lowestPrice<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">12000</span>,
      <span class="pl-s"><span class="pl-pds">"</span>averagePrice<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">114059.35206869633</span>,
      <span class="pl-s"><span class="pl-pds">"</span>priceStdDev<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">81540.50490801703</span>
    },

...

    {
      <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">2015</span>,
      <span class="pl-s"><span class="pl-pds">"</span>higestPrice<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1688000</span>,
      <span class="pl-s"><span class="pl-pds">"</span>lowestPrice<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">125000</span>,
      <span class="pl-s"><span class="pl-pds">"</span>averagePrice<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">451413.23917137476</span>,
      <span class="pl-s"><span class="pl-pds">"</span>priceStdDev<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">228293.6005201898</span>
    }

</pre>
</div>
<p>Note that this is using the <code>$stdDevPop</code> (standard deviation) aggregation operator being introduced in MongoDB 3.2.</p>
<p>There&#8217;s more precision than needed for some of the keys and so a common pattern can be employed – use a final <code>$project</code> stage to tidy up the data:</p>
<div class="highlight highlight-source-js">
<pre>db.homeSales.aggregate([
  {
    $group<span class="pl-k">:</span> 
    {
      _id<span class="pl-k">:</span> {$year<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$date<span class="pl-pds">"</span></span>},
      higestPrice<span class="pl-k">:</span> {$max<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$amount<span class="pl-pds">"</span></span>},
      lowestPrice<span class="pl-k">:</span> {$min<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$amount<span class="pl-pds">"</span></span>},
      averagePrice<span class="pl-k">:</span> {$avg<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$amount<span class="pl-pds">"</span></span>},
      priceStdDev<span class="pl-k">:</span> {$stdDevPop<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$amount<span class="pl-pds">"</span></span>}
    }
  },
  {
    $sort<span class="pl-k">:</span> {_id<span class="pl-k">:</span> <span class="pl-c1">1</span>}
  },
  {
    $project<span class="pl-k">:</span>
    {
      _id<span class="pl-k">:</span> <span class="pl-c1">1</span>,
      higestPrice<span class="pl-k">:</span> <span class="pl-c1">1</span>,
      lowestPrice<span class="pl-k">:</span> <span class="pl-c1">1</span>,
      averagePrice<span class="pl-k">:</span> {$trunc<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$averagePrice<span class="pl-pds">"</span></span>},
      priceStdDev<span class="pl-k">:</span> {$trunc<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$priceStdDev<span class="pl-pds">"</span></span>}
    }
  }
])</pre>
</div>
<div class="highlight highlight-source-js">
<pre>
    {
      <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1995</span>,
      <span class="pl-s"><span class="pl-pds">"</span>higestPrice<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1000000</span>,
      <span class="pl-s"><span class="pl-pds">"</span>lowestPrice<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">12000</span>,
      <span class="pl-s"><span class="pl-pds">"</span>averagePrice<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">114059</span>,
      <span class="pl-s"><span class="pl-pds">"</span>priceStdDev<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">81540</span>
    },

...

    {
      <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">2015</span>,
      <span class="pl-s"><span class="pl-pds">"</span>higestPrice<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1688000</span>,
      <span class="pl-s"><span class="pl-pds">"</span>lowestPrice<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">125000</span>,
      <span class="pl-s"><span class="pl-pds">"</span>averagePrice<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">451413</span>,
      <span class="pl-s"><span class="pl-pds">"</span>priceStdDev<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">228293</span>
    }</pre>
</div>
<p>It often makes sense to store the results in a new collection – either because the results will be reused many times or that subsequent aggregation pipelines will reference them. This is simple to achieve using a <code>$out</code> stage; note that:</p>
<ul>
<li>If the target collection already exists then its contents will be overwritten</li>
<li>If used then the <code>$out</code> must be the final stage in the pipeline</li>
</ul>
<p>The following example writes the results to a collection called <code>annualHomePrices</code>:</p>
<div class="highlight highlight-source-js">
<pre>db.homeSales.aggregate([
  {
    $group<span class="pl-k">:</span> 
    {
      _id<span class="pl-k">:</span> {$year<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$date<span class="pl-pds">"</span></span>},
      highestPrice<span class="pl-k">:</span> {$max<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$amount<span class="pl-pds">"</span></span>},
      lowestPrice<span class="pl-k">:</span> {$min<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$amount<span class="pl-pds">"</span></span>},
      averagePrice<span class="pl-k">:</span> {$avg<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$amount<span class="pl-pds">"</span></span>},
      priceStdDev<span class="pl-k">:</span> {$stdDevPop<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$amount<span class="pl-pds">"</span></span>}
    }
  },
  {
    $sort<span class="pl-k">:</span> {_id<span class="pl-k">:</span> <span class="pl-c1">1</span>}
  },
  {
    $project<span class="pl-k">:</span>
    {
      _id<span class="pl-k">:</span> <span class="pl-c1">0</span>,
      year<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$_id<span class="pl-pds">"</span></span>,
      highestPrice<span class="pl-k">:</span> <span class="pl-c1">1</span>,
      lowestPrice<span class="pl-k">:</span> <span class="pl-c1">1</span>,
      averagePrice<span class="pl-k">:</span> {$trunc<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$averagePrice<span class="pl-pds">"</span></span>},
      priceStdDev<span class="pl-k">:</span> {$trunc<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$priceStdDev<span class="pl-pds">"</span></span>}
    }
  },
  {
    $out<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>annualHomePrices<span class="pl-pds">"</span></span>
  }
])</pre>
</div>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">&gt;</span> db.annualHomePrices.findOne()
{
  <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span><span class="pl-k">:</span> ObjectId(<span class="pl-s"><span class="pl-pds">"</span>560957ac29a5574d557d426d<span class="pl-pds">"</span></span>),
  <span class="pl-s"><span class="pl-pds">"</span>highestPrice<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1000000</span>,
  <span class="pl-s"><span class="pl-pds">"</span>lowestPrice<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">12000</span>,
  <span class="pl-s"><span class="pl-pds">"</span>averagePrice<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">114059</span>,
  <span class="pl-s"><span class="pl-pds">"</span>priceStdDev<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">81540</span>,
  <span class="pl-s"><span class="pl-pds">"</span>year<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1995</span>
}</pre>
</div>
<p>These &#8220;interim&#8221; results could then be used to build further result sets – without the need to run all of that processing again. As an example, using a simple <code>$project</code> stage, the gap between the highest and lowest house sale can be calculated for each year:</p>
<div class="highlight highlight-source-js">
<pre>db.annualHomePrices.aggregate([
  {$project<span class="pl-k">:</span> 
    {
      Year<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$year<span class="pl-pds">"</span></span>,
      hightToLowPriceGap<span class="pl-k">:</span> {
        $subtract<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">"</span>$highestPrice<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>$lowestPrice<span class="pl-pds">"</span></span>]
      },
      _id<span class="pl-k">:</span> <span class="pl-c1">0</span>
    }
  }
])</pre>
</div>
<div class="highlight highlight-source-js">
<pre>{
   <span class="pl-s"><span class="pl-pds">"</span>Year<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">2012</span>,
   <span class="pl-s"><span class="pl-pds">"</span>hightToLowPriceGap<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">2923000</span>
},
{
   <span class="pl-s"><span class="pl-pds">"</span>Year<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">2013</span>,
   <span class="pl-s"><span class="pl-pds">"</span>hightToLowPriceGap<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">5092250</span>
},
{
   <span class="pl-s"><span class="pl-pds">"</span>Year<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">2014</span>,
   <span class="pl-s"><span class="pl-pds">"</span>hightToLowPriceGap<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">3883050</span>
},
{
  <span class="pl-s"><span class="pl-pds">"</span>Year<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">2015</span>,
  <span class="pl-s"><span class="pl-pds">"</span>hightToLowPriceGap<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1563000</span>
}</pre>
</div>
<p>As a final stage in this post, a pipeline is built to find the postal code and geographic location of the most expensive house sale for each of the recorded years:<br>
Perform a <code>$sort</code> on the full <code>homeSales</code> data set so that the documents are ordered from most expensive sale first<br>
<code>$group</code> the results based on the year of the home sale, deriving the <code>priciestPostCode</code> from the <code>$first</code> document in that group (year). Because the documents were sorted on price before entering the <code>group</code> stage, the first document is also the one with the highest price<br>
<code>$lookup</code> the postal code in the <code>postcodes</code> collection to get the geolocation data<br>
<code>$sort</code> the results by year<br>
<code>$project</code> just the data that is of interest</p>
<div class="highlight highlight-source-js">
<pre>db.homeSales.aggregate([
    {
      $sort<span class="pl-k">:</span> {amount<span class="pl-k">:</span> <span class="pl-k">-</span><span class="pl-c1">1</span>}
    },
    {
      $group<span class="pl-k">:</span>
      {
        _id<span class="pl-k">:</span> {$year<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$date<span class="pl-pds">"</span></span>},
        priciestPostCode<span class="pl-k">:</span> {$first<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$address.postcode<span class="pl-pds">"</span></span>}
      }
    },
    {
      $lookup<span class="pl-k">:</span>
      {
        from<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>postcodes<span class="pl-pds">"</span></span>,
        localField<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>priciestPostCode<span class="pl-pds">"</span></span>,
        foreignField<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>postcode<span class="pl-pds">"</span></span>,
        as<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>locationData<span class="pl-pds">"</span></span>
      }
    },
    {
      $sort<span class="pl-k">:</span> {_id<span class="pl-k">:</span> <span class="pl-k">-</span><span class="pl-c1">1</span>}
    },
    {
      $project<span class="pl-k">:</span>
      {
        _id<span class="pl-k">:</span> <span class="pl-c1">0</span>,
        Year<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$_id<span class="pl-pds">"</span></span>,
        PostCode<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$priciestPostCode<span class="pl-pds">"</span></span>,
        <span class="pl-c1">Location</span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$locationData.location<span class="pl-pds">"</span></span>
      }
    }
  ])</pre>
</div>
<div class="highlight highlight-source-js">
<pre>{
  <span class="pl-s"><span class="pl-pds">"</span>Year<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">2015</span>,
  <span class="pl-s"><span class="pl-pds">"</span>PostCode<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>SL6 9UD<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>Location<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
    {
      <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Point<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>coordinates<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
        <span class="pl-c1">51.558455</span>,
        <span class="pl-k">-</span><span class="pl-c1">0.756023</span>
      ]
    }
  ]
},
{
  <span class="pl-s"><span class="pl-pds">"</span>Year<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">2014</span>,
  <span class="pl-s"><span class="pl-pds">"</span>PostCode<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>SL6 1UP<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>Location<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
    {
      <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Point<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>coordinates<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
        <span class="pl-c1">51.51407</span>,
        <span class="pl-k">-</span><span class="pl-c1">0.704414</span>
      ]
    }
  ]
},
...</pre>
</div>
<h2>
<a id="user-content-adding-some-coding-glue-and-geolocation" class="anchor" href="#adding-some-coding-glue-and-geolocation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Adding Some Coding Glue and Geolocation</h2>
<p>Obviously, there are limits as to how much can be achieved with a single aggregation pipeline but with the addition of just a little code outside of the database (in this example, JavaScript in the <code>mongo</code> shell), additional results can be produced.</p>
<p>We start by repeating an aggregation from the previous section but store the data in a collection so that we can build upon those results:</p>
<div class="highlight highlight-source-js">
<pre>db.homeSales.aggregate([
    {
      $sort<span class="pl-k">:</span> {amount<span class="pl-k">:</span> <span class="pl-k">-</span><span class="pl-c1">1</span>}
    },
    {
      $group<span class="pl-k">:</span>
      {
        _id<span class="pl-k">:</span> {$year<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$date<span class="pl-pds">"</span></span>},
        priciestPostCode<span class="pl-k">:</span> {$first<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$address.postcode<span class="pl-pds">"</span></span>}
      }
    },
    {
      $lookup<span class="pl-k">:</span>
      {
        from<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>postcodes<span class="pl-pds">"</span></span>,
        localField<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>priciestPostCode<span class="pl-pds">"</span></span>,
        foreignField<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>postcode<span class="pl-pds">"</span></span>,
        as<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>locationData<span class="pl-pds">"</span></span>
      }
    },
    {
      $sort<span class="pl-k">:</span> {_id<span class="pl-k">:</span> <span class="pl-k">-</span><span class="pl-c1">1</span>}
    },
    {
      $project<span class="pl-k">:</span>
      {
        _id<span class="pl-k">:</span> <span class="pl-c1">0</span>,
        Year<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$_id<span class="pl-pds">"</span></span>,
        PostCode<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$priciestPostCode<span class="pl-pds">"</span></span>,
        <span class="pl-c1">Location</span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$locationData.location<span class="pl-pds">"</span></span>
      }
    },
    {
      $out<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>hottestLocations<span class="pl-pds">"</span></span>
    }
  ])</pre>
</div>
<div class="highlight highlight-source-js">
<pre>db.hottestLocations.findOne()
{
  <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span><span class="pl-k">:</span> ObjectId(<span class="pl-s"><span class="pl-pds">"</span>5629108c96be45aba9cb0c98<span class="pl-pds">"</span></span>),
  <span class="pl-s"><span class="pl-pds">"</span>Year<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">2015</span>,
  <span class="pl-s"><span class="pl-pds">"</span>PostCode<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>SL6 9UD<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>Location<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
    {
      <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Point<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>coordinates<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
        <span class="pl-c1">51.558455</span>,
        <span class="pl-k">-</span><span class="pl-c1">0.756023</span>
      ]
    }
  ]
}</pre>
</div>
<p>In this example, geospatial operations are performed on the <code>location</code> from the <code>postcodes</code> collection and so a geospatial index should be added:</p>
<div class="highlight highlight-source-js">
<pre>db.postcodes.createIndex({location<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>2dsphere<span class="pl-pds">"</span></span>})</pre>
</div>
<p>A function is created that, given a location, will find the five nearest postcodes – taking advantage of a <code>$geoNear</code> stage – note that this must be the first stage in the pipeline:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> <span class="pl-en">findNeighbours</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">spot</span>, <span class="pl-smi">yearTag</span>) {
  <span class="pl-k">var</span> result <span class="pl-k">=</span> db.postcodes.aggregate([
      {
        $geoNear<span class="pl-k">:</span>
        {
          near<span class="pl-k">:</span> spot,
          distanceField<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>distance<span class="pl-pds">"</span></span>,
          num<span class="pl-k">:</span> <span class="pl-c1">5</span>,
          spherical<span class="pl-k">:</span> <span class="pl-c1">true</span>
        }
      },
      {
        $group<span class="pl-k">:</span> {
          _id<span class="pl-k">:</span> yearTag,
          <span class="pl-s"><span class="pl-pds">"</span>neighbours<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
            $addToSet<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$postcode<span class="pl-pds">"</span></span>
          }
        }
      }
    ]);
  <span class="pl-k">return</span> result.result;
}</pre>
</div>
<p>Then, for each of the <code>hottestLocations</code> collection, that function is called to display and the contents of the returned cursor are displayed:</p>
<div class="highlight highlight-source-js">
<pre>db.hottestLocations.<span class="pl-c1">find</span>().forEach(<span class="pl-k">function</span>(<span class="pl-smi">myDoc</span>) {
  <span class="pl-k">var</span> myCursor <span class="pl-k">=</span> findNeighbours(myDoc.<span class="pl-c1">Location</span>[<span class="pl-c1">0</span>], myDoc.Year);
  myCursor.forEach(printjson);
})</pre>
</div>
<p>The result is a list of the 5 closest postcodes to the top selling home each year:</p>
<div class="highlight highlight-source-js">
<pre>{
  <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1995</span>,
  <span class="pl-s"><span class="pl-pds">"</span>neighbours<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
    <span class="pl-s"><span class="pl-pds">"</span>SL6 2NL<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>SL6 2JL<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>SL6 2NB<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>SL6 2JN<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>SL6 2NA<span class="pl-pds">"</span></span>
  ]
}

...

{
  <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">2015</span>,
  <span class="pl-s"><span class="pl-pds">"</span>neighbours<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
    <span class="pl-s"><span class="pl-pds">"</span>SL6 9XB<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>SL6 9XL<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>SL6 9UE<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>SL6 9UB<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>SL6 9UD<span class="pl-pds">"</span></span>
  ]
}</pre>
</div>
<h2>
<a id="user-content-bonus-query--for-those-choosing-a-school" class="anchor" href="#bonus-query--for-those-choosing-a-school" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bonus Query – For Those Choosing a School</h2>
<p>There&#8217;s often a correlation between the house prices near a school and that school&#8217;s performance. So, if you were considering a specific school then it might make sense to check house prices in the area surrounding that school. </p>
<p>The following pipeline will find house price statistics, by year, for all postcodes within a 3 km radius of the school – which is located at coordinates (51.5156725, -0.727387):</p>
<div class="highlight highlight-source-js">
<pre>db.postcodes.aggregate([
      {
        $geoNear<span class="pl-k">:</span>
        {
          near<span class="pl-k">:</span> 
          {
            <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Point<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>coordinates<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
              <span class="pl-c1">51.5156725</span>,
              <span class="pl-k">-</span><span class="pl-c1">0.727387</span>
            ]},
          distanceField<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>distance<span class="pl-pds">"</span></span>,
          num<span class="pl-k">:</span> <span class="pl-c1">10000</span>,
          maxDistance<span class="pl-k">:</span> <span class="pl-c1">3000</span>,
          spherical<span class="pl-k">:</span> <span class="pl-c1">true</span>
        }
      },
      {
        $lookup<span class="pl-k">:</span> {
          from<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>homeSales<span class="pl-pds">"</span></span>,
          localField<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>postcode<span class="pl-pds">"</span></span>,
          foreignField<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>address.postcode<span class="pl-pds">"</span></span>,
          as<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>priceData<span class="pl-pds">"</span></span>
        }
      },
      {
        $unwind<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$priceData<span class="pl-pds">"</span></span>
      },

      {
        $group<span class="pl-k">:</span> 
        {
          _id<span class="pl-k">:</span> {$year<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$priceData.date<span class="pl-pds">"</span></span>},
          highestPrice<span class="pl-k">:</span> {$max<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$priceData.amount<span class="pl-pds">"</span></span>},
          lowestPrice<span class="pl-k">:</span> {$min<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$priceData.amount<span class="pl-pds">"</span></span>},
          averagePrice<span class="pl-k">:</span> {$avg<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$priceData.amount<span class="pl-pds">"</span></span>},
          priceStdDev<span class="pl-k">:</span> {$stdDevPop<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$priceData.amount<span class="pl-pds">"</span></span>}
        }
      },
      {
        $project<span class="pl-k">:</span>
        {
          _id<span class="pl-k">:</span> <span class="pl-c1">0</span>,
          Year<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span>,
          highestPrice<span class="pl-k">:</span> <span class="pl-c1">1</span>,
          lowestPrice<span class="pl-k">:</span> <span class="pl-c1">1</span>,
          averagePrice<span class="pl-k">:</span> {$trunc<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$averagePrice<span class="pl-pds">"</span></span>},
          priceStdDev<span class="pl-k">:</span> {$trunc<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>$priceStdDev<span class="pl-pds">"</span></span>}
        }
      },
      {
        $sort<span class="pl-k">:</span> 
        {
          <span class="pl-s"><span class="pl-pds">"</span>Year<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-k">-</span><span class="pl-c1">1</span>
        }
      }
    ]);</pre>
</div>
<div class="highlight highlight-source-js">
<pre>{
  <span class="pl-s"><span class="pl-pds">"</span>highestPrice<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1350000</span>,
  <span class="pl-s"><span class="pl-pds">"</span>lowestPrice<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">125000</span>,
  <span class="pl-s"><span class="pl-pds">"</span>averagePrice<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">410593</span>,
  <span class="pl-s"><span class="pl-pds">"</span>priceStdDev<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">182358</span>,
  <span class="pl-s"><span class="pl-pds">"</span>Year<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">2015</span>
},
...
{
  <span class="pl-s"><span class="pl-pds">"</span>highestPrice<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">930000</span>,
  <span class="pl-s"><span class="pl-pds">"</span>lowestPrice<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">12000</span>,
  <span class="pl-s"><span class="pl-pds">"</span>averagePrice<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">103455</span>,
  <span class="pl-s"><span class="pl-pds">"</span>priceStdDev<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">68615</span>,
  <span class="pl-s"><span class="pl-pds">"</span>Year<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1995</span>
}</pre>
</div>
<h2>
<a id="user-content-limitations" class="anchor" href="#limitations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Limitations</h2>
<p>As seen, it’s possible to build up sophisticated analytical queries using the enhanced aggregation features – especially when pipelines are combined with a little application or scripting glue. </p>
<p>Some limitations that you may meet include:</p>
<ul>
<li>
<code>$geoNear</code> can only be used as the first stage in the pipeline</li>
<li>
<code>$lookup</code> only supports equality for the match and the equality has to be between a single key from each collection</li>
<li>The right-collection for <code>$lookup</code> cannot be sharded</li>
<li>The pipeline is linear; there are no forks and once data has been aggregated, the lost details can&#8217;t be reused later in the pipeline (this is why writing results to a new collection using <code>$out</code> can be helpful)</li>
<li>One can remove information at each stage but it&#8217;s impossible to add new raw data (other than through <code>$lookup</code>)</li>
<li>Indexes are only used for the beginning stages of the pipeline (and right tables in any subsequent <code>$lookup</code>)</li>
<li>
<code>$out</code> can only be used in the final stage of the pipeline</li>
</ul>
<h2>
<a id="user-content-when-to-use-full-data-visualization-solutions" class="anchor" href="#when-to-use-full-data-visualization-solutions" aria-hidden="true"><span class="octicon octicon-link"></span></a>When to Use Full Data Visualization Solutions</h2>
<p>A lot can be achieved directly in the database – especially when augmented with a small amount of code. So when would it make sense to use a BI visualization tool such as Tableau. The capabilities will vary from product to product but some general considerations are given here:</p>
<ul>
<li>
<strong>Visualization</strong> – displaying information in graphs and on maps (rather than in JSON result sets) makes it much simpler for the human mind to see patterns and draw conclusions from the data (see Figure 1 which is based on the same data set used earlier and graphically shows the highest home sale price by location and year)</li>
<li>
<strong>Multiple Data Sources</strong> – combining data from multiple sources (data blending); for example from a MongoDB database and an Excel spreadsheet can greatly broaden the context of reports</li>
<li>
<strong>Interactivity</strong> – visualization tools make it simple to create interactive queries/dashboards where business user can graphically tweak parameters to get precise results and test theories</li>
<li>
<strong>Skills</strong> – performing all of the analytics directly in MongoDB requires knowledge of the MongoDB Query Language and possibly some basic coding skills. Using the visualization tools is analogous to using intermediate features in Microsoft Excel such as pivot tables and graphs and so it opens up the ability to analyze the data to a broader set of users in the organization</li>
<li>
<strong>Extra functions</strong> – for example, the ability to add trend lines to a chart</li>
</ul>
<p><a href="https://camo.githubusercontent.com/c06051cc9b7415379160844df37fd39da4c75e38/687474703a2f2f636c757374657264622e636f6d2f75706c6f61642f5461626c6561755f4d6f6e676f44425f446174612e706e67" target="_blank"><img decoding="async" src="https://camo.githubusercontent.com/c06051cc9b7415379160844df37fd39da4c75e38/687474703a2f2f636c757374657264622e636f6d2f75706c6f61642f5461626c6561755f4d6f6e676f44425f446174612e706e67" alt="MongoDB Data Visualized in a Tableau Map" title="MongoDB Data Visualized in a Tableau Map" data-canonical-src="http://clusterdb.com/upload/Tableau_MongoDB_Data.png" style="max-width:100%;"></a><br>
<em>Figure 1: MongoDB Data Visualized in a Tableau Map</em></p>
<p>MongoDB 3.2 introduces the MongoDB Connector for BI which allows Business Intelligence tools such as Tableau to access data from MongoDB using SQL – opening up a range of new options for performing analytics on live data.</p>
<h2>
<a id="user-content-next-steps" class="anchor" href="#next-steps" aria-hidden="true"><span class="octicon octicon-link"></span></a>Next Steps</h2>
<p>To learn more about what&#8217;s coming up in MongoDB 3.2, register for the <a href="https://www.mongodb.com/webinar/whats-new-in-mongodb-3-2">What&#8217;s new in MongoDB 3.2 webinar</a> and review the <a href="https://docs.mongodb.org/manual/release-notes/3.2/">MongoDB 3.2 release notes</a>.</p>
<p>There&#8217;s a <a href="https://www.mongodb.com/presentations/webinar-joins-and-other-aggregation-enhancements-coming-in-mongodb-3-2" title="Webinar: Joins and Other Aggregation Enhancements Coming in MongoDB 3.2">webinar recording</a> explaining more about <code>$lookup</code> and the other aggregation features.</p>
<p>To get the best understanding of the new features then you should experiment with the software which is available in the MongoDB 3.2 (not for production) download – to use the new <code>$lookup</code> aggregation theMongoDB Enterprise Advanced download should be used.</p>
<p>The reason MongoDB releases development releases is to give the community a chance to try out the new software – and we hope that you&#8217;ll give us feedback, whether it be by joining the <a href="https://www.mongodb.com/blog/post/announcing-the-mongodb-3-2-bug-hunt">MongoDB 3.2 bug hunt</a> or commenting on this post.</p>

<p></p>
</div>
</div>
</div>
</div>
</div>
</div>
</body>
					<div class="clear"></div>
									
		<br>
		<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
   		<a href="http://twitter.com/share" class="twitter-share-button" data-url=".//mongodb/joins-and-other-aggregation-enhancements-in-mongodb-3-2" data-via="wpbeginner" data-text="Joins and Other Aggregation Enhancements in MongoDB 3.2" data-related="syedbalkhi:Founder of WPBeginner" data-count="horizontal">Tweet</a>
		<br>
		<!-- <g:plusone size="medium" href=".//mongodb/joins-and-other-aggregation-enhancements-in-mongodb-3-2"></g:plusone> -->
		<div class="g-plusone" data-annotation="inline" data-width="300"></div>
		<!-- Place this tag after the last +1 button tag. -->
		<script type="text/javascript">(function() {
    				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    				po.src = 'https://apis.google.com/js/plusone.js';
    				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  			})();</script>
		<br>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url=".//mongodb/joins-and-other-aggregation-enhancements-in-mongodb-3-2" data-counter="right"></script>
		<br>
		<iframe src="http://www.facebook.com/plugins/like.php?href=.%2F%2Fmongodb%2Fjoins-and-other-aggregation-enhancements-in-mongodb-3-2&amp;layout=standard&amp;show_faces=true&amp;width=450&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowtransparency="true" style="border:none; overflow:hidden; width:450px; height:60px;">
		</iframe>

<!-- ZXZX -->
				<div class="postinfo">Category: <a href="./../../../category/mongodb/index.html" rel="category tag">MongoDB</a> | 
Tags: <a href="./../../aggregation/index.html" rel="tag">aggregation</a>, <a href="./../../join/index.html" rel="tag">join</a>, <a href="./../../mongodb/index.html" rel="tag">mongodb</a>, <a href="./../../mongodb-3-2/index.html" rel="tag">MongoDB 3.2</a>
</div>

			      
							<div class="more_posts">
					<span class="post_links"><a href="./6/index.html">&laquo; Older Entries</a> &nbsp; <a href="./4/index.html">Recent Entries &raquo;</a></span>
				</div>
						

					
	
		
		
<div id="sidebar">
	<ul>

<li id="search-2" class="widget widget_search"><form role="search" method="get" id="searchform" class="searchform" action=".//">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s">
					<input type="submit" id="searchsubmit" value="Search">
				</div>
			</form></li>

		<li id="recent-posts-2" class="widget widget_recent_entries">
		<h2 class="widgettitle">Recent Posts</h2>

		<ul>
											<li>
					<a href="./../../../mongodb/building-a-collaborative-ios-minesweeper-game-with-realm/index.html">Building a collaborative iOS Minesweeper game with Realm</a>
									</li>
											<li>
					<a href="./../../../mongodb/using-realm-flexible-sync-in-your-app-an-ios-tutorial/index.html">Using Realm Flexible Sync in Your App—an iOS Tutorial</a>
									</li>
											<li>
					<a href="./../../../mongodb/realm-swift-type-projections/index.html">Realm-Swift Type Projections</a>
									</li>
											<li>
					<a href="./../../../mongodb/introducing-flexible-sync-preview-the-next-iteration-of-realm-sync/index.html">Introducing Flexible Sync (Preview) – The Next Iteration of Realm Sync</a>
									</li>
											<li>
					<a href="./../../../mongodb/goodbye-nspredicate-hello-realm-swift-query-api/index.html">Goodbye NSPredicate, hello Realm Swift Query API</a>
									</li>
					</ul>

		</li>
<li id="text-2" class="widget widget_text">			<div class="textwidget">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-5257306915232759";
/* Clusterdb-home */
google_ad_slot = "1624229680";
google_ad_width = 200;
google_ad_height =600;
//--></script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
</div>
		</li>
<li id="recent-comments-2" class="widget widget_recent_comments">
<h2 class="widgettitle">Recent Comments</h2>
<ul id="recentcomments">
<li class="recentcomments">
<span class="comment-author-link"><a href="http://mikael.ronstrom@blogspot.com/" class="url" rel="ugc external nofollow">Mikael Ronström</a></span> on <a href="./../../../mysql-cluster/mysql-cluster-running-on-raspberry-pi/index.html#comment-787242">MySQL Cluster running on Raspberry Pi</a>
</li>
<li class="recentcomments">
<span class="comment-author-link">andrew</span> on <a href="./../../../mysql-cluster/setting-up-mysql-asynchronous-replication-for-high-availability/index.html#comment-668717">Setting up MySQL Asynchronous Replication for High Availability</a>
</li>
<li class="recentcomments">
<span class="comment-author-link"><a href="http://www.suksesonline.com/" class="url" rel="ugc external nofollow">Betty</a></span> on <a href="./../../../mysql-cluster/setting-up-mysql-asynchronous-replication-for-high-availability/index.html#comment-668713">Setting up MySQL Asynchronous Replication for High Availability</a>
</li>
<li class="recentcomments">
<span class="comment-author-link">Sai Krishnan</span> on <a href="./../../../mysql-cluster/get-mysql-replication-up-and-running-in-5-minutes/index.html#comment-661143">Get MySQL Replication up and running in 5 minutes</a>
</li>
<li class="recentcomments">
<span class="comment-author-link">Nayan</span> on <a href="./../../../mysql-cluster/get-mysql-replication-up-and-running-in-5-minutes/index.html#comment-660628">Get MySQL Replication up and running in 5 minutes</a>
</li>
</ul>
</li>
<li id="categories-2" class="widget widget_categories">
<h2 class="widgettitle">Categories</h2>

			<ul>
					<li class="cat-item cat-item-2">
<a href="./../../../category/me/index.html">Me</a>
</li>
	<li class="cat-item cat-item-146">
<a href="./../../../category/mongodb/index.html">MongoDB</a>
</li>
	<li class="cat-item cat-item-3">
<a href="./../../../category/mysql/index.html">MySQL</a>
</li>
	<li class="cat-item cat-item-4">
<a href="./../../../category/mysql-cluster/index.html">MySQL Cluster</a>
</li>
	<li class="cat-item cat-item-131">
<a href="./../../../category/mysql-fabric/index.html">MySQL Fabric</a>
</li>
	<li class="cat-item cat-item-5">
<a href="./../../../category/mysql-replication/index.html">MySQL Replication</a>
</li>
	<li class="cat-item cat-item-214">
<a href="./../../../category/mongodb/realm/index.html">Realm</a>
</li>
	<li class="cat-item cat-item-1">
<a href="./../../../category/uncategorized/index.html">Uncategorized</a>
</li>
			</ul>

			</li>
<li id="tag_cloud-2" class="widget widget_tag_cloud">
<h2 class="widgettitle">Tags</h2>
<div class="tagcloud">
<a href="./../../7-4/index.html" class="tag-cloud-link tag-link-137 tag-link-position-1" style="font-size: 9.0632911392405pt;" aria-label="7.4 (7 items)">7.4</a>
<a href="./../../apache-kafka/index.html" class="tag-cloud-link tag-link-169 tag-link-position-2" style="font-size: 8.620253164557pt;" aria-label="Apache Kafka (6 items)">Apache Kafka</a>
<a href="./../../cluster/index.html" class="tag-cloud-link tag-link-18 tag-link-position-3" style="font-size: 8.620253164557pt;" aria-label="Cluster (6 items)">Cluster</a>
<a href="./../../ha/index.html" class="tag-cloud-link tag-link-41 tag-link-position-4" style="font-size: 15.354430379747pt;" aria-label="HA (40 items)">HA</a>
<a href="./../../high-availability/index.html" class="tag-cloud-link tag-link-43 tag-link-position-5" style="font-size: 15.26582278481pt;" aria-label="High Availability (39 items)">High Availability</a>
<a href="./../../ios/index.html" class="tag-cloud-link tag-link-215 tag-link-position-6" style="font-size: 10.658227848101pt;" aria-label="ios (11 items)">ios</a>
<a href="./../../java/index.html" class="tag-cloud-link tag-link-47 tag-link-position-7" style="font-size: 8.620253164557pt;" aria-label="Java (6 items)">Java</a>
<a href="./../../javascript/index.html" class="tag-cloud-link tag-link-48 tag-link-position-8" style="font-size: 10.303797468354pt;" aria-label="javascript (10 items)">javascript</a>
<a href="./../../mcm/index.html" class="tag-cloud-link tag-link-56 tag-link-position-9" style="font-size: 8pt;" aria-label="MCM (5 items)">MCM</a>
<a href="./../../mean/index.html" class="tag-cloud-link tag-link-186 tag-link-position-10" style="font-size: 8pt;" aria-label="MEAN (5 items)">MEAN</a>
<a href="./../../memcached/index.html" class="tag-cloud-link tag-link-57 tag-link-position-11" style="font-size: 8pt;" aria-label="Memcached (5 items)">Memcached</a>
<a href="./../../mobile/index.html" class="tag-cloud-link tag-link-211 tag-link-position-12" style="font-size: 8pt;" aria-label="mobile (5 items)">mobile</a>
<a href="./../../mongodb/index.html" class="tag-cloud-link tag-link-150 tag-link-position-13" style="font-size: 16.417721518987pt;" aria-label="mongodb (53 items)">mongodb</a>
<a href="./../../mongodb-3-2/index.html" class="tag-cloud-link tag-link-153 tag-link-position-14" style="font-size: 8pt;" aria-label="MongoDB 3.2 (5 items)">MongoDB 3.2</a>
<a href="./../../mongodb-atlas/index.html" class="tag-cloud-link tag-link-163 tag-link-position-15" style="font-size: 9.0632911392405pt;" aria-label="MongoDB Atlas (7 items)">MongoDB Atlas</a>
<a href="./../../mongodb-mobile/index.html" class="tag-cloud-link tag-link-212 tag-link-position-16" style="font-size: 8pt;" aria-label="MongoDB Mobile (5 items)">MongoDB Mobile</a>
<a href="./../../mongodb-stitch/index.html" class="tag-cloud-link tag-link-204 tag-link-position-17" style="font-size: 12.253164556962pt;" aria-label="MongoDB Stitch (17 items)">MongoDB Stitch</a>
<a href="./../../mysql/index.html" class="tag-cloud-link tag-link-147 tag-link-position-18" style="font-size: 22pt;" aria-label="MySQL (229 items)">MySQL</a>
<a href="./../../mysql-5-6/index.html" class="tag-cloud-link tag-link-64 tag-link-position-19" style="font-size: 10.924050632911pt;" aria-label="MySQL 5.6 (12 items)">MySQL 5.6</a>
<a href="./../../mysql-cluster/index.html" class="tag-cloud-link tag-link-148 tag-link-position-20" style="font-size: 21.46835443038pt;" aria-label="MySQL Cluster (198 items)">MySQL Cluster</a>
<a href="./../../mysql-cluster-70/index.html" class="tag-cloud-link tag-link-69 tag-link-position-21" style="font-size: 13.936708860759pt;" aria-label="MySQL Cluster 7.0 (27 items)">MySQL Cluster 7.0</a>
<a href="./../../mysql-cluster-7-1/index.html" class="tag-cloud-link tag-link-70 tag-link-position-22" style="font-size: 15.177215189873pt;" aria-label="MySQL Cluster 7.1 (38 items)">MySQL Cluster 7.1</a>
<a href="./../../mysql-cluster-7-2/index.html" class="tag-cloud-link tag-link-71 tag-link-position-23" style="font-size: 14.556962025316pt;" aria-label="MySQL Cluster 7.2 (32 items)">MySQL Cluster 7.2</a>
<a href="./../../mysql-cluster-7-3/index.html" class="tag-cloud-link tag-link-72 tag-link-position-24" style="font-size: 12.253164556962pt;" aria-label="MySQL Cluster 7.3 (17 items)">MySQL Cluster 7.3</a>
<a href="./../../mysql-cluster-7-4/index.html" class="tag-cloud-link tag-link-134 tag-link-position-25" style="font-size: 11.278481012658pt;" aria-label="MySQL Cluster 7.4 (13 items)">MySQL Cluster 7.4</a>
<a href="./../../mysql-cluster-cge/index.html" class="tag-cloud-link tag-link-73 tag-link-position-26" style="font-size: 17.569620253165pt;" aria-label="MySQL Cluster CGE (72 items)">MySQL Cluster CGE</a>
<a href="./../../mysql-cluster-manager/index.html" class="tag-cloud-link tag-link-74 tag-link-position-27" style="font-size: 12.607594936709pt;" aria-label="MySQL Cluster Manager (19 items)">MySQL Cluster Manager</a>
<a href="./../../mysql-enterprise-monitor/index.html" class="tag-cloud-link tag-link-76 tag-link-position-28" style="font-size: 9.0632911392405pt;" aria-label="MySQL Enterprise Monitor (7 items)">MySQL Enterprise Monitor</a>
<a href="./../../mysql-fabric-2/index.html" class="tag-cloud-link tag-link-132 tag-link-position-29" style="font-size: 9.0632911392405pt;" aria-label="mysql fabric (7 items)">mysql fabric</a>
<a href="./../../mysql-replication/index.html" class="tag-cloud-link tag-link-149 tag-link-position-30" style="font-size: 15.354430379747pt;" aria-label="MySQL Replication (40 items)">MySQL Replication</a>
<a href="./../../mysql-utilities/index.html" class="tag-cloud-link tag-link-78 tag-link-position-31" style="font-size: 8pt;" aria-label="MySQL Utilities (5 items)">MySQL Utilities</a>
<a href="./../../ndb-api/index.html" class="tag-cloud-link tag-link-80 tag-link-position-32" style="font-size: 10.303797468354pt;" aria-label="NDB API (10 items)">NDB API</a>
<a href="./../../node-js/index.html" class="tag-cloud-link tag-link-83 tag-link-position-33" style="font-size: 10.303797468354pt;" aria-label="node.js (10 items)">node.js</a>
<a href="./../../nosql/index.html" class="tag-cloud-link tag-link-84 tag-link-position-34" style="font-size: 12.784810126582pt;" aria-label="NoSQL (20 items)">NoSQL</a>
<a href="./../../performance/index.html" class="tag-cloud-link tag-link-97 tag-link-position-35" style="font-size: 9.9493670886076pt;" aria-label="Performance (9 items)">Performance</a>
<a href="./../../realm/index.html" class="tag-cloud-link tag-link-213 tag-link-position-36" style="font-size: 11.721518987342pt;" aria-label="Realm (15 items)">Realm</a>
<a href="./../../replication/index.html" class="tag-cloud-link tag-link-104 tag-link-position-37" style="font-size: 10.924050632911pt;" aria-label="Replication (12 items)">Replication</a>
<a href="./../../secondary/index.html" class="tag-cloud-link tag-link-138 tag-link-position-38" style="font-size: 11.278481012658pt;" aria-label="secondary (13 items)">secondary</a>
<a href="./../../serverless/index.html" class="tag-cloud-link tag-link-208 tag-link-position-39" style="font-size: 8.620253164557pt;" aria-label="serverless (6 items)">serverless</a>
<a href="./../../sharding/index.html" class="tag-cloud-link tag-link-129 tag-link-position-40" style="font-size: 8pt;" aria-label="sharding (5 items)">sharding</a>
<a href="./../../swift/index.html" class="tag-cloud-link tag-link-216 tag-link-position-41" style="font-size: 10.303797468354pt;" aria-label="Swift (10 items)">Swift</a>
<a href="./../../swiftui/index.html" class="tag-cloud-link tag-link-217 tag-link-position-42" style="font-size: 10.303797468354pt;" aria-label="SwiftUI (10 items)">SwiftUI</a>
<a href="./../../webcast/index.html" class="tag-cloud-link tag-link-124 tag-link-position-43" style="font-size: 8pt;" aria-label="Webcast (5 items)">Webcast</a>
<a href="./../../webinar/index.html" class="tag-cloud-link tag-link-125 tag-link-position-44" style="font-size: 12.430379746835pt;" aria-label="webinar (18 items)">webinar</a>
<a href="./../../windows/index.html" class="tag-cloud-link tag-link-127 tag-link-position-45" style="font-size: 9.0632911392405pt;" aria-label="Windows (7 items)">Windows</a>
</div>
</li>
<li id="theme_socialmedia-2" class="widget theme_socialmedia">			<div class="widget-social-icons">
				
			<a href="http://twitter.com/andrewmorgan"><img src="./../../../wp-content/themes/zeesynergie/images/icons/twitter.png" alt="twitter"></a><a href="http://www.facebook.com/andrewjamesmorgan"><img src="./../../../wp-content/themes/zeesynergie/images/icons/facebook.png" alt="facebook"></a><a href="https://plus.google.com/u/0/100605473697871424413/posts"><img src="./../../../wp-content/themes/zeesynergie/images/icons/googleplus.png" alt="googleplus"></a><a href="http://www.linkedin.com/profile/view?id=16709956"><img src="./../../../wp-content/themes/zeesynergie/images/icons/linkedin.png" alt="linkedin"></a><a href="http://www.flickr.com/photos/andrewjamesmorgan/"><img src="./../../../wp-content/themes/zeesynergie/images/icons/flickr.png" alt="flickr"></a><a href="http://www.youtube.com/channel/UCodtDakJ4VdeSCzS3P3rIsw"><img src="./../../../wp-content/themes/zeesynergie/images/icons/youtube.png" alt="youtube"></a>			</div>
		</li>
<li id="archives-2" class="widget widget_archive">
<h2 class="widgettitle">Archives</h2>

			<ul>
					<li><a href="./../../../2022/03/index.html">March 2022</a></li>
	<li><a href="./../../../2022/02/index.html">February 2022</a></li>
	<li><a href="./../../../2022/01/index.html">January 2022</a></li>
	<li><a href="./../../../2021/12/index.html">December 2021</a></li>
	<li><a href="./../../../2021/11/index.html">November 2021</a></li>
	<li><a href="./../../../2021/09/index.html">September 2021</a></li>
	<li><a href="./../../../2021/08/index.html">August 2021</a></li>
	<li><a href="./../../../2021/07/index.html">July 2021</a></li>
	<li><a href="./../../../2021/06/index.html">June 2021</a></li>
	<li><a href="./../../../2021/05/index.html">May 2021</a></li>
	<li><a href="./../../../2021/04/index.html">April 2021</a></li>
	<li><a href="./../../../2021/02/index.html">February 2021</a></li>
	<li><a href="./../../../2021/01/index.html">January 2021</a></li>
	<li><a href="./../../../2020/12/index.html">December 2020</a></li>
	<li><a href="./../../../2019/03/index.html">March 2019</a></li>
	<li><a href="./../../../2019/01/index.html">January 2019</a></li>
	<li><a href="./../../../2018/12/index.html">December 2018</a></li>
	<li><a href="./../../../2018/11/index.html">November 2018</a></li>
	<li><a href="./../../../2018/10/index.html">October 2018</a></li>
	<li><a href="./../../../2018/09/index.html">September 2018</a></li>
	<li><a href="./../../../2017/09/index.html">September 2017</a></li>
	<li><a href="./../../../2017/03/index.html">March 2017</a></li>
	<li><a href="./../../../2017/02/index.html">February 2017</a></li>
	<li><a href="./../../../2017/01/index.html">January 2017</a></li>
	<li><a href="./../../../2016/12/index.html">December 2016</a></li>
	<li><a href="./../../../2016/11/index.html">November 2016</a></li>
	<li><a href="./../../../2016/09/index.html">September 2016</a></li>
	<li><a href="./../../../2016/01/index.html">January 2016</a></li>
	<li><a href="./../../../2015/11/index.html">November 2015</a></li>
	<li><a href="./../../../2015/10/index.html">October 2015</a></li>
	<li><a href="./../../../2015/09/index.html">September 2015</a></li>
	<li><a href="./../../../2015/06/index.html">June 2015</a></li>
	<li><a href="./../../../2015/04/index.html">April 2015</a></li>
	<li><a href="./../../../2015/03/index.html">March 2015</a></li>
	<li><a href="./../../../2015/02/index.html">February 2015</a></li>
	<li><a href="./../../../2015/01/index.html">January 2015</a></li>
	<li><a href="./../../../2014/12/index.html">December 2014</a></li>
	<li><a href="./../../../2014/11/index.html">November 2014</a></li>
	<li><a href="./../../../2014/10/index.html">October 2014</a></li>
	<li><a href="./../../../2014/09/index.html">September 2014</a></li>
	<li><a href="./../../../2014/08/index.html">August 2014</a></li>
	<li><a href="./../../../2014/07/index.html">July 2014</a></li>
	<li><a href="./../../../2014/06/index.html">June 2014</a></li>
	<li><a href="./../../../2014/05/index.html">May 2014</a></li>
	<li><a href="./../../../2014/04/index.html">April 2014</a></li>
	<li><a href="./../../../2014/03/index.html">March 2014</a></li>
	<li><a href="./../../../2014/02/index.html">February 2014</a></li>
	<li><a href="./../../../2014/01/index.html">January 2014</a></li>
	<li><a href="./../../../2013/12/index.html">December 2013</a></li>
	<li><a href="./../../../2013/11/index.html">November 2013</a></li>
	<li><a href="./../../../2013/09/index.html">September 2013</a></li>
	<li><a href="./../../../2013/08/index.html">August 2013</a></li>
	<li><a href="./../../../2013/07/index.html">July 2013</a></li>
	<li><a href="./../../../2013/06/index.html">June 2013</a></li>
	<li><a href="./../../../2013/05/index.html">May 2013</a></li>
	<li><a href="./../../../2013/03/index.html">March 2013</a></li>
	<li><a href="./../../../2013/02/index.html">February 2013</a></li>
	<li><a href="./../../../2013/01/index.html">January 2013</a></li>
	<li><a href="./../../../2012/12/index.html">December 2012</a></li>
	<li><a href="./../../../2012/11/index.html">November 2012</a></li>
	<li><a href="./../../../2012/09/index.html">September 2012</a></li>
	<li><a href="./../../../2012/07/index.html">July 2012</a></li>
	<li><a href="./../../../2012/06/index.html">June 2012</a></li>
	<li><a href="./../../../2012/05/index.html">May 2012</a></li>
	<li><a href="./../../../2012/04/index.html">April 2012</a></li>
	<li><a href="./../../../2012/03/index.html">March 2012</a></li>
	<li><a href="./../../../2012/02/index.html">February 2012</a></li>
	<li><a href="./../../../2012/01/index.html">January 2012</a></li>
	<li><a href="./../../../2011/12/index.html">December 2011</a></li>
	<li><a href="./../../../2011/11/index.html">November 2011</a></li>
	<li><a href="./../../../2011/10/index.html">October 2011</a></li>
	<li><a href="./../../../2011/09/index.html">September 2011</a></li>
	<li><a href="./../../../2011/07/index.html">July 2011</a></li>
	<li><a href="./../../../2011/06/index.html">June 2011</a></li>
	<li><a href="./../../../2011/05/index.html">May 2011</a></li>
	<li><a href="./../../../2011/04/index.html">April 2011</a></li>
	<li><a href="./../../../2011/03/index.html">March 2011</a></li>
	<li><a href="./../../../2011/02/index.html">February 2011</a></li>
	<li><a href="./../../../2011/01/index.html">January 2011</a></li>
	<li><a href="./../../../2010/12/index.html">December 2010</a></li>
	<li><a href="./../../../2010/11/index.html">November 2010</a></li>
	<li><a href="./../../../2010/10/index.html">October 2010</a></li>
	<li><a href="./../../../2010/09/index.html">September 2010</a></li>
	<li><a href="./../../../2010/08/index.html">August 2010</a></li>
	<li><a href="./../../../2010/07/index.html">July 2010</a></li>
	<li><a href="./../../../2010/06/index.html">June 2010</a></li>
	<li><a href="./../../../2010/05/index.html">May 2010</a></li>
	<li><a href="./../../../2010/04/index.html">April 2010</a></li>
	<li><a href="./../../../2010/03/index.html">March 2010</a></li>
	<li><a href="./../../../2010/02/index.html">February 2010</a></li>
	<li><a href="./../../../2010/01/index.html">January 2010</a></li>
	<li><a href="./../../../2009/12/index.html">December 2009</a></li>
	<li><a href="./../../../2009/11/index.html">November 2009</a></li>
	<li><a href="./../../../2009/10/index.html">October 2009</a></li>
	<li><a href="./../../../2009/09/index.html">September 2009</a></li>
	<li><a href="./../../../2009/08/index.html">August 2009</a></li>
	<li><a href="./../../../2009/07/index.html">July 2009</a></li>
	<li><a href="./../../../2009/06/index.html">June 2009</a></li>
	<li><a href="./../../../2009/05/index.html">May 2009</a></li>
	<li><a href="./../../../2009/04/index.html">April 2009</a></li>
			</ul>

			</li>
	
	</ul>
</div>	
	
	
	<div id="footer">
		<div id="foot">
			Supported by <a href="http://www.thievesgarden.co.uk/" title="Maidenhead Accommodation - self catering apartment to rent" target="Thieves Garden">Thieves Garden - Maidenhead self catering apartment</a> and <a href="http://www.oleronvilla.com/" title="Ile d'Oleron Holiday Home to rent" target="Oleron Villa">Oleron Villa holiday home on Ile d'Oleron</a>.			<div class="credit_link">	<a href="http://themezee.com/">Theme by ThemeZee</a>
</div>
			<div class="clear"></div>
		</div>
	</div>

	<!-- Powered by WPtouch: 4.3.39 --><link rel="stylesheet" id="mediaelement-css" href="./../../../wp-includes/js/mediaelement/mediaelementplayer-legacy.min.css?ver=4.2.17" type="text/css" media="all">
<link rel="stylesheet" id="wp-mediaelement-css" href="./../../../wp-includes/js/mediaelement/wp-mediaelement.min.css?ver=81fb77f64976ac32efe42aab69fdb5e4" type="text/css" media="all">
<script type="text/javascript" id="mediaelement-core-js-before">
/* <![CDATA[ */
var mejsL10n = {"language":"en","strings":{"mejs.download-file":"Download File","mejs.install-flash":"You are using a browser that does not have Flash player enabled or installed. Please turn on your Flash player plugin or download the latest version from https:\/\/get.adobe.com\/flashplayer\/","mejs.fullscreen":"Fullscreen","mejs.play":"Play","mejs.pause":"Pause","mejs.time-slider":"Time Slider","mejs.time-help-text":"Use Left\/Right Arrow keys to advance one second, Up\/Down arrows to advance ten seconds.","mejs.live-broadcast":"Live Broadcast","mejs.volume-help-text":"Use Up\/Down Arrow keys to increase or decrease volume.","mejs.unmute":"Unmute","mejs.mute":"Mute","mejs.volume-slider":"Volume Slider","mejs.video-player":"Video Player","mejs.audio-player":"Audio Player","mejs.captions-subtitles":"Captions\/Subtitles","mejs.captions-chapters":"Chapters","mejs.none":"None","mejs.afrikaans":"Afrikaans","mejs.albanian":"Albanian","mejs.arabic":"Arabic","mejs.belarusian":"Belarusian","mejs.bulgarian":"Bulgarian","mejs.catalan":"Catalan","mejs.chinese":"Chinese","mejs.chinese-simplified":"Chinese (Simplified)","mejs.chinese-traditional":"Chinese (Traditional)","mejs.croatian":"Croatian","mejs.czech":"Czech","mejs.danish":"Danish","mejs.dutch":"Dutch","mejs.english":"English","mejs.estonian":"Estonian","mejs.filipino":"Filipino","mejs.finnish":"Finnish","mejs.french":"French","mejs.galician":"Galician","mejs.german":"German","mejs.greek":"Greek","mejs.haitian-creole":"Haitian Creole","mejs.hebrew":"Hebrew","mejs.hindi":"Hindi","mejs.hungarian":"Hungarian","mejs.icelandic":"Icelandic","mejs.indonesian":"Indonesian","mejs.irish":"Irish","mejs.italian":"Italian","mejs.japanese":"Japanese","mejs.korean":"Korean","mejs.latvian":"Latvian","mejs.lithuanian":"Lithuanian","mejs.macedonian":"Macedonian","mejs.malay":"Malay","mejs.maltese":"Maltese","mejs.norwegian":"Norwegian","mejs.persian":"Persian","mejs.polish":"Polish","mejs.portuguese":"Portuguese","mejs.romanian":"Romanian","mejs.russian":"Russian","mejs.serbian":"Serbian","mejs.slovak":"Slovak","mejs.slovenian":"Slovenian","mejs.spanish":"Spanish","mejs.swahili":"Swahili","mejs.swedish":"Swedish","mejs.tagalog":"Tagalog","mejs.thai":"Thai","mejs.turkish":"Turkish","mejs.ukrainian":"Ukrainian","mejs.vietnamese":"Vietnamese","mejs.welsh":"Welsh","mejs.yiddish":"Yiddish"}};
/* ]]> */
</script>
<script type="text/javascript" src="./../../../wp-includes/js/mediaelement/mediaelement-and-player.min.js?ver=4.2.17" id="mediaelement-core-js"></script>
<script type="text/javascript" src="./../../../wp-includes/js/mediaelement/mediaelement-migrate.min.js?ver=81fb77f64976ac32efe42aab69fdb5e4" id="mediaelement-migrate-js"></script>
<script type="text/javascript" id="mediaelement-js-extra">
/* <![CDATA[ */
var _wpmejsSettings = {"pluginPath":"\/wp-includes\/js\/mediaelement\/","classPrefix":"mejs-","stretching":"responsive","audioShortcodeLibrary":"mediaelement","videoShortcodeLibrary":"mediaelement"};
/* ]]> */
</script>
<script type="text/javascript" src="./../../../wp-includes/js/mediaelement/wp-mediaelement.min.js?ver=81fb77f64976ac32efe42aab69fdb5e4" id="wp-mediaelement-js"></script>
<script type="text/javascript" src="./../../../wp-includes/js/mediaelement/renderers/vimeo.min.js?ver=4.2.17" id="mediaelement-vimeo-js"></script>

</html>